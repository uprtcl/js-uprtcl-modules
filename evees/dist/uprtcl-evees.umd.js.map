{"version":3,"file":"uprtcl-evees.umd.js","sources":["../src/bindings.ts","../src/utils/cid-hash.ts","../src/utils/signed.ts","../src/graphql/queries.ts","../src/graphql/evees.helpers.ts","../src/services/evees.ts","../src/patterns/perspective.pattern.ts","../src/patterns/commit.pattern.ts","../src/elements/evees-commit-history.ts","../src/graphql/schema.ts","../src/services/evees.workspace.ts","../src/graphql/resolvers.ts","../src/elements/support.ts","../src/elements/evees-perspectives-list.ts","../src/elements/evees-info-popper.ts","../src/types.ts","../src/elements/evees-diff.ts","../src/elements/events.ts","../src/elements/evees-info-base.ts","../src/elements/evees-info-page.ts","../src/merge/common-ancestor.ts","../src/merge/diff.utils.ts","../src/merge/utils.ts","../src/merge/simple.merge-strategy.ts","../src/merge/recursive-context.merge-strategy.ts","../src/elements/blockies.js","../src/elements/evees-author.ts","../src/elements/evees-proposals-list.ts","../src/elements/evees-proposal-diff.ts","../src/elements/evees-login.ts","../src/elements/evees-proposal-row.ts","../src/elements/evees-info-user-based.ts","../src/evees.module.ts","../src/evees-content.module.ts","../src/services/providers/local/evees.db.ts","../src/services/providers/local/evees.drafts.local.ts","../src/elements/evees-perspective-icon.ts","../src/utils/ancestor.ts"],"sourcesContent":["export const EveesBindings = {\n  PerspectiveType: 'Perspective',\n  CommitType: 'Commit',\n  EveesRemote: 'evees-remote',\n  MergeStrategy: 'merge-strategy',\n  Evees: 'evees',\n  Config: 'evees-config',\n  Remote: 'remote'\n};\n","import multihashing from 'multihashing-async';\nimport CBOR from 'cbor-js';\nimport CID from 'cids';\nimport { Signed, Entity } from '@uprtcl/cortex';\nimport { sortObject } from '@uprtcl/ipfs-provider';\nimport { CidConfig, defaultCidConfig } from '@uprtcl/multiplatform';\n\nexport async function hashObject(\n  object: object,\n  config: CidConfig = defaultCidConfig\n): Promise<string> {\n  const sorted = sortObject(object);\n  const buffer = CBOR.encode(sorted);\n  const encoded = await multihashing(buffer, config.type);\n\n  const cid = new CID(config.version, config.codec, encoded, config.base);\n\n  return cid.toString();\n}\n\nexport type Secured<T> = Entity<Signed<T>>;\n\nexport async function deriveEntity<O extends object>(\n  object: O,\n  config: CidConfig = defaultCidConfig\n): Promise<Entity<O>> {\n  const hash = await hashObject(object, config);\n  return {\n    id: hash,\n    object,\n    casID: undefined,\n  };\n}\n","import { Signed, Entity } from '@uprtcl/cortex';\nimport { CidConfig, defaultCidConfig, CASSource } from '@uprtcl/multiplatform';\nimport { deriveEntity, Secured } from './cid-hash';\n\nexport function signObject<T>(object: T): Signed<T> {\n  return {\n    proof: {\n      signature: '',\n      type: '',\n    },\n    payload: object,\n  };\n}\n\nexport function extractSignedEntity(object: object): any | undefined {\n  if (!(object.hasOwnProperty('id') && object.hasOwnProperty('object'))) return undefined;\n\n  const entity = (object as Entity<any>).object;\n  if (!(entity.hasOwnProperty('proof') && entity.hasOwnProperty('payload'))) return undefined;\n\n  return entity.payload;\n}\n\nexport async function deriveSecured<O>(\n  object: O,\n  config: CidConfig = defaultCidConfig\n): Promise<Secured<O>> {\n  const signed = signObject(object);\n  return deriveEntity(signed, config);\n}\n","import { gql } from 'apollo-boost';\nimport { DocumentNode } from 'graphql';\n\nexport const UPDATE_HEAD: DocumentNode = gql`\n  mutation UpdatePerspectiveHead(\n    $perspectiveId: ID!\n    $headId: ID\n    $context: String\n    $name: String\n  ) {\n    updatePerspectiveHead(\n      perspectiveId: $perspectiveId\n      headId: $headId\n      context: $context\n      name: $name\n    ) {\n      id\n      head {\n        id\n        data {\n          id\n        }\n      }\n      context {\n        id\n      }\n      name\n      payload {\n        remote\n      }\n      _context {\n        content {\n          id\n        }\n      }\n    }\n  }\n`;\n\nexport const DELETE_PERSPECTIVE: DocumentNode = gql`\n  mutation DeletePerspective($perspectiveId: ID!) {\n    deletePerspective(perspectiveId: $perspectiveId) {\n      id\n    }\n  }\n`;\n\nexport const CREATE_ENTITY: DocumentNode = gql`\n  mutation CreateEntity($id: String, $object: JSON!, $casID: ID) {\n    createEntity(id: $id, object: $object, casID: $casID) {\n      id\n    }\n  }\n`;\n\nexport const CREATE_PERSPECTIVE: DocumentNode = gql`\n  mutation CreatePerspective(\n    $remote: String!\n    $path: String\n    $creatorId: String\n    $timestamp: Date\n    $headId: ID\n    $context: String\n    $name: String\n    $canWrite: String\n    $parentId: String\n    $fromPerspectiveId: String\n    $fromHeadId: String\n  ) {\n    createPerspective(\n      remote: $remote\n      path: $path\n      creatorId: $creatorId\n      timestamp: $timestamp\n      headId: $headId\n      context: $context\n      name: $name\n      canWrite: $canWrite\n      parentId: $parentId\n      fromPerspectiveId: $fromPerspectiveId\n      fromHeadId: $fromHeadId\n    ) {\n      id\n      name\n      head {\n        id\n        data {\n          id\n        }\n      }\n      payload {\n        creatorId\n        remote\n        path\n        timestamp\n        context {\n          id\n          perspectives {\n            id\n          }\n        }\n        fromPerspectiveId\n        fromHeadId\n      }\n    }\n  }\n`;\n\nexport const FORK_PERSPECTIVE: DocumentNode = gql`\n  mutation ForkPerspective(\n    $perspectiveId: String\n    $remote: String\n    $parentId: String\n    $name: String\n  ) {\n    forkPerspective(\n      perspectiveId: $perspectiveId\n      remote: $remote\n      parentId: $parentId\n      name: $name\n    ) {\n      id\n      head {\n        id\n      }\n      context {\n        id\n        perspectives {\n          id\n        }\n      }\n      name\n      payload {\n        path\n        remote\n        creatorId\n        timestamp\n      }\n    }\n  }\n`;\n\nexport const CREATE_PROPOSAL: DocumentNode = gql`\n  mutation AddProposal(\n    $toPerspectiveId: ID!\n    $fromPerspectiveId: ID!\n    $toHeadId: ID\n    $fromHeadId: ID\n    $newPerspectives: [NewPerspectiveInput]!\n    $updates: [HeadUpdateInput!]\n  ) {\n    addProposal(\n      toPerspectiveId: $toPerspectiveId\n      fromPerspectiveId: $fromPerspectiveId\n      toHeadId: $toHeadId\n      fromHeadId: $fromHeadId\n      newPerspectives: $newPerspectives\n      updates: $updates\n    ) {\n      id\n      toPerspective {\n        id\n        proposals\n      }\n      fromPerspective {\n        id\n      }\n      updates\n      newPerspectives\n    }\n  }\n`;\n\nexport const EXECUTE_PROPOSAL: DocumentNode = gql`\n  mutation ExecuteProposal($proposalId: ID!, $perspectiveId: ID!) {\n    executeProposal(proposalId: $proposalId, perspectiveId: $perspectiveId) {\n      id\n      toPerspective {\n        id\n        head {\n          id\n          data {\n            id\n          }\n        }\n      }\n    }\n  }\n`;\n\nexport const GET_PERSPECTIVE_CONTEXTS = (perspectiveId: string) => {\n  return gql`{\n    entity(uref: \"${perspectiveId}\") {\n      id\n      ... on Perspective {\n        payload {\n          context {\n            id\n            perspectives {\n              id\n            } \n          }\n        }\n      }\n    }\n  }`;\n};\n","import { ApolloClient, gql } from 'apollo-boost';\nimport { cloneDeep } from 'lodash-es';\n\nimport { CASStore, loadEntity } from '@uprtcl/multiplatform';\nimport { Signed, Entity, PatternRecognizer, HasChildren } from '@uprtcl/cortex';\n\nimport { CREATE_ENTITY, CREATE_PERSPECTIVE, UPDATE_HEAD } from './queries';\nimport { EveesRemote } from '../services/evees.remote';\nimport { Commit, EveesConfig, Perspective } from '../types';\nimport { deriveSecured, signObject } from '../utils/signed';\nimport { EveesBindings } from '../bindings';\nimport { hashObject, Secured } from '../utils/cid-hash';\n\nexport interface CreateCommit {\n  dataId: string;\n  parentsIds?: string[];\n  creatorsIds?: string[];\n  message?: string;\n  timestamp?: number;\n}\n\nexport interface CreatePerspective {\n  headId?: string;\n  parentId?: string;\n  context?: string;\n  name?: string;\n  canWrite?: string;\n  timestamp?: number;\n  creatorId?: string;\n}\n\nexport class EveesHelpers {\n  static async getPerspectiveHeadId(\n    client: ApolloClient<any>,\n    perspectiveId: string\n  ): Promise<string | undefined> {\n    if (!perspectiveId) throw new Error('PerspectiveId undefined');\n\n    const result = await client.query({\n      query: gql`\n        {\n          entity(uref: \"${perspectiveId}\") {\n            id\n            ... on Perspective {\n              head {\n                id\n              }\n            }\n          }\n        }`\n    });\n    if (result.data.entity.head === undefined || result.data.entity.head == null) return undefined;\n    return result.data.entity.head.id;\n  }\n\n  static async canWrite(client: ApolloClient<any>, perspectiveId: string): Promise<boolean> {\n    const result = await client.query({\n      query: gql`\n        {\n          entity(uref: \"${perspectiveId}\") {\n            id\n            ... on Perspective {\n              canWrite\n            }\n          }\n        }`\n    });\n    if (result.data.entity.canWrite === undefined || result.data.entity.canWrite == null)\n      return false;\n    return result.data.entity.canWrite;\n  }\n\n  static async getPerspectiveRemoteId(\n    client: ApolloClient<any>,\n    perspectiveId: string\n  ): Promise<string> {\n    const perspective = await loadEntity<Signed<Perspective>>(client, perspectiveId);\n    if (!perspective) throw new Error('perspective not found');\n    return perspective.object.payload.remote;\n  }\n\n  static async getPerspectiveDataId(\n    client: ApolloClient<any>,\n    perspectiveId: string\n  ): Promise<string | undefined> {\n    const headId = await this.getPerspectiveHeadId(client, perspectiveId);\n    if (headId === undefined) return undefined;\n    return this.getCommitDataId(client, headId);\n  }\n\n  static async getPerspectiveData(\n    client: ApolloClient<any>,\n    perspectiveId: string\n  ): Promise<Entity<any> | undefined> {\n    const headId = await this.getPerspectiveHeadId(client, perspectiveId);\n    if (headId === undefined) return undefined;\n    return this.getCommitData(client, headId);\n  }\n\n  static async getCommitData(client: ApolloClient<any>, commitId: string): Promise<Entity<any>> {\n    const dataId = await this.getCommitDataId(client, commitId);\n    const data = await loadEntity<any>(client, dataId);\n    if (!data) throw new Error('data not found');\n    /** make sure users of loadEntity wont mess the cache by reference */\n    return cloneDeep(data);\n  }\n\n  static async getCommitDataId(client: ApolloClient<any>, commitId: string): Promise<string> {\n    const commit = await loadEntity<Signed<Commit>>(client, commitId);\n    if (!commit) throw new Error('commit not found');\n    return commit.object.payload.dataId;\n  }\n\n  static async getData(client: ApolloClient<any>, recognizer: PatternRecognizer, uref: string) {\n    const entity = await loadEntity<any>(client, uref);\n    if (!entity) return undefined;\n\n    let entityType: string = recognizer.recognizeType(entity);\n\n    switch (entityType) {\n      case EveesBindings.PerspectiveType:\n        return this.getPerspectiveData(client, uref);\n\n      case EveesBindings.CommitType:\n        return this.getCommitData(client, uref);\n\n      default:\n        return entity;\n    }\n  }\n\n  static async getChildren(\n    client: ApolloClient<any>,\n    recognizer: PatternRecognizer,\n    uref: string\n  ): Promise<string[]> {\n    const data = await this.getData(client, recognizer, uref);\n\n    const hasChildren: HasChildren = recognizer\n      .recognizeBehaviours(data)\n      .find(b => (b as HasChildren).getChildrenLinks);\n\n    return hasChildren.getChildrenLinks(data);\n  }\n\n  static async getDescendantsRec(\n    client: ApolloClient<any>,\n    recognizer: PatternRecognizer,\n    uref: string,\n    current: string[]\n  ): Promise<string[]> {\n    const newDescendants: string[] = [];\n    const children = await this.getChildren(client, recognizer, uref);\n    for (let ix = 0; ix < children.length; ix++) {\n      const child = children[ix];\n      const thisDescendants = await this.getDescendantsRec(client, recognizer, child, []);\n      newDescendants.push(child);\n      newDescendants.push(...thisDescendants);\n    }\n    return current.concat(newDescendants);\n  }\n\n  static async getDescendants(\n    client: ApolloClient<any>,\n    recognizer: PatternRecognizer,\n    uref: string\n  ): Promise<string[]> {\n    return this.getDescendantsRec(client, recognizer, uref, []);\n  }\n\n  // Creators\n  static async createEntity(client: ApolloClient<any>, store: CASStore, object: any) {\n    const create = await client.mutate({\n      mutation: CREATE_ENTITY,\n      variables: {\n        object: object,\n        casID: store.casID\n      }\n    });\n\n    return create.data.createEntity.id;\n  }\n\n  static async createCommit(client: ApolloClient<any>, store: CASStore, commit: CreateCommit) {\n    const message = commit.message !== undefined ? commit.message : '';\n    const timestamp = commit.timestamp !== undefined ? commit.timestamp : Date.now();\n    const creatorsIds = commit.creatorsIds !== undefined ? commit.creatorsIds : [];\n    const parentsIds = commit.parentsIds !== undefined ? commit.parentsIds : [];\n\n    const commitData: Commit = {\n      creatorsIds: creatorsIds,\n      dataId: commit.dataId,\n      message: message,\n      timestamp: timestamp,\n      parentsIds: parentsIds\n    };\n\n    const commitObject = signObject(commitData);\n\n    const create = await client.mutate({\n      mutation: CREATE_ENTITY,\n      variables: {\n        object: commitObject,\n        casID: store.casID\n      }\n    });\n\n    return create.data.createEntity.id;\n  }\n\n  static async createPerspective(\n    client: ApolloClient<any>,\n    remote: EveesRemote,\n    perspective: CreatePerspective\n  ) {\n    const createPerspective = await client.mutate({\n      mutation: CREATE_PERSPECTIVE,\n      variables: {\n        remote: remote.id,\n        casID: remote.store.casID,\n        ...perspective\n      }\n    });\n\n    return createPerspective.data.createPerspective.id;\n  }\n\n  static async updateHead(client: ApolloClient<any>, perspectiveId: string, headId: string) {\n    await client.mutate({\n      mutation: UPDATE_HEAD,\n      variables: {\n        perspectiveId,\n        headId\n      }\n    });\n\n    return headId;\n  }\n\n  static async isAncestorCommit(\n    client: ApolloClient<any>,\n    perspectiveId: string,\n    commitId: string,\n    stopAt?: string\n  ) {\n    const headId = await this.getPerspectiveHeadId(client, perspectiveId);\n    if (headId === undefined) return false;\n    const findAncestor = new FindAncestor(client, commitId, stopAt);\n    return findAncestor.checkIfParent(headId);\n  }\n\n  static async checkEmit(\n    config: EveesConfig,\n    client: ApolloClient<any>,\n    eveesRemotes: EveesRemote[],\n    perspectiveId: string\n  ): Promise<boolean> {\n    if (config.emitIf === undefined) return false;\n\n    const remoteId = await EveesHelpers.getPerspectiveRemoteId(client, perspectiveId);\n    const toRemote = eveesRemotes.find(r => r.id === remoteId);\n    if (!toRemote) throw new Error(`remote not found for ${remoteId}`);\n\n    if (remoteId === config.emitIf.remote) {\n      const owner = await (toRemote.accessControl as any).getOwner(perspectiveId);\n      return owner.toLocaleLowerCase() === config.emitIf.owner.toLocaleLowerCase();\n    }\n\n    return false;\n  }\n\n  static async snapDefaultPerspective(\n    remote: EveesRemote,\n    creatorId?: string,\n    context?: string,\n    timestamp?: number,\n    path?: string,\n    fromPerspectiveId?: string,\n    fromHeadId?: string\n  ) {\n    creatorId = creatorId ? creatorId : remote.userId ? remote.userId : '';\n    timestamp = timestamp ? timestamp : Date.now();\n\n    const defaultContext = await hashObject({\n      creatorId,\n      timestamp\n    });\n\n    context = context || defaultContext;\n\n    const object: Perspective = {\n      creatorId,\n      remote: remote.id,\n      path: path !== undefined ? path : remote.defaultPath,\n      timestamp,\n      context\n    };\n\n    if (fromPerspectiveId) object.fromPerspectiveId = fromPerspectiveId;\n    if (fromHeadId) object.fromHeadId = fromHeadId;\n\n    const perspective = await deriveSecured<Perspective>(object, remote.store.cidConfig);\n    perspective.casID = remote.store.casID;\n    return perspective;\n  }\n\n  static async getHome(remote: EveesRemote, userId?: string): Promise<Secured<Perspective>> {\n    const creatorId = userId === undefined ? 'root' : userId;\n    const remoteHome = {\n      remote: remote.id,\n      path: '',\n      creatorId,\n      timestamp: 0,\n      context: `${creatorId}.home`\n    };\n\n    return deriveSecured(remoteHome, remote.store.cidConfig);\n  }\n}\n\nexport class FindAncestor {\n  done: boolean = false;\n\n  constructor(\n    protected client: ApolloClient<any>,\n    protected lookingFor: string,\n    protected stopAt?: string\n  ) {}\n\n  async checkIfParent(commitId: string) {\n    /* stop searching all paths once one path finds it */\n    if (this.done) {\n      return false;\n    }\n\n    if (this.lookingFor === commitId) {\n      this.done = true;\n      return true;\n    }\n\n    if (this.stopAt !== undefined) {\n      if (this.stopAt === commitId) {\n        this.done = true;\n        return false;\n      }\n    }\n\n    const commit = await loadEntity<Signed<Commit>>(this.client, commitId);\n    if (!commit) throw new Error(`commit ${commitId} not found`);\n\n    if (commit.object.payload.parentsIds.length === 0) {\n      return false;\n    }\n\n    const seeParents = await Promise.all(\n      commit.object.payload.parentsIds.map(parentId => {\n        /* recursively look on parents */\n        return this.checkIfParent(parentId);\n      })\n    );\n\n    return seeParents.includes(true);\n  }\n}\n","import { ApolloClient, gql } from 'apollo-boost';\nimport { multiInject, injectable, inject } from 'inversify';\n\nimport { PatternRecognizer, HasChildren, CortexModule, Signed } from '@uprtcl/cortex';\nimport { loadEntity } from '@uprtcl/multiplatform';\nimport { Logger } from '@uprtcl/micro-orchestrator';\nimport { ApolloClientModule } from '@uprtcl/graphql';\n\nimport { Perspective, Commit, EveesConfig } from '../types';\nimport { EveesBindings } from '../bindings';\nimport { EveesRemote } from './evees.remote';\nimport { Secured, deriveEntity } from '../utils/cid-hash';\nimport { deriveSecured } from '../utils/signed';\nimport { EveesWorkspace } from './evees.workspace';\nimport { EveesHelpers } from '../graphql/evees.helpers';\n\n/**\n * Main service used to interact with _Prtcl compatible objects and providers\n */\n@injectable()\nexport class Evees {\n  logger = new Logger('evees');\n\n  constructor(\n    @inject(CortexModule.bindings.Recognizer)\n    protected recognizer: PatternRecognizer,\n    @multiInject(EveesBindings.EveesRemote)\n    protected eveesRemotes: EveesRemote[],\n    @inject(ApolloClientModule.bindings.Client)\n    protected client: ApolloClient<any>,\n    @inject(EveesBindings.Config)\n    protected config: EveesConfig\n  ) {}\n\n  /** Public functions */\n\n  public getRemote(remote: string | undefined): EveesRemote {\n    if (!remote && this.eveesRemotes.length === 1) return this.eveesRemotes[0];\n\n    const remoteInstance = this.eveesRemotes.find(instance => instance.id === remote);\n\n    if (!remoteInstance) throw new Error(`Remote ${remote}  is not registered`);\n\n    return remoteInstance;\n  }\n\n  /**\n   * Returns the uprtcl remote that controls the given perspective, from its remote\n   * @returns the uprtcl remote\n   */\n  public getPerspectiveProvider(perspective: Signed<Perspective>): EveesRemote {\n    return this.getRemote(perspective.payload.remote);\n  }\n\n  /**\n   * Returns the uprtcl remote that controls the given perspective, from its remote\n   * @returns the uprtcl remote\n   */\n  public async getPerspectiveRemoteById(perspectiveId: String): Promise<EveesRemote> {\n    const result = await this.client.query({\n      query: gql`\n        {\n          entity(uref: \"${perspectiveId}\") {\n            id\n            ... on Perspective {\n              payload {\n                remote\n              }\n            }\n          }\n        }\n      `\n    });\n\n    // TODO: this throws: cannot read property entity of null\n    const remote = result.data.entity.payload.remote;\n    return this.getRemote(remote);\n  }\n\n  public async isPerspective(id: string): Promise<boolean> {\n    const entity = await loadEntity(this.client, id);\n    if (entity === undefined) throw new Error('entity not found');\n    const type = this.recognizer.recognizeType(entity);\n    return type === 'Perspective';\n  }\n\n  async isPattern(id: string, type: string): Promise<boolean> {\n    const entity = await loadEntity(this.client, id);\n    if (entity === undefined) throw new Error('entity not found');\n    const recognizedType = this.recognizer.recognizeType(entity);\n    return type === recognizedType;\n  }\n\n  /**\n   * receives an entity id and compute the actions that will\n   * result on this entity being forked on a target remote\n   * with a target owner (canWrite).\n   *\n   * it also makes sure that all entities are clonned\n   * on the target remote default store.\n   *\n   * recursively fork entity children\n   */\n  public async fork(\n    id: string,\n    workspace: EveesWorkspace,\n    remote: string,\n    parentId?: string\n  ): Promise<string> {\n    const isPerspective = await this.isPattern(id, EveesBindings.PerspectiveType);\n    if (isPerspective) {\n      return this.forkPerspective(id, workspace, remote, parentId);\n    } else {\n      const isCommit = await this.isPattern(id, EveesBindings.CommitType);\n      if (isCommit) {\n        return this.forkCommit(id, workspace, remote, parentId);\n      } else {\n        return this.forkEntity(id, workspace, remote, parentId);\n      }\n    }\n  }\n\n  getEntityChildren(entity: object) {\n    let hasChildren: HasChildren | undefined = this.recognizer\n      .recognizeBehaviours(entity)\n      .find(prop => !!(prop as HasChildren).getChildrenLinks);\n\n    if (!hasChildren) {\n      return [];\n    } else {\n      return hasChildren.getChildrenLinks(entity);\n    }\n  }\n\n  replaceEntityChildren(entity: object, newLinks: string[]) {\n    let hasChildren: HasChildren | undefined = this.recognizer\n      .recognizeBehaviours(entity)\n      .find(prop => !!(prop as HasChildren).getChildrenLinks);\n\n    if (!hasChildren) {\n      throw new Error(`entity dont hasChildren ${JSON.stringify(entity)}`);\n    } else {\n      return hasChildren.replaceChildrenLinks(entity)(newLinks);\n    }\n  }\n\n  public async forkPerspective(\n    perspectiveId: string,\n    workspace: EveesWorkspace,\n    remote?: string,\n    parentId?: string,\n    name?: string\n  ): Promise<string> {\n    const eveesRemote =\n      remote !== undefined && remote !== null\n        ? this.getRemote(remote)\n        : (this.config.defaultRemote as EveesRemote);\n\n    const refPerspective = await loadEntity<Signed<Perspective>>(this.client, perspectiveId);\n    if (!refPerspective) throw new Error(`base perspective ${perspectiveId} not found`);\n\n    const headId = await EveesHelpers.getPerspectiveHeadId(this.client, perspectiveId);\n\n    const perspective = await eveesRemote.snapPerspective(\n      parentId,\n      refPerspective.object.payload.context,\n      undefined,\n      undefined,\n      perspectiveId,\n      headId\n    );\n\n    /* BUG-FIXED: this is needed so that the getOwner of the snapPerspective function has the parent object. \n       TODO: How to add the concept of workspaces to the fork process? how to snapPerspectives based on a workspace ? */\n    await EveesHelpers.createEntity(this.client, eveesRemote.store, perspective.object);\n\n    let forkCommitId: string | undefined = undefined;\n\n    if (headId !== undefined) {\n      forkCommitId = await this.forkCommit(\n        headId,\n        workspace,\n        eveesRemote.id,\n        perspective.id // this perspective is set as the parent of the children's new perspectives\n      );\n    }\n\n    workspace.newPerspective({\n      perspective,\n      details: { headId: forkCommitId, name },\n      parentId\n    });\n\n    return perspective.id;\n  }\n\n  public async forkCommit(\n    commitId: string,\n    workspace: EveesWorkspace,\n    remote: string,\n    parentId?: string\n  ): Promise<string> {\n    const commit: Secured<Commit> | undefined = await loadEntity(this.client, commitId);\n    if (!commit) throw new Error(`Could not find commit with id ${commitId}`);\n\n    const remoteInstance = this.getRemote(remote);\n\n    const dataId = commit.object.payload.dataId;\n    const dataForkId = await this.forkEntity(dataId, workspace, remote, parentId);\n\n    const eveesRemote = this.getRemote(remote);\n\n    /** build new head object pointing to new data */\n    const newCommit: Commit = {\n      creatorsIds: eveesRemote.userId ? [eveesRemote.userId] : [''],\n      dataId: dataForkId,\n      message: `autocommit to fork ${commitId} on remote ${remote}`,\n      forking: commitId,\n      parentsIds: [],\n      timestamp: Date.now()\n    };\n\n    const newHead: Secured<Commit> = await deriveSecured(newCommit, remoteInstance.store.cidConfig);\n    newHead.casID = remoteInstance.store.casID;\n    workspace.create(newHead);\n\n    return newHead.id;\n  }\n\n  public async forkEntity(\n    entityId: string,\n    workspace: EveesWorkspace,\n    remote: string,\n    parentId?: string\n  ): Promise<string> {\n    const data = await loadEntity(this.client, entityId);\n    if (!data) throw new Error(`data ${entityId} not found`);\n\n    /** createOwnerPreservingEntity of children */\n    const getLinksForks = this.getEntityChildren(data).map(link =>\n      this.fork(link, workspace, remote, parentId)\n    );\n    const newLinks = await Promise.all(getLinksForks);\n    const tempData = this.replaceEntityChildren(data, newLinks);\n\n    const remoteInstance = this.eveesRemotes.find(r => r.id === remote);\n    if (!remoteInstance)\n      throw new Error(`Could not find registered evees remote for remote with ID ${remote}`);\n\n    const newData = await deriveEntity(tempData.object, remoteInstance.store.cidConfig);\n\n    newData.casID = remoteInstance.store.casID;\n    workspace.create(newData);\n\n    return newData.id;\n  }\n}\n","import { ApolloClient, gql } from 'apollo-boost';\nimport { injectable, inject } from 'inversify';\n\nimport { Pattern, HasLinks, Entity, Signed } from '@uprtcl/cortex';\nimport { HasRedirect } from '@uprtcl/multiplatform';\nimport { ApolloClientModule } from '@uprtcl/graphql';\n\nimport { Perspective } from '../types';\nimport { EveesBindings } from '../bindings';\nimport { extractSignedEntity } from '../utils/signed';\n\nexport const propertyOrder = ['creatorId', 'path', 'remote', 'timestamp'];\n\nexport class PerspectivePattern extends Pattern<Entity<Signed<Perspective>>> {\n  recognize(entity: object) {\n    const object = extractSignedEntity(entity);\n\n    return object && propertyOrder.every((p) => object.hasOwnProperty(p));\n  }\n\n  type = EveesBindings.PerspectiveType;\n}\n\n@injectable()\nexport class PerspectiveLinks implements HasLinks, HasRedirect {\n  constructor(\n    @inject(ApolloClientModule.bindings.Client)\n    protected client: ApolloClient<any>\n  ) {}\n\n  links = async (perspective: Entity<Signed<Perspective>>) => {\n    const result = await this.client.query({\n      query: gql`{\n        entity(uref: \"${perspective.id}\") {\n          id\n          ... on Perspective {\n            head {\n              id\n            }\n          }\n        }\n      }`,\n    });\n\n    const headId = result.data.entity.head\n      ? result.data.entity.head.id\n      : undefined;\n\n    return headId ? [headId] : [];\n  };\n\n  redirect = async (perspective: Entity<Signed<Perspective>>) => {\n    const result = await this.client.query({\n      query: gql`{\n        entity(uref: \"${perspective.id}\") {\n          id\n          ... on Perspective {\n            head {\n              id\n            }\n          }\n        }\n      }`,\n    });\n\n    return result.data.entity.head ? result.data.entity.head.id : undefined;\n  };\n}\n","import { injectable } from 'inversify';\n\nimport { Pattern, HasLinks, Entity, Signed } from '@uprtcl/cortex';\n\nimport { Commit } from '../types';\nimport { extractSignedEntity } from '../utils/signed';\nimport { HasRedirect } from '@uprtcl/multiplatform';\nimport { EveesBindings } from '../bindings';\n\nexport const propertyOrder = ['creatorsIds', 'timestamp', 'message', 'parentsIds', 'dataId'];\n\nexport class CommitPattern extends Pattern<Entity<Signed<Commit>>> {\n  recognize(entity: object) {\n    const object = extractSignedEntity(entity);\n\n    return object && propertyOrder.every((p) => object.hasOwnProperty(p));\n  }\n\n  type = EveesBindings.CommitType;\n}\n\n@injectable()\nexport class CommitLinked\n  implements HasLinks<Entity<Signed<Commit>>>, HasRedirect<Entity<Signed<Commit>>> {\n  links: (commit: Entity<Signed<Commit>>) => Promise<string[]> = async (\n    commit: Entity<Signed<Commit>>\n  ): Promise<string[]> => [commit.object.payload.dataId, ...commit.object.payload.parentsIds];\n\n  getChildrenLinks: (commit: Entity<Signed<Commit>>) => string[] = (\n    commit: Entity<Signed<Commit>>\n  ) => [] as string[];\n\n  replaceChildrenLinks = (\n    commit: Entity<Signed<Commit>>,\n    newLinks: string[]\n  ): Entity<Signed<Commit>> => commit;\n\n  redirect: (commit: Entity<Signed<Commit>>) => Promise<string | undefined> = async (\n    commit: Entity<Signed<Commit>>\n  ) => commit.object.payload.dataId;\n}\n","import { LitElement, property, html, css } from 'lit-element';\nimport { ApolloClient, gql } from 'apollo-boost';\n\nimport { moduleConnect } from '@uprtcl/micro-orchestrator';\nimport { ApolloClientModule } from '@uprtcl/graphql';\n\ninterface CommitHistoryData {\n  id: string;\n  entity: {\n    message: string;\n    timestamp: number;\n    parentCommits: Array<CommitHistoryData>;\n  };\n}\n\nexport class CommitHistory extends moduleConnect(LitElement) {\n  @property({ attribute: 'commit-id' })\n  commitId!: string;\n\n  @property({ type: Object, attribute: false })\n  private commitHistory: CommitHistoryData | undefined;\n\n  async firstUpdated() {\n    this.loadCommitHistory();\n  }\n\n  async loadCommitHistory() {\n    this.commitHistory = undefined;\n\n    const apolloClient: ApolloClient<any> = this.request(\n      ApolloClientModule.bindings.Client\n    );\n    const result = await apolloClient.query({\n      query: gql`\n      {\n        entity(uref: \"${this.commitId}\") {\n          id\n          entity {\n            ... on Commit {\n              message\n              timestamp\n              parentCommits {\n                id\n                entity {\n                  ... on Commit {\n                    message\n                    timestamp\n                    parentCommits {\n                      id\n                      entity {\n                        ... on Commit {\n                          timestamp\n                          message\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    `,\n    });\n\n    this.commitHistory = result.data.entity;\n  }\n\n  renderCommitHistory(commitHistory: CommitHistoryData) {\n    return html`\n      <div class=\"column\">\n        ${commitHistory.id} ${commitHistory.entity.message}\n        ${commitHistory.entity.timestamp}\n        ${commitHistory.entity.parentCommits\n          ? html`\n              <div class=\"row\">\n                ${commitHistory.entity.parentCommits.map((parent) =>\n                  this.renderCommitHistory(parent)\n                )}\n              </div>\n            `\n          : html``}\n      </div>\n    `;\n  }\n\n  render() {\n    return html`\n      <div class=\"row\">\n        ${this.commitHistory\n          ? this.renderCommitHistory(this.commitHistory)\n          : html``}\n        <slot name=\"plugins\"></slot>\n      </div>\n    `;\n  }\n\n  static get styles() {\n    return css`\n      .column {\n        display: flex;\n        flex-direction: column;\n      }\n\n      .row {\n        display: flex;\n        flex-direction: row;\n      }\n    `;\n  }\n}\n","import { gql } from 'apollo-boost';\nimport { DocumentNode } from 'graphql';\n\nexport const eveesTypeDefs: DocumentNode = gql`\n  scalar Date\n\n  extend type Mutation {\n    updatePerspectiveHead(perspectiveId: ID!, headId: ID, name: String): Perspective!\n\n    createEntity(id: String, object: JSON!, casID: ID): Entity!\n\n    createPerspective(\n      remote: String!\n      path: String\n      creatorId: String\n      timestamp: Date\n      headId: ID\n      context: String\n      name: String\n      parentId: String\n      fromPerspectiveId: String\n      fromHeadId: String\n    ): Perspective!\n\n    forkPerspective(\n      perspectiveId: ID!\n      remote: String\n      parentId: String\n      name: String\n    ): Perspective!\n\n    deletePerspective(perspectiveId: ID!): Perspective!\n\n    addProposal(\n      toPerspectiveId: ID!\n      fromPerspectiveId: ID!\n      toHeadId: ID\n      fromHeadId: ID\n      newPerspectives: [NewPerspectiveInput!]\n      updates: [HeadUpdateInput!]\n    ): UpdateProposal!\n\n    executeProposal(proposalId: ID!, perspectiveId: ID!): UpdateProposal!\n  }\n\n  extend type Query {\n    contextPerspectives(context: String!): [Perspective!]\n  }\n\n  type Context {\n    id: String!\n    perspectives: [Perspective!] @discover\n  }\n\n  type HeadUpdate {\n    fromPerspective: Perspective! @discover\n    oldHead: Commit! @discover\n    toPerspective: Perspective! @discover\n    newHead: Commit! @discover\n  }\n\n  # Exact match to UpdateRequest typescript type\n  input HeadUpdateInput {\n    fromPerspectiveId: String\n    oldHeadId: String\n    perspectiveId: String\n    newHeadId: String\n  }\n\n  input ProofInput {\n    signature: String\n    type: String\n  }\n\n  input PerspectivePayloadInput {\n    remote: String\n    path: String\n    timestamp: Float\n    creatorId: String\n    context: String\n    fromPerspectiveId: String\n    fromHeadId: String\n  }\n\n  input PerspectiveEntityInput {\n    proof: ProofInput\n    payload: PerspectivePayloadInput\n  }\n\n  input PerspectiveInput {\n    id: String\n    object: PerspectiveEntityInput\n    casID: String\n  }\n\n  input PerspectiveDetailsInput {\n    name: String\n    headId: String\n  }\n\n  input NewPerspectiveInput {\n    perspective: PerspectiveInput\n    details: PerspectiveDetailsInput\n    parentId: String\n  }\n\n  input ProposalInput {\n    toPerspectiveId: String!\n    fromPerspectiveId: String!\n    toHeadId: String!\n    fromHeadId: String!\n    newPerspectives: [NewPerspectiveInput!]\n    updates: [HeadUpdateInput!]\n  }\n\n  type NewPerspective {\n    perspective: Perspective\n    details: PerspectiveDetails\n    parentId: String\n  }\n\n  type PerspectiveDetails {\n    name: String\n    headId: String\n  }\n\n  type UpdateProposal {\n    id: ID!\n\n    creatorId: String\n    toPerspective: Perspective! @discover\n    fromPerspective: Perspective! @discover\n    toHead: Commit! @discover\n    fromHead: Commit! @discover\n    newPerspectives: [NewPerspective!]\n    updates: [HeadUpdate!]\n  }\n\n  type Commit implements Entity {\n    id: ID!\n\n    parentCommits: [Commit!]! @discover\n    timestamp: Date!\n    message: String\n    data: Entity @discover\n    creatorsIds: [ID!]!\n\n    _context: EntityContext!\n  }\n\n  type Perspective implements Entity {\n    id: ID!\n\n    head: Commit @discover\n    name: String\n    payload: Payload\n    proposals: [String!]\n    canWrite: Boolean\n\n    _context: EntityContext!\n  }\n\n  type Payload {\n    remote: String\n    path: String\n    creatorId: String\n    timestamp: Date\n    context: Context\n    fromPerspectiveId: String\n    fromHeadId: String\n  }\n`;\n","import { ApolloClient, ApolloLink, gql } from 'apollo-boost';\nimport Observable from 'zen-observable-ts';\nimport cloneDeep from 'lodash-es/cloneDeep';\nimport { Entity, PatternRecognizer } from '@uprtcl/cortex';\nimport { UpdateRequest, NewPerspectiveData } from '../types';\nimport { EveesHelpers } from '../graphql/evees.helpers';\n\nimport { CREATE_ENTITY, CREATE_PERSPECTIVE, UPDATE_HEAD } from '../graphql/queries';\n\nexport class EveesWorkspace {\n  private entities: Entity<any>[] = [];\n  private newPerspectives: NewPerspectiveData[] = [];\n  private updates: UpdateRequest[] = [];\n\n  public workspace: ApolloClient<any>;\n\n  constructor(client: ApolloClient<any>, protected recognizer?: PatternRecognizer) {\n    this.workspace = this.buildWorkspace(client);\n  }\n\n  private buildWorkspace(client: ApolloClient<any>): ApolloClient<any> {\n    const link = new ApolloLink((operation, forward) => {\n      return new Observable(observer => {\n        client\n          .query({\n            query: operation.query,\n            variables: operation.variables,\n            context: operation.getContext()\n          })\n          .then(result => {\n            observer.next(result);\n            observer.complete();\n          })\n          .catch(error => {\n            observer.error(error);\n            observer.complete();\n          });\n\n        return () => {};\n      });\n    });\n\n    const workspace = new ApolloClient<any>({\n      cache: cloneDeep(client.cache),\n      typeDefs: client.typeDefs,\n      link: link\n    });\n\n    return workspace;\n  }\n\n  public hasUpdates() {\n    return this.updates.length > 0;\n  }\n\n  public async isSingleAuthority(remote: string) {\n    const newNot = this.newPerspectives.find(\n      newPerspective => newPerspective.perspective.object.payload.remote !== remote\n    );\n    if (newNot !== undefined) return false;\n\n    const check = this.updates.map(async update =>\n      EveesHelpers.getPerspectiveRemoteId(this.workspace, update.perspectiveId)\n    );\n    const checktoPerspectives = await Promise.all(check);\n\n    const updateNot = checktoPerspectives.find(_remoteId => _remoteId !== remote);\n    if (updateNot !== undefined) return false;\n\n    return true;\n  }\n\n  public getUpdates() {\n    return this.updates;\n  }\n\n  public getEntities() {\n    return this.entities;\n  }\n\n  public getNewPerspectives() {\n    return this.newPerspectives;\n  }\n\n  public create(entity: Entity<any>) {\n    this.entities.push(entity);\n    this.cacheCreateEntity(this.workspace, entity);\n  }\n\n  public newPerspective(newPerspective: NewPerspectiveData) {\n    /* perspective entity is stored as an entity too */\n    this.create(newPerspective.perspective);\n    this.newPerspectives.push(newPerspective);\n    this.cacheInitPerspective(this.workspace, newPerspective);\n  }\n\n  public update(update: UpdateRequest) {\n    this.updates.push(update);\n    this.cacheUpdateHead(this.workspace, update);\n  }\n\n  public cacheCreateEntity(client: ApolloClient<any>, entity: Entity<any>) {\n    if (!this.recognizer) throw new Error('recognized not provided');\n\n    const type = this.recognizer.recognizeType(entity);\n\n    client.writeQuery({\n      query: gql`{\n        entity(uref: \"${entity.id}\") {\n          __typename\n          id\n          _context {\n            object\n            casID\n          }\n        }\n      }`,\n\n      data: {\n        entity: {\n          __typename: type,\n          id: entity.id,\n          _context: {\n            __typename: 'EntityContext',\n            object: entity.object,\n            casID: entity.casID\n          }\n        }\n      }\n    });\n  }\n\n  public cacheInitPerspective(client: ApolloClient<any>, newPerspective: NewPerspectiveData) {\n    const perspectiveId = newPerspective.perspective.id;\n    const headId = newPerspective.details ? newPerspective.details.headId : undefined;\n    const object = newPerspective.perspective.object;\n\n    client.cache.writeQuery({\n      query: gql`{\n        entity(uref: \"${perspectiveId}\") {\n          id\n          ... on Perspective {\n            head {\n              id\n            }\n          }\n          _context {\n            object\n            casID\n          }\n        }\n      }`,\n      data: {\n        entity: {\n          __typename: 'Perspective',\n          id: perspectiveId,\n          head: {\n            __typename: 'Commit',\n            id: headId\n          },\n          _context: {\n            __typename: 'EntityContext',\n            object,\n            casID: ''\n          }\n        }\n      }\n    });\n  }\n\n  public cacheUpdateHead(client: ApolloClient<any>, update: UpdateRequest) {\n    const perspectiveId = update.perspectiveId;\n    // TODO: keep track of old head?...\n\n    client.cache.writeQuery({\n      query: gql`{\n        entity(uref: \"${perspectiveId}\") {\n          id\n          ... on Perspective {\n            head {\n              id\n            }\n          }\n        }\n      }`,\n      data: {\n        entity: {\n          __typename: 'Perspective',\n          id: perspectiveId,\n          head: {\n            __typename: 'Commit',\n            id: update.newHeadId\n          }\n        }\n      }\n    });\n  }\n\n  /** takes the Evees actions and replicates them in another client  */\n  public async execute(client: ApolloClient<any>) {\n    await this.executeCreate(client);\n    await this.executeInit(client);\n    return this.executeUpdate(client);\n  }\n\n  public async executeCreate(client: ApolloClient<any>) {\n    const create = this.entities.map(async entity => {\n      const mutation = await client.mutate({\n        mutation: CREATE_ENTITY,\n        variables: {\n          id: entity.id,\n          object: entity.object,\n          casID: entity.casID\n        }\n      });\n\n      const dataId = mutation.data.createEntity.id;\n\n      if (dataId !== entity.id) {\n        throw new Error(`created entity id ${dataId} not as expected ${entity.id}`);\n      }\n    });\n\n    return Promise.all(create);\n  }\n\n  /* Takes the new perspectives and sets their head in the cache \n     before the perspective is actually created */\n  public precacheInit(client: ApolloClient<any>) {}\n\n  private async executeInit(client: ApolloClient<any>) {\n    const createPerspective = async (newPerspective: NewPerspectiveData) => {\n      const result = await client.mutate({\n        mutation: CREATE_PERSPECTIVE,\n        variables: {\n          ...newPerspective.perspective.object.payload,\n          ...newPerspective.details,\n          remote: newPerspective.perspective.object.payload.remote,\n          path: newPerspective.perspective.object.payload.path,\n          parentId: newPerspective.parentId\n        }\n      });\n      if (result.data.createPerspective.id !== newPerspective.perspective.id) {\n        throw new Error(\n          `created perspective id ${result.data.createPerspective.id} not as expected ${newPerspective.perspective.id}`\n        );\n      }\n    };\n\n    /** must run backwards and sequentially since new perspectives\n     *  permissions depend on previous ones */\n    await this.newPerspectives\n      .reverse()\n      .reduce((promise, action) => promise.then(_ => createPerspective(action)), Promise.resolve());\n  }\n\n  /** copies the new perspective data (head) in the workspace into the\n   *  cache of an apollo client */\n  public async precacheNewPerspectives(client: ApolloClient<any>) {\n    this.newPerspectives.reverse().map(newPerspective => {\n      this.cacheInitPerspective(client, newPerspective);\n    });\n  }\n\n  public async executeUpdate(client: ApolloClient<any>) {\n    const update = this.getUpdates().map(async update => {\n      return client.mutate({\n        mutation: UPDATE_HEAD,\n        variables: {\n          perspectiveId: update.perspectiveId,\n          headId: update.newHeadId\n        }\n      });\n    });\n\n    return Promise.all(update);\n  }\n}\n","import { ApolloClient, gql } from 'apollo-boost';\nimport { IResolvers } from 'graphql-tools';\n\nimport {\n  MultiSourceService,\n  DiscoveryModule,\n  CASStore,\n  CASModule,\n  KnownSourcesSource,\n  EntityCache,\n  KnownSourcesService,\n  loadEntity\n} from '@uprtcl/multiplatform';\nimport { Entity, Signed, CortexModule } from '@uprtcl/cortex';\nimport { ApolloClientModule } from '@uprtcl/graphql';\n\nimport { Perspective, NewProposal, NewPerspectiveData } from '../types';\nimport { EveesBindings } from '../bindings';\nimport { Evees } from '../services/evees';\nimport { EveesRemote } from '../services/evees.remote';\nimport { EveesHelpers } from './evees.helpers';\nimport { EveesWorkspace } from '../services/evees.workspace';\nimport { GET_PERSPECTIVE_CONTEXTS } from './queries';\n\nconst getContextPerspectives = async (context, container) => {\n  if (context === undefined) return [];\n\n  const eveesRemotes: EveesRemote[] = container.getAll(EveesBindings.EveesRemote);\n  const knownSources: KnownSourcesService = container.get(\n    DiscoveryModule.bindings.LocalKnownSources\n  );\n\n  const promises = eveesRemotes.map(async remote => {\n    const thisPerspectivesIds = await remote.getContextPerspectives(context);\n    thisPerspectivesIds.forEach(pId => {\n      knownSources.addKnownSources(pId, [remote.store.casID], EveesBindings.PerspectiveType);\n    });\n    return thisPerspectivesIds;\n  });\n\n  const perspectivesIdsPerRemote = await Promise.all(promises);\n\n  const perspectivesIds = ([] as string[]).concat(...perspectivesIdsPerRemote);\n  // remove duplicates\n  const map = new Map<string, null>();\n  perspectivesIds.forEach(id => map.set(id, null));\n  return Array.from(map, key => key[0]);\n};\n\nexport const eveesResolvers: IResolvers = {\n  Commit: {\n    message(parent) {\n      return parent.payload.message;\n    },\n    timestamp(parent) {\n      return parent.payload.timestamp;\n    },\n    parentCommits(parent) {\n      return parent.payload.parentsIds;\n    },\n    data(parent) {\n      return parent.payload.dataId;\n    },\n    creatorsIds(parent) {\n      return parent.payload.creatorsIds;\n    }\n  },\n  Context: {\n    id(parent) {\n      return typeof parent === 'string' ? parent : parent.id;\n    },\n    async perspectives(parent, _, { container }) {\n      const context = typeof parent === 'string' ? parent : parent.id;\n      return getContextPerspectives(context, container);\n    }\n  },\n  UpdateProposal: {\n    toPerspective(parent) {\n      return parent.toPerspectiveId;\n    },\n    fromPerspective(parent) {\n      return parent.fromPerspectiveId;\n    },\n    toHead(parent) {\n      return parent.toPerspectiveId;\n    },\n    fromHead(parent) {\n      return parent.fromPerspectiveId;\n    }\n  },\n  HeadUpdate: {\n    toPerspective(parent) {\n      return parent.perspectiveId;\n    },\n    fromPerspective(parent) {\n      return parent.fromPerspectiveId;\n    },\n    newHead(parent) {\n      return parent.newHeadId;\n    },\n    oldHead(parent) {\n      return parent.oldHeadId;\n    }\n  },\n  Perspective: {\n    async head(parent, _, { container }) {\n      const evees: Evees = container.get(EveesBindings.Evees);\n\n      const remote = evees.getPerspectiveProvider(parent);\n      const details = await remote.getPerspective(parent.id);\n\n      return details && details.headId;\n    },\n    async name(parent, _, { container }) {\n      const evees: Evees = container.get(EveesBindings.Evees);\n\n      const remote = evees.getPerspectiveProvider(parent);\n      const details = await remote.getPerspective(parent.id);\n\n      return details && details.name;\n    },\n    async proposals(parent, _, { container }) {\n      const evees: Evees = container.get(EveesBindings.Evees);\n\n      const remote = evees.getPerspectiveProvider(parent);\n\n      if (!remote.proposals) return [];\n\n      return remote.proposals.getProposalsToPerspective(parent.id);\n    },\n    async payload(parent, _, { container }) {\n      return {\n        remote: parent.payload.remote,\n        path: parent.payload.path,\n        creatorId: parent.payload.creatorId,\n        timestamp: parent.payload.timestamp,\n        context: {\n          id: parent.payload.context\n        }\n      };\n    },\n    async canWrite(parent, _, { container }) {\n      const evees: Evees = container.get(EveesBindings.Evees);\n      const remote = evees.getPerspectiveProvider(parent);\n      return remote.canWrite(parent.id);\n    }\n  },\n  Mutation: {\n    async updatePerspectiveHead(parent, { perspectiveId, headId, name }, { container }) {\n      const evees: Evees = container.get(EveesBindings.Evees);\n      const multiSource: MultiSourceService = container.get(\n        DiscoveryModule.bindings.MultiSourceService\n      );\n      const client: ApolloClient<any> = container.get(ApolloClientModule.bindings.Client);\n\n      const provider = await evees.getPerspectiveRemoteById(perspectiveId);\n\n      await provider.updatePerspective(perspectiveId, {\n        headId,\n        name\n      });\n      /** needed to return the current values in case one of the inputs is undefined */\n      const detailsRead = await provider.getPerspective(perspectiveId);\n\n      if (((provider as unknown) as KnownSourcesSource).knownSources) {\n        await multiSource.postEntityUpdate((provider as unknown) as KnownSourcesSource, [headId]);\n      }\n\n      const result = await client.query({\n        query: gql`{\n          entity(uref: \"${perspectiveId}\") {\n            id\n            _context {\n              object\n            }\n          }\n        }`\n      });\n\n      const perspective = result.data.entity._context.object;\n\n      if (!perspective) throw new Error(`Perspective with id ${perspectiveId} not found`);\n\n      return {\n        id: perspectiveId,\n        ...perspective,\n        head: {\n          id: detailsRead.headId\n        },\n        name: detailsRead.name\n      };\n    },\n\n    async deletePerspective(parent, { perspectiveId }, { container, cache }) {\n      const evees: Evees = container.get(EveesBindings.Evees);\n      const remote = await evees.getPerspectiveRemoteById(perspectiveId);\n      await remote.deletePerspective(perspectiveId);\n\n      /** we need to remove the perspective from the cache.\n       * this code is based on\n       * https://www.apollographql.com/docs/tutorial/local-state/ */\n      const queryResult = cache.readQuery({\n        query: GET_PERSPECTIVE_CONTEXTS(perspectiveId)\n      });\n\n      const entity = { ...queryResult.entity };\n\n      /** remove this perspective from the perspectives array */\n      entity.payload.context.perspectives = [\n        ...entity.payload.context.perspectives.filter(persp => persp.id !== perspectiveId)\n      ];\n\n      /** overwrite cache */\n      cache.writeQuery({\n        query: GET_PERSPECTIVE_CONTEXTS(perspectiveId),\n        data: entity\n      });\n\n      return { id: perspectiveId };\n    },\n\n    async createEntity(_, { id, object, casID }, { container }) {\n      const stores: CASStore[] = container.getAll(CASModule.bindings.CASStore);\n      const store = stores.find(d => d.casID === casID);\n\n      if (!store) throw new Error(`No store registered for casID ${casID}`);\n      const newId = await store.create(object, id);\n\n      const entity: Entity<any> = {\n        id: newId,\n        object,\n        casID\n      };\n\n      if (id !== undefined) {\n        if (id !== newId) {\n          throw new Error(\n            `Unexpected id ${newId} for object ${JSON.stringify(object)}, expected ${id}`\n          );\n        }\n      }\n\n      const entityCache: EntityCache = container.get(DiscoveryModule.bindings.EntityCache);\n      entityCache.cacheEntity(entity);\n\n      return {\n        id: newId,\n        ...object\n      };\n    },\n\n    async createPerspective(\n      _,\n      {\n        remote,\n        path,\n        creatorId,\n        timestamp,\n        headId,\n        context,\n        name,\n        parentId,\n        fromPerspectiveId,\n        fromHeadId\n      },\n      { container }\n    ) {\n      const remotes = container.getAll(EveesBindings.EveesRemote);\n      const remoteInstance: EveesRemote = remotes.find(instance => instance.id === remote);\n\n      const perspective = await EveesHelpers.snapDefaultPerspective(\n        remoteInstance,\n        creatorId,\n        context,\n        timestamp,\n        path,\n        fromPerspectiveId,\n        fromHeadId\n      );\n\n      const entityCache: EntityCache = container.get(DiscoveryModule.bindings.EntityCache);\n      entityCache.cacheEntity({\n        ...perspective,\n        casID: remoteInstance.store.casID\n      });\n\n      const newPerspectiveData: NewPerspectiveData = {\n        perspective,\n        details: { headId, name },\n        parentId\n      };\n      await remoteInstance.createPerspective(newPerspectiveData);\n      return {\n        id: perspective.id,\n        name: name,\n        head: headId,\n        payload: perspective.object.payload\n      };\n    },\n\n    async forkPerspective(_, { perspectiveId, remote, parentId, name }, { container }) {\n      const evees: Evees = container.get(EveesBindings.Evees);\n      const client: ApolloClient<any> = container.get(ApolloClientModule.bindings.Client);\n      const recognizer = container.get(CortexModule.bindings.Recognizer);\n\n      const workspace = new EveesWorkspace(client, recognizer);\n      const newPerspectiveId = await evees.forkPerspective(perspectiveId, workspace, remote);\n      await workspace.execute(client);\n\n      const headId = await EveesHelpers.getPerspectiveHeadId(client, newPerspectiveId);\n      const perspective = await loadEntity<Signed<Perspective>>(client, newPerspectiveId);\n      if (!perspective) throw new Error('perspective not found');\n\n      return {\n        id: newPerspectiveId,\n        name: name,\n        head: headId,\n        payload: {\n          remote: perspective.object.payload.remote,\n          path: perspective.object.payload.path,\n          creatorId: perspective.object.payload.creatorId,\n          timestamp: perspective.object.payload.timestamp,\n          context: {\n            id: perspective.object.payload.context,\n            perspectives: {\n              newPerspectiveId\n            }\n          }\n        }\n      };\n    },\n\n    async addProposal(\n      _,\n      { toPerspectiveId, fromPerspectiveId, toHeadId, fromHeadId, newPerspectives, updates },\n      { container }\n    ) {\n      const evees: Evees = container.get(EveesBindings.Evees);\n\n      const remote = await evees.getPerspectiveRemoteById(toPerspectiveId);\n      if (!remote.proposals) throw new Error('remote cant handle proposals');\n\n      const proposal: NewProposal = {\n        fromPerspectiveId,\n        toPerspectiveId,\n        fromHeadId,\n        toHeadId,\n        details: {\n          updates: updates,\n          newPerspectives: newPerspectives\n        }\n      };\n      const proposalId = await remote.proposals.createProposal(proposal);\n\n      return {\n        id: proposalId,\n        toPerspectiveId,\n        fromPerspectiveId,\n        updates: updates,\n        canExecute: false,\n        executed: false\n      };\n    }\n  },\n  Query: {\n    async contextPerspectives(parent, { context }, { container }) {\n      return getContextPerspectives(context, container);\n    }\n  }\n};\n","import { html } from 'lit-element';\nimport { randomColor } from 'randomcolor';\n\nconst MT2D = 30;\nconst D2H = 24;\nconst H2M = 60;\nconst M2S = 60;\nconst S2MS = 1000;\n\nconst MT2MS = MT2D * D2H * H2M * M2S * S2MS;\nconst D2MS = D2H * H2M * M2S * S2MS;\nconst H2MS = H2M * M2S * S2MS;\nconst M2MS = H2M * M2S * S2MS;\n\nexport const prettyTime = (timestamp: number): string => {\n  const date = new Date(timestamp);\n  const ago = Date.now() - timestamp;\n  let value;\n\n  if (ago > 3 * MT2MS) {\n    return `on ${date.getMonth()} ${date.getUTCDay} `;\n  } else {\n    if (ago > 1 * MT2MS) {\n      value = Math.floor(ago / MT2MS);\n      return `${value} month${value > 1 ? 's' : ''} ago`;\n    } else {\n      if (ago > 1 * D2MS) {\n        value = Math.floor(ago / D2MS);\n        return `${value} day${value > 1 ? 's' : ''} ago`;\n      } else {\n        if (ago > 1 * H2MS) {\n          value = Math.floor(ago / H2MS);\n          return `${value} hour${value > 1 ? 's' : ''} ago`;\n        } else {\n          if (ago > 5 * M2MS) {\n            value = Math.floor(ago / M2MS);\n            return `${value} minute${value > 1 ? 's' : ''} ago`;\n          } else {\n            return `a few minutes ago`;\n          }\n        }\n      }\n    }\n  }\n};\n\nexport const prettyAddress = (address: string) => {\n  return html` <span\n    style=\"font-family: Lucida Console, Monaco, monospace; background-color: #d0d8db; padding: 3px 6px; font-size: 14px; border-radius: 3px; margin-right: 6px;\"\n  >\n    ${address.substr(0, 4)}...${address.substr(\n      address.length - 3,\n      address.length\n    )}\n  </span>`;\n};\n\nexport const DEFAULT_COLOR: string = '#d0dae0';\n\nexport const eveeColor = (perspectiveId: string): string => {\n  return randomColor({ seed: perspectiveId });\n};\n","import { ApolloClient, gql } from 'apollo-boost';\nimport { LitElement, property, html, css } from 'lit-element';\n\nimport { ApolloClientModule } from '@uprtcl/graphql';\nimport { moduleConnect, Logger } from '@uprtcl/micro-orchestrator';\n\nimport { eveeColor } from './support';\nimport { EveesBindings } from './../bindings';\nimport { EveesRemote } from './../services/evees.remote';\nimport { EveesHelpers } from '../graphql/evees.helpers';\n\ninterface PerspectiveData {\n  id: string;\n  name: string;\n  remote: string;\n  creatorId: string;\n  timestamp: number;\n}\n\nexport class EveesPerspectivesList extends moduleConnect(LitElement) {\n  logger = new Logger('EVEES-PERSPECTIVES-LIST');\n\n  @property({ type: String, attribute: 'perspective-id' })\n  perspectiveId!: string;\n\n  @property({ type: Array })\n  hidePerspectives: string[] = [];\n\n  @property({ type: Boolean, attribute: 'can-propose' })\n  canPropose: Boolean = false;\n\n  @property({ attribute: false })\n  loadingPerspectives: boolean = true;\n\n  @property({ attribute: false })\n  otherPerspectivesData: PerspectiveData[] = [];\n\n  @property({ attribute: false })\n  canWrite: Boolean = false;\n\n  perspectivesData: PerspectiveData[] = [];\n\n  protected client!: ApolloClient<any>;\n  protected remotes!: EveesRemote[];\n\n  async firstUpdated() {\n    if (!this.isConnected) return;\n\n    this.client = this.request(ApolloClientModule.bindings.Client);\n    this.remotes = this.requestAll(EveesBindings.EveesRemote) as EveesRemote[];\n    this.load();\n  }\n\n  async load() {\n    this.loadingPerspectives = true;\n    const result = await this.client.query({\n      query: gql`{\n        entity(uref: \"${this.perspectiveId}\") {\n          id\n          ... on Perspective {\n            payload {\n              remote\n              context {\n                id\n                perspectives {\n                  id\n                  name\n                  payload {\n                    creatorId\n                    timestamp\n                    remote\n                  }\n                } \n              }\n            }\n          }\n        }\n      }`\n    });\n\n    /** data on other perspectives (proposals are injected on them) */\n    const perspectivesData: PerspectiveData[] =\n      result.data.entity.payload.context === null\n        ? []\n        : await Promise.all(\n            result.data.entity.payload.context.perspectives.map(\n              async (perspective): Promise<PerspectiveData> => {\n                /** data on this perspective */\n                const remote = this.remotes.find(r => r.id === perspective.payload.remote);\n                if (!remote) throw new Error(`remote not found for ${perspective.payload.remote}`);\n                this.canWrite = await EveesHelpers.canWrite(this.client, this.perspectiveId);\n                return {\n                  id: perspective.id,\n                  name: perspective.name,\n                  creatorId: perspective.payload.creatorId,\n                  timestamp: perspective.payload.timestamp,\n                  remote: perspective.payload.remote\n                };\n              }\n            )\n          );\n\n    // remove duplicates\n    const map = new Map<string, PerspectiveData>();\n    perspectivesData.forEach(perspectiveData => map.set(perspectiveData.id, perspectiveData));\n    this.perspectivesData = Array.from(map, key => key[1]);\n\n    this.otherPerspectivesData = this.perspectivesData.filter(\n      perspectiveData => !this.hidePerspectives.includes(perspectiveData.id)\n    );\n\n    this.loadingPerspectives = false;\n\n    this.logger.info('getOtherPersepectives() - post', {\n      persperspectivesData: this.perspectivesData\n    });\n  }\n\n  perspectiveClicked(id: string) {\n    this.dispatchEvent(\n      new CustomEvent('perspective-selected', {\n        bubbles: true,\n        composed: true,\n        detail: {\n          id\n        }\n      })\n    );\n  }\n\n  perspectiveColor(creatorId: string) {\n    return eveeColor(creatorId);\n  }\n\n  perspectiveButtonClicked(event: Event, perspectiveData: PerspectiveData) {\n    event.stopPropagation();\n    this.dispatchEvent(\n      new CustomEvent('merge-perspective', {\n        bubbles: true,\n        composed: true,\n        detail: {\n          perspectiveId: perspectiveData.id\n        }\n      })\n    );\n  }\n\n  renderLoading() {\n    return html`\n      <div class=\"loading-container\">\n        <uprtcl-loading></uprtcl-loading>\n      </div>\n    `;\n  }\n\n  renderPerspectiveRow(perspectiveData: PerspectiveData) {\n    return html`\n      <uprtcl-list-item\n        style=${`--selected-border-color: ${this.perspectiveColor(perspectiveData.creatorId)}`}\n        hasMeta\n        ?selected=${this.perspectiveId === perspectiveData.id}\n        @click=${() => this.perspectiveClicked(perspectiveData.id)}\n      >\n        <evees-author\n          show-name\n          color=${this.perspectiveColor(perspectiveData.creatorId)}\n          user-id=${perspectiveData.creatorId}\n        ></evees-author>\n      </uprtcl-list-item>\n    `;\n  }\n\n  render() {\n    return this.loadingPerspectives\n      ? this.renderLoading()\n      : this.otherPerspectivesData.length > 0\n      ? html`\n          <uprtcl-list activatable>\n            ${this.otherPerspectivesData.map(perspectiveData =>\n              this.renderPerspectiveRow(perspectiveData)\n            )}\n          </uprtcl-list>\n        `\n      : html`\n          <uprtcl-list-item>\n            <i>No other perspectives found</i>\n          </uprtcl-list-item>\n        `;\n  }\n\n  static get styles() {\n    return css`\n      :host {\n        flex-grow: 1;\n        display: flex;\n        flex-direction: column;\n      }\n\n      .loading-container {\n        flex-grow: 1;\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n      }\n      uprtcl-list-item {\n        user-select: none;\n      }\n    `;\n  }\n}\n","import { html, css, property, LitElement, query } from 'lit-element';\nimport { DEFAULT_COLOR, eveeColor } from './support';\nimport { UprtclPopper, icons } from '@uprtcl/common-ui';\nimport { Logger, moduleConnect } from '@uprtcl/micro-orchestrator';\nimport { loadEntity } from '@uprtcl/multiplatform';\nimport { ApolloClient } from 'apollo-boost';\nimport { ApolloClientModule } from '@uprtcl/graphql';\nimport { Signed } from '@uprtcl/cortex';\nimport { Perspective } from '../types';\n\nconst styleMap = style => {\n  return Object.entries(style).reduce((styleString, [propName, propValue]) => {\n    propName = propName.replace(/([A-Z])/g, matches => `-${matches[0].toLowerCase()}`);\n    return `${styleString}${propName}:${propValue};`;\n  }, '');\n};\n\nexport class EveesInfoPopper extends moduleConnect(LitElement) {\n  logger = new Logger('EVEES-INFO-POPPER');\n\n  @property({ type: String, attribute: 'uref' })\n  uref!: string;\n\n  @property({ type: String, attribute: 'first-uref' })\n  firstRef!: string;\n\n  @property({ type: String, attribute: 'parent-id' })\n  parentId!: string;\n\n  @property({ type: String, attribute: 'official-owner' })\n  officialOwner: string | undefined = undefined;\n\n  @property({ type: Boolean, attribute: 'check-owner' })\n  checkOwner: boolean = false;\n\n  @property({ type: String, attribute: 'evee-color' })\n  eveeColor!: string;\n\n  @property({ type: Boolean, attribute: 'show-draft' })\n  showDraft: boolean = false;\n\n  @property({ type: Boolean, attribute: 'show-proposals' })\n  showProposals: boolean = false;\n\n  @property({ type: Boolean, attribute: 'show-acl' })\n  showAcl: boolean = false;\n\n  @property({ type: Boolean, attribute: 'show-info' })\n  showInfo: boolean = false;\n\n  @property({ type: Boolean, attribute: 'show-icon' })\n  showIcon: boolean = false;\n\n  @property({ type: Boolean, attribute: 'show-debug' })\n  showDebug: boolean = false;\n\n  @property({ type: Boolean, attribute: 'emit-proposals' })\n  emitProposals: boolean = false;\n\n  @property({ attribute: false })\n  officialId!: string;\n\n  @property({ attribute: false })\n  creatorId!: string;\n\n  @property({ attribute: false })\n  dropdownShown: boolean = false;\n\n  @query('#info-popper')\n  infoPopper!: UprtclPopper;\n\n  protected client!: ApolloClient<any>;\n\n  async firstUpdated() {\n    this.client = this.request(ApolloClientModule.bindings.Client);\n    await this.load();\n  }\n\n  async load() {\n    const current = await loadEntity<Signed<Perspective>>(this.client, this.uref);\n    if (!current) throw new Error(`cant find current perspective ${this.uref}`);\n\n    this.creatorId = current.object.payload.creatorId;\n  }\n\n  color() {\n    return this.officialId && this.uref === this.officialId\n      ? DEFAULT_COLOR\n      : this.uref === this.firstRef\n      ? this.eveeColor\n      : eveeColor(this.creatorId);\n  }\n\n  updated(changedProperties) {\n    if (changedProperties.has('uref')) {\n      this.load();\n    }\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n\n    this.addEventListener('checkout-perspective', ((event: CustomEvent) => {\n      this.infoPopper.showDropdown = false;\n      this.requestUpdate();\n    }) as EventListener);\n  }\n\n  officialIdReceived(perspectiveId: string) {\n    this.officialId = perspectiveId;\n  }\n\n  handleDragStart(e) {\n    const dragged = { uref: this.uref, parentId: this.parentId };\n    this.logger.info('dragging', dragged);\n    e.dataTransfer.setData('text/plain', JSON.stringify(dragged));\n  }\n\n  render() {\n    return html`\n      <uprtcl-popper\n        id=\"info-popper\"\n        position=\"right\"\n        @drop-down-changed=${e => (this.dropdownShown = e.detail.shown)}\n      >\n        <div draggable=\"false\" @dragstart=${this.handleDragStart} slot=\"icon\" class=\"evee-stripe\">\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            viewBox=\"0 0 24 24\"\n            fill=${this.color()}\n            width=\"18px\"\n            height=\"18px\"\n          >\n            <path d=\"M0 0h24v24H0z\" fill=\"none\" />\n            <path d=\"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z\" />\n          </svg>\n        </div>\n        ${this.dropdownShown\n          ? html`\n              <div class=\"evees-info\">\n                <evees-info-user-based\n                  ?show-draft=${this.showDraft}\n                  ?show-proposals=${this.showProposals}\n                  ?show-info=${this.showInfo}\n                  ?show-icon=${this.showIcon}\n                  ?show-debug=${this.showDebug}\n                  ?emit-proposals=${this.showInfo}\n                  uref=${this.uref}\n                  parent-id=${this.parentId}\n                  first-uref=${this.firstRef as string}\n                  official-owner=${this.officialOwner as string}\n                  ?check-owner=${this.checkOwner}\n                  @official-id=${e => this.officialIdReceived(e.detail.perspectiveId)}\n                ></evees-info-user-based>\n              </div>\n            `\n          : ``}\n      </uprtcl-popper>\n    `;\n  }\n\n  static get styles() {\n    return [\n      css`\n        :host {\n          flex-grow: 1;\n          display: flex;\n          flex-direction: column;\n        }\n        uprtcl-popper {\n          flex-grow: 1;\n        }\n        .evees-info {\n          padding: 10px;\n          display: block;\n        }\n        .evee-stripe {\n          cursor: pointer;\n          padding: 5px 6px 0px;\n          height: 100%;\n          border-radius: 15px;\n          user-select: none;\n          transition: background-color 100ms linear;\n        }\n        .evee-stripe:hover {\n          background-color: #eef1f1;\n        }\n      `\n    ];\n  }\n}\n","import { TemplateResult } from 'lit-element';\n\nimport { Behaviour } from '@uprtcl/cortex';\n\nimport { EveesRemote } from './services/evees.remote';\nimport { Secured } from './utils/cid-hash';\nimport { EveesWorkspace } from './services/evees.workspace';\n\nexport type Context = string;\n\nexport interface Perspective {\n  remote: string;\n  path: string;\n  creatorId: string;\n  context: string;\n  timestamp: number;\n  fromPerspectiveId?: string; // optional parameters to hardcode\n  fromHeadId?: string; // forks on the perspective id\n}\n\nexport const getAuthority = (perspective: Perspective): string => {\n  return `${perspective.remote}:${perspective.path}`;\n};\n\nexport interface PerspectiveDetails {\n  name?: string;\n  headId?: string | undefined;\n}\n\nexport interface Commit {\n  creatorsIds: string[];\n  timestamp: number;\n  message?: string;\n  forking?: string;\n  parentsIds: Array<string>;\n  dataId: string;\n}\n\nexport interface UpdateRequest {\n  fromPerspectiveId?: string;\n  oldHeadId?: string;\n  perspectiveId: string;\n  newHeadId: string;\n}\n\nexport interface Proposal {\n  id: string;\n  creatorId?: string;\n  timestamp?: number;\n  toPerspectiveId: string;\n  fromPerspectiveId?: string;\n  toHeadId?: string;\n  fromHeadId?: string;\n  details: ProposalDetails;\n}\n\nexport interface ProposalDetails {\n  updates: UpdateRequest[];\n  newPerspectives: NewPerspectiveData[];\n}\n\nexport interface NewProposal {\n  fromPerspectiveId: string;\n  toPerspectiveId: string;\n  fromHeadId: string;\n  toHeadId: string;\n  details: ProposalDetails;\n}\n\nexport interface ProposalCreatedDetail {\n  remote: string;\n  proposalDetails: ProposalDetails;\n}\n\nexport const PROPOSAL_CREATED_TAG: string = 'evees-proposal';\n\nexport class ProposalCreatedEvent extends CustomEvent<ProposalCreatedDetail> {\n  constructor(eventInitDict?: CustomEventInit<ProposalCreatedDetail>) {\n    super(PROPOSAL_CREATED_TAG, eventInitDict);\n  }\n}\n\nexport interface NewPerspectiveData {\n  perspective: Secured<Perspective>;\n  details: PerspectiveDetails;\n  parentId?: string;\n}\n\nexport interface DiffLens {\n  name: string;\n  render: (\n    workspace: EveesWorkspace,\n    newEntity: any,\n    oldEntity: any,\n    summary: boolean\n  ) => TemplateResult;\n  type?: string;\n}\n\nexport interface HasDiffLenses<T = any> extends Behaviour<T> {\n  diffLenses: () => DiffLens[];\n}\n\nexport interface EveesConfig {\n  defaultRemote?: EveesRemote;\n  officialRemote?: EveesRemote;\n  editableRemotesIds?: string[];\n  emitIf?: {\n    remote: string;\n    owner: string;\n  };\n}\n","import { LitElement, property, html, css } from 'lit-element';\n\nimport { moduleConnect, Logger, Dictionary } from '@uprtcl/micro-orchestrator';\nimport { PatternRecognizer, CortexModule } from '@uprtcl/cortex';\n\nimport { UpdateRequest, HasDiffLenses, DiffLens } from '../types';\n\nimport { EveesWorkspace } from '../services/evees.workspace';\nimport { EveesHelpers } from '../graphql/evees.helpers';\n\nconst LOGINFO = true;\n\ninterface UpdateDetails {\n  update?: UpdateRequest;\n  newData: any;\n  oldData: any;\n  diffLense: DiffLens;\n}\n\nexport class EveesDiff extends moduleConnect(LitElement) {\n  logger = new Logger('EVEES-DIFF');\n\n  @property({ type: String, attribute: 'root-perspective' })\n  rootPerspective!: string;\n\n  @property({ type: Boolean })\n  summary: boolean = false;\n\n  @property({ attribute: false })\n  workspace!: EveesWorkspace;\n\n  @property({ attribute: false })\n  loading: boolean = true;\n\n  updatesDetails: Dictionary<UpdateDetails> = {};\n\n  protected recognizer!: PatternRecognizer;\n\n  async firstUpdated() {\n    this.logger.log('firstUpdated()');\n    this.recognizer = this.request(CortexModule.bindings.Recognizer);\n\n    this.loadUpdates();\n  }\n\n  async updated(changedProperties) {\n    this.logger.log('updated()', changedProperties);\n\n    if (changedProperties.has('workspace')) {\n      this.loadUpdates();\n    }\n\n    if (changedProperties.has('rootPerspective')) {\n      this.loadUpdates();\n    }\n  }\n\n  async loadUpdates() {\n    if (!this.workspace) return;\n\n    this.loading = true;\n\n    const getDetails = this.workspace.getUpdates().map(async update => {\n      const newData = await EveesHelpers.getCommitData(this.workspace.workspace, update.newHeadId);\n\n      const oldData =\n        update.oldHeadId !== undefined\n          ? await EveesHelpers.getCommitData(this.workspace.workspace, update.oldHeadId)\n          : undefined;\n\n      const hasDiffLenses = this.recognizer\n        .recognizeBehaviours(newData)\n        .find(b => (b as HasDiffLenses<any>).diffLenses);\n      if (!hasDiffLenses) throw Error('hasDiffLenses undefined');\n\n      this.updatesDetails[update.perspectiveId] = {\n        diffLense: hasDiffLenses.diffLenses()[0],\n        update,\n        oldData,\n        newData\n      };\n    });\n\n    await Promise.all(getDetails);\n\n    /** if a new perspective with the root id is found,\n     *  shown as an update from undefined head */\n    if (this.rootPerspective) {\n      const newRoot = this.workspace\n        .getNewPerspectives()\n        .find(newPerspective => newPerspective.perspective.id === this.rootPerspective);\n      if (newRoot) {\n        if (newRoot.details.headId) {\n          const newData = await EveesHelpers.getCommitData(\n            this.workspace.workspace,\n            newRoot.details.headId\n          );\n\n          const hasDiffLenses = this.recognizer\n            .recognizeBehaviours(newData)\n            .find(b => (b as HasDiffLenses<any>).diffLenses);\n          if (!hasDiffLenses) throw Error('hasDiffLenses undefined');\n\n          this.updatesDetails[this.rootPerspective] = {\n            diffLense: hasDiffLenses.diffLenses()[0],\n            update: undefined,\n            oldData: undefined,\n            newData\n          };\n        }\n      }\n    }\n\n    this.loading = false;\n  }\n\n  renderUpdateDiff(details: UpdateDetails) {\n    // TODO: review if old data needs to be\n    return html`\n      <div class=\"evee-diff\">\n        ${details.diffLense.render(this.workspace, details.newData, details.oldData, this.summary)}\n      </div>\n    `;\n  }\n\n  render() {\n    if (this.loading) {\n      return html`\n        <uprtcl-loading></uprtcl-loading>\n      `;\n    }\n\n    const perspectiveIds = Object.keys(this.updatesDetails);\n    return perspectiveIds.length === 0\n      ? html`\n          <span><i>no changes found</i></span>\n        `\n      : perspectiveIds.map(perspectiveId =>\n          this.renderUpdateDiff(this.updatesDetails[perspectiveId])\n        );\n  }\n\n  static get styles() {\n    return css`\n      :host {\n        display: block;\n        text-align: center;\n      }\n      .evee-diff {\n        overflow: auto;\n      }\n    `;\n  }\n}\n","export type ContentUpdatedArgs = {\n  uref: string;\n};\n\nexport type UpdateContentArgs = {\n  dataId: string;\n};\n\nexport type SpliceChildrenArgs = {\n  startedOnElementId: string;\n  elements: any[];\n  index?: number;\n  toIndex?: number;\n  appendBackwards?: string;\n  liftBackwards?: string[];\n  focusAfter?: number;\n};\n\nexport type LiftChildrenArgs = {\n  startedOnElementId: string;\n  index: number;\n  toIndex: number;\n};\n\nexport const UPDATE_CONTENT_TAG = 'update-content';\nexport const SPLICE_CHILDREN_TAG = 'splice-children';\nexport const LIFT_CHILDREN_TAG = 'lift-children';\nexport const CONTENT_UPDATED_TAG = 'content-updated';\n\nexport class UpdateContentEvent extends CustomEvent<UpdateContentArgs> {\n  constructor(init: CustomEventInit<UpdateContentArgs>) {\n    super(UPDATE_CONTENT_TAG, init);\n  }\n}\n\nexport class SpliceChildrenEvent extends CustomEvent<SpliceChildrenArgs> {\n  constructor(init: CustomEventInit<SpliceChildrenArgs>) {\n    super(SPLICE_CHILDREN_TAG, init);\n  }\n}\n\nexport class LiftChildrenEvent extends CustomEvent<LiftChildrenArgs> {\n  constructor(init: CustomEventInit<LiftChildrenArgs>) {\n    super(LIFT_CHILDREN_TAG, init);\n  }\n}\n\nexport class ContentUpdatedEvent extends CustomEvent<ContentUpdatedArgs> {\n  constructor(init: CustomEventInit<ContentUpdatedArgs>) {\n    super(CONTENT_UPDATED_TAG, init);\n  }\n}\n","import { LitElement, property, html, css, query, TemplateResult } from 'lit-element';\n\nimport { ApolloClient, gql } from 'apollo-boost';\n\nimport { ApolloClientModule } from '@uprtcl/graphql';\nimport { moduleConnect, Logger } from '@uprtcl/micro-orchestrator';\nimport { CortexModule, PatternRecognizer, Entity, Signed } from '@uprtcl/cortex';\nimport { DiscoveryModule, EntityCache, loadEntity } from '@uprtcl/multiplatform';\nimport { MenuConfig, UprtclDialog } from '@uprtcl/common-ui';\n\nimport {\n  ProposalCreatedEvent,\n  Perspective,\n  PerspectiveDetails,\n  Commit,\n  getAuthority,\n  EveesConfig\n} from '../types';\nimport { EveesBindings } from '../bindings';\nimport { DELETE_PERSPECTIVE, CREATE_PROPOSAL, FORK_PERSPECTIVE } from '../graphql/queries';\nimport { EveesHelpers } from '../graphql/evees.helpers';\nimport { MergeStrategy } from '../merge/merge-strategy';\nimport { Evees } from '../services/evees';\n\nimport { EveesRemote } from '../services/evees.remote';\n\nimport { EveesWorkspace } from '../services/evees.workspace';\nimport { EveesDiff } from './evees-diff';\nimport { ContentUpdatedEvent } from './events';\n\ninterface PerspectiveData {\n  id?: string;\n  perspective?: Perspective;\n  details?: PerspectiveDetails;\n  canWrite?: Boolean;\n  permissions?: any;\n  head?: Entity<Commit>;\n  data?: Entity<any>;\n}\n\nexport class EveesInfoBase extends moduleConnect(LitElement) {\n  logger = new Logger('EVEES-INFO');\n\n  @property({ type: String, attribute: 'uref' })\n  uref!: string;\n\n  @property({ type: String, attribute: 'first-uref' })\n  firstRef!: string;\n\n  @property({ type: String, attribute: 'parent-id' })\n  parentId!: string;\n\n  @property({ type: String, attribute: 'default-remote' })\n  defaultRemoteId: string | undefined = undefined;\n\n  @property({ type: String, attribute: 'official-remote' })\n  officialRemoteId: string | undefined = undefined;\n\n  @property({ type: String, attribute: 'evee-color' })\n  eveeColor!: string;\n\n  @property({ type: Boolean, attribute: 'emit-proposals' })\n  emitProposals: boolean = false;\n\n  @property({ type: String, attribute: false })\n  entityType: string | undefined = undefined;\n\n  @property({ attribute: false })\n  loading: Boolean = false;\n\n  @property({ attribute: false })\n  isLogged: boolean = false;\n\n  @property({ attribute: false })\n  isLoggedOnDefault;\n\n  @property({ attribute: false })\n  forceUpdate: string = 'true';\n\n  @property({ attribute: false })\n  showUpdatesDialog: boolean = false;\n\n  @property({ attribute: false })\n  loggingIn: boolean = false;\n\n  @property({ attribute: false })\n  creatingNewPerspective: boolean = false;\n\n  @property({ attribute: false })\n  proposingUpdate: boolean = false;\n\n  @property({ attribute: false })\n  makingPublic: boolean = false;\n\n  @property({ attribute: false })\n  firstHasChanges!: boolean;\n\n  @property({ attribute: false })\n  merging: boolean = false;\n\n  @query('#updates-dialog')\n  updatesDialogEl!: UprtclDialog;\n\n  @query('#evees-update-diff')\n  eveesDiffEl!: EveesDiff;\n\n  @property({ attribute: false })\n  eveesDiffInfoMessage!: TemplateResult;\n\n  perspectiveData!: PerspectiveData;\n  pullWorkspace: EveesWorkspace | undefined = undefined;\n\n  protected client!: ApolloClient<any>;\n  protected config!: EveesConfig;\n  protected merge!: MergeStrategy;\n  protected evees!: Evees;\n  protected remote!: EveesRemote;\n  protected remotes!: EveesRemote[];\n  protected recognizer!: PatternRecognizer;\n  protected cache!: EntityCache;\n\n  /** official remote is used to indentity the special perspective, \"the master branch\" */\n  protected officialRemote: EveesRemote | undefined = undefined;\n\n  /** default remote is used to create new branches */\n  protected defaultRemote: EveesRemote | undefined = undefined;\n\n  async firstUpdated() {\n    this.client = this.request(ApolloClientModule.bindings.Client);\n    this.config = this.request(EveesBindings.Config);\n    this.merge = this.request(EveesBindings.MergeStrategy);\n    this.evees = this.request(EveesBindings.Evees);\n    this.recognizer = this.request(CortexModule.bindings.Recognizer);\n    this.cache = this.request(DiscoveryModule.bindings.EntityCache);\n\n    this.remotes = this.requestAll(EveesBindings.EveesRemote) as EveesRemote[];\n    this.defaultRemote =\n      this.defaultRemoteId !== undefined\n        ? this.remotes.find(remote => remote.id === this.defaultRemoteId)\n        : (this.request(EveesBindings.Config) as EveesConfig).defaultRemote;\n\n    this.officialRemote =\n      this.officialRemoteId !== undefined\n        ? this.remotes.find(remote => remote.id === this.officialRemoteId)\n        : (this.request(EveesBindings.Config) as EveesConfig).officialRemote;\n  }\n\n  updated(changedProperties) {\n    if (changedProperties.get('uref') !== undefined) {\n      this.logger.info('updated() reload', { changedProperties });\n      this.load();\n    }\n  }\n\n  /** must be called from subclass as super.load() */\n  async load() {\n    this.logger.info('Loading evee perspective', this.uref);\n\n    this.remote = await this.evees.getPerspectiveRemoteById(this.uref);\n\n    const entity = await loadEntity(this.client, this.uref);\n    if (!entity) throw Error(`Entity not found ${this.uref}`);\n\n    this.entityType = this.recognizer.recognizeType(entity);\n\n    this.loading = true;\n\n    if (this.entityType === EveesBindings.PerspectiveType) {\n      const headId = await EveesHelpers.getPerspectiveHeadId(this.client, this.uref);\n\n      const head = headId !== undefined ? await loadEntity<Commit>(this.client, headId) : undefined;\n      const data = await EveesHelpers.getPerspectiveData(this.client, this.uref);\n\n      const canWrite = await EveesHelpers.canWrite(this.client, this.uref);\n\n      this.perspectiveData = {\n        id: this.uref,\n        details: {\n          headId: headId\n        },\n        perspective: (entity.object as Signed<Perspective>).payload,\n        canWrite: canWrite,\n        head,\n        data\n      };\n\n      this.logger.info('load', { perspectiveData: this.perspectiveData });\n    }\n\n    if (this.entityType === EveesBindings.CommitType) {\n      const head = await loadEntity<Commit>(this.client, this.uref);\n      const data = await EveesHelpers.getCommitData(this.client, this.uref);\n\n      this.perspectiveData = {\n        head,\n        data\n      };\n    }\n\n    this.isLogged = await this.remote.isLogged();\n\n    if (this.defaultRemote) await this.defaultRemote.ready();\n\n    this.isLoggedOnDefault =\n      this.defaultRemote !== undefined ? await this.defaultRemote.isLogged() : false;\n\n    this.loading = false;\n    this.logger.log(`evee ${this.uref} loaded`, {\n      perspectiveData: this.perspectiveData,\n      isLogged: this.isLogged,\n      isLoggedOnDefault: this.isLoggedOnDefault\n    });\n  }\n\n  async checkPull(fromUref: string) {\n    if (this.entityType !== EveesBindings.PerspectiveType) {\n      this.pullWorkspace = undefined;\n      return;\n    }\n\n    if (this.uref === fromUref || !this.perspectiveData.canWrite) {\n      this.pullWorkspace = undefined;\n      return;\n    }\n\n    if (this.perspectiveData.perspective === undefined) throw new Error('undefined');\n\n    const config = {\n      forceOwner: true,\n      remote: this.perspectiveData.perspective.remote,\n      path: this.perspectiveData.perspective.path,\n      canWrite: this.remote.userId,\n      parentId: this.uref\n    };\n\n    this.pullWorkspace = new EveesWorkspace(this.client, this.recognizer);\n\n    await this.merge.mergePerspectivesExternal(this.uref, fromUref, this.pullWorkspace, config);\n\n    this.logger.info('checkPull()', this.pullWorkspace);\n  }\n\n  async getContextPerspectives(perspectiveId?: string): Promise<string[]> {\n    perspectiveId = perspectiveId || this.uref;\n    const result = await this.client.query({\n      query: gql`{\n          entity(uref: \"${perspectiveId}\") {\n            id\n            ... on Perspective {\n              payload {\n                remote\n                context {\n                  id\n                  perspectives {\n                    id\n                  } \n                }\n              }\n            }\n          }\n        }`\n    });\n\n    /** data on other perspectives (proposals are injected on them) */\n    const perspectives =\n      result.data.entity.payload.context === null\n        ? []\n        : result.data.entity.payload.context.perspectives;\n\n    // remove duplicates\n    const map = new Map<string, null>();\n    perspectives.forEach(perspective => map.set(perspective.id, null));\n    return Array.from(map, key => key[0]);\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n\n    this.addEventListener('permissions-updated', ((e: CustomEvent) => {\n      this.logger.info('CATCHED EVENT: permissions-updated ', {\n        perspectiveId: this.uref,\n        e\n      });\n      e.stopPropagation();\n      this.load();\n    }) as EventListener);\n  }\n\n  async login() {\n    if (this.defaultRemote === undefined) throw new Error('default remote undefined');\n    this.loggingIn = true;\n    await this.defaultRemote.login();\n\n    await this.client.resetStore();\n    this.load();\n    this.loggingIn = false;\n  }\n\n  async logout() {\n    if (this.defaultRemote === undefined) throw new Error('default remote undefined');\n    await this.defaultRemote.logout();\n\n    await this.client.resetStore();\n    this.load();\n  }\n\n  async otherPerspectiveMerge(fromPerspectiveId: string, toPerspectiveId: string) {\n    this.merging = true;\n    this.logger.info(`merge ${fromPerspectiveId} on ${toPerspectiveId}`);\n\n    const workspace = new EveesWorkspace(this.client, this.recognizer);\n    const toRemoteId = await EveesHelpers.getPerspectiveRemoteId(this.client, toPerspectiveId);\n\n    const config = {\n      forceOwner: true,\n      remote: toRemoteId,\n      parentId: toPerspectiveId\n    };\n\n    const toHeadId = await EveesHelpers.getPerspectiveHeadId(this.client, toPerspectiveId);\n    const fromHeadId = await EveesHelpers.getPerspectiveHeadId(this.client, fromPerspectiveId);\n\n    await this.merge.mergePerspectivesExternal(\n      toPerspectiveId,\n      fromPerspectiveId,\n      workspace,\n      config\n    );\n\n    const canWrite = await EveesHelpers.canWrite(this.client, toPerspectiveId);\n    const toRemote = this.remotes.find(r => r.id === toRemoteId);\n    const canPropose = toRemote\n      ? toRemote.proposals\n        ? await toRemote.proposals.canPropose(this.remote.userId)\n        : false\n      : false;\n\n    const options: MenuConfig = {\n      apply: {\n        text: canWrite ? 'merge' : 'propose',\n        icon: 'done',\n        disabled: !canWrite && !canPropose,\n        skinny: false\n      },\n      close: {\n        text: 'close',\n        icon: 'clear',\n        skinny: true\n      }\n    };\n\n    const result = await this.updatesDialog(\n      workspace,\n      options,\n      this.renderFromToPerspective(toPerspectiveId, fromPerspectiveId)\n    );\n\n    if (result !== 'apply') {\n      this.merging = false;\n      return;\n    }\n\n    /* for some remotes the proposal is not created but sent to a parent component who will \n       take care of executing it */\n    const emitBecauseOfTarget = await EveesHelpers.checkEmit(\n      this.config,\n      this.client,\n      this.remotes,\n      toPerspectiveId\n    );\n\n    if (!canWrite && (emitBecauseOfTarget || this.emitProposals)) {\n      /* entities are just cloned, not part of the proposal */\n      await workspace.executeCreate(this.client);\n      await workspace.precacheNewPerspectives(this.client);\n\n      this.dispatchEvent(\n        new ProposalCreatedEvent({\n          detail: {\n            remote: await EveesHelpers.getPerspectiveRemoteId(this.client, toPerspectiveId),\n            proposalDetails: {\n              newPerspectives: workspace.getNewPerspectives(),\n              updates: workspace.getUpdates()\n            }\n          },\n          bubbles: true,\n          composed: true\n        })\n      );\n\n      this.merging = false;\n      return;\n    }\n\n    /* if the merge execution is not delegated, it is done here. A proposal is created\n       on the toPerspective remote, or the changes are directly applied.\n       Note that it is assumed that if a user canWrite on toPerspectiveId, he can write \n       on all the perspectives inside the workspace.updates array. */\n    if (canWrite) {\n      await workspace.execute(this.client);\n      /* inform the world */\n\n      workspace.getUpdates().map(update => {\n        this.dispatchEvent(\n          new ContentUpdatedEvent({\n            detail: { uref: update.perspectiveId },\n            bubbles: true,\n            composed: true\n          })\n        );\n      });\n    } else {\n      /** create commits and data */\n      await workspace.executeCreate(this.client);\n      await workspace.precacheNewPerspectives(this.client);\n\n      if (fromHeadId === undefined) throw new Error(`undefined head for ${fromPerspectiveId}`);\n      await this.createMergeProposal(\n        fromPerspectiveId,\n        toPerspectiveId,\n        fromHeadId,\n        toHeadId,\n        workspace\n      );\n    }\n\n    if (this.uref !== toPerspectiveId) {\n      this.checkoutPerspective(toPerspectiveId);\n    }\n\n    this.merging = false;\n  }\n\n  async createMergeProposal(\n    fromPerspectiveId: string,\n    toPerspectiveId: string,\n    fromHeadId: string,\n    toHeadId: string | undefined,\n    workspace: EveesWorkspace\n  ): Promise<void> {\n    // TODO: handle proposals and updates on multiple authorities.\n    const toRemoteId = await EveesHelpers.getPerspectiveRemoteId(this.client, toPerspectiveId);\n\n    const not = await workspace.isSingleAuthority(toRemoteId);\n    if (!not) throw new Error('cant create merge proposals on multiple authorities yet');\n\n    const result = await this.client.mutate({\n      mutation: CREATE_PROPOSAL,\n      variables: {\n        toPerspectiveId,\n        fromPerspectiveId,\n        toHeadId,\n        fromHeadId,\n        newPerspectives: workspace.getNewPerspectives(),\n        updates: workspace.getUpdates()\n      }\n    });\n\n    const proposalId = result.data.addProposal.id;\n\n    this.logger.info('created proposal', { proposalId });\n  }\n\n  async deletePerspective(perspectiveId?: string) {\n    const result = await this.client.mutate({\n      mutation: DELETE_PERSPECTIVE,\n      variables: {\n        perspectiveId: perspectiveId || this.uref\n      }\n    });\n  }\n\n  async forkPerspective(perspectiveId?: string) {\n    this.creatingNewPerspective = true;\n\n    const result = await this.client.mutate({\n      mutation: FORK_PERSPECTIVE,\n      variables: {\n        perspectiveId: perspectiveId || this.uref,\n        remote: this.defaultRemoteId\n      }\n    });\n\n    const newPerspectiveId = result.data.forkPerspective.id;\n\n    this.dispatchEvent(\n      new CustomEvent('new-perspective-created', {\n        detail: {\n          oldPerspectiveId: this.uref,\n          newPerspectiveId: newPerspectiveId\n        },\n        bubbles: true,\n        composed: true\n      })\n    );\n    this.checkoutPerspective(newPerspectiveId);\n\n    this.logger.info('newPerspectiveClicked() - perspective created', {\n      id: newPerspectiveId\n    });\n    this.creatingNewPerspective = false;\n  }\n\n  checkoutPerspective(perspectiveId: string) {\n    this.dispatchEvent(\n      new CustomEvent('checkout-perspective', {\n        detail: {\n          perspectiveId: perspectiveId\n        },\n        composed: true,\n        bubbles: true\n      })\n    );\n  }\n\n  async proposeMergeClicked() {\n    this.proposingUpdate = true;\n    await this.otherPerspectiveMerge(this.uref, this.firstRef);\n    this.proposingUpdate = false;\n  }\n\n  perspectiveTextColor() {\n    if (this.uref === this.firstRef) {\n      return '#37352f';\n    } else {\n      return '#ffffff';\n    }\n  }\n\n  async delete() {\n    if (!this.client) throw new Error('client undefined');\n\n    await this.client.mutate({\n      mutation: DELETE_PERSPECTIVE,\n      variables: {\n        perspectiveId: this.uref\n      }\n    });\n\n    this.checkoutPerspective(this.firstRef);\n  }\n\n  async updatesDialog(\n    workspace: EveesWorkspace,\n    options: MenuConfig,\n    message: TemplateResult = html``\n  ): Promise<string> {\n    this.showUpdatesDialog = true;\n    await this.updateComplete;\n\n    this.updatesDialogEl.options = options;\n    this.eveesDiffEl.workspace = workspace;\n    this.eveesDiffInfoMessage = message;\n\n    return new Promise(resolve => {\n      this.updatesDialogEl.resolved = value => {\n        this.showUpdatesDialog = false;\n        resolve(value);\n      };\n    });\n  }\n\n  renderUpdatesDialog() {\n    return html`\n      <uprtcl-dialog id=\"updates-dialog\">\n        <div>${this.eveesDiffInfoMessage}</div>\n        <evees-update-diff id=\"evees-update-diff\"></evees-update-diff>\n      </uprtcl-dialog>\n    `;\n  }\n\n  renderFromToPerspective(toPerspectiveId: string, fromPerspectiveId: string) {\n    return html`\n      <div class=\"row merge-message\">\n        <uprtcl-indicator label=\"To\">\n          <evees-perspective-icon perspective-id=${toPerspectiveId}></evees-perspective-icon>\n        </uprtcl-indicator>\n        <div class=\"arrow\">\n          <uprtcl-icon-button icon=\"arrow_back\"></uprtcl-icon-button>\n        </div>\n        <uprtcl-indicator label=\"From\">\n          <evees-perspective-icon perspective-id=${fromPerspectiveId}></evees-perspective-icon>\n        </uprtcl-indicator>\n      </div>\n    `;\n  }\n\n  renderLoading() {\n    return html`\n      <uprtcl-loading></uprtcl-loading>\n    `;\n  }\n\n  /** overwrite */\n  renderIcon() {\n    return html`\n      <evees-perspective-icon perspective-id=${this.uref}></evees-perspective-icon>\n    `;\n  }\n\n  renderInfo() {\n    return html`\n      <div class=\"perspective-details\">\n        <div class=\"prop-name\"><h2>${this.entityType}</h2></div>\n        ${this.entityType === EveesBindings.PerspectiveType\n          ? html`\n              <div class=\"prop-name\">perspective id</div>\n              <pre class=\"prop-value\">${this.perspectiveData.id}</pre>\n\n              <div class=\"prop-name\">perspective</div>\n              <pre class=\"prop-value\">\n${JSON.stringify(this.perspectiveData.perspective, undefined, 2)}</pre\n              >\n\n              <div class=\"prop-name\">authority</div>\n              <pre class=\"prop-value\">\n${this.perspectiveData.perspective ? getAuthority(this.perspectiveData.perspective) : ''}</pre\n              >\n            `\n          : ''}\n\n        <div class=\"prop-name\">head</div>\n        <pre class=\"prop-value\">${JSON.stringify(this.perspectiveData.head, undefined, 2)}</pre>\n\n        <div class=\"prop-name\">data</div>\n        <pre class=\"prop-value\">${JSON.stringify(this.perspectiveData.data, undefined, 2)}</pre>\n      </div>\n    `;\n  }\n\n  static get styles() {\n    return [\n      css`\n        .perspective-details {\n          padding: 5px;\n          text-align: left;\n          max-width: calc(100vw - 72px);\n          min-width: 490px;\n        }\n\n        .prop-name {\n          font-weight: bold;\n          width: 100%;\n        }\n\n        .prop-value {\n          font-family: Lucida Console, Monaco, monospace;\n          font-size: 12px;\n          text-align: left;\n          background-color: #a0a3cb;\n          color: #1c1d27;\n          padding: 16px 16px;\n          margin-bottom: 16px;\n          border-radius: 6px;\n          width: 100%;\n          overflow: auto;\n          width: calc(100% - 32px);\n          overflow-x: auto;\n        }\n        .row {\n          width: 100%;\n          display: flex;\n          margin-bottom: 20px;\n        }\n        .merge-message uprtcl-indicator {\n          flex: 1 1 auto;\n          margin: 5px;\n        }\n        .merge-message .arrow {\n          flex: 0.3 1 auto;\n          display: flex;\n          flex-direction: column;\n          justify-content: center;\n          align-items: center;\n        }\n      `\n    ];\n  }\n}\n","import { html, css, property, query } from 'lit-element';\nconst styleMap = style => {\n  return Object.entries(style).reduce((styleString, [propName, propValue]) => {\n    propName = propName.replace(/([A-Z])/g, matches => `-${matches[0].toLowerCase()}`);\n    return `${styleString}${propName}:${propValue};`;\n  }, '');\n};\n\nimport { Logger } from '@uprtcl/micro-orchestrator';\n\nimport { EveesInfoBase } from './evees-info-base';\nimport { UPDATE_HEAD } from '../graphql/queries';\nimport { ApolloClient } from 'apollo-boost';\nimport { MenuConfig } from '@uprtcl/common-ui';\nimport { doesNotReject } from 'assert';\n\nexport class EveesInfoPage extends EveesInfoBase {\n  logger = new Logger('EVEES-INFO-PAGE');\n\n  @property({ type: Boolean, attribute: 'show-perspectives' })\n  showPerspectives: boolean = false;\n\n  @property({ type: Boolean, attribute: 'show-proposals' })\n  showProposals: boolean = false;\n\n  @property({ type: Boolean, attribute: 'show-acl' })\n  showAcl: boolean = false;\n\n  @property({ type: Boolean, attribute: 'show-info' })\n  showInfo: boolean = false;\n\n  @property({ attribute: false })\n  showEditName: boolean = false;\n\n  @property({ attribute: true })\n  parentId: string = '';\n\n  @query('#draft-textfield')\n  draftTextField!: any;\n\n  async firstUpdated() {\n    super.firstUpdated();\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n\n    this.logger.log('Connected', this.uref);\n\n    this.addEventListener('keydown', event => {\n      if (event.keyCode === 27) {\n        // 27 is esc\n        this.showEditName = false;\n      }\n\n      if (event.keyCode === 13) {\n        // 13 is enter\n        if (this.showEditName) {\n          this.saveName();\n        }\n      }\n    });\n  }\n\n  async disconnectedCallback() {\n    super.disconnectedCallback();\n    this.logger.log('Disconnected', this.uref);\n  }\n\n  async editNameClicked() {\n    this.showEditName = true;\n    await this.updateComplete;\n    this.draftTextField.focus();\n  }\n\n  async saveName() {\n    if (!this.shadowRoot) return;\n    const client = this.client as ApolloClient<any>;\n    const newName = this.draftTextField.value;\n\n    this.showEditName = false;\n\n    await client.mutate({\n      mutation: UPDATE_HEAD,\n      variables: {\n        perspectiveId: this.uref,\n        name: newName\n      }\n    });\n\n    this.load();\n  }\n\n  optionClicked(e) {\n    switch (e.detail.key) {\n      case 'logout':\n        this.logout();\n        break;\n\n      case 'login':\n        this.login();\n        break;\n\n      case 'edit-profile':\n        if (this.defaultRemote) {\n          window.open(`https://3box.io/${this.defaultRemote.userId}`);\n        }\n        break;\n\n      case 'edit':\n        this.editNameClicked();\n        break;\n    }\n  }\n\n  async showPullChanges() {\n    if (!this.pullWorkspace) throw new Error('pullWorkspace undefined');\n\n    const options: MenuConfig = {\n      apply: {\n        text: 'apply',\n        icon: 'done',\n        skinny: false\n      },\n      close: {\n        text: 'close',\n        icon: 'clear',\n        skinny: true\n      }\n    };\n\n    const result = await this.updatesDialog(this.pullWorkspace, options);\n\n    if (result !== 'apply') {\n      return;\n    }\n\n    await this.pullWorkspace.execute(this.client);\n\n    this.checkoutPerspective(this.uref);\n  }\n\n  renderPermissions() {\n    return html`\n      <div class=\"perspectives-permissions\">\n        ${!this.loading\n          ? this.remote.accessControl.lense().render({ uref: this.uref, parentId: this.parentId })\n          : ''}\n      </div>\n    `;\n  }\n\n  renderNewPerspectiveButton() {\n    return html`\n      <uprtcl-button-loading\n        class=\"section-button\"\n        skinny\n        icon=\"call_split\"\n        @click=${this.forkPerspective}\n        ?loading=${this.creatingNewPerspective}\n      >\n        new perspective\n      </uprtcl-button-loading>\n    `;\n  }\n\n  renderMakeProposalButton() {\n    return html`\n      <uprtcl-button-loading\n        class=\"section-button\"\n        skinny\n        icon=\"call_merge\"\n        @click=${this.proposeMergeClicked}\n        ?loading=${this.proposingUpdate}\n      >\n        Propose Merge\n      </uprtcl-button-loading>\n    `;\n  }\n\n  renderPerspectiveActions() {\n    /** most likely action button */\n    const actionButton = html`\n        ${\n          this.isLogged && this.uref !== this.firstRef\n            ? html`\n                <div class=\"action-button\">\n                  ${this.renderMakeProposalButton()}\n                </div>\n              `\n            : this.isLoggedOnDefault\n            ? html`\n                <div class=\"action-button\">\n                  ${this.renderNewPerspectiveButton()}\n                </div>\n              `\n            : ''\n        }\n      </div>\n    `;\n\n    const contextButton = html`\n      <div class=\"context-menu\">\n        <uprtcl-help>\n          <span>\n            To update the \"Official Version\" of this Wiki you need to create a new \"Perspective\"<br /><br />\n            Once changes have been made to that perspectective, click \"Propose Update\" to update the\n            \"Official\" perspective.\n          </span>\n        </uprtcl-help>\n      </div>\n    `;\n\n    const pullButton = html`\n      <div class=\"pull-menu\">\n        <uprtcl-icon-button @click=${this.showPullChanges} icon=\"play_for_work\" button>\n        </uprtcl-icon-button>\n      </div>\n    `;\n\n    return html`\n      ${this.showEditName ? '' : actionButton} ${contextButton}\n      ${this.firstHasChanges ? pullButton : ''}\n    `;\n  }\n\n  render() {\n    if (this.perspectiveData === undefined)\n      return html`\n        <uprtcl-loading></uprtcl-loading>\n      `;\n\n    return html`\n      <div class=\"container\">\n        <div class=\"column\">\n          ${this.showPerspectives\n            ? html`\n                <div class=\"section\">\n                  <div class=\"section-header perspective-title\">\n                    Perspectives\n                  </div>\n\n                  <div class=\"section-content\">\n                    ${this.renderPerspectiveActions()}\n                    <div class=\"list-container\">\n                      ${!this.loading\n                        ? html`\n                            <evees-perspectives-list\n                              perspective-id=${this.uref}\n                              ?can-propose=${this.isLogged}\n                              @perspective-selected=${e => this.checkoutPerspective(e.detail.id)}\n                              @merge-perspective=${e =>\n                                this.otherPerspectiveMerge(e.detail.perspectiveId, this.uref)}\n                            ></evees-perspectives-list>\n                          `\n                        : html`\n                            <uprtcl-loading></uprtcl-loading>\n                          `}\n                    </div>\n                  </div>\n                </div>\n              `\n            : ''}\n          ${this.showProposals\n            ? html`\n                <div class=\"section\">\n                  <div class=\"section-header\">\n                    Proposals\n                  </div>\n\n                  <div class=\"section-content\">\n                    <div class=\"list-container\">\n                      ${!this.loading\n                        ? html`\n                            <evees-proposals-list\n                              perspective-id=${this.uref}\n                            ></evees-proposals-list>\n                          `\n                        : html`\n                            <uprtcl-loading></uprtcl-loading>\n                          `}\n                    </div>\n                  </div>\n                </div>\n              `\n            : ''}\n          ${this.showAcl\n            ? html`\n                <div class=\"section\">\n                  <div class=\"section-header\">\n                    Access Control\n                  </div>\n                  <div class=\"section-content\">\n                    ${this.renderPermissions()}\n                  </div>\n                  <div class=\"context-menu\"></div>\n                </div>\n              `\n            : ''}\n          ${this.showInfo\n            ? html`\n                <div class=\"section\">\n                  <div class=\"section-header\">\n                    Evee Info\n                  </div>\n                  <div class=\"section-content info-text\">\n                    ${this.renderInfo()}\n                  </div>\n                </div>\n              `\n            : ''}\n        </div>\n      </div>\n      ${this.showUpdatesDialog ? this.renderUpdatesDialog() : ''}\n    `;\n  }\n\n  static get styles() {\n    return super.styles.concat([\n      css`\n        .section-button {\n          width: 220px;\n          margin: 0 auto;\n        }\n\n        p {\n          margin: 0;\n        }\n        .column {\n          display: flex;\n          flex-direction: column;\n          padding: 0px 5vw;\n        }\n        .section {\n          text-align: center;\n          width: 100%;\n          max-width: 700px;\n          margin: 0 auto;\n          box-shadow: 0px 0px 4px 0px rgba(0, 0, 0, 0.2);\n          margin-bottom: 36px;\n          border-radius: 4px;\n          background-color: rgb(255, 255, 255, 0.6);\n          position: relative;\n        }\n        .user-icon {\n          padding-top: 8px;\n          width: 48px;\n          height: 48px;\n          cursor: pointer;\n        }\n        .section-header {\n          font-weight: bold;\n          padding: 2vw 0px 0.8vw 0px;\n          font-size: 30px;\n          border-style: solid 2px;\n        }\n        .section-header evees-author {\n          margin: 0 auto;\n        }\n        .context-menu {\n          position: absolute;\n          top: 6px;\n          right: 6px;\n          display: flex;\n        }\n        .pull-menu {\n          position: absolute;\n          top: 6px;\n          left: 6px;\n        }\n        .section-content {\n          padding: 2.2vw 0px 2.2vw 0px;\n        }\n        .info-text {\n          color: #4e585c;\n          padding: 0px 2.5vw;\n          min-height: 75px;\n        }\n        .action-button {\n          margin-bottom: 24px;\n        }\n        .list-container {\n          min-height: 200px;\n          display: flex;\n          flex-direction: column;\n          text-align: left;\n          padding: 6px 12px 0px 16px;\n          color: #4e585c;\n        }\n\n        @media (max-width: 768px) {\n          .section-header {\n            margin-top: 33px;\n          }\n          .context-menu {\n            top: 2px;\n            right: 5px;\n          }\n          .pull-menu {\n            top: 2px;\n            left: 5px;\n          }\n          .mdc-icon-button {\n            width: 35px !important;\n            height: 35px !important;\n          }\n          .draft-mod-action uprtcl-button {\n            margin-bottom: 10px;\n          }\n          .draft-name uprtcl-textfield {\n            width: 85%;\n          }\n        }\n      `\n    ]);\n  }\n}\n","import { ApolloClient, gql } from 'apollo-boost';\n\nimport { Commit } from '../types';\nimport { Secured } from '../utils/cid-hash';\n\ninterface Path {\n  visited: { [commitId: string]: boolean };\n  heads: string[];\n}\n\nexport class FindMostRecentCommonAncestor {\n  allCommits: { [key: string]: Secured<Commit> } = {};\n  paths: Path[];\n\n  constructor(protected client: ApolloClient<any>, commitsIds: string[]) {\n    this.paths = commitsIds.map((commitId) => ({\n      visited: {},\n      heads: [commitId],\n    }));\n  }\n\n  private getMostRecentCommonAncestor(pathToExplore: Path): string | undefined {\n    // Do we have a commit that has already been visited by all other paths?\n    const otherPaths = this.paths.filter((p) => p !== pathToExplore);\n    return pathToExplore.heads.find((commitId) =>\n      otherPaths.every((path) => path.visited[commitId])\n    );\n  }\n\n  /**\n   * Explore the given path: get the parents of its heads and prepare the path for the next iteration\n   */\n  private async explorePath(pathToExplore: Path): Promise<Path> {\n    const promises = pathToExplore.heads.map(async (commitId) => {\n      let commit: Secured<Commit> | undefined = this.allCommits[commitId];\n      if (!commit) {\n        commit = await this.getCommit(commitId);\n\n        if (!commit) throw new Error('Could not get ancestor commit');\n\n        this.allCommits[commitId] = commit;\n      }\n\n      pathToExplore.visited[commitId] = true;\n      return commit;\n    });\n\n    const commits = await Promise.all(promises);\n    const nextCommits = commits.map((commit) =>\n      commit.object.payload.parentsIds.concat(\n        commit.object.payload.forking ? [commit.object.payload.forking] : []\n      )\n    );\n\n    pathToExplore.heads = Array.prototype.concat.apply([], nextCommits);\n    return pathToExplore;\n  }\n\n  public async getCommit(commitId: string): Promise<Secured<Commit>> {\n    const result = await this.client.query({\n      query: gql`{\n        entity(uref: \"${commitId}\") {\n          id\n          _context {\n            object\n          }\n        }\n      }`,\n    });\n\n    return { id: commitId, object: result.data.entity._context.object };\n  }\n\n  public async compute(): Promise<string | undefined> {\n    // Iterate until there is no more parent commits to explore\n    while (this.paths.find((path) => path.heads.length > 0)) {\n      for (let i = 0; i < this.paths.length; i++) {\n        const commonAncestor = this.getMostRecentCommonAncestor(this.paths[i]);\n\n        // If so, we have the most recent common ancestor, return it\n        if (commonAncestor) {\n          return commonAncestor;\n        }\n\n        // Else, explore parents and prepare for next iteration\n        this.paths[i] = await this.explorePath(this.paths[i]);\n      }\n    }\n\n    return undefined;\n  }\n}\n\nexport default function findMostRecentCommonAncestor(\n  client: ApolloClient<any>\n): (commitsIds: string[]) => Promise<string | undefined> {\n  return (commitsIds: string[]) =>\n    new FindMostRecentCommonAncestor(client, commitsIds).compute();\n}\n","import { Diff, DiffMatchPatch, DiffOp } from 'diff-match-patch-ts';\n\nconst diff = new DiffMatchPatch();\n\nexport class DiffUtils {\n  static charDiff(str1: string, str2: string): Diff[] {\n    const diffs = diff.diff_main(str1, str2);\n    return this.toChars(diffs);\n  }\n\n  static toChars(diffs: Diff[]): Diff[] {\n    let result: Diff[] = [];\n    for (const diff of diffs) {\n      const charDiff = diff[1].split('').map((word) => <Diff>[diff[0], word]);\n      result = result.concat(charDiff);\n    }\n    return result;\n  }\n\n  static alignDiffs(diffs: Diff[][]): { original: Diff[]; news: Diff[][] } {\n    const chars = {\n      original: [] as Array<Diff | undefined>,\n      news: diffs.map(() => []) as Array<Array<Diff | undefined>>,\n    };\n\n    while (!diffs.every((diff) => diff.length === 0)) {\n      const removalIndex = diffs.findIndex(\n        (diff) => diff.length > 0 && diff[0][0] === DiffOp.Delete\n      );\n      if (\n        removalIndex !== -1 &&\n        diffs.every(\n          (diff, index) =>\n            removalIndex === index ||\n            diff[0][0] === DiffOp.Equal ||\n            (diff[0][0] === DiffOp.Delete && diff[0][1] === diffs[removalIndex][0][1])\n        )\n      ) {\n        // There has been a removal\n        let original = diffs[removalIndex][0];\n        diffs.forEach((diff) => diff.shift());\n        chars.original.push(original);\n        chars.news.forEach((newChars) => newChars.push(original));\n      } else {\n        const changeIndex = diffs.findIndex(\n          (diff) => diff.length > 0 && diff[0][0] !== DiffOp.Equal\n        );\n        if (changeIndex !== -1) {\n          const change = diffs[changeIndex].shift();\n          chars.original.push(undefined);\n          for (let i = 0; i < diffs.length; i++) {\n            if (changeIndex === i) {\n              chars.news[i].push(change);\n            } else {\n              chars.news[i].push(undefined);\n            }\n          }\n        } else {\n          let original: Diff | undefined = undefined;\n          diffs.forEach((diff) => (original = diff.shift()));\n          chars.original.push(original);\n          chars.news.forEach((newChars) => newChars.push(original));\n        }\n      }\n    }\n\n    return chars as { original: Diff[]; news: Diff[][] };\n  }\n\n  static applyDiff(str: string, diffs: Diff[]): string {\n    const patches = diff.patch_make(str, diffs, undefined as any);\n    return diff.patch_apply(patches, str)[0];\n  }\n}\n","import { Diff } from 'diff-match-patch-ts';\nimport isEqual from 'lodash-es/isEqual';\n\nimport { DiffUtils } from './diff.utils';\n\nexport function mergeStrings(originalString: string, newStrings: string[]): string {\n  const diffs = newStrings.map((newString) => DiffUtils.charDiff(originalString, newString));\n\n  const alignedDiffs = DiffUtils.alignDiffs(diffs);\n  let mergeDiffs: Diff[] = [];\n  for (let i = 0; i < alignedDiffs.original.length; i++) {\n    const mergeDiff = mergeResult(\n      alignedDiffs.original[i],\n      alignedDiffs.news.map((newChar) => newChar[i])\n    );\n    mergeDiffs.push(mergeDiff);\n  }\n\n  return DiffUtils.applyDiff(originalString, mergeDiffs);\n}\n\n/**\n *\n * @param original\n * @param modifications\n * @returns the appropiate result of the merge\n */\nexport function mergeResult<A>(original: A, modifications: A[]): A {\n  const changes = modifications.filter((modification) => !isEqual(original, modification));\n\n  switch (changes.length) {\n    // Object has not changed\n    case 0:\n      return original;\n    case 1:\n      return changes[0];\n    default:\n      if (changes.every((change) => isEqual(changes[0], change))) {\n        return changes[0];\n      }\n      throw new Error('conflict when trying to merge');\n  }\n}\n","import { ApolloClient, gql } from 'apollo-boost';\nimport { inject, injectable } from 'inversify';\n\nimport { DiscoveryModule, EntityCache, loadEntity } from '@uprtcl/multiplatform';\nimport { Dictionary } from '@uprtcl/micro-orchestrator';\nimport { CortexModule, PatternRecognizer, Entity, Signed } from '@uprtcl/cortex';\nimport { ApolloClientModule } from '@uprtcl/graphql';\n\nimport { UpdateRequest, Commit } from '../types';\nimport { EveesBindings } from '../bindings';\nimport { Evees } from '../services/evees';\nimport { MergeStrategy } from './merge-strategy';\nimport findMostRecentCommonAncestor from './common-ancestor';\nimport { Merge } from '../behaviours/merge';\nimport { mergeResult } from './utils';\nimport { deriveEntity } from '../utils/cid-hash';\nimport { deriveSecured } from '../utils/signed';\nimport { EveesWorkspace } from '../services/evees.workspace';\nimport { EveesHelpers } from '../graphql/evees.helpers';\n\n@injectable()\nexport class SimpleMergeStrategy implements MergeStrategy {\n  constructor(\n    @inject(EveesBindings.Evees) protected evees: Evees,\n    @inject(CortexModule.bindings.Recognizer)\n    protected recognizer: PatternRecognizer,\n    @inject(ApolloClientModule.bindings.Client)\n    protected client: ApolloClient<any>,\n    @inject(DiscoveryModule.bindings.EntityCache)\n    protected entityCache: EntityCache\n  ) {}\n\n  mergePerspectivesExternal(\n    toPerspectiveId: string,\n    fromPerspectiveId: string,\n    workspace: EveesWorkspace,\n    config: any\n  ): Promise<string> {\n    return this.mergePerspectives(toPerspectiveId, fromPerspectiveId, config, workspace);\n  }\n\n  async mergePerspectives(\n    toPerspectiveId: string,\n    fromPerspectiveId: string,\n    workspace: EveesWorkspace,\n    config: any\n  ): Promise<string> {\n    const promises = [toPerspectiveId, fromPerspectiveId].map(async id =>\n      EveesHelpers.getPerspectiveHeadId(this.client, id)\n    );\n    const [toHeadId, fromHeadId] = await Promise.all(promises);\n\n    const remote = await this.evees.getPerspectiveRemoteById(toPerspectiveId);\n\n    let newHead: string | undefined;\n\n    newHead = fromHeadId\n      ? await this.mergeCommits(toHeadId, fromHeadId, remote.id, workspace, config)\n      : toHeadId;\n\n    /** prevent an update head to the same head */\n    if (newHead === toHeadId) {\n      return toPerspectiveId;\n    }\n\n    if (newHead === undefined) {\n      throw new Error('New head is undefined');\n    }\n\n    const request: UpdateRequest = {\n      fromPerspectiveId,\n      perspectiveId: toPerspectiveId,\n      oldHeadId: toHeadId,\n      newHeadId: newHead\n    };\n\n    workspace.update(request);\n    return toPerspectiveId;\n  }\n\n  protected async loadPerspectiveData(perspectiveId: string): Promise<Entity<any>> {\n    const result = await this.client.query({\n      query: gql`{\n        entity(uref: \"${perspectiveId}\") {\n          id\n          ... on Perspective {\n            head {\n              id\n              data {\n                id \n                _context {\n                  object\n                }\n              }\n            }\n          }\n        }\n      }`\n    });\n\n    const object = result.data.entity.head.data._context.object;\n    return {\n      id: result.data.entity.head.data.id,\n      object\n    };\n  }\n\n  protected async loadCommitData(commitId: string | undefined): Promise<Entity<any> | undefined> {\n    if (commitId === undefined) return undefined;\n\n    const result = await this.client.query({\n      query: gql`{\n        entity(uref: \"${commitId}\") {\n          id\n          data {\n            id\n            _context {\n              object\n            }\n          }\n        }\n      }`\n    });\n\n    if (!result.data.entity.data) return undefined;\n\n    const object = result.data.entity.data._context.object;\n    return {\n      id: result.data.entity.data.id,\n      object\n    };\n  }\n\n  async findLatestNonFork(commitId: string) {\n    const commit = await loadEntity<Signed<Commit>>(this.client, commitId);\n    if (commit === undefined) throw new Error('commit not found');\n\n    if (commit.object.payload.forking !== undefined) {\n      return this.findLatestNonFork(commit.object.payload.forking);\n    } else {\n      return commitId;\n    }\n  }\n\n  async mergeCommits(\n    toCommitIdOrg: string | undefined,\n    fromCommitIdOrg: string,\n    remote: string,\n    workspace: EveesWorkspace,\n    config: any\n  ): Promise<string> {\n    const toCommitId = toCommitIdOrg ? await this.findLatestNonFork(toCommitIdOrg) : undefined;\n    const fromCommitId = await this.findLatestNonFork(fromCommitIdOrg);\n\n    const commitsIds = [toCommitId, fromCommitId];\n    const ancestorId = toCommitId\n      ? await findMostRecentCommonAncestor(this.client)(commitsIds)\n      : fromCommitId;\n\n    const datasPromises = commitsIds.map(async commitId => this.loadCommitData(commitId));\n    const newDatas = await Promise.all(datasPromises);\n\n    const ancestorData: any =\n      ancestorId !== undefined ? await this.loadCommitData(ancestorId) : newDatas[0];\n\n    const mergedData = await this.mergeData(ancestorData, newDatas, workspace, config);\n\n    const instance = this.evees.getRemote(remote);\n    const sourceRemote = instance.store;\n\n    const entity = await deriveEntity(mergedData, sourceRemote.cidConfig);\n    entity.casID = sourceRemote.casID;\n\n    /** prevent an update head to the same data */\n    if (\n      ((!!newDatas[0] && entity.id === newDatas[0].id) || toCommitId === fromCommitId) &&\n      toCommitIdOrg !== undefined\n    ) {\n      return toCommitIdOrg;\n    }\n\n    workspace.create(entity);\n\n    if (!instance.userId) throw new Error('Cannot create commits in a casID you are not signed in');\n\n    /** some commits might be undefined */\n    const parentsIds = commitsIds.filter(commit => !!commit);\n\n    const newCommit: Commit = {\n      dataId: entity.id,\n      parentsIds: parentsIds,\n      message: `Merging commits ${parentsIds.toString()}`,\n      timestamp: Date.now(),\n      creatorsIds: [instance.userId]\n    };\n\n    const securedCommit = await deriveSecured(newCommit, instance.store.cidConfig);\n\n    securedCommit.casID = instance.store.casID;\n    workspace.create(securedCommit);\n\n    return securedCommit.id;\n  }\n\n  async mergeData<T extends object>(\n    originalData: T,\n    newDatas: T[],\n    workspace: EveesWorkspace,\n    config: any\n  ): Promise<T> {\n    const merge: Merge | undefined = this.recognizer\n      .recognizeBehaviours(originalData)\n      .find(prop => !!(prop as Merge).merge);\n\n    if (!merge)\n      throw new Error(\n        `Cannot merge data ${JSON.stringify(\n          originalData\n        )} that does not implement the Mergeable behaviour`\n      );\n\n    return merge.merge(originalData)(newDatas, this, workspace, config);\n  }\n\n  async mergeLinks(\n    originalLinks: string[],\n    modificationsLinks: string[][],\n    workspace: EveesWorkspace,\n    config: any\n  ): Promise<string[]> {\n    const allLinks: Dictionary<boolean> = {};\n\n    const originalLinksDic = {};\n    for (let i = 0; i < originalLinks.length; i++) {\n      const link = originalLinks[i];\n      originalLinksDic[link] = {\n        index: i,\n        link: link\n      };\n    }\n\n    const newLinks: Array<Dictionary<{ index: number; link: string }>> = [];\n    for (let i = 0; i < modificationsLinks.length; i++) {\n      const newData = modificationsLinks[i];\n      const links: Dictionary<{ index: number; link: string }> = {};\n      for (let j = 0; j < newData.length; j++) {\n        const link = newData[j];\n        links[link] = {\n          index: j,\n          link: link\n        };\n        allLinks[link] = true;\n      }\n      newLinks.push(links);\n    }\n\n    const resultLinks: any[] = [];\n    for (const link of Object.keys(allLinks)) {\n      const linkResult = mergeResult(\n        originalLinksDic[link],\n        newLinks.map(newLink => newLink[link])\n      );\n      if (linkResult) {\n        resultLinks.push(linkResult);\n      }\n    }\n\n    const sortedLinks = resultLinks\n      .sort((link1, link2) => link1.index - link2.index)\n      .map(link => link.link);\n\n    return sortedLinks;\n  }\n}\n","import { gql } from 'apollo-boost';\nimport { injectable } from 'inversify';\n\nimport { Dictionary } from '@uprtcl/micro-orchestrator';\nimport { loadEntity } from '@uprtcl/multiplatform';\nimport { HasChildren, Signed } from '@uprtcl/cortex';\n\nimport { SimpleMergeStrategy } from './simple.merge-strategy';\nimport { EveesWorkspace } from '../services/evees.workspace';\nimport { Perspective } from '../types';\n\n@injectable()\nexport class RecursiveContextMergeStrategy extends SimpleMergeStrategy {\n  perspectivesByContext:\n    | Dictionary<{\n        to: string | undefined;\n        from: string | undefined;\n      }>\n    | undefined = undefined;\n\n  allPerspectives: Dictionary<string> | undefined = undefined;\n\n  async isPattern(id: string, type: string): Promise<boolean> {\n    const entity = await loadEntity(this.client, id);\n    if (entity === undefined) throw new Error('entity not found');\n    const recongnizedType = this.recognizer.recognizeType(entity);\n    return type === recongnizedType;\n  }\n\n  setPerspective(perspectiveId: string, context: string, to: boolean): void {\n    if (!this.perspectivesByContext) throw new Error('perspectivesByContext undefined');\n    if (!this.allPerspectives) throw new Error('allPerspectives undefined');\n\n    if (!this.perspectivesByContext[context]) {\n      this.perspectivesByContext[context] = {\n        to: undefined,\n        from: undefined\n      };\n    }\n\n    if (to) {\n      this.perspectivesByContext[context].to = perspectiveId;\n    } else {\n      this.perspectivesByContext[context].from = perspectiveId;\n    }\n\n    this.allPerspectives[perspectiveId] = context;\n  }\n\n  async readPerspective(perspectiveId: string, to: boolean): Promise<void> {\n    const result = await this.client.query({\n      query: gql`{\n        entity(uref: \"${perspectiveId}\") {\n          id\n          ... on Perspective {\n            payload {\n              context {\n                id\n              }\n            }\n            head {\n              id\n              data {\n                id\n                _context {\n                  object\n                }\n              }\n            }\n          }\n        }\n      }`\n    });\n\n    const context = result.data.entity.payload.context.id;\n\n    this.setPerspective(perspectiveId, context, to);\n\n    if (result.data.entity.head == null) {\n      return;\n    }\n\n    /** read children recursively */\n    const dataObject = result.data.entity.head.data._context.object;\n    const dataId = result.data.entity.head.data.id;\n    const data = { id: dataId, object: dataObject };\n\n    const hasChildren: HasChildren | undefined = this.recognizer\n      .recognizeBehaviours(data)\n      .find(prop => !!(prop as HasChildren).getChildrenLinks);\n\n    if (hasChildren) {\n      const links = hasChildren.getChildrenLinks(data);\n\n      const promises = links.map(async link => {\n        const isPerspective = await this.isPattern(link, 'Perspective');\n        if (isPerspective) {\n          this.readPerspective(link, to);\n        } else {\n          Promise.resolve();\n        }\n      });\n\n      await Promise.all(promises);\n    }\n  }\n\n  async readAllSubcontexts(toPerspectiveId: string, fromPerspectiveId: string): Promise<void> {\n    const promises = [\n      this.readPerspective(toPerspectiveId, true),\n      this.readPerspective(fromPerspectiveId, false)\n    ];\n\n    await Promise.all(promises);\n  }\n\n  async mergePerspectivesExternal(\n    toPerspectiveId: string,\n    fromPerspectiveId: string,\n    workspace: EveesWorkspace,\n    config: any\n  ) {\n    /** reset internal state */\n    this.perspectivesByContext = undefined;\n    this.allPerspectives = undefined;\n\n    return this.mergePerspectives(toPerspectiveId, fromPerspectiveId, workspace, config);\n  }\n\n  async mergePerspectives(\n    toPerspectiveId: string,\n    fromPerspectiveId: string,\n    workspace: EveesWorkspace,\n    config: any\n  ): Promise<string> {\n    let root = false;\n    if (!this.perspectivesByContext) {\n      root = true;\n      this.perspectivesByContext = {};\n      this.allPerspectives = {};\n      await this.readAllSubcontexts(toPerspectiveId, fromPerspectiveId);\n    }\n\n    return super.mergePerspectives(toPerspectiveId, fromPerspectiveId, workspace, config);\n  }\n\n  private async getPerspectiveContext(perspectiveId: string): Promise<string> {\n    if (!this.allPerspectives) throw new Error('allPerspectives undefined');\n\n    if (this.allPerspectives[perspectiveId]) {\n      return this.allPerspectives[perspectiveId];\n    } else {\n      const secured = await loadEntity<Signed<Perspective>>(this.client, perspectiveId);\n      if (!secured) throw new Error(`perspective ${perspectiveId} not found`);\n      return secured.object.payload.context;\n    }\n  }\n\n  async getLinkMergeId(link: string) {\n    const isPerspective = await this.isPattern(link, 'Perspective');\n    if (isPerspective) {\n      return this.getPerspectiveContext(link);\n    } else {\n      return Promise.resolve(link);\n    }\n  }\n\n  async mergeLinks(\n    originalLinks: string[],\n    modificationsLinks: string[][],\n    workspace: EveesWorkspace,\n    config: any\n  ): Promise<string[]> {\n    if (!this.perspectivesByContext) throw new Error('perspectivesByContext undefined');\n\n    /** The context is used as Merge ID for perspective to have a context-based merge. For other\n     * type of entities, like commits or data, the link itself is used as mergeId */\n    const originalPromises = originalLinks.map(link => this.getLinkMergeId(link));\n    const modificationsPromises = modificationsLinks.map(links =>\n      links.map(link => this.getLinkMergeId(link))\n    );\n\n    const originalMergeIds = await Promise.all(originalPromises);\n    const modificationsMergeIds = await Promise.all(\n      modificationsPromises.map(promises => Promise.all(promises))\n    );\n\n    const mergedLinks = await super.mergeLinks(\n      originalMergeIds,\n      modificationsMergeIds,\n      workspace,\n      config\n    );\n\n    const dictionary = this.perspectivesByContext;\n\n    const mergeLinks = mergedLinks.map(\n      async (link): Promise<string> => {\n        const perspectivesByContext = dictionary[link];\n\n        if (perspectivesByContext) {\n          const needsSubperspectiveMerge = perspectivesByContext.to && perspectivesByContext.from;\n\n          if (needsSubperspectiveMerge) {\n            /** Two perspectives of the same context are merged, keeping the \"to\" perspecive id,\n             *  and updating its head (here is where recursion start) */\n\n            config = {\n              parentId: perspectivesByContext.to,\n              ...config\n            };\n\n            await this.mergePerspectives(\n              perspectivesByContext.to as string,\n              perspectivesByContext.from as string,\n              workspace,\n              config\n            );\n\n            return perspectivesByContext.to as string;\n          } else {\n            if (perspectivesByContext.to) {\n              /** if the perspective is only present in the \"to\", just keep it */\n              return perspectivesByContext.to;\n            } else {\n              /** otherwise, if merge config.forceOwner and this perspective is only present in the\n               * \"from\", a fork will be created using parentId as the source for permissions*/\n              if (config.forceOwner) {\n                const newPerspectiveId = await this.evees.forkPerspective(\n                  perspectivesByContext.from as string,\n                  workspace,\n                  config.remote,\n                  config.parentId\n                );\n                return newPerspectiveId;\n              } else {\n                return perspectivesByContext.from as string;\n              }\n            }\n          }\n        } else {\n          return link;\n        }\n      }\n    );\n\n    const mergeResults = await Promise.all(mergeLinks);\n\n    return mergeResults;\n  }\n}\n","// The random number is a js implementation of the Xorshift PRNG\nvar randseed = new Array(4); // Xorshift: [x, y, z, w] 32 bit values\n\nfunction seedrand(seed) {\n  for (var i = 0; i < randseed.length; i++) {\n    randseed[i] = 0;\n  }\n  for (var i = 0; i < seed.length; i++) {\n    randseed[i % 4] =\n      (randseed[i % 4] << 5) - randseed[i % 4] + seed.charCodeAt(i);\n  }\n}\n\nfunction rand() {\n  // based on Java's String.hashCode(), expanded to 4 32bit values\n  var t = randseed[0] ^ (randseed[0] << 11);\n\n  randseed[0] = randseed[1];\n  randseed[1] = randseed[2];\n  randseed[2] = randseed[3];\n  randseed[3] = randseed[3] ^ (randseed[3] >> 19) ^ t ^ (t >> 8);\n\n  return (randseed[3] >>> 0) / ((1 << 31) >>> 0);\n}\n\nfunction createColor() {\n  //saturation is the whole color spectrum\n  var h = Math.floor(rand() * 360);\n  //saturation goes from 40 to 100, it avoids greyish colors\n  var s = rand() * 60 + 40 + '%';\n  //lightness can be anything from 0 to 100, but probabilities are a bell curve around 50%\n  var l = (rand() + rand() + rand() + rand()) * 25 + '%';\n\n  var color = 'hsl(' + h + ',' + s + ',' + l + ')';\n  return color;\n}\n\nfunction createImageData(size) {\n  var width = size; // Only support square icons for now\n  var height = size;\n\n  var dataWidth = Math.ceil(width / 2);\n  var mirrorWidth = width - dataWidth;\n\n  var data = [];\n  for (var y = 0; y < height; y++) {\n    var row = [];\n    for (var x = 0; x < dataWidth; x++) {\n      // this makes foreground and background color to have a 43% (1/2.3) probability\n      // spot color has 13% chance\n      row[x] = Math.floor(rand() * 2.3);\n    }\n    var r = row.slice(0, mirrorWidth);\n    r.reverse();\n    row = row.concat(r);\n\n    for (var i = 0; i < row.length; i++) {\n      data.push(row[i]);\n    }\n  }\n\n  return data;\n}\n\nfunction buildOpts(opts) {\n  var newOpts = {};\n\n  newOpts.seed =\n    opts.seed || Math.floor(Math.random() * Math.pow(10, 16)).toString(16);\n\n  seedrand(newOpts.seed);\n\n  newOpts.size = opts.size || 8;\n  newOpts.scale = opts.scale || 4;\n  newOpts.color = opts.color || createColor();\n  newOpts.bgcolor = opts.bgcolor || createColor();\n  newOpts.spotcolor = opts.spotcolor || createColor();\n\n  return newOpts;\n}\n\nfunction renderIcon(opts, canvas) {\n  opts = buildOpts(opts || {});\n  var imageData = createImageData(opts.size);\n  var width = Math.sqrt(imageData.length);\n\n  canvas.width = canvas.height = opts.size * opts.scale;\n\n  var cc = canvas.getContext('2d');\n  cc.fillStyle = opts.bgcolor;\n  cc.fillRect(0, 0, canvas.width, canvas.height);\n  cc.fillStyle = opts.color;\n\n  for (var i = 0; i < imageData.length; i++) {\n    // if data is 0, leave the background\n    if (imageData[i]) {\n      var row = Math.floor(i / width);\n      var col = i % width;\n\n      // if data is 2, choose spot color, if 1 choose foreground\n      cc.fillStyle = imageData[i] == 1 ? opts.color : opts.spotcolor;\n\n      cc.fillRect(col * opts.scale, row * opts.scale, opts.scale, opts.scale);\n    }\n  }\n  return canvas;\n}\n\nfunction createIcon(opts) {\n  var canvas = document.createElement('canvas');\n\n  renderIcon(opts, canvas);\n\n  return canvas;\n}\n\nvar blockies = {\n  create: createIcon,\n  render: renderIcon,\n};\n\nexport { blockies };\n","import { LitElement, property, html, css, query } from 'lit-element';\n// import * as ENS from 'ethereum-ens';\nimport { blockies } from './blockies.js';\n\nimport { moduleConnect, Logger } from '@uprtcl/micro-orchestrator';\nconst styleMap = style => {\n  return Object.entries(style).reduce((styleString, [propName, propValue]) => {\n    propName = propName.replace(/([A-Z])/g, matches => `-${matches[0].toLowerCase()}`);\n    return `${styleString}${propName}:${propValue};`;\n  }, '');\n};\n\nexport class EveesAuthor extends moduleConnect(LitElement) {\n  logger = new Logger('EVEES-AUTHOR');\n\n  @property({ type: String, attribute: 'user-id' })\n  userId!: string;\n\n  @property({ type: Boolean, attribute: 'show-name' })\n  showName: boolean = false;\n\n  @property({ type: Boolean })\n  short: boolean = false;\n\n  @property({ type: String })\n  color!: string;\n\n  @property({ attribute: false })\n  loading: boolean = true;\n\n  @property({ attribute: false })\n  profile: any = {};\n\n  @property({ attribute: false })\n  image: any | undefined = undefined;\n\n  @query('#blockie-canvas')\n  blockie!: HTMLElement;\n\n  async firstUpdated() {\n    this.load();\n  }\n\n  updated(changedProperties) {\n    if (changedProperties.has('userId')) {\n      this.load();\n    }\n  }\n\n  async load() {\n    this.image = undefined;\n    this.profile = {};\n    this.profile.userId = this.userId;\n\n    /** wait so that the canvas blockie is alraedy rendered */\n    this.requestUpdate();\n    await this.updateComplete;\n\n    if (this.blockie != null) {\n      blockies.render(\n        {\n          seed: this.profile.userId,\n          size: 8,\n          scale: 4\n        },\n        this.blockie\n      );\n    }\n\n    // this.profile = await Box.getProfile(this.userId);\n    this.profile.userId = this.userId;\n    this.image = this.profile.image\n      ? `https://ipfs.io/ipfs/${this.profile.image[0].contentUrl['/']}`\n      : undefined;\n\n    this.requestUpdate();\n\n    // let provider = window['ethereum'];\n    // await provider.enable();\n    // const ensApi = new ENS(provider);\n\n    // try {\n    //   this.logger.log('ens', ens);\n    //   const add = await ensApi.resolver(ens).addr();\n    //   this.logger.log('add', add);\n    // } catch (e) {\n    //   this.logger.warn('error connecting to ensApi');\n    // }\n  }\n\n  clicked() {\n    if (this.profile.url) {\n      window.location = this.profile.url;\n    }\n  }\n\n  render() {\n    if (this.profile.userId === undefined) return '';\n    let addressBoxClasses = ['box-address-txt'];\n    if (this.short) {\n      addressBoxClasses.push('box-address-shorter');\n    } else {\n      addressBoxClasses.push('box-address-short');\n    }\n    return html`\n      <div class=\"box-address\">\n        <div\n          class=\"box-img\"\n          style=\"${styleMap({\n            borderColor: this.color\n          })}\"\n        >\n          ${this.image !== undefined\n            ? html`\n                <img src=${this.image} />\n              `\n            : html`\n                <canvas id=\"blockie-canvas\"></canvas>\n              `}\n          }\n        </div>\n\n        ${this.showName\n          ? html`\n              <div class=${addressBoxClasses.join(' ')}>\n                ${this.profile.name ? this.profile.name : this.profile.userId}\n              </div>\n            `\n          : ''}\n      </div>\n    `;\n  }\n\n  static get styles() {\n    const baseTileHeight = css`28px`;\n    return css`\n      :host {\n        width: fit-content;\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n      }\n      .box-address {\n        background: transparent;\n        height: fit-content;\n        padding: 0px;\n        position: relative;\n        width: fit-content;\n        display: flex;\n        justify-content: flex-start;\n        align-items: center;\n      }\n\n      .box-address .box-img {\n        background: rgb(7, 73, 136);\n        height: ${baseTileHeight};\n        width: ${baseTileHeight};\n        border-radius: 50%;\n        overflow: hidden;\n        border-style: solid;\n        border-width: 2px;\n      }\n\n      .box-address .box-img img {\n        height: 100%;\n        width: 100%;\n        object-fit: cover;\n        background-color: white;\n      }\n\n      .box-address-txt {\n        color: var(--color, rgb(99, 102, 104));\n        font-size: 15px;\n        font-weight: 600;\n        letter-spacing: 0.015em;\n        display: block;\n        padding: 0 16px 0px 10px;\n        text-overflow: ellipsis;\n        overflow: hidden;\n        white-space: nowrap;\n      }\n      .box-address-short {\n        max-width: 200px;\n      }\n      .box-address-shorter {\n        max-width: 100px;\n      }\n    `;\n  }\n}\n","import { ApolloClient, gql } from 'apollo-boost';\nimport { LitElement, property, html, css } from 'lit-element';\n\nimport { ApolloClientModule } from '@uprtcl/graphql';\nimport { moduleConnect, Logger } from '@uprtcl/micro-orchestrator';\nimport { EveesHelpers } from '../graphql/evees.helpers';\n\nexport class ProposalsList extends moduleConnect(LitElement) {\n  logger = new Logger('EVEES-PERSPECTIVES-LIST');\n\n  @property({ type: String, attribute: 'perspective-id' })\n  perspectiveId!: string;\n\n  @property({ attribute: false })\n  loadingProposals: boolean = true;\n\n  proposalsIds: string[] = [];\n  remoteId!: string;\n  client!: ApolloClient<any>;\n\n  async firstUpdated() {\n    if (!this.isConnected) return;\n\n    this.client = this.request(ApolloClientModule.bindings.Client);\n    this.load();\n  }\n\n  async load() {\n    if (!this.isConnected) return;\n    if (!this.client) return;\n\n    this.loadingProposals = true;\n    this.logger.info('loadProposals');\n\n    const result = await this.client.query({\n      query: gql`{\n          entity(uref: \"${this.perspectiveId}\") {\n            id\n            ... on Perspective {\n              proposals\n            }\n          }\n        }`\n    });\n\n    /** data on other perspectives (proposals are injected on them) */\n    this.proposalsIds = result.data.entity.proposals;\n    this.remoteId = await EveesHelpers.getPerspectiveRemoteId(this.client, this.perspectiveId);\n\n    this.loadingProposals = false;\n    this.logger.info('getProposals()', { proposalsIds: this.proposalsIds });\n  }\n\n  updated(changedProperties) {\n    if (changedProperties.has('perspectiveId')) {\n      this.logger.log('updating proposals');\n      this.load();\n    }\n  }\n\n  render() {\n    return this.loadingProposals\n      ? html`\n          <div class=\"loading-container\">\n            <uprtcl-loading></uprtcl-loading>\n          </div>\n        `\n      : html`\n          ${this.proposalsIds.length > 0\n            ? html`\n                <uprtcl-list>\n                  ${this.proposalsIds.map(\n                    id =>\n                      html`\n                        <uprtcl-list-item\n                          ><evees-proposal-row\n                            proposal-id=${id}\n                            remote-id=${this.remoteId}\n                          ></evees-proposal-row\n                        ></uprtcl-list-item>\n                      `\n                  )}\n                </uprtcl-list>\n              `\n            : html`\n                <uprtcl-list-item>\n                  <i>No proposals found</i>\n                </uprtcl-list-item>\n              `}\n        `;\n  }\n\n  static get styles() {\n    return css`\n      :host {\n        flex-grow: 1;\n        display: flex;\n        flex-direction: column;\n      }\n      .loading-container {\n        flex-grow: 1;\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n      }\n    `;\n  }\n}\n","import { ApolloClient, gql } from 'apollo-boost';\nimport { LitElement, property, html, css, query } from 'lit-element';\n\nimport { moduleConnect, Logger } from '@uprtcl/micro-orchestrator';\nimport { ApolloClientModule } from '@uprtcl/graphql';\n\nimport { EveesWorkspace } from '../services/evees.workspace';\nimport { EveesRemote } from '../services/evees.remote';\nimport { EveesBindings } from '../bindings';\nimport { EveesDiff } from './evees-diff';\n\nexport class EveesProposalDiff extends moduleConnect(LitElement) {\n  logger = new Logger('EVEES-PROPOSAL-DIFF');\n\n  @property({ type: String, attribute: 'proposal-id' })\n  proposalId!: string;\n\n  @property({ type: String, attribute: 'remote-id' })\n  remoteId!: string;\n\n  @property({ type: Boolean })\n  summary: boolean = false;\n\n  @property({ attribute: false })\n  loading: boolean = true;\n\n  @query('#evees-update-diff')\n  eveesDiffEl!: EveesDiff;\n\n  protected client!: ApolloClient<any>;\n  protected workspace!: EveesWorkspace;\n\n  async firstUpdated() {\n    this.client = this.request(ApolloClientModule.bindings.Client);\n    this.loadProposal();\n  }\n\n  async updated(changedProperties) {\n    this.logger.log('updated()', changedProperties);\n\n    if (changedProperties.has('proposalId')) {\n      this.loadProposal();\n    }\n  }\n\n  async loadProposal() {\n    this.loading = true;\n\n    const eveesRemote = (this.requestAll(EveesBindings.EveesRemote) as EveesRemote[]).find(\n      remote => remote.id === this.remoteId\n    );\n\n    if (eveesRemote === undefined) throw new Error(`remote ${this.remoteId} not found`);\n    if (eveesRemote.proposals === undefined)\n      throw new Error(`proposal of remote ${this.remoteId} undefined`);\n    const proposal = await eveesRemote.proposals.getProposal(this.proposalId);\n\n    if (proposal === undefined)\n      throw new Error(`proposal ${this.proposalId} not found on remote ${this.remoteId}`);\n    this.workspace = new EveesWorkspace(this.client);\n\n    for (const update of proposal.details.updates) {\n      this.workspace.update(update);\n    }\n    for (const newPerspective of proposal.details.newPerspectives) {\n      this.workspace.newPerspective(newPerspective);\n    }\n\n    this.loading = false;\n    await this.updateComplete;\n\n    this.eveesDiffEl.workspace = this.workspace;\n  }\n\n  render() {\n    if (this.loading) {\n      return html`\n        <uprtcl-loading></uprtcl-loading>\n      `;\n    }\n\n    return html`\n      <evees-update-diff id=\"evees-update-diff\" ?summary=${this.summary}> </evees-update-diff>\n    `;\n  }\n\n  static get styles() {\n    return css`\n      :host {\n        display: block;\n        padding: 30px 0px 30px 0px;\n        text-align: center;\n      }\n    `;\n  }\n}\n","import { LitElement, property, internalProperty, html, css } from 'lit-element';\n\nimport { moduleConnect, Logger } from '@uprtcl/micro-orchestrator';\n\nimport { EveesRemote } from '../services/evees.remote';\nimport { EveesBindings } from '../bindings';\nimport { ApolloClient } from 'apollo-boost';\nimport { ApolloClientModule } from '@uprtcl/graphql';\nimport { Lens } from '@uprtcl/lenses';\n\nexport class EveesLoginWidget extends moduleConnect(LitElement) {\n  logger = new Logger('EVEES-LOGIN');\n\n  @property({ attribute: false })\n  loading: boolean = true;\n\n  @property({ attribute: false })\n  logged!: boolean;\n\n  remotes!: EveesRemote[];\n  client!: ApolloClient<any>;\n\n  @internalProperty()\n  private showAccountSelection: boolean = false;\n\n  async firstUpdated() {\n    this.remotes = this.requestAll(EveesBindings.EveesRemote);\n    this.client = this.request(ApolloClientModule.bindings.Client);\n    this.load();\n  }\n\n  async load() {\n    this.loading = true;\n\n    const loggedList = await Promise.all(this.remotes.map(remote => remote.isLogged()));\n    this.logged = !loggedList.includes(false);\n\n    await Promise.all(this.remotes.map(r => r.ready()));\n\n    this.loading = false;\n  }\n\n  async reload() {\n    await this.client.resetStore();\n    this.dispatchEvent(new CustomEvent('changed'));\n    await this.load();\n  }\n\n  async loginAll() {\n    await Promise.all(\n      this.remotes.map(async remote => {\n        const isLogged = await remote.isLogged();\n        if (!isLogged) await remote.login();\n      })\n    );\n    this.reload();\n  }\n\n  async logoutAll() {\n    await Promise.all(\n      this.remotes.map(async remote => {\n        const isLogged = await remote.isLogged();\n        if (isLogged) {\n          try {\n            await remote.logout();\n          } catch (e) {\n            // TODO: dont swallow errors\n          }\n        }\n      })\n    );\n    this.reload();\n  }\n\n  render() {\n    if (this.loading) {\n      return html`\n        <uprtcl-loading></uprtcl-loading>\n      `;\n    }\n\n    if (!this.logged) {\n      return html`\n        <uprtcl-button @click=${() => this.loginAll()}>login</uprtcl-button>\n      `;\n    }\n\n    return html`\n      <uprtcl-button skinny @click=${() => this.logoutAll()}>logout</uprtcl-button>\n      ${this.remotes.map(remote => {\n        return remote.lense !== undefined\n          ? remote.lense().render({ remoteId: remote.id })\n          : html`\n              <evees-author user-id=${remote.userId as string}></evees-author>\n            `;\n      })}\n    `;\n  }\n\n  static get styles() {\n    return css`\n      :host {\n        display: flex;\n        align-items: center;\n      }\n\n      .account-list-title {\n        text-align: center;\n      }\n\n      uprtcl-button {\n        margin-right: 10px;\n      }\n    `;\n  }\n}\n","import { LitElement, property, html, css, query } from 'lit-element';\n\nimport { moduleConnect, Logger } from '@uprtcl/micro-orchestrator';\nimport { Perspective, Proposal } from '../types';\nimport { EveesRemote } from 'src/services/evees.remote';\nimport { EveesBindings } from 'src/bindings';\nimport { MenuConfig, UprtclDialog } from '@uprtcl/common-ui';\nimport { EveesDiff } from './evees-diff';\nimport { EveesWorkspace } from '../services/evees.workspace';\nimport { ApolloClient } from 'apollo-boost';\nimport { ApolloClientModule } from '@uprtcl/graphql';\nimport { CortexModule, PatternRecognizer, Signed } from '@uprtcl/cortex';\nimport { EveesHelpers } from '../graphql/evees.helpers';\nimport { loadEntity } from '@uprtcl/multiplatform';\nimport { ContentUpdatedEvent } from './events';\nimport { ProposalsProvider } from 'src/services/proposals.provider';\n\nexport class EveesProposalRow extends moduleConnect(LitElement) {\n  logger = new Logger('EVEES-PROPOSAL-ROW');\n\n  @property({ type: String, attribute: 'proposal-id' })\n  proposalId!: string;\n\n  @property({ type: String, attribute: 'remote-id' })\n  remoteId!: string;\n\n  @property({ attribute: false })\n  loading: boolean = true;\n\n  @property({ attribute: false })\n  loadingCreator: boolean = true;\n\n  @property({ attribute: false })\n  showDiff: Boolean = false;\n\n  @property({ attribute: false })\n  authorId: string | undefined = undefined;\n\n  @property({ attribute: false })\n  canRemove: Boolean = false;\n\n  @query('#updates-dialog')\n  updatesDialogEl!: UprtclDialog;\n\n  @query('#evees-update-diff')\n  eveesDiffEl!: EveesDiff;\n\n  remote!: EveesRemote;\n  proposals!: ProposalsProvider;\n  proposal!: Proposal;\n  executed: boolean = false;\n  canExecute: boolean = false;\n\n  protected client!: ApolloClient<any>;\n  protected recognizer!: PatternRecognizer;\n  protected eveesRemotes!: EveesRemote[];\n\n  async firstUpdated() {\n    this.client = this.request(ApolloClientModule.bindings.Client);\n    this.recognizer = this.request(CortexModule.bindings.Recognizer);\n    this.eveesRemotes = this.requestAll(EveesBindings.EveesRemote);\n    const remote = (this.requestAll(EveesBindings.EveesRemote) as EveesRemote[]).find(\n      r => r.id === this.remoteId\n    );\n    if (remote === undefined) throw new Error(`remote ${this.remoteId} not found`);\n\n    const proposals = remote.proposals;\n    if (proposals === undefined)\n      throw new Error(`remote ${this.remoteId} proposals provider not found`);\n\n    this.remote = remote;\n    this.proposals = proposals;\n\n    this.load();\n  }\n\n  updated(changedProperties) {\n    if (changedProperties.has('proposal-id')) {\n      this.load();\n    }\n  }\n\n  async load() {\n    this.loading = true;\n    this.loadingCreator = true;\n\n    if (this.remote.proposals === undefined)\n      throw new Error(`remote ${this.remoteId} cant handle proposals`);\n\n    this.proposal = await this.proposals.getProposal(this.proposalId);\n\n    const fromPerspective = this.proposal.fromPerspectiveId\n      ? await loadEntity<Signed<Perspective>>(this.client, this.proposal.fromPerspectiveId)\n      : undefined;\n\n    /** the author is the creator of the fromPerspective */\n    this.authorId = fromPerspective ? fromPerspective.object.payload.creatorId : undefined;\n    this.loadingCreator = false;\n\n    await this.checkCanExecute();\n    await this.checkExecuted();\n\n    /** the proposal creator is set at proposal creation */\n    this.canRemove = await this.remote.proposals.canRemove(this.proposalId);\n\n    this.loading = false;\n  }\n\n  async checkIsOwner() {}\n\n  async checkExecuted() {\n    /* a proposal is considered accepted if all the updates are now ancestors of their target */\n    const isAncestorVector = await Promise.all(\n      this.proposal.details.updates.map(update => {\n        return EveesHelpers.isAncestorCommit(\n          this.client,\n          update.perspectiveId,\n          update.newHeadId,\n          update.oldHeadId\n        );\n      })\n    );\n\n    this.executed = !isAncestorVector.includes(false);\n  }\n\n  async checkCanExecute() {\n    /* check the update list, if user canWrite on all the target perspectives,\n    the user can execute the proposal */\n    const canExecuteVector = await Promise.all(\n      this.proposal.details.updates.map(\n        async (update): Promise<boolean> => {\n          const remoteId = await EveesHelpers.getPerspectiveRemoteId(\n            this.client,\n            update.perspectiveId\n          );\n          const remote = this.eveesRemotes.find(remote => remote.id === remoteId);\n          if (remote === undefined) throw new Error('remote undefined');\n          return EveesHelpers.canWrite(this.client, update.perspectiveId);\n        }\n      )\n    );\n\n    this.canExecute = !canExecuteVector.includes(false);\n  }\n\n  async showProposalChanges() {\n    const workspace = new EveesWorkspace(this.client, this.recognizer);\n    for (const update of this.proposal.details.updates) {\n      workspace.update(update);\n    }\n\n    for (const newPerspective of this.proposal.details.newPerspectives) {\n      workspace.newPerspective(newPerspective);\n    }\n\n    /* new perspectives are added to the apollo cache to be able to read their head */\n    await workspace.precacheNewPerspectives(this.client);\n\n    this.showDiff = true;\n    const options: MenuConfig = {};\n\n    if (this.canExecute && !this.executed) {\n      options['accept'] = {\n        disabled: false,\n        text: 'accept',\n        icon: 'done'\n      };\n    }\n\n    options['close'] = {\n      disabled: false,\n      text: 'close',\n      icon: 'clear'\n    };\n\n    if (this.canExecute || this.canRemove) {\n      options['delete'] = {\n        disabled: false,\n        text: 'delete',\n        icon: 'delete',\n        background: '#c93131'\n      };\n    }\n\n    await this.updateComplete;\n\n    this.eveesDiffEl.workspace = workspace;\n    this.updatesDialogEl.options = options;\n\n    const value = await new Promise(resolve => {\n      this.updatesDialogEl.resolved = value => {\n        this.showDiff = false;\n        resolve(value);\n      };\n    });\n\n    this.dispatchEvent(new CustomEvent('dialogue-closed', { bubbles: true, composed: true }));\n    this.showDiff = false;\n\n    if (value === 'accept') {\n      /** run the proposal changes as the logged user */\n      await workspace.execute(this.client);\n      await this.proposals.deleteProposal(this.proposalId);\n\n      this.load();\n\n      this.dispatchEvent(\n        new ContentUpdatedEvent({\n          detail: { uref: this.proposal.toPerspectiveId },\n          bubbles: true,\n          composed: true\n        })\n      );\n    }\n\n    if (value === 'delete') {\n      await this.proposals.deleteProposal(this.proposalId);\n      this.load();\n    }\n  }\n\n  renderDiff() {\n    return html`\n      <uprtcl-dialog id=\"updates-dialog\">\n        <evees-update-diff id=\"evees-update-diff\"> </evees-update-diff>\n      </uprtcl-dialog>\n    `;\n  }\n\n  renderDefault() {\n    return html`\n      <div @click=${() => this.showProposalChanges()} class=\"row-container\">\n        <div class=\"proposal-name\">\n          ${this.authorId !== undefined\n            ? html`\n                <evees-author user-id=${this.authorId} show-name></evees-author>\n              `\n            : 'unknown'}\n        </div>\n        <div class=\"proposal-state\">\n          ${this.loading\n            ? html`\n                <uprtcl-loading></uprtcl-loading>\n              `\n            : this.canExecute\n            ? html`\n                <uprtcl-icon-button\n                  icon=${this.executed ? 'done' : 'call_merge'}\n                  ?disabled=${this.executed}\n                ></uprtcl-icon-button>\n              `\n            : ''}\n        </div>\n      </div>\n      ${this.showDiff ? this.renderDiff() : ''}\n    `;\n  }\n\n  render() {\n    if (this.loadingCreator) {\n      return html`\n        <div class=\"\"><uprtcl-loading></uprtcl-loading></div>\n      `;\n    }\n\n    let renderDefault = true;\n    let lense: any = undefined;\n    if (this.remote && this.remote.proposals && this.remote.proposals.lense !== undefined) {\n      renderDefault = false;\n      lense = this.remote.proposals.lense as any;\n    }\n\n    return renderDefault ? this.renderDefault() : lense().render({ proposalId: this.proposalId });\n  }\n\n  static get styles() {\n    return css`\n      :host {\n        width: 100%;\n      }\n      .row-container {\n        height: 100%;\n        display: flex;\n        flex-direction: row;\n      }\n      .proposal-name {\n        height: 100%;\n        flex-grow: 1;\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n      }\n      .proposal-state {\n        width: 140px;\n        height: 100%;\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n      }\n\n      .proposal-state uprtcl-button {\n        margin: 0 auto;\n      }\n    `;\n  }\n}\n","import { html, css, property, query } from 'lit-element';\n\nimport { Logger } from '@uprtcl/micro-orchestrator';\nimport { MenuConfig, UprtclPopper } from '@uprtcl/common-ui';\nimport { loadEntity } from '@uprtcl/multiplatform';\nimport { Signed } from '@uprtcl/cortex';\nimport { EveesInfoBase } from './evees-info-base';\nimport { EveesPerspectivesList } from './evees-perspectives-list';\nimport { ProposalsList } from './evees-proposals-list';\nimport { Perspective } from '../types';\nimport { EveesRemote } from '../services/evees.remote';\nimport { DEFAULT_COLOR, eveeColor } from './support';\nimport { Secured } from '../utils/cid-hash';\nimport { ContentUpdatedEvent } from './events';\n\n/** An evees info with\n *  - one official remote with the official perspective\n *  - one defaultRemote with one perspective per user */\nexport class EveesInfoUserBased extends EveesInfoBase {\n  logger = new Logger('EVEES-INFO-UserBased');\n\n  @property({ type: Boolean, attribute: 'show-proposals' })\n  showProposals: boolean = false;\n\n  @property({ type: Boolean, attribute: 'show-draft' })\n  showDraftControl: boolean = false;\n\n  @property({ type: Boolean, attribute: 'show-edit-draft' })\n  showEditDraft: boolean = false;\n\n  @property({ type: Boolean, attribute: 'show-info' })\n  showInfo: boolean = false;\n\n  @property({ type: Boolean, attribute: 'show-icon' })\n  showIcon: boolean = false;\n\n  @property({ type: Boolean, attribute: 'show-acl' })\n  showAcl: boolean = false;\n\n  @property({ type: Boolean, attribute: 'show-debug' })\n  showDebugInfo: boolean = false;\n\n  @property({ type: String, attribute: 'official-owner' })\n  officialOwner!: string;\n\n  @property({ type: Boolean, attribute: 'check-owner' })\n  checkOwner: boolean = false;\n\n  @property({ attribute: false })\n  officialId: string | undefined = undefined;\n\n  @property({ attribute: false })\n  mineId: string | undefined = undefined;\n\n  @property({ attribute: false })\n  author!: string;\n\n  @property({ attribute: false })\n  isTheirs!: boolean;\n\n  @property({ attribute: false })\n  isMine!: boolean;\n\n  @property({ attribute: false })\n  isOfficial!: boolean;\n\n  @property({ attribute: false })\n  hasPull!: boolean;\n\n  @property({ attribute: false })\n  creatingMine: boolean = false;\n\n  @query('#proposals-popper')\n  proposalsPopper!: UprtclPopper;\n\n  @query('#perspectives-popper')\n  perspectivesPopper!: UprtclPopper;\n\n  @query('#evees-perspectives-list')\n  perspectivesList!: EveesPerspectivesList;\n\n  @query('#evees-proposals-list')\n  eveesProposalsList!: ProposalsList;\n\n  async firstUpdated() {\n    await super.firstUpdated();\n    this.load();\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.logger.log('Connected', this.uref);\n  }\n\n  async disconnectedCallback() {\n    super.disconnectedCallback();\n    this.logger.log('Disconnected', this.uref);\n  }\n\n  /** overwrite  */\n  updated(changedProperties) {\n    if (changedProperties.has('uref')) {\n      this.logger.info('updated() UserBased reload', { changedProperties });\n      this.load();\n    }\n  }\n\n  async load() {\n    this.logger.info('load() UserBased', { uref: this.uref, firstRef: this.firstRef });\n\n    await super.firstUpdated();\n    await super.load();\n\n    this.loading = true;\n\n    /** from all the perspectives of this evee we must identify the official perspective and this\n     * user perspective in the default remote  */\n    const first = await loadEntity<Signed<Perspective>>(this.client, this.firstRef);\n    if (!first) throw new Error(`first perspective ${this.firstRef}`);\n\n    const perspectiveIds = await this.getContextPerspectives(this.firstRef);\n    const perspectives = ((await Promise.all(\n      perspectiveIds.map(perspectiveId =>\n        loadEntity<Signed<Perspective>>(this.client, perspectiveId)\n      )\n    )) as unknown) as Secured<Perspective>[];\n\n    if (!this.defaultRemote) throw new Error('default remote not found');\n    const defaultRemote: EveesRemote = this.defaultRemote;\n\n    if (!this.officialRemote) throw new Error('official remote not found');\n    const officialRemote: EveesRemote = this.officialRemote;\n\n    const sortOnTimestamp = (p1, p2) => p1.object.payload.timestamp - p2.object.payload.timestamp;\n\n    if (this.checkOwner) {\n      const officials = perspectives.filter(\n        p =>\n          p.object.payload.remote === officialRemote.id &&\n          p.object.payload.creatorId === this.officialOwner\n      );\n      const officialsSorted = officials.sort(sortOnTimestamp).reverse();\n      this.officialId = officialsSorted.length > 0 ? officialsSorted[0].id : undefined;\n    } else {\n      this.officialId = this.firstRef;\n    }\n\n    const mines = perspectives.filter(\n      p =>\n        p.object.payload.remote === defaultRemote.id &&\n        p.object.payload.creatorId === defaultRemote.userId\n    );\n\n    /** the latest perspective is considered the \"mine\", other perspectives might exist and are listed under other */\n    const minesSorted = mines.sort(sortOnTimestamp).reverse();\n    this.mineId = minesSorted.length > 0 ? minesSorted[0].id : undefined;\n\n    /** inform the parent whose the official, a bit ugly... but */\n    this.dispatchEvent(\n      new CustomEvent('official-id', {\n        detail: {\n          perspectiveId: this.officialId\n        },\n        bubbles: false,\n        composed: false\n      })\n    );\n\n    this.isTheirs = this.uref !== this.mineId && this.uref !== this.officialId;\n    this.isMine = this.uref === this.mineId;\n    this.isOfficial = this.uref === this.officialId;\n\n    /** check pull from official*/\n    if (this.isMine && this.officialId !== undefined) {\n      this.checkPull(this.officialId).then(() => {\n        this.hasPull = this.pullWorkspace !== undefined && this.pullWorkspace.hasUpdates();\n      });\n    }\n\n    /** get the current perspective author */\n    const nowPerspective = await loadEntity<Signed<Perspective>>(this.client, this.uref);\n    if (!nowPerspective) throw new Error(`official perspective ${this.uref}`);\n\n    this.author = nowPerspective.object.payload.creatorId;\n\n    /** force load of perspectives and proposals lists */\n    if (this.eveesProposalsList && this.eveesProposalsList !== null) this.eveesProposalsList.load();\n    if (this.perspectivesList) this.perspectivesList.load();\n\n    this.showInfo = false;\n    await this.updateComplete;\n    this.showInfo = true;\n\n    this.loading = false;\n  }\n\n  draftClicked() {\n    if (this.mineId) {\n      this.seeDraft();\n    } else {\n      this.createDraft();\n    }\n  }\n\n  closePoppers() {\n    if (this.proposalsPopper) this.proposalsPopper.showDropdown = false;\n    if (this.perspectivesPopper) this.perspectivesPopper.showDropdown = false;\n  }\n\n  async createDraft() {\n    this.closePoppers();\n    this.creatingMine = true;\n    await this.forkPerspective(this.officialId);\n    this.creatingMine = false;\n  }\n\n  seeDraft() {\n    this.closePoppers();\n    this.checkoutPerspective(this.mineId);\n  }\n\n  async proposeDraft() {\n    this.logger.log('propose draft');\n    if (!this.officialId) throw new Error('can only propose to official');\n    this.closePoppers();\n    await this.otherPerspectiveMerge(this.uref, this.officialId);\n    if (this.eveesProposalsList && this.eveesProposalsList !== null) this.eveesProposalsList.load();\n  }\n\n  seeOfficial() {\n    this.closePoppers();\n    this.checkoutPerspective(this.officialId);\n  }\n\n  async showPull() {\n    this.logger.log('show pull');\n\n    if (!this.pullWorkspace) throw new Error('pullWorkspace undefined');\n\n    const options: MenuConfig = {\n      apply: {\n        text: 'apply',\n        icon: 'done',\n        skinny: false\n      },\n      close: {\n        text: 'close',\n        icon: 'clear',\n        skinny: true\n      }\n    };\n\n    const result = await this.updatesDialog(\n      this.pullWorkspace,\n      options,\n      this.renderFromToPerspective(this.uref, this.officialId as string)\n    );\n\n    if (result !== 'apply') {\n      return;\n    }\n    await this.pullWorkspace.execute(this.client);\n\n    this.dispatchEvent(\n      new ContentUpdatedEvent({\n        detail: {\n          uref: this.uref\n        },\n        bubbles: true,\n        composed: true\n      })\n    );\n  }\n\n  async optionOnMine(option: string) {\n    switch (option) {\n      case 'delete':\n        await this.deletePerspective();\n        break;\n    }\n\n    this.checkoutPerspective(this.officialId);\n  }\n\n  checkoutPerspective(perspectiveId) {\n    this.closePoppers();\n    this.dispatchEvent(\n      new CustomEvent('checkout-perspective', {\n        detail: {\n          perspectiveId: perspectiveId\n        },\n        composed: true,\n        bubbles: true\n      })\n    );\n  }\n\n  color() {\n    if (this.isOfficial) {\n      return DEFAULT_COLOR;\n    } else {\n      return eveeColor(this.author);\n    }\n  }\n\n  renderOtherPerspectives() {\n    const hidePerspectives: string[] = [];\n\n    if (this.officialId) hidePerspectives.push(this.officialId);\n    if (this.mineId) hidePerspectives.push(this.mineId);\n\n    return html`\n      <div class=\"list-container\">\n        <evees-perspectives-list\n          id=\"evees-perspectives-list\"\n          perspective-id=${this.uref}\n          .hidePerspectives=${hidePerspectives}\n          ?can-propose=${this.isLogged}\n          @perspective-selected=${e => this.checkoutPerspective(e.detail.id)}\n          @merge-perspective=${e => this.otherPerspectiveMerge(e.detail.perspectiveId, this.uref)}\n        ></evees-perspectives-list>\n      </div>\n    `;\n  }\n\n  renderDraftControl() {\n    const mineConfig: MenuConfig = {\n      delete: {\n        disabled: false,\n        text: 'delete',\n        icon: 'delete'\n      }\n    };\n\n    return html`\n      <uprtcl-button\n        class=\"tab-button\"\n        ?skinny=${!this.isOfficial}\n        @click=${() => (this.officialId !== undefined ? this.seeOfficial() : undefined)}\n        ?disabled=${this.officialId === undefined}\n        transition\n      >\n        official\n      </uprtcl-button>\n      ${this.isLogged && this.isLoggedOnDefault\n        ? html`\n            <uprtcl-icon-button\n              button\n              class=${this.isTheirs || this.isMine\n                ? 'margin-left-small highlighted'\n                : 'margin-left-small'}\n              icon=\"menu_open\"\n              @click=${() => (this.isTheirs || this.isMine ? this.proposeDraft() : undefined)}\n              ?disabled=${this.isOfficial || this.officialId === undefined}\n              style=${`--background-color: ${\n                this.isTheirs || this.isMine ? this.color() : 'initial'\n              }`}\n              ?loading=${this.merging}\n            >\n            </uprtcl-icon-button>\n            <uprtcl-icon-button\n              button\n              class=${this.hasPull ? 'margin-left-small highlighted' : 'margin-left-small'}\n              icon=\"menu_open_180\"\n              @click=${() => (this.isMine && this.hasPull ? this.showPull() : undefined)}\n              ?disabled=${!this.hasPull}\n              style=${`--background-color: ${\n                this.isTheirs || this.isMine ? this.color() : 'initial'\n              }`}\n            >\n            </uprtcl-icon-button>\n          `\n        : ''}\n      ${this.isLoggedOnDefault\n        ? html`\n            <div class=\"mine-and-settings\">\n              <uprtcl-button-loading\n                ?skinny=${!this.isMine}\n                @click=${() => this.draftClicked()}\n                class=\"margin-left-small tab-button\"\n                style=${`--background-color: ${this.isMine ? this.color() : 'initial'}`}\n                ?loading=${this.creatingMine}\n                transition\n              >\n                mine\n              </uprtcl-button-loading>\n              ${this.isMine && this.showEditDraft\n                ? html`\n                    <div class=\"options-menu-container\">\n                      <uprtcl-options-menu\n                        icon=\"settings\"\n                        class=\"options-menu\"\n                        style=${`--background-color: ${this.isMine ? this.color() : 'initial'}`}\n                        @option-click=${e => this.optionOnMine(e.detail.key)}\n                        .config=${mineConfig}\n                      >\n                      </uprtcl-options-menu>\n                    </div>\n                  `\n                : ''}\n            </div>\n          `\n        : ''}\n\n      <uprtcl-popper\n        id=\"perspectives-popper\"\n        position=\"bottom-left\"\n        class=\"perspectives-popper margin-left\"\n      >\n        <uprtcl-button\n          slot=\"icon\"\n          icon=\"arrow_drop_down\"\n          ?skinny=${!this.isTheirs}\n          style=${`--background-color: ${this.isTheirs ? this.color() : 'initial'}`}\n          class=\"tab-other\"\n          transition\n          >${this.isTheirs\n            ? html`\n                <evees-author\n                  show-name\n                  user-id=${this.author}\n                  show-name\n                  short\n                  color=${eveeColor(this.uref)}\n                ></evees-author>\n              `\n            : html`\n                other\n              `}\n        </uprtcl-button>\n        ${this.renderOtherPerspectives()}\n      </uprtcl-popper>\n    `;\n  }\n\n  renderProposals() {\n    return html`\n      <div class=\"list-container\">\n        ${!this.loading && this.officialId\n          ? html`\n              <evees-proposals-list\n                id=\"evees-proposals-list\"\n                perspective-id=${this.officialId}\n                @dialogue-closed=${() => (this.proposalsPopper.showDropdown = false)}\n              ></evees-proposals-list>\n            `\n          : html`\n              <uprtcl-loading></uprtcl-loading>\n            `}\n      </div>\n    `;\n  }\n\n  renderPermissions() {\n    return html`\n      <div class=\"perspectives-permissions\">\n        ${!this.loading\n          ? this.remote.accessControl.lense().render({ uref: this.uref, parentId: this.parentId })\n          : ''}\n      </div>\n    `;\n  }\n\n  render() {\n    if (this.perspectiveData === undefined)\n      return html`\n        <uprtcl-loading></uprtcl-loading>\n      `;\n\n    return html`\n      <div class=\"left-buttons\">\n        ${this.showInfo\n          ? html`\n              <uprtcl-popper\n                icon=\"info\"\n                id=\"info-popper\"\n                position=\"bottom-left\"\n                class=\"info-popper margin-right\"\n              >\n                ${this.showIcon\n                  ? html`\n                      <div class=\"icon-container\">${this.renderIcon()}</div>\n                    `\n                  : ''}\n                ${this.showAcl\n                  ? html`\n                      <div class=\"permissions-container\">${this.renderPermissions()}</div>\n                    `\n                  : ''}\n                ${this.showDebugInfo ? this.renderInfo() : ''}\n              </uprtcl-popper>\n            `\n          : ''}\n        ${this.showProposals\n          ? html`\n              <uprtcl-popper id=\"proposals-popper\" position=\"bottom-left\" class=\"proposals-popper\">\n                <uprtcl-button\n                  slot=\"icon\"\n                  class=\"proposals-button\"\n                  icon=\"arrow_drop_down\"\n                  skinny\n                  transition\n                >\n                  proposals\n                </uprtcl-button>\n                ${this.renderProposals()}\n              </uprtcl-popper>\n            `\n          : ''}\n      </div>\n      <div class=\"center-buttons\">\n        ${this.showDraftControl ? this.renderDraftControl() : ''}\n      </div>\n      ${this.showUpdatesDialog ? this.renderUpdatesDialog() : ''}\n    `;\n  }\n\n  static get styles() {\n    return super.styles.concat([\n      css`\n        :host {\n          display: flex;\n          flex-direction: row;\n        }\n        .proposals-popper {\n          --box-width: 340px;\n        }\n        .info-popper {\n          --max-height: 70vh;\n          --overflow: auto;\n        }\n        .perspectives-popper {\n          --box-width: 340px;\n        }\n        .proposals-button {\n          width: 150px;\n        }\n        .margin-left {\n          margin-left: 10px;\n        }\n        .margin-left-small {\n          margin-left: 4px;\n        }\n        .margin-right {\n          margin-right: 10px;\n        }\n        .tab-button {\n          width: 120px;\n        }\n        .mine-and-settings {\n          width: 142px;\n          display: flex;\n          align-items: center;\n        }\n        .tab-other {\n          width: 160px;\n        }\n        .left-buttons {\n          flex: 0 0 auto;\n          display: flex;\n        }\n        .center-buttons {\n          flex: 1 1 auto;\n          display: flex;\n          justify-content: center;\n          align-items: center;\n        }\n        .highlighted {\n          --background-color: #00b31e;\n        }\n        .permissions-container {\n          padding: 12px;\n          border-bottom: solid 1px #cccccc;\n        }\n        .icon-container {\n          margin: 0 auto;\n          padding: 12px;\n        }\n        .options-menu-container {\n          margin-left: -18px;\n          border: solid 2px white;\n          border-radius: 20px;\n        }\n      `\n    ]);\n  }\n}\n","import { interfaces } from 'inversify';\n\nimport { MicroModule, i18nextModule } from '@uprtcl/micro-orchestrator';\nimport { PatternsModule } from '@uprtcl/cortex';\nimport { CASModule } from '@uprtcl/multiplatform';\nimport { GraphQlSchemaModule } from '@uprtcl/graphql';\nimport { CommonUIModule } from '@uprtcl/common-ui';\n\nimport { PerspectiveLinks, PerspectivePattern } from './patterns/perspective.pattern';\nimport { CommitPattern, CommitLinked } from './patterns/commit.pattern';\nimport { CommitHistory } from './elements/evees-commit-history';\nimport { EveesBindings } from './bindings';\nimport { Evees } from './services/evees';\nimport { EveesRemote } from './services/evees.remote';\nimport { eveesTypeDefs } from './graphql/schema';\nimport { eveesResolvers } from './graphql/resolvers';\nimport { EveesPerspectivesList } from './elements/evees-perspectives-list';\nimport { EveesInfoPopper } from './elements/evees-info-popper';\n\nimport en from './i18n/en.json';\nimport { EveesConfig } from './types';\nimport { EveesInfoPage } from './elements/evees-info-page';\nimport { RecursiveContextMergeStrategy } from './merge/recursive-context.merge-strategy';\nimport { EveesDiff } from './elements/evees-diff';\nimport { EveesAuthor } from './elements/evees-author';\nimport { ProposalsList } from './elements/evees-proposals-list';\nimport { EveesProposalDiff } from './elements/evees-proposal-diff';\nimport { EveesLoginWidget } from './elements/evees-login';\nimport { EveesProposalRow } from './elements/evees-proposal-row';\nimport { EveesInfoUserBased } from './elements/evees-info-user-based';\nimport { EveesPerspectiveIcon } from './uprtcl-evees';\n\n/**\n * Configure a _Prtcl Evees module with the given service providers\n *\n * Example usage:\n *\n * ```ts\n * import { MicroOrchestrator } from '@uprtcl/micro-orchestrator';\n * import { IpfsStore } from '@uprtcl/ipfs-provider';\n * import { HttpConnection } from '@uprtcl/http-provider';\n * import { EthereumConnection } from '@uprtcl/ethereum-provider';\n * import { EveesModule, EveesEthereum, EveesHttp } from '@uprtcl/evees';\n *\n * const ipfsConfig = { host: 'ipfs.infura.io', port: 5001, protocol: 'https' };\n *\n * const cidConfig = { version: 1, type: 'sha2-256', codec: 'raw', base: 'base58btc' };\n *\n * // Don't put anything on host to get from Metamask's ethereum provider\n * const ethConnection = new EthereumConnection({});\n *\n * const eveesEth = new EveesEthereum(ethConnection, ipfsConfig, cidConfig);\n *\n * const httpConnection = new HttpConnection();\n *\n * const httpEvees = new EveesHttp('http://localhost:3100/uprtcl/1', httpConnection, ethConnection, cidConfig);\n *\n * const evees = new EveesModule([httpEvees, eveesEth], httpEvees);\n *\n * const orchestrator = new MicroOrchestrator();\n *\n * await orchestrator.loadModule(evees);\n * ```\n *\n *\n * @param eveesProviders array of remote services that implement Evees behaviour\n * @param defaultRemote default remote service to which to create Perspective and Commits\n */\nexport class EveesModule extends MicroModule {\n  static id = 'evees-module';\n\n  dependencies = [];\n\n  static bindings = EveesBindings;\n\n  constructor(protected eveesProviders: Array<EveesRemote>, protected config?: EveesConfig) {\n    super();\n  }\n\n  async onLoad(container: interfaces.Container) {\n    container.bind(EveesModule.bindings.Evees).to(Evees);\n    container.bind(EveesModule.bindings.MergeStrategy).to(RecursiveContextMergeStrategy);\n\n    /** set first remote as default remote, the second as official remote, and only the\n     * first remote ad editable by default */\n\n    this.config = this.config || {};\n\n    this.config.defaultRemote = this.config.defaultRemote\n      ? this.config.defaultRemote[0]\n      : this.eveesProviders[0];\n\n    this.config.officialRemote = this.config.officialRemote\n      ? this.config.officialRemote\n      : this.eveesProviders.length > 1\n      ? this.eveesProviders[1]\n      : this.eveesProviders[0];\n\n    this.config.editableRemotesIds = this.config.editableRemotesIds\n      ? this.config.editableRemotesIds\n      : [this.eveesProviders[0].id];\n\n    container.bind(EveesModule.bindings.Config).toConstantValue(this.config);\n\n    for (const remote of this.eveesProviders) {\n      container.bind(EveesModule.bindings.EveesRemote).toConstantValue(remote);\n      container.bind(EveesModule.bindings.Remote).toConstantValue(remote);\n    }\n\n    customElements.define('evees-commit-history', CommitHistory);\n    customElements.define('evees-info-popper', EveesInfoPopper);\n    customElements.define('evees-info-page', EveesInfoPage);\n    customElements.define('evees-info-user-based', EveesInfoUserBased);\n    customElements.define('evees-perspectives-list', EveesPerspectivesList);\n    customElements.define('evees-proposals-list', ProposalsList);\n    customElements.define('evees-update-diff', EveesDiff);\n    customElements.define('evees-proposal-diff', EveesProposalDiff);\n    customElements.define('evees-author', EveesAuthor);\n    customElements.define('evees-login-widget', EveesLoginWidget);\n    customElements.define('evees-proposal-row', EveesProposalRow);\n    customElements.define('evees-perspective-icon', EveesPerspectiveIcon);\n  }\n\n  get submodules() {\n    return [\n      new GraphQlSchemaModule(eveesTypeDefs, eveesResolvers),\n      new i18nextModule('evees', { en: en }),\n      new PatternsModule([\n        new CommitPattern([CommitLinked]),\n        new PerspectivePattern([PerspectiveLinks])\n      ]),\n      new CASModule(this.eveesProviders.map(p => p.store)),\n      new CommonUIModule()\n    ];\n  }\n}\n","import { interfaces } from 'inversify';\n\nimport { MicroModule } from '@uprtcl/micro-orchestrator';\nimport { CASStore, CASModule } from '@uprtcl/multiplatform';\nimport { EveesModule } from './evees.module';\n\nexport abstract class EveesContentModule extends MicroModule {\n  constructor(protected stores: Array<CASStore | interfaces.ServiceIdentifier<CASStore>> = []) {\n    super();\n  }\n\n  dependencies = [EveesModule.id];\n\n  abstract providerIdentifier: interfaces.ServiceIdentifier<CASStore> | undefined;\n\n  async onLoad(container: interfaces.Container) {\n    this.stores.forEach((storeOrId) => {\n      const store =\n        typeof storeOrId === 'object' && (storeOrId as CASStore).casID\n          ? (storeOrId as CASStore)\n          : container.get(storeOrId as interfaces.ServiceIdentifier<CASStore>);\n\n      if (this.providerIdentifier) {\n        container.bind<CASStore>(this.providerIdentifier).toConstantValue(store);\n      }\n    });\n  }\n\n  get submodules(): MicroModule[] {\n    return [new CASModule(this.stores.filter((store) => (store as CASStore).casID) as CASStore[])];\n  }\n}\n","import Dexie from 'dexie';\n\nexport class EveesDB extends Dexie {\n  drafts: Dexie.Table<any, string>;\n\n  constructor() {\n    super('uprtcl');\n    this.version(0.1).stores({\n      drafts: ''\n    });\n    this.drafts = this.table('drafts');\n  }\n}\n","import { EveesDB } from './evees.db';\nimport { EveesDrafts } from '../../evees.drafts';\n\nexport class EveesDraftsLocal implements EveesDrafts {\n  eveesDB = new EveesDB();\n\n  removeDraft(objectId: string): Promise<void> {\n    return this.eveesDB.drafts.delete(objectId);\n  }\n\n  getDraft(objectId: string): Promise<any> {\n    return this.eveesDB.drafts.get(objectId);\n  }\n\n  async setDraft(objectId: string, draft: any): Promise<void> {\n    delete draft['id'];\n    await this.eveesDB.drafts.put(draft, objectId);\n  }\n}\n","import { Signed } from '@uprtcl/cortex';\nimport { ApolloClientModule } from '@uprtcl/graphql';\nimport { moduleConnect } from '@uprtcl/micro-orchestrator';\nimport { loadEntity } from '@uprtcl/multiplatform';\nimport { ApolloClient } from 'apollo-boost';\nimport { LitElement, html, css, property } from 'lit-element';\nimport { EveesBindings } from 'src/bindings';\nimport { Secured } from 'src/uprtcl-evees';\nimport { EveesRemote } from '../services/evees.remote';\nimport { Perspective } from '../types';\n\nexport class EveesPerspectiveIcon extends moduleConnect(LitElement) {\n  @property({ type: String, attribute: 'perspective-id' })\n  perspectiveId!: string;\n\n  @property({ attribute: false })\n  loading: boolean = true;\n\n  perspective!: Secured<Perspective>;\n  remote!: EveesRemote;\n  remotes!: EveesRemote[];\n  client!: ApolloClient<any>;\n\n  async firstUpdated() {\n    this.client = this.request(ApolloClientModule.bindings.Client);\n    this.remotes = this.requestAll(EveesBindings.EveesRemote) as EveesRemote[];\n    this.load();\n  }\n\n  updated(changedProperties) {\n    if (changedProperties.has('perspectiveId')) {\n      this.load();\n    }\n  }\n\n  async load() {\n    this.loading = true;\n    const perspective = await loadEntity<Signed<Perspective>>(this.client, this.perspectiveId);\n    if (!perspective) throw new Error('perspective undefined');\n\n    const remote = this.remotes.find(r => r.id === perspective.object.payload.remote);\n    if (!remote) throw new Error('remote undefined');\n\n    this.perspective = perspective;\n    this.remote = remote;\n    this.loading = false;\n  }\n\n  render() {\n    if (this.loading) {\n      return html`\n        <uprtcl-loading></uprtcl-loading>\n      `;\n    }\n    return html`\n      <div class=\"row\">\n        <b class=\"tag-text\">id</b>\n        <span class=\"perspective-id\"\n          >${this.perspectiveId.substr(0, 6)}...${this.perspectiveId.slice(\n            this.perspectiveId.length - 6\n          )}</span\n        >\n      </div>\n      ${this.perspective.object.payload.creatorId\n        ? html`\n            <div class=\"row\">\n              ${this.remote.userId === this.perspective.object.payload.creatorId\n                ? html`\n                    <b class=\"tag-text\">yours</b>\n                  `\n                : html`\n                    <b class=\"tag-text\">by</b>\n                    <evees-author\n                      user-id=${this.perspective.object.payload.creatorId}\n                      show-name\n                    ></evees-author>\n                  `}\n            </div>\n          `\n        : ''}\n      <div class=\"row\">\n        <b class=\"tag-text\">on</b>\n        <div class=\"remote-icon\">\n          ${this.remote.icon\n            ? html`\n                ${this.remote.icon()}\n              `\n            : html`\n                remote\n                <pre>${this.perspective.object.payload.remote}</pre>\n              `}\n        </div>\n      </div>\n    `;\n  }\n\n  static get styles() {\n    return [\n      css`\n        :host {\n          display: flex;\n          width: fit-content;\n          flex-direction: column;\n          align-items: start;\n          width: 100%;\n          font-size: 15px;\n        }\n        .row {\n          display: flex;\n          align-items: center;\n          height: 35px;\n        }\n        .tag-text {\n          color: #cccccc;\n        }\n        evees-author {\n          margin-left: 8px;\n        }\n        .remote-icon {\n          margin-left: 6px;\n        }\n        .perspective-id {\n          color: var(--color, rgb(99, 102, 104));\n          font-weight: 600;\n          letter-spacing: 0.015em;\n          display: block;\n          overflow: hidden;\n          white-space: nowrap;\n          margin-left: 12px;\n        }\n      `\n    ];\n  }\n}\n","import { ApolloClient, gql } from 'apollo-boost';\n\nexport const isAncestorOf = (client: ApolloClient<any>) => async (\n  ancestorId: string,\n  commitId: string\n): Promise<boolean> => {\n  if (ancestorId === commitId) return true;\n\n  const result = await client.query({\n    query: gql`{\n      entity(uref: \"${commitId}\") {\n        id\n        ... on Commit {\n          parentCommits {\n            id\n          }\n        }\n      }\n    }`,\n  });\n\n  const parentsIds = result.data.entity.parentCommits.map((p) => p.id);\n\n  if (parentsIds.includes(ancestorId)) {\n    return true;\n  } else {\n    /** recursive call */\n    for (let ix = 0; ix < parentsIds.length; ix++) {\n      if (await isAncestorOf(client)(ancestorId, parentsIds[ix])) {\n        return true;\n      }\n    }\n  }\n\n  return false;\n};\n"],"names":["defaultCidConfig","sortObject","CBOR","multihashing","CID","gql","loadEntity","cloneDeep","Evees","Logger","injectable","inject","CortexModule","multiInject","ApolloClientModule","PatternRecognizer","ApolloClient","Pattern","PerspectiveLinks","propertyOrder","CommitLinked","moduleConnect","LitElement","html","css","property","ApolloLink","Observable","DiscoveryModule","CASModule","randomColor","query","UprtclPopper","UprtclDialog","TemplateResult","DiffMatchPatch","isEqual","SimpleMergeStrategy","EntityCache","RecursiveContextMergeStrategy","internalProperty","MicroModule","GraphQlSchemaModule","i18nextModule","PatternsModule","CommonUIModule","Dexie"],"mappings":"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"}