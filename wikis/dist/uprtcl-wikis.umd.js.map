{"version":3,"file":"uprtcl-wikis.umd.js","sources":["../src/bindings.ts","../src/elements/wiki-drawer-content.ts","../src/elements/wiki-drawer.ts","../src/patterns/wiki.pattern.ts","../src/graphql/schema.ts","../src/elements/wiki-diff.ts","../src/wikis.module.ts"],"sourcesContent":["export const WikiBindings = {\n  WikiType: 'Wiki',\n  WikisRemote: 'wikis-remote',\n};\n","import { property, html, css, LitElement, query } from 'lit-element';\nimport { ApolloClient, gql } from 'apollo-boost';\nconst styleMap = style => {\n  return Object.entries(style).reduce((styleString, [propName, propValue]) => {\n    propName = propName.replace(/([A-Z])/g, matches => `-${matches[0].toLowerCase()}`);\n    return `${styleString}${propName}:${propValue};`;\n  }, '');\n};\n\nimport { htmlToText, TextType, TextNode } from '@uprtcl/documents';\nimport { Logger, moduleConnect } from '@uprtcl/micro-orchestrator';\nimport { styles } from '@uprtcl/common-ui';\nimport { Entity, HasTitle, CortexModule, PatternRecognizer, Signed } from '@uprtcl/cortex';\nimport {\n  EveesRemote,\n  EveesModule,\n  EveesHelpers,\n  Perspective,\n  CONTENT_UPDATED_TAG,\n  ContentUpdatedEvent,\n  EveesConfig\n} from '@uprtcl/evees';\nimport { MenuConfig } from '@uprtcl/common-ui';\nimport { ApolloClientModule } from '@uprtcl/graphql';\nimport { CASStore, loadEntity } from '@uprtcl/multiplatform';\n\nimport { Wiki } from '../types';\n\nimport { WikiBindings } from '../bindings';\n\nconst MAX_LENGTH = 999;\n\ninterface PageData {\n  id: string;\n  title: string;\n}\n\nexport class WikiDrawerContent extends moduleConnect(LitElement) {\n  logger = new Logger('WIKI-DRAWER-CONTENT');\n\n  @property({ type: String })\n  uref!: string;\n\n  @property({ type: String })\n  color!: string;\n\n  @property({ type: String, attribute: 'official-owner' })\n  officialOwner!: string;\n\n  @property({ type: Boolean, attribute: 'check-owner' })\n  checkOwner: boolean = false;\n\n  @property({ type: Boolean })\n  editable: boolean = false;\n\n  @property({ attribute: false })\n  loading: boolean = true;\n\n  @property({ attribute: false })\n  wiki: Entity<Wiki> | undefined;\n\n  @property({ attribute: false })\n  pagesList: PageData[] | undefined = undefined;\n\n  @property({ attribute: false })\n  selectedPageIx: number | undefined = undefined;\n\n  @property({ attribute: false })\n  creatingNewPage: boolean = false;\n\n  @property({ attribute: false })\n  editableActual: boolean = false;\n\n  remote: string = '';\n  currentHeadId: string | undefined = undefined;\n\n  protected client!: ApolloClient<any>;\n  protected remotes!: EveesRemote[];\n  protected recognizer!: PatternRecognizer;\n  protected editableRemotesIds!: string[];\n\n  async firstUpdated() {\n    this.client = this.request(ApolloClientModule.bindings.Client);\n    this.remotes = this.requestAll(EveesModule.bindings.EveesRemote);\n    this.recognizer = this.request(CortexModule.bindings.Recognizer);\n\n    const config = this.request(EveesModule.bindings.Config) as EveesConfig;\n    this.editableRemotesIds = config.editableRemotesIds ? config.editableRemotesIds : [];\n\n    this.logger.log('firstUpdated()', { uref: this.uref });\n\n    this.loading = true;\n    await this.load();\n    this.loading = false;\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n\n    this.addEventListener(CONTENT_UPDATED_TAG, ((e: ContentUpdatedEvent) => {\n      if (e.detail.uref === this.uref) {\n        this.logger.log('ContentUpdatedEvent()', this.uref);\n        this.load();\n      }\n      if (this.pagesList && this.pagesList.findIndex(page => page.id === e.detail.uref) !== -1) {\n        this.loadPagesData();\n      }\n    }) as EventListener);\n  }\n\n  updated(changedProperties) {\n    if (changedProperties.get('uref') !== undefined) {\n      this.logger.info('updated()', { changedProperties });\n      this.reset();\n    }\n  }\n\n  async reset() {\n    // await this.client.resetStore();\n    this.pagesList = undefined;\n    this.selectedPageIx = undefined;\n    this.wiki = undefined;\n    this.logger.log('reset()', this.uref);\n    this.loading = true;\n    this.load();\n    this.loading = false;\n  }\n\n  async load() {\n    if (this.uref === undefined) return;\n\n    this.logger.log('load()');\n\n    const perspective = (await loadEntity(this.client, this.uref)) as Entity<Signed<Perspective>>;\n    const headId = await EveesHelpers.getPerspectiveHeadId(this.client, this.uref);\n\n    this.remote = perspective.object.payload.remote;\n    const canWrite = await EveesHelpers.canWrite(this.client, this.uref);\n\n    this.currentHeadId = headId;\n    this.editableActual =\n      this.editableRemotesIds.length > 0\n        ? this.editableRemotesIds.includes(this.remote) && canWrite\n        : canWrite;\n\n    this.wiki = await EveesHelpers.getPerspectiveData(this.client, this.uref);\n\n    await this.loadPagesData();\n  }\n\n  async loadPagesData() {\n    if (!this.wiki) {\n      this.pagesList = [];\n      return;\n    }\n\n    this.logger.log('loadPagesData()');\n\n    const pagesListPromises = this.wiki.object.pages.map(\n      async (pageId): Promise<PageData> => {\n        const data = await EveesHelpers.getPerspectiveData(this.client, pageId);\n        if (!data) throw new Error(`data not found for page ${pageId}`);\n        const hasTitle: HasTitle = this.recognizer\n          .recognizeBehaviours(data)\n          .find(b => (b as HasTitle).title);\n\n        const title = hasTitle.title(data);\n\n        return {\n          id: pageId,\n          title\n        };\n      }\n    );\n\n    this.pagesList = await Promise.all(pagesListPromises);\n    this.logger.log('loadPagesData()', { pagesList: this.pagesList });\n  }\n\n  selectPage(ix: number | undefined) {\n    if (!this.wiki) return;\n    this.selectedPageIx = ix;\n  }\n\n  getStore(remote: string, type: string): CASStore | undefined {\n    const remoteInstance = this.remotes.find(r => r.id === remote);\n    if (!remoteInstance) throw new Error(`Remote not found for remote ${remote}`);\n    return remoteInstance.store;\n  }\n\n  handlePageDrag(e, pageId) {\n    const dragged = { uref: pageId, parentId: this.uref };\n    this.logger.info('dragging', dragged);\n    e.dataTransfer.setData('text/plain', JSON.stringify(dragged));\n  }\n\n  async handlePageDrop(e) {\n    const wikiObject = this.wiki\n      ? this.wiki.object\n      : {\n          title: '',\n          pages: []\n        };\n\n    const dragged = JSON.parse(e.dataTransfer.getData('text/plain'));\n\n    this.logger.info('dropped', dragged);\n\n    if (!this.wiki) return;\n    if (!dragged.uref) return;\n    if (dragged.parentId === this.uref) return;\n\n    const index = this.wiki.object.pages.length;\n\n    const result = await this.splicePages(wikiObject, [dragged.uref], index, 0);\n\n    if (!result.entity) throw Error('problem with splice pages');\n\n    await this.updateContent(result.entity);\n  }\n\n  dragOverEffect(e) {\n    e.preventDefault();\n    e.dataTransfer.dropEffect = 'move';\n  }\n\n  async createPage(page: TextNode, remote: string) {\n    if (!this.remotes) throw new Error('eveesRemotes undefined');\n    if (!this.client) throw new Error('client undefined');\n\n    const remoteInstance = this.remotes.find(r => r.id === remote);\n    if (!remoteInstance) throw new Error(`Remote not found for remote ${remote}`);\n\n    const dataId = await EveesHelpers.createEntity(this.client, remoteInstance.store, page);\n    const headId = await EveesHelpers.createCommit(this.client, remoteInstance.store, {\n      dataId,\n      parentsIds: []\n    });\n    return EveesHelpers.createPerspective(this.client, remoteInstance, {\n      headId,\n      parentId: this.uref\n    });\n  }\n\n  async updateContent(newWiki: Wiki) {\n    const store = this.getStore(this.remote, WikiBindings.WikiType);\n    if (!store) throw new Error('store is undefined');\n\n    const remote = this.remotes.find(r => r.id === this.remote);\n    if (!remote) throw Error(`Remote not found for remote ${this.remote}`);\n\n    const dataId = await EveesHelpers.createEntity(this.client, store, newWiki);\n    const headId = await EveesHelpers.createCommit(this.client, remote.store, {\n      dataId,\n      parentsIds: this.currentHeadId ? [this.currentHeadId] : undefined\n    });\n    await EveesHelpers.updateHead(this.client, this.uref, headId);\n\n    this.logger.info('updateContent()', newWiki);\n\n    await this.load();\n  }\n\n  async replacePagePerspective(oldId, newId) {\n    if (!this.wiki) throw new Error('wiki undefined');\n\n    const ix = this.wiki.object.pages.findIndex(pageId => pageId === oldId);\n\n    if (ix === -1) return;\n\n    const result = await this.splicePages(this.wiki.object, [newId], ix, 1);\n    if (!result.entity) throw Error('problem with splice pages');\n\n    await this.updateContent(result.entity);\n  }\n\n  async splicePages(wikiObject: Wiki, pages: any[], index: number, count: number) {\n    const getPages = pages.map(page => {\n      if (typeof page !== 'string') {\n        return this.createPage(page, this.remote);\n      } else {\n        return Promise.resolve(page);\n      }\n    });\n\n    const pagesIds = await Promise.all(getPages);\n\n    const newObject = { ...wikiObject };\n    const removed = newObject.pages.splice(index, count, ...pagesIds);\n\n    return {\n      entity: newObject,\n      removed\n    };\n  }\n\n  async newPage(index?: number) {\n    const wikiObject = this.wiki\n      ? this.wiki.object\n      : {\n          title: '',\n          pages: []\n        };\n\n    this.creatingNewPage = true;\n\n    const newPage: TextNode = {\n      text: '',\n      type: TextType.Title,\n      links: []\n    };\n\n    index = index === undefined ? wikiObject.pages.length : index;\n\n    const result = await this.splicePages(wikiObject, [newPage], index, 0);\n    if (!result.entity) throw Error('problem with splice pages');\n\n    await this.updateContent(result.entity);\n    this.selectPage(index);\n\n    this.creatingNewPage = false;\n  }\n\n  async movePage(fromIndex: number, toIndex: number) {\n    if (!this.wiki) throw new Error('wiki not defined');\n\n    const { removed } = await this.splicePages(this.wiki.object, [], fromIndex, 1);\n    const { entity } = await this.splicePages(this.wiki.object, removed as string[], toIndex, 0);\n\n    await this.updateContent(entity);\n\n    if (this.selectedPageIx === undefined) return;\n\n    /** this page was moved */\n    if (fromIndex === this.selectedPageIx) {\n      this.selectPage(toIndex);\n    } else {\n      /** a non selected page was moved to the selected index */\n      if (toIndex === this.selectedPageIx) {\n        this.selectPage(fromIndex);\n      }\n    }\n  }\n\n  async removePage(pageIndex: number) {\n    if (!this.wiki) throw new Error('wiki not defined');\n\n    const { entity } = await this.splicePages(this.wiki.object, [], pageIndex, 1);\n    await this.updateContent(entity);\n\n    if (this.selectedPageIx === undefined) return;\n\n    /** this page was removed */\n    if (pageIndex === this.selectedPageIx) {\n      this.selectPage(undefined);\n    }\n\n    /** a younger page was removed */\n    if (pageIndex < this.selectedPageIx) {\n      this.selectedPageIx = this.selectedPageIx - 1;\n    }\n  }\n\n  async optionOnPage(pageIndex: number, option: string) {\n    switch (option) {\n      case 'move-up':\n        this.movePage(pageIndex, pageIndex - 1);\n        break;\n\n      case 'move-down':\n        this.movePage(pageIndex, pageIndex + 1);\n        break;\n\n      case 'add-below':\n        this.newPage(pageIndex + 1);\n        break;\n\n      case 'remove':\n        this.removePage(pageIndex);\n        break;\n    }\n  }\n\n  goToHome() {\n    this.selectPage(undefined);\n  }\n\n  goBack() {\n    this.dispatchEvent(new CustomEvent('back', { bubbles: true, composed: true }));\n  }\n\n  renderPageList(showOptions: boolean = true) {\n    if (this.pagesList === undefined)\n      return html`\n        <uprtcl-loading class=\"empty-pages-loader\"></uprtcl-loading>\n      `;\n\n    return html`\n      ${this.pagesList.length === 0\n        ? html`\n            <div class=\"empty\">\n              <span><i>${this.t('wikis:no-pages-yet')}</i></span>\n            </div>\n          `\n        : html`\n            <uprtcl-list>\n              ${this.pagesList.map((page, ix) => {\n                // this.logger.log(`rendering page title ${page.id}`, menuConfig);\n                return this.renderPageItem(page, ix, showOptions);\n              })}\n            </uprtcl-list>\n          `}\n      ${this.editableActual\n        ? html`\n            <div class=\"button-row\">\n              <uprtcl-button-loading\n                icon=\"add_circle_outline\"\n                @click=${() => this.newPage()}\n                ?loading=${this.creatingNewPage}\n              >\n                ${this.t('wikis:new-page')}\n              </uprtcl-button-loading>\n            </div>\n          `\n        : html``}\n    `;\n  }\n\n  renderPageItem(page: PageData, ix: number, showOptions: boolean) {\n    const menuConfig: MenuConfig = {\n      'move-up': {\n        disabled: ix === 0,\n        text: 'move up',\n        icon: 'arrow_upward'\n      },\n      'move-down': {\n        disabled: ix === (this.pagesList as any[]).length - 1,\n        text: 'move down',\n        icon: 'arrow_downward'\n      },\n      'add-below': {\n        disabled: false,\n        text: 'create below',\n        icon: 'add'\n      },\n      remove: {\n        disabled: false,\n        text: 'remove',\n        icon: 'clear'\n      }\n    };\n\n    const text = htmlToText(page.title);\n    const empty = text === '';\n    const selected = this.selectedPageIx === ix;\n\n    let classes: string[] = [];\n\n    classes.push('page-item');\n    if (empty) classes.push('title-empty');\n    if (selected) classes.push('title-selected');\n\n    return html`\n      <div\n        class=${classes.join(' ')}\n        draggable=\"false\"\n        @dragstart=${e => this.handlePageDrag(e, page.id)}\n        @click=${() => this.selectPage(ix)}\n      >\n        <div class=\"text-container\">\n          ${text.length < MAX_LENGTH ? text : `${text.slice(0, MAX_LENGTH)}...`}\n        </div>\n        ${this.editableActual && showOptions\n          ? html`\n              <div class=\"item-menu-container\">\n                <uprtcl-options-menu\n                  class=\"options-menu\"\n                  @option-click=${e => this.optionOnPage(ix, e.detail.key)}\n                  .config=${menuConfig}\n                >\n                </uprtcl-options-menu>\n              </div>\n            `\n          : ''}\n      </div>\n    `;\n  }\n\n  renderHome() {\n    return ``;\n    // return this.pagesList\n    //   ? this.pagesList.map((page, ix) => {\n    //       return html`\n    //         <uprtcl-card class=\"home-card bg-transition\" @click=${() => this.selectPage(ix)}>\n    //           ${page.title}\n    //         </uprtcl-card>\n    //       `;\n    //     })\n    //   : '';\n  }\n\n  render() {\n    if (this.loading)\n      return html`\n        <uprtcl-loading></uprtcl-loading>\n      `;\n\n    this.logger.log('rendering wiki after loading');\n\n    return html`\n      <div class=\"app-content-with-nav\">\n        <div class=\"app-navbar\" @dragover=${this.dragOverEffect} @drop=${this.handlePageDrop}>\n          ${this.renderPageList()}\n        </div>\n\n        <div class=\"app-content\">\n          ${this.selectedPageIx !== undefined && this.wiki\n            ? html`\n                <div class=\"page-container\">\n                  <documents-editor\n                    id=\"doc-editor\"\n                    .client=${this.client}\n                    uref=${this.wiki.object.pages[this.selectedPageIx] as string}\n                    parent-id=${this.uref}\n                    color=${this.color}\n                    official-owner=${this.officialOwner}\n                    ?check-owner=${this.checkOwner}\n                    show-info\n                  >\n                  </documents-editor>\n                </div>\n              `\n            : html`\n                <div class=\"home-container\">\n                  ${this.renderHome()}\n                </div>\n              `}\n        </div>\n      </div>\n    `;\n  }\n\n  static get styles() {\n    return [\n      styles,\n      css`\n        :host {\n          display: flex;\n          flex: 1 1 0;\n          flex-direction: column;\n        }\n        .app-content-with-nav {\n          flex: 1 1 0;\n          display: flex;\n          flex-direction: row;\n          position: relative;\n        }\n        .app-navbar {\n          width: 260px;\n          flex-shrink: 0;\n        }\n        .app-content {\n          border-left: solid #cccccc 1px;\n          min-width: 475px;\n          max-width: calc(100% - 260px - 1px);\n          flex-grow: 1;\n          display: flex;\n          flex-direction: column;\n          position: relative;\n        }\n        .empty-pages-loader {\n          margin-top: 22px;\n          display: block;\n        }\n        .page-item {\n          min-height: 48px;\n          cursor: pointer;\n          width: calc(100% - 19px);\n          display: flex;\n          padding: 0px 3px 0px 16px;\n          transition: all 0.1s ease-in;\n        }\n        .page-item .text-container {\n          white-space: nowrap;\n          overflow: hidden;\n          max-width: calc(100% - 48px);\n          overflow-x: hidden;\n          flex-grow: 1;\n          display: flex;\n          flex-direction: column;\n          justify-content: center;\n          align-items: flex-start;\n        }\n        .page-item .item-menu-container {\n          display: flex;\n          flex-direction: column;\n          justify-content: center;\n        }\n        .page-item .item-menu-container .options-menu {\n          --box-width: 160px;\n          font-weight: normal;\n        }\n        .page-item:hover {\n          background-color: #e8ecec;\n        }\n        .title-empty {\n          color: #a2a8aa;\n          font-style: italic;\n        }\n        .title-selected {\n          font-weight: bold;\n          background-color: rgb(200, 200, 200, 0.2);\n        }\n        .empty {\n          width: 100%;\n          text-align: center;\n          padding-top: 24px;\n          color: #a2a8aa;\n        }\n        .button-row {\n          width: calc(100% - 20px);\n          padding: 16px 10px 8px 10px;\n          display: flex;\n        }\n        .button-row uprtcl-button-loading {\n          margin: 0 auto;\n          width: 180px;\n        }\n        .page-container {\n          margin: 0 auto;\n          max-width: 900px;\n          width: 100%;\n          flex-grow: 1;\n          display: flex;\n          flex-direction: column;\n        }\n        .home-container {\n          text-align: center;\n          height: auto;\n          padding: 6vw 0vw;\n        }\n        .home-card {\n          width: 100%;\n          font-size: 20px;\n          display: block;\n          max-width: 340px;\n          margin: 18px auto;\n          cursor: pointer;\n          padding: 8px 24px;\n          font-weight: bold;\n        }\n        .home-card:hover {\n          background-color: #f1f1f1;\n        }\n      `\n    ];\n  }\n}\n","import { property, html, css, LitElement, query } from 'lit-element';\nimport { ApolloClient, gql } from 'apollo-boost';\nconst styleMap = style => {\n  return Object.entries(style).reduce((styleString, [propName, propValue]) => {\n    propName = propName.replace(/([A-Z])/g, matches => `-${matches[0].toLowerCase()}`);\n    return `${styleString}${propName}:${propValue};`;\n  }, '');\n};\n\nimport { Logger, moduleConnect } from '@uprtcl/micro-orchestrator';\nimport { sharedStyles } from '@uprtcl/lenses';\nimport { CortexModule, PatternRecognizer, Signed } from '@uprtcl/cortex';\nimport {\n  EveesRemote,\n  EveesModule,\n  eveeColor,\n  DEFAULT_COLOR,\n  Perspective,\n  CONTENT_UPDATED_TAG,\n  ContentUpdatedEvent\n} from '@uprtcl/evees';\nimport { ApolloClientModule } from '@uprtcl/graphql';\nimport { WikiDrawerContent } from './wiki-drawer-content';\nimport { loadEntity } from '@uprtcl/multiplatform';\nimport { CREATE_PROPOSAL, PROPOSAL_CREATED_TAG } from '@uprtcl/evees';\nimport { ProposalCreatedEvent } from '@uprtcl/evees/dist/types/types';\n\nexport class WikiDrawer extends moduleConnect(LitElement) {\n  logger = new Logger('WIKI-DRAWER');\n\n  @property({ type: String, attribute: 'uref' })\n  firstRef!: string;\n\n  @property({ type: Boolean, attribute: 'show-proposals' })\n  showProposals: boolean = false;\n\n  @property({ type: Boolean, attribute: 'show-back' })\n  showBack: boolean = false;\n\n  @property({ attribute: false })\n  uref!: string;\n\n  @property({ attribute: false })\n  officialOwner!: string;\n\n  @property({ type: Boolean, attribute: 'check-owner' })\n  checkOwner: boolean = false;\n\n  @property({ attribute: false })\n  loading: boolean = true;\n\n  @property({ attribute: false })\n  creatorId!: string;\n\n  @query('#wiki-drawer-content')\n  content!: WikiDrawerContent;\n\n  @query('#evees-info-row')\n  eveesInfoLocal!: any;\n\n  protected client!: ApolloClient<any>;\n  protected eveesRemotes!: EveesRemote[];\n  protected recognizer!: PatternRecognizer;\n\n  constructor() {\n    super();\n  }\n\n  async firstUpdated() {\n    this.client = this.request(ApolloClientModule.bindings.Client);\n    this.eveesRemotes = this.requestAll(EveesModule.bindings.EveesRemote);\n    this.recognizer = this.request(CortexModule.bindings.Recognizer);\n\n    this.logger.log('firstUpdated()', { uref: this.uref });\n\n    this.uref = this.firstRef;\n\n    /** the official owner is the creator of the firstRef of the Wiki,\n     * the firstRef is comming from the outside e.g. browser url. */\n    const official = await loadEntity<Signed<Perspective>>(this.client, this.firstRef);\n    if (!official) throw new Error(`cant find official perspective ${this.firstRef}`);\n    this.officialOwner = official.object.payload.creatorId;\n\n    await this.load();\n    this.loading = false;\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n\n    this.addEventListener('checkout-perspective', ((event: CustomEvent) => {\n      this.uref = event.detail.perspectiveId;\n    }) as EventListener);\n\n    this.addEventListener(CONTENT_UPDATED_TAG, ((event: ContentUpdatedEvent) => {\n      if (this.uref === event.detail.uref) {\n        this.content.load();\n      }\n    }) as EventListener);\n\n    this.addEventListener(PROPOSAL_CREATED_TAG, ((event: ProposalCreatedEvent) => {\n      this.catchMergeProposal(event);\n    }) as EventListener);\n  }\n\n  async load() {\n    const current = await loadEntity<Signed<Perspective>>(this.client, this.uref);\n    if (!current) throw new Error(`cant find current perspective ${this.uref}`);\n\n    this.creatorId = current.object.payload.creatorId;\n  }\n\n  async forceReload() {\n    this.loading = true;\n    await this.updateComplete;\n    await this.client.resetStore();\n    this.load();\n    this.loading = false;\n  }\n\n  updated(changedProperties) {\n    if (changedProperties.has('uref')) {\n      this.load();\n    }\n  }\n\n  async catchMergeProposal(e: ProposalCreatedEvent) {\n    await this.client.mutate({\n      mutation: CREATE_PROPOSAL,\n      variables: {\n        toPerspectiveId: this.firstRef,\n        fromPerspectiveId: this.uref,\n        newPerspectives: e.detail.proposalDetails.newPerspectives,\n        updates: e.detail.proposalDetails.updates\n      }\n    });\n    this.eveesInfoLocal.load();\n  }\n\n  color() {\n    if (this.firstRef === this.uref) {\n      return DEFAULT_COLOR;\n    } else {\n      return eveeColor(this.creatorId);\n    }\n  }\n\n  loggedIn() {\n    this.content.load();\n    this.eveesInfoLocal.load();\n  }\n\n  renderBreadcrumb() {\n    return html`\n      ${this.showBack\n        ? html`\n            <uprtcl-icon-button\n              button\n              class=\"back-button\"\n              icon=\"arrow_back\"\n              @click=${() => this.dispatchEvent(new CustomEvent('back'))}\n            ></uprtcl-icon-button>\n          `\n        : ``}\n      <evees-info-user-based\n        id=\"evees-info-row\"\n        uref=${this.uref}\n        first-uref=${this.firstRef}\n        official-owner=${this.officialOwner}\n        ?check-owner=${this.checkOwner}\n        ?show-proposals=${this.showProposals}\n        show-info\n        show-icon\n        ?show-debug=${false}\n        show-draft\n        show-edit-draft\n      >\n      </evees-info-user-based>\n    `;\n  }\n\n  renderLoginWidget() {\n    return html`\n      <uprtcl-icon-button\n        button\n        class=\"reload-button\"\n        icon=\"cached\"\n        @click=${() => this.forceReload()}\n      ></uprtcl-icon-button>\n      <evees-login-widget @changed=${() => this.loggedIn()}></evees-login-widget>\n    `;\n  }\n\n  render() {\n    if (this.loading)\n      return html`\n        <uprtcl-loading></uprtcl-loading>\n      `;\n\n    this.logger.log('rendering wiki after loading');\n\n    return html`\n      <div class=\"app-drawer\">\n        <div\n          class=\"app-topbar\"\n          style=${styleMap({\n            borderColor: this.color()\n          })}\n        >\n          <div class=\"breadcrum-container\">${this.renderBreadcrumb()}</div>\n          <div class=\"login-widget-container\">${this.renderLoginWidget()}</div>\n        </div>\n\n        <wiki-drawer-content\n          id=\"wiki-drawer-content\"\n          uref=${this.uref}\n          editable\n          color=${this.color()}\n          official-owner=${this.officialOwner}\n          ?check-owner=${this.checkOwner}\n        >\n        </wiki-drawer-content>\n      </div>\n    `;\n  }\n\n  static get styles() {\n    return [\n      sharedStyles,\n      css`\n        :host {\n          display: flex;\n          flex: 1 1 0;\n          flex-direction: column;\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, 'Apple Color Emoji',\n            Arial, sans-serif, 'Segoe UI Emoji', 'Segoe UI Symbol';\n          font-size: 16px;\n          color: #37352f;\n          --mdc-theme-primary: #2196f3;\n          width: 100%;\n          position: relative;\n        }\n        .app-drawer {\n          width: 100%;\n          flex: 1 1 0;\n          display: flex;\n          flex-direction: column;\n        }\n        .app-topbar {\n          width: 100%;\n          display: flex;\n          flex-direction: row;\n          height: 68px;\n          border-width: 5px;\n          border-bottom-style: solid;\n        }\n        .breadcrum-container {\n          flex: 1 1 0;\n          padding: 16px;\n          display: flex;\n          flex-direction: row;\n        }\n        evees-info-user-based {\n          width: 100%;\n        }\n        .login-widget-container {\n          flex: 0 0 0;\n          padding: 16px;\n          display: flex;\n        }\n        .reload-button {\n          margin-right: 8px;\n        }\n        .back-button {\n          margin-right: 8px;\n        }\n      `\n    ];\n  }\n}\n","import { html } from 'lit-element';\nimport { injectable } from 'inversify';\n\nimport { Logger } from '@uprtcl/micro-orchestrator';\nimport { Pattern, Entity, HasChildren, recognizeEntity, HasTitle } from '@uprtcl/cortex';\nimport {\n  MergeStrategy,\n  mergeStrings,\n  Merge,\n  HasDiffLenses,\n  DiffLens,\n  EveesWorkspace\n} from '@uprtcl/evees';\nimport { HasLenses, Lens } from '@uprtcl/lenses';\n\nimport { Wiki } from '../types';\nimport { WikiBindings } from '../bindings';\n\nconst propertyOrder = ['title', 'pages'];\n\nconst logger = new Logger('WIKI-ENTITY');\n\nexport class WikiPattern extends Pattern<Wiki> {\n  recognize(entity: object): boolean {\n    return recognizeEntity(entity) && propertyOrder.every(p => entity.object.hasOwnProperty(p));\n  }\n\n  type = WikiBindings.WikiType;\n}\n\n@injectable()\nexport class WikiLinks implements HasChildren<Entity<Wiki>>, Merge<Entity<Wiki>> {\n  replaceChildrenLinks = (wiki: Entity<Wiki>) => (childrenHashes: string[]): Entity<Wiki> => ({\n    ...wiki,\n    object: {\n      ...wiki.object,\n      pages: childrenHashes\n    }\n  });\n\n  getChildrenLinks: (wiki: Entity<Wiki>) => string[] = (wiki: Entity<Wiki>): string[] =>\n    wiki.object.pages;\n\n  links: (wiki: Entity<Wiki>) => Promise<string[]> = async (wiki: Entity<Wiki>) =>\n    this.getChildrenLinks(wiki);\n\n  merge = (originalNode: Entity<Wiki>) => async (\n    modifications: (Entity<Wiki> | undefined)[],\n    mergeStrategy: MergeStrategy,\n    workspace: EveesWorkspace,\n    config\n  ): Promise<Wiki> => {\n    const mergedTitle = mergeStrings(\n      originalNode.object.title,\n      modifications.map(data => (!!data ? data.object.title : originalNode.object.title))\n    );\n\n    // TODO: add entity\n    const mergedPages = await mergeStrategy.mergeLinks(\n      originalNode.object.pages,\n      modifications.map(data => (!!data ? data.object.pages : originalNode.object.pages)),\n      workspace,\n      config\n    );\n\n    return {\n      title: mergedTitle,\n      pages: mergedPages\n    };\n  };\n}\n\n@injectable()\nexport class WikiCommon implements HasTitle, HasLenses<Entity<Wiki>>, HasDiffLenses<Entity<Wiki>> {\n  lenses = (wiki: Entity<Wiki>): Lens[] => {\n    return [\n      {\n        name: 'Wiki',\n        type: 'content',\n        render: (entity: Entity<any>, context: any) => {\n          logger.info('lenses() - Wiki', { wiki, context });\n          return html`\n            <wiki-drawer\n              .data=${wiki}\n              .uref=${entity.id}\n              color=${context.color}\n              .selectedPageHash=${context.selectedPageHash}\n            >\n            </wiki-drawer>\n          `;\n        }\n      }\n    ];\n  };\n\n  diffLenses = (): DiffLens[] => {\n    return [\n      {\n        name: 'wikis:wiki-diff',\n        type: 'diff',\n        render: (\n          workspace: EveesWorkspace,\n          newEntity: Entity<Wiki>,\n          oldEntity: Entity<Wiki>,\n          summary: boolean\n        ) => {\n          // logger.log('lenses: documents:document - render()', { node, lensContent, context });\n          return html`\n            <wiki-diff\n              .workspace=${workspace}\n              .newData=${newEntity}\n              .oldData=${oldEntity}\n              ?summary=${summary}\n            >\n            </wiki-diff>\n          `;\n        }\n      }\n    ];\n  };\n\n  title = (wiki: Entity<Wiki>) => wiki.object.title;\n}\n","import gql from 'graphql-tag';\nimport { DocumentNode } from 'graphql';\n\nexport const wikiTypeDefs: DocumentNode = gql`\n  type Wiki implements Entity {\n    id: ID!\n\n    title: String!\n    pages: [Entity!]! @discover\n\n    _context: EntityContext!\n  }\n`;\n","import { LitElement, property, html, css } from 'lit-element';\n\nimport { moduleConnect, Logger } from '@uprtcl/micro-orchestrator';\nimport { Entity } from '@uprtcl/cortex';\n\nimport { Wiki } from '../types';\nimport { EveesWorkspace } from '@uprtcl/evees';\n\nconst LOGINFO = true;\n\ninterface PageDetails {\n  uref: string;\n  title: string;\n}\n\nexport class WikiDiff extends moduleConnect(LitElement) {\n  logger = new Logger('EVEES-DIFF');\n\n  @property({ type: Boolean })\n  summary: boolean = false;\n\n  @property({ attribute: false })\n  workspace!: EveesWorkspace;\n\n  @property({ attribute: false })\n  newData!: Entity<Wiki>;\n\n  @property({ attribute: false })\n  oldData!: Entity<Wiki>;\n\n  @property({ attribute: false })\n  loading: boolean = true;\n\n  newPages!: string[];\n  deletedPages!: string[];\n  oldTitle: string = '';\n\n  async firstUpdated() {\n    this.logger.log('firstUpdated()', {\n      newData: this.newData,\n      oldData: this.oldData\n    });\n\n    this.loadChanges();\n  }\n\n  async loadChanges() {\n    this.loading = true;\n\n    const oldPages = this.oldData ? this.oldData.object.pages : [];\n    this.oldTitle = this.oldData ? this.oldData.object.title : '';\n\n    this.newPages = this.newData.object.pages.filter(page =>\n      this.oldData ? !oldPages.includes(page) : true\n    );\n    this.deletedPages = this.oldData\n      ? oldPages.filter(page => !this.newData.object.pages.includes(page))\n      : [];\n\n    this.loading = false;\n  }\n\n  renderPage(page: string, classes: string[]) {\n    return html`\n      <div class=${['page-row'].concat(classes).join(' ')}>\n        <documents-editor\n          .client=${this.workspace.workspace}\n          uref=${page}\n          read-only\n        ></documents-editor>\n      </div>\n    `;\n  }\n\n  renderTitleChange(title: string, classes: string[]) {\n    return html`\n      <div class=${['page-row'].concat(classes).join(' ')}>\n        <h1>${title}</h1>\n      </div>\n    `;\n  }\n\n  render() {\n    if (this.loading) {\n      return html`\n        <uprtcl-loading></uprtcl-loading>\n      `;\n    }\n\n    const titleChanged = this.newData.object.title !== this.oldTitle;\n\n    const newPages = this.newPages !== undefined ? this.newPages : [];\n    const deletedPages = this.deletedPages !== undefined ? this.deletedPages : [];\n\n    if (this.summary) {\n      return html`\n        ${titleChanged\n          ? html`\n              <span class=\"\">Title changed, </span>\n            `\n          : ''}\n        ${newPages.length\n          ? html`\n              <span>${newPages.length} new pages added,</span>\n            `\n          : ''}\n        ${deletedPages.length\n          ? html`\n              <span>${deletedPages.length} pages deleted.</span>\n            `\n          : ''}\n      `;\n    }\n\n    return html`\n      ${titleChanged\n        ? html`\n            <div class=\"pages-list\">\n              <div class=\"page-list-title\">New Title</div>\n              ${this.renderTitleChange(this.newData.object.title, ['green-background'])}\n              ${this.renderTitleChange(this.oldTitle, ['red-background'])}\n            </div>\n          `\n        : ''}\n      ${newPages.length > 0\n        ? html`\n            <div class=\"pages-list\">\n              <div class=\"page-list-title\">Pages Added</div>\n              ${newPages.map(page => this.renderPage(page, ['green-background']))}\n            </div>\n          `\n        : ''}\n      ${deletedPages.length > 0\n        ? html`\n            <div class=\"pages-list\">\n              <div class=\"page-list-title\">Pages Removed</div>\n              ${deletedPages.map(page => this.renderPage(page, ['red-background']))}\n            </div>\n          `\n        : ''}\n    `;\n  }\n\n  static get styles() {\n    return css`\n      :host {\n        text-align: left;\n      }\n      .page-list-title {\n        font-weight: bold;\n        margin-bottom: 9px;\n        color: gray;\n      }\n      .page-row {\n        padding: 2vw;\n        border-radius: 3px;\n        margin-bottom: 16px;\n      }\n      .green-background {\n        background-color: #abdaab;\n      }\n      .red-background {\n        background-color: #dab6ab;\n      }\n    `;\n  }\n}\n","import { Container } from 'inversify';\n\nimport { PatternsModule } from '@uprtcl/cortex';\nimport { EveesContentModule } from '@uprtcl/evees';\nimport { GraphQlSchemaModule } from '@uprtcl/graphql';\nimport { i18nextModule } from '@uprtcl/micro-orchestrator';\n\nimport { WikiDrawer } from './elements/wiki-drawer';\nimport { WikiCommon, WikiLinks, WikiPattern } from './patterns/wiki.pattern';\nimport { wikiTypeDefs } from './graphql/schema';\n\nimport en from './i18n/en.json';\nimport { WikiBindings } from './bindings';\nimport { WikiDiff } from './elements/wiki-diff';\nimport { WikiDrawerContent } from './elements/wiki-drawer-content';\n\n/**\n * Configure a wikis module with the given providers\n *\n * Depends on: lensesModule, PatternsModule, multiSourceModule\n *\n * Example usage:\n *\n * ```ts\n * import { IpfsStore } from '@uprtcl/ipfs-provider';\n * import { WikisModule, WikisTypes } from '@uprtcl/wikis';\n *\n * const ipfsStore = new IpfsStore({\n *   host: 'ipfs.infura.io',\n *   port: 5001,\n *   protocol: 'https'\n * });\n *\n * const wikis = new WikisModule([ ipfsStore ]);\n * await orchestrator.loadModule(wikis);\n * ```\n *\n * @category CortexModule\n *\n * @param stores an array of CASStores in which the wiki objects can be stored/retrieved from\n */\nexport class WikisModule extends EveesContentModule {\n  static id = 'wikis-module';\n\n  static bindings = WikiBindings;\n\n  providerIdentifier = WikiBindings.WikisRemote;\n\n  async onLoad(container: Container) {\n    super.onLoad(container);\n    customElements.define('wiki-drawer', WikiDrawer);\n    customElements.define('wiki-drawer-content', WikiDrawerContent);\n    customElements.define('wiki-diff', WikiDiff);\n  }\n\n  get submodules() {\n    return [\n      ...super.submodules,\n      new GraphQlSchemaModule(wikiTypeDefs, {}),\n      new i18nextModule('wikis', { en: en }),\n      new PatternsModule([new WikiPattern([WikiCommon, WikiLinks])])\n    ];\n  }\n}\n"],"names":["moduleConnect","LitElement","Logger","ApolloClientModule","EveesModule","CortexModule","CONTENT_UPDATED_TAG","loadEntity","EveesHelpers","TextType","html","htmlToText","styles","css","property","PROPOSAL_CREATED_TAG","CREATE_PROPOSAL","DEFAULT_COLOR","eveeColor","sharedStyles","query","Pattern","recognizeEntity","mergeStrings","injectable","gql","EveesWorkspace","EveesContentModule","GraphQlSchemaModule","i18nextModule","PatternsModule"],"mappings":"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"}