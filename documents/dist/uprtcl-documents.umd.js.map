{"version":3,"file":"uprtcl-documents.umd.js","sources":["../src/types.ts","../src/bindings.ts","../src/support/documents.support.ts","../src/patterns/text-node.pattern.ts","../src/graphql/schema.ts","../src/elements/prosemirror/codemirror.css.ts","../src/elements/prosemirror/codeview.ts","../src/elements/prosemirror/icons.ts","../src/elements/prosemirror/icons.css.ts","../src/elements/prosemirror/prosemirror.css.ts","../src/elements/prosemirror/lesser-dark.css.ts","../src/elements/prosemirror/schema-block.ts","../src/elements/prosemirror/schema-title.ts","../src/elements/prosemirror/documents-text-node-editor.ts","../src/elements/document-editor.ts","../src/elements/document-text-node-diff.ts","../src/documents.module.ts"],"sourcesContent":["import { Entity, HasChildren } from '@uprtcl/cortex';\nimport { HasDocNodeLenses } from './patterns/document-patterns';\n\nexport enum TextType {\n  Title = 'Title',\n  Paragraph = 'Paragraph'\n}\n\nexport interface TextNode {\n  text: string;\n  type: TextType;\n  links: string[];\n}\n\nexport interface DocNode {\n  uref: string;\n  isPlaceholder: boolean;\n  placeholderRef?: string;\n  remote?: string;\n  context?: string;\n  data?: Entity<any>;\n  draft: any;\n  type?: string;\n  timestamp: number;\n  coord: number[];\n  level: number;\n  append?: any; // used by upper layer to tell the docnode lense to append content using its internal appending logic.\n  childrenNodes: DocNode[];\n  headId?: string;\n  editable: boolean;\n  parent?: DocNode;\n  ix?: number; // ix on parent\n  focused: boolean;\n  hasDocNodeLenses: HasDocNodeLenses;\n  hasChildren: HasChildren;\n}\n\nexport interface DocNodeEventsHandlers {\n  focus: () => void;\n  blur: () => void;\n  contentChanged: (newContent: any, lift: boolean) => void;\n  split: (tail: string, asChild: boolean) => void;\n  joinBackward: (tail: string) => void;\n  pullDownward: () => void;\n  focusBackward: () => void;\n  focusDownward: () => void;\n  lift: () => void;\n  appended: () => void;\n}\n","export const DocumentsBindings = {\n  TextNodeType: 'TextNode',\n  DocumentsRemote: 'documents-remote',\n};\n","export const htmlToText = (textWithHtml: string): string => {\n  const temp = document.createElement('template');\n  temp.innerHTML = textWithHtml;\n\n  if (!temp.content) return 'unknown';\n  if (temp.content.textContent !== '') {\n    return temp.content.textContent != null ? temp.content.textContent : 'unknown';\n  } else {\n    if (!temp.content.firstElementChild) return 'unknown';\n    return (temp.content.firstElementChild as HTMLElement).innerText;\n  }\n};\n","import { html } from 'lit-element';\nimport { injectable } from 'inversify';\n\nimport {\n  Pattern,\n  recognizeEntity,\n  HasChildren,\n  Entity,\n  HasTitle,\n  New,\n} from '@uprtcl/cortex';\nimport {\n  Merge,\n  MergeStrategy,\n  mergeStrings,\n  mergeResult,\n  HasDiffLenses,\n  DiffLens,\n  EveesWorkspace,\n} from '@uprtcl/evees';\nimport { Lens, HasLenses } from '@uprtcl/lenses';\n\nimport { TextNode, TextType, DocNode, DocNodeEventsHandlers } from '../types';\nimport { DocNodeLens } from './document-patterns';\nimport { DocumentsBindings } from '../bindings';\n\nconst propertyOrder = ['text', 'type', 'links'];\n\nconst textToTextNode = (textNode: TextNode, text: string): TextNode => {\n  return {\n    ...textNode,\n    text: text,\n  };\n};\n\nconst typeToTextNode = (textNode: TextNode, type: TextType): TextNode => {\n  return {\n    ...textNode,\n    type: type,\n  };\n};\n\nexport class TextNodePattern extends Pattern<Entity<TextNode>> {\n  recognize(entity: object): boolean {\n    return (\n      recognizeEntity(entity) &&\n      propertyOrder.every((p) => entity.object.hasOwnProperty(p))\n    );\n  }\n\n  type = DocumentsBindings.TextNodeType;\n}\n\n@injectable()\nexport class TextNodeCommon\n  implements\n    HasLenses<Entity<TextNode>>,\n    HasChildren<Entity<TextNode>>,\n    Merge<Entity<TextNode>> {\n  replaceChildrenLinks = (node: Entity<TextNode>) => (\n    childrenHashes: string[]\n  ): Entity<TextNode> => ({\n    id: '',\n    object: {\n      ...node.object,\n      links: childrenHashes,\n    },\n  });\n\n  getChildrenLinks = (node: Entity<TextNode>): string[] => node.object.links;\n\n  links = async (node: Entity<TextNode>) => this.getChildrenLinks(node);\n\n  lenses = (node: Entity<TextNode>): Lens[] => {\n    return [\n      {\n        name: 'documents:document',\n        type: 'content',\n        render: (entity: Entity<any>, context: any) => {\n          return html`\n            <documents-text-node .data=${node} uref=${entity.id}>\n            </documents-text-node>\n          `;\n        },\n      },\n    ];\n  };\n\n  /** lenses top is a lense that dont render the node children, leaving the job to an upper node tree controller */\n  docNodeLenses = (): DocNodeLens[] => {\n    return [\n      {\n        name: 'documents:document',\n        type: 'content',\n        render: (node: DocNode, events: DocNodeEventsHandlers) => {\n          // logger.log('lenses: documents:document - render()', { node });\n          return html`\n            <documents-text-node-editor\n              type=${node.draft.type}\n              init=${node.draft.text}\n              to-append=${node.append}\n              level=${node.level + 1}\n              editable=${node.editable ? 'true' : 'false'}\n              focus-init=${node.focused}\n              @focus=${events.focus}\n              @blur=${events.blur}\n              @content-changed=${(e) =>\n                events.contentChanged(\n                  textToTextNode(node.draft, e.detail.content),\n                  false\n                )}\n              @enter-pressed=${(e) =>\n                events.split(e.detail.content, e.detail.asChild)}\n              @backspace-on-start=${(e) =>\n                events.joinBackward(e.detail.content)}\n              @delete-on-end=${(e) => events.pullDownward()}\n              @keyup-on-start=${events.focusBackward}\n              @keydown-on-end=${events.focusDownward}\n              @lift-heading=${events.lift}\n              @change-type=${(e) =>\n                events.contentChanged(\n                  typeToTextNode(node.draft, e.detail.type),\n                  e.detail.lift\n                )}\n              @content-appended=${events.appended}\n            >\n            </documents-text-node-editor>\n          `;\n        },\n      },\n    ];\n  };\n\n  merge = (originalNode: Entity<TextNode>) => async (\n    modifications: Entity<TextNode>[],\n    mergeStrategy: MergeStrategy,\n    workspace: EveesWorkspace,\n    config: any\n  ): Promise<TextNode> => {\n    const resultText = modifications[1].object.text;\n    const resultType = mergeResult(\n      originalNode.object.type,\n      modifications.map((data) => data.object.type)\n    );\n\n    const mergedLinks = await mergeStrategy.mergeLinks(\n      originalNode.object.links,\n      modifications.map((data) => data.object.links),\n      workspace,\n      config\n    );\n\n    return {\n      text: resultText,\n      type: resultType,\n      links: mergedLinks,\n    };\n  };\n}\n\n@injectable()\nexport class TextNodeTitle implements HasTitle, HasDiffLenses {\n  title = (textNode: Entity<TextNode>) => textNode.object.text;\n\n  diffLenses = (node?: TextNode): DiffLens[] => {\n    return [\n      {\n        name: 'documents:document-diff',\n        type: 'diff',\n        render: (\n          workspace: EveesWorkspace,\n          newEntity: Entity<TextNode>,\n          oldEntity: Entity<TextNode>,\n          summary: boolean\n        ) => {\n          // logger.log('lenses: documents:document - render()', { node, lensContent, context });\n          return html`\n            <documents-text-node-diff\n              .workspace=${workspace}\n              .newData=${newEntity}\n              .oldData=${oldEntity}\n              ?summary=${summary}\n            >\n            </documents-text-node-diff>\n          `;\n        },\n      },\n    ];\n  };\n}\n","import gql from 'graphql-tag';\nimport { DocumentNode } from 'graphql';\n\nexport const documentsTypeDefs: DocumentNode = gql`\n  extend type Patterns {\n    title: String\n  }\n\n  enum TextType {\n    Title\n    Paragraph\n  }\n\n  type TextNode implements Entity {\n    id: ID!\n\n    text: String!\n    type: TextType!\n    links: [Entity]! @discover\n\n    _context: EntityContext!\n  }\n`;\n","import { css } from 'lit-element';\n\nexport const styles = css`\n  /* BASICS */\n\n  .CodeMirror {\n    /* Set height, width, borders, and global font properties here */\n    font-family: monospace;\n    height: auto;\n    color: black;\n    direction: ltr;\n    padding: 2vh 1.5vh;\n    border-radius: 5px;\n  }\n\n  /* PADDING */\n\n  .CodeMirror-lines {\n    padding: 4px 0; /* Vertical padding around content */\n  }\n  .CodeMirror pre.CodeMirror-line,\n  .CodeMirror pre.CodeMirror-line-like {\n    padding: 0 4px; /* Horizontal padding of content */\n  }\n\n  .CodeMirror-scrollbar-filler,\n  .CodeMirror-gutter-filler {\n    background-color: white; /* The little square between H and V scrollbars */\n  }\n\n  /* GUTTER */\n\n  .CodeMirror-gutters {\n    border-right: 1px solid #ddd;\n    background-color: #f7f7f7;\n    white-space: nowrap;\n  }\n  .CodeMirror-linenumbers {\n  }\n  .CodeMirror-linenumber {\n    padding: 0 3px 0 5px;\n    min-width: 20px;\n    text-align: right;\n    color: #999;\n    white-space: nowrap;\n  }\n\n  .CodeMirror-guttermarker {\n    color: black;\n  }\n  .CodeMirror-guttermarker-subtle {\n    color: #999;\n  }\n\n  /* CURSOR */\n\n  .CodeMirror-cursor {\n    border-left: 1px solid black;\n    border-right: none;\n    width: 0;\n  }\n  /* Shown when moving in bi-directional text */\n  .CodeMirror div.CodeMirror-secondarycursor {\n    border-left: 1px solid silver;\n  }\n  .cm-fat-cursor .CodeMirror-cursor {\n    width: auto;\n    border: 0 !important;\n    background: #7e7;\n  }\n  .cm-fat-cursor div.CodeMirror-cursors {\n    z-index: 1;\n  }\n  .cm-fat-cursor-mark {\n    background-color: rgba(20, 255, 20, 0.5);\n    -webkit-animation: blink 1.06s steps(1) infinite;\n    -moz-animation: blink 1.06s steps(1) infinite;\n    animation: blink 1.06s steps(1) infinite;\n  }\n  .cm-animate-fat-cursor {\n    width: auto;\n    border: 0;\n    -webkit-animation: blink 1.06s steps(1) infinite;\n    -moz-animation: blink 1.06s steps(1) infinite;\n    animation: blink 1.06s steps(1) infinite;\n    background-color: #7e7;\n  }\n  @-moz-keyframes blink {\n    0% {\n    }\n    50% {\n      background-color: transparent;\n    }\n    100% {\n    }\n  }\n  @-webkit-keyframes blink {\n    0% {\n    }\n    50% {\n      background-color: transparent;\n    }\n    100% {\n    }\n  }\n  @keyframes blink {\n    0% {\n    }\n    50% {\n      background-color: transparent;\n    }\n    100% {\n    }\n  }\n\n  /* Can style cursor different in overwrite (non-insert) mode */\n  .CodeMirror-overwrite .CodeMirror-cursor {\n  }\n\n  .cm-tab {\n    display: inline-block;\n    text-decoration: inherit;\n  }\n\n  .CodeMirror-rulers {\n    position: absolute;\n    left: 0;\n    right: 0;\n    top: -50px;\n    bottom: 0;\n    overflow: hidden;\n  }\n  .CodeMirror-ruler {\n    border-left: 1px solid #ccc;\n    top: 0;\n    bottom: 0;\n    position: absolute;\n  }\n\n  /* DEFAULT THEME */\n\n  .cm-s-default .cm-header {\n    color: blue;\n  }\n  .cm-s-default .cm-quote {\n    color: #090;\n  }\n  .cm-negative {\n    color: #d44;\n  }\n  .cm-positive {\n    color: #292;\n  }\n  .cm-header,\n  .cm-strong {\n    font-weight: bold;\n  }\n  .cm-em {\n    font-style: italic;\n  }\n  .cm-link {\n    text-decoration: underline;\n  }\n  .cm-strikethrough {\n    text-decoration: line-through;\n  }\n\n  .cm-s-default .cm-keyword {\n    color: #708;\n  }\n  .cm-s-default .cm-atom {\n    color: #219;\n  }\n  .cm-s-default .cm-number {\n    color: #164;\n  }\n  .cm-s-default .cm-def {\n    color: #00f;\n  }\n  .cm-s-default .cm-variable,\n  .cm-s-default .cm-punctuation,\n  .cm-s-default .cm-property,\n  .cm-s-default .cm-operator {\n  }\n  .cm-s-default .cm-variable-2 {\n    color: #05a;\n  }\n  .cm-s-default .cm-variable-3,\n  .cm-s-default .cm-type {\n    color: #085;\n  }\n  .cm-s-default .cm-comment {\n    color: #a50;\n  }\n  .cm-s-default .cm-string {\n    color: #a11;\n  }\n  .cm-s-default .cm-string-2 {\n    color: #f50;\n  }\n  .cm-s-default .cm-meta {\n    color: #555;\n  }\n  .cm-s-default .cm-qualifier {\n    color: #555;\n  }\n  .cm-s-default .cm-builtin {\n    color: #30a;\n  }\n  .cm-s-default .cm-bracket {\n    color: #997;\n  }\n  .cm-s-default .cm-tag {\n    color: #170;\n  }\n  .cm-s-default .cm-attribute {\n    color: #00c;\n  }\n  .cm-s-default .cm-hr {\n    color: #999;\n  }\n  .cm-s-default .cm-link {\n    color: #00c;\n  }\n\n  .cm-s-default .cm-error {\n    color: #f00;\n  }\n  .cm-invalidchar {\n    color: #f00;\n  }\n\n  .CodeMirror-composing {\n    border-bottom: 2px solid;\n  }\n\n  /* Default styles for common addons */\n\n  div.CodeMirror span.CodeMirror-matchingbracket {\n    color: #0b0;\n  }\n  div.CodeMirror span.CodeMirror-nonmatchingbracket {\n    color: #a22;\n  }\n  .CodeMirror-matchingtag {\n    background: rgba(255, 150, 0, 0.3);\n  }\n  .CodeMirror-activeline-background {\n    background: #e8f2ff;\n  }\n\n  /* STOP */\n\n  /* The rest of this file contains styles related to the mechanics of\n   the editor. You probably shouldn't touch them. */\n\n  .CodeMirror {\n    position: relative;\n    overflow: hidden;\n    background: white;\n  }\n\n  .CodeMirror-scroll {\n    overflow: scroll !important; /* Things will break if this is overridden */\n    /* 50px is the magic margin used to hide the element's real scrollbars */\n    /* See overflow: hidden in .CodeMirror */\n    margin-bottom: -50px;\n    margin-right: -50px;\n    padding-bottom: 50px;\n    height: auto !important;\n    outline: none; /* Prevent dragging from highlighting the element */\n    position: relative;\n  }\n  .CodeMirror-sizer {\n    position: relative;\n    border-right: 50px solid transparent;\n  }\n\n  /* The fake, visible scrollbars. Used to force redraw during scrolling\n   before actual scrolling happens, thus preventing shaking and\n   flickering artifacts. */\n  .CodeMirror-vscrollbar,\n  .CodeMirror-hscrollbar,\n  .CodeMirror-scrollbar-filler,\n  .CodeMirror-gutter-filler {\n    position: absolute;\n    z-index: 6;\n    display: none;\n  }\n  .CodeMirror-vscrollbar {\n    right: 0;\n    top: 0;\n    overflow-x: hidden;\n    overflow-y: scroll;\n  }\n  .CodeMirror-hscrollbar {\n    bottom: 0;\n    left: 0;\n    overflow-y: hidden;\n    overflow-x: scroll;\n  }\n  .CodeMirror-scrollbar-filler {\n    right: 0;\n    bottom: 0;\n  }\n  .CodeMirror-gutter-filler {\n    left: 0;\n    bottom: 0;\n  }\n\n  .CodeMirror-gutters {\n    position: absolute;\n    left: 0;\n    top: 0;\n    min-height: 100%;\n    z-index: 3;\n  }\n  .CodeMirror-gutter {\n    white-space: normal;\n    height: 100%;\n    display: inline-block;\n    vertical-align: top;\n    margin-bottom: -50px;\n  }\n  .CodeMirror-gutter-wrapper {\n    position: absolute;\n    z-index: 4;\n    background: none !important;\n    border: none !important;\n  }\n  .CodeMirror-gutter-background {\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    z-index: 4;\n  }\n  .CodeMirror-gutter-elt {\n    position: absolute;\n    cursor: default;\n    z-index: 4;\n  }\n  .CodeMirror-gutter-wrapper ::selection {\n    background-color: transparent;\n  }\n  .CodeMirror-gutter-wrapper ::-moz-selection {\n    background-color: transparent;\n  }\n\n  .CodeMirror-lines {\n    cursor: text;\n    min-height: 1px; /* prevents collapsing before first draw */\n  }\n  .CodeMirror pre.CodeMirror-line,\n  .CodeMirror pre.CodeMirror-line-like {\n    /* Reset some styles that the rest of the page might have set */\n    -moz-border-radius: 0;\n    -webkit-border-radius: 0;\n    border-radius: 0;\n    border-width: 0;\n    background: transparent;\n    font-family: inherit;\n    font-size: inherit;\n    margin: 0;\n    white-space: pre;\n    word-wrap: normal;\n    line-height: inherit;\n    color: inherit;\n    z-index: 2;\n    position: relative;\n    overflow: visible;\n    -webkit-tap-highlight-color: transparent;\n    -webkit-font-variant-ligatures: contextual;\n    font-variant-ligatures: contextual;\n  }\n  .CodeMirror-wrap pre.CodeMirror-line,\n  .CodeMirror-wrap pre.CodeMirror-line-like {\n    word-wrap: break-word;\n    white-space: pre-wrap;\n    word-break: normal;\n  }\n\n  .CodeMirror-linebackground {\n    position: absolute;\n    left: 0;\n    right: 0;\n    top: 0;\n    bottom: 0;\n    z-index: 0;\n  }\n\n  .CodeMirror-linewidget {\n    position: relative;\n    z-index: 2;\n    padding: 0.1px; /* Force widget margins to stay inside of the container */\n  }\n\n  .CodeMirror-widget {\n  }\n\n  .CodeMirror-rtl pre {\n    direction: rtl;\n  }\n\n  .CodeMirror-code {\n    outline: none;\n  }\n\n  /* Force content-box sizing for the elements where we expect it */\n  .CodeMirror-scroll,\n  .CodeMirror-sizer,\n  .CodeMirror-gutter,\n  .CodeMirror-gutters,\n  .CodeMirror-linenumber {\n    -moz-box-sizing: content-box;\n    box-sizing: content-box;\n  }\n\n  .CodeMirror-measure {\n    position: absolute;\n    width: 100%;\n    height: 0;\n    overflow: hidden;\n    visibility: hidden;\n  }\n\n  .CodeMirror-cursor {\n    position: absolute;\n    pointer-events: none;\n  }\n  .CodeMirror-measure pre {\n    position: static;\n  }\n\n  div.CodeMirror-cursors {\n    visibility: hidden;\n    position: relative;\n    z-index: 3;\n  }\n  div.CodeMirror-dragcursors {\n    visibility: visible;\n  }\n\n  .CodeMirror-focused div.CodeMirror-cursors {\n    visibility: visible;\n  }\n\n  .CodeMirror-selected {\n    background: #d9d9d9;\n  }\n  .CodeMirror-focused .CodeMirror-selected {\n    background: #d7d4f0;\n  }\n  .CodeMirror-crosshair {\n    cursor: crosshair;\n  }\n  .CodeMirror-line::selection,\n  .CodeMirror-line > span::selection,\n  .CodeMirror-line > span > span::selection {\n    background: #d7d4f0;\n  }\n  .CodeMirror-line::-moz-selection,\n  .CodeMirror-line > span::-moz-selection,\n  .CodeMirror-line > span > span::-moz-selection {\n    background: #d7d4f0;\n  }\n\n  .cm-searching {\n    background-color: #ffa;\n    background-color: rgba(255, 255, 0, 0.4);\n  }\n\n  /* Used to force a border model for a node */\n  .cm-force-border {\n    padding-right: 0.1px;\n  }\n\n  @media print {\n    /* Hide the cursor when printing */\n    .CodeMirror div.CodeMirror-cursors {\n      visibility: hidden;\n    }\n  }\n\n  /* See issue #2901 */\n  .cm-tab-wrap-hack:after {\n    content: '';\n  }\n\n  /* Help users use markselection to safely style text background */\n  span.CodeMirror-selectedtext {\n    background: none;\n  }\n`;\n","import CodeMirror from 'codemirror';\nimport { exitCode } from 'prosemirror-commands';\nimport { Node } from 'prosemirror-model';\nimport { Selection, TextSelection } from 'prosemirror-state';\nimport { EditorView } from 'prosemirror-view';\n\n// This is the one responsible for code highlighting\n// in codemirror editor\nrequire('codemirror/mode/javascript/javascript.js');\n\nexport class CodeBlockView {\n  cm: CodeMirror.Editor;\n  dom: HTMLElement;\n  updating: boolean;\n  incomingChanges = false;\n\n  constructor(\n    public node: Node,\n    public view: EditorView,\n    public getPos,\n    public enterPressed: Function\n  ) {\n    // Create a CodeMirror instance\n    this.cm = CodeMirror(null as any, {\n      value: this.node.textContent,\n      mode: 'javascript',\n      extraKeys: this.codeMirrorKeymap(),\n      lineNumbers: false,\n      theme: 'lesser-dark',\n    });\n\n    // The editor's outer node is our DOM representation\n    this.dom = this.cm.getWrapperElement();\n    // CodeMirror needs to be in the DOM to properly initialize, so\n    // schedule it to update itself\n    setTimeout(() => this.cm.refresh(), 20);\n\n    // This flag is used to avoid an update loop between the outer and\n    // inner editor\n    this.updating = false;\n    // Track whether changes are have been made but not yet propagated\n    this.cm.on('beforeChange', () => (this.incomingChanges = true));\n    // Propagate updates from the code editor to ProseMirror\n    this.cm.on('cursorActivity', () => {\n      if (!this.updating && !this.incomingChanges) this.forwardSelection();\n    });\n    this.cm.on('changes', () => {\n      if (!this.updating) {\n        this.valueChanged();\n        this.forwardSelection();\n      }\n      this.incomingChanges = false;\n    });\n    this.cm.on('focus', () => this.forwardSelection());\n  }\n\n  forwardSelection() {\n    if (!this.cm.hasFocus()) return;\n    let state = this.view.state;\n    let selection = this.asProseMirrorSelection(state.doc);\n    if (!selection.eq(state.selection))\n      this.view.dispatch(state.tr.setSelection(selection));\n  }\n\n  asProseMirrorSelection(doc) {\n    let offset = this.getPos() + 1;\n    let anchor = this.cm.indexFromPos(this.cm.getCursor('anchor')) + offset;\n    let head = this.cm.indexFromPos(this.cm.getCursor('head')) + offset;\n    return TextSelection.create(doc, anchor, head);\n  }\n\n  setSelection(anchor, head) {\n    this.cm.focus();\n    this.updating = true;\n    this.cm.setSelection(\n      this.cm.posFromIndex(anchor),\n      this.cm.posFromIndex(head)\n    );\n    this.updating = false;\n  }\n\n  valueChanged() {\n    let change = computeChange(this.node.textContent, this.cm.getValue());\n    if (change) {\n      let start = this.getPos() + 1;\n      let tr = this.view.state.tr.replaceWith(\n        start + change.from,\n        start + change.to,\n        change.text ? this.view.state.schema.text(change.text) : null\n      );\n      this.view.dispatch(tr);\n    }\n  }\n\n  codeMirrorKeymap() {\n    let view = this.view;\n    return CodeMirror.normalizeKeyMap({\n      Up: () => this.maybeEscape('line', -1),\n      Left: () => this.maybeEscape('char', -1),\n      Down: () => this.maybeEscape('line', 1),\n      Right: () => this.maybeEscape('char', 1),\n      'Ctrl-Enter': () => {\n        this.enterPressed();\n      },\n    });\n  }\n\n  maybeEscape(unit, dir) {\n    let pos = this.cm.getCursor();\n    if (\n      this.cm.somethingSelected() ||\n      pos.line != (dir < 0 ? this.cm.firstLine() : this.cm.lastLine()) ||\n      (unit == 'char' &&\n        pos.ch != (dir < 0 ? 0 : this.cm.getLine(pos.line).length))\n    )\n      return CodeMirror.Pass;\n    this.view.focus();\n    let targetPos = this.getPos() + (dir < 0 ? 0 : this.node.nodeSize);\n    let selection = Selection.near(this.view.state.doc.resolve(targetPos), dir);\n    this.view.dispatch(\n      this.view.state.tr.setSelection(selection).scrollIntoView()\n    );\n    this.view.focus();\n  }\n\n  update(node) {\n    if (node.type != this.node.type) return false;\n    this.node = node;\n    let change = computeChange(this.cm.getValue(), node.textContent);\n    if (change) {\n      this.updating = true;\n      this.cm.replaceRange(\n        change.text,\n        this.cm.posFromIndex(change.from),\n        this.cm.posFromIndex(change.to)\n      );\n      this.updating = false;\n    }\n    return true;\n  }\n\n  selectNode() {\n    this.cm.focus();\n  }\n  stopEvent() {\n    return true;\n  }\n}\n\nfunction computeChange(oldVal, newVal) {\n  if (oldVal == newVal) return null;\n  let start = 0,\n    oldEnd = oldVal.length,\n    newEnd = newVal.length;\n  while (start < oldEnd && oldVal.charCodeAt(start) == newVal.charCodeAt(start))\n    ++start;\n  while (\n    oldEnd > start &&\n    newEnd > start &&\n    oldVal.charCodeAt(oldEnd - 1) == newVal.charCodeAt(newEnd - 1)\n  ) {\n    oldEnd--;\n    newEnd--;\n  }\n  return { from: start, to: oldEnd, text: newVal.slice(start, newEnd) };\n}\n","import { html } from 'lit-element';\n\nexport const icons = {\n  bold: html`\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\n      <path fill=\"none\" d=\"M0 0h24v24H0V0z\" />\n      <path\n        d=\"M15.6 10.79c.97-.67 1.65-1.77 1.65-2.79 0-2.26-1.75-4-4-4H8c-.55 0-1 .45-1 1v12c0 .55.45 1 1 1h5.78c2.07 0 3.96-1.69 3.97-3.77.01-1.53-.85-2.84-2.15-3.44zM10 6.5h3c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5h-3v-3zm3.5 9H10v-3h3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5z\"\n      />\n    </svg>\n  `,\n  em: html`\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\n      <path fill=\"none\" d=\"M0 0h24v24H0V0z\" />\n      <path\n        d=\"M10 5.5c0 .83.67 1.5 1.5 1.5h.71l-3.42 8H7.5c-.83 0-1.5.67-1.5 1.5S6.67 18 7.5 18h5c.83 0 1.5-.67 1.5-1.5s-.67-1.5-1.5-1.5h-.71l3.42-8h1.29c.83 0 1.5-.67 1.5-1.5S17.33 4 16.5 4h-5c-.83 0-1.5.67-1.5 1.5z\"\n      />\n    </svg>\n  `,\n  link: html`\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\n      <path fill=\"none\" d=\"M0 0h24v24H0V0z\" />\n      <path\n        d=\"M3.96 11.38C4.24 9.91 5.62 8.9 7.12 8.9h2.93c.52 0 .95-.43.95-.95S10.57 7 10.05 7H7.22c-2.61 0-4.94 1.91-5.19 4.51C1.74 14.49 4.08 17 7 17h3.05c.52 0 .95-.43.95-.95s-.43-.95-.95-.95H7c-1.91 0-3.42-1.74-3.04-3.72zM9 13h6c.55 0 1-.45 1-1s-.45-1-1-1H9c-.55 0-1 .45-1 1s.45 1 1 1zm7.78-6h-2.83c-.52 0-.95.43-.95.95s.43.95.95.95h2.93c1.5 0 2.88 1.01 3.16 2.48.38 1.98-1.13 3.72-3.04 3.72h-3.05c-.52 0-.95.43-.95.95s.43.95.95.95H17c2.92 0 5.26-2.51 4.98-5.49-.25-2.6-2.59-4.51-5.2-4.51z\"\n      />\n    </svg>\n  `,\n  check: html`\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\n      <path fill=\"none\" d=\"M0 0h24v24H0V0z\" />\n      <path\n        d=\"M9 16.2l-3.5-3.5c-.39-.39-1.01-.39-1.4 0-.39.39-.39 1.01 0 1.4l4.19 4.19c.39.39 1.02.39 1.41 0L20.3 7.7c.39-.39.39-1.01 0-1.4-.39-.39-1.01-.39-1.4 0L9 16.2z\"\n      />\n    </svg>\n  `,\n  cross: html`\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\n      <path fill=\"none\" d=\"M0 0h24v24H0V0z\" />\n      <path\n        d=\"M18.3 5.71c-.39-.39-1.02-.39-1.41 0L12 10.59 7.11 5.7c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41L10.59 12 5.7 16.89c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0L12 13.41l4.89 4.89c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4z\"\n      />\n    </svg>\n  `,\n  arrow_left: html`\n    <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 0 24 24\" width=\"24\">\n      <path d=\"M14 7l-5 5 5 5V7z\" />\n      <path d=\"M24 0v24H0V0h24z\" fill=\"none\" />\n    </svg>\n  `,\n  arrow_right: html`\n    <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 0 24 24\" width=\"24\">\n      <path d=\"M10 17l5-5-5-5v10z\" />\n      <path d=\"M0 24V0h24v24H0z\" fill=\"none\" />\n    </svg>\n  `,\n  arrow_drop_down: html`\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      viewBox=\"0 0 24 24\"\n      fill=\"black\"\n      width=\"18px\"\n      height=\"18px\"\n    >\n      <path d=\"M0 0h24v24H0z\" fill=\"none\" />\n      <path d=\"M7 10l5 5 5-5z\" />\n    </svg>\n  `,\n  arrow_back: html`\n    <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 0 24 24\" width=\"24\">\n      <path d=\"M0 0h24v24H0z\" fill=\"none\" />\n      <path d=\"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z\" />\n    </svg>\n  `,\n  add: html`\n    <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 0 24 24\" width=\"24\">\n      <path d=\"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z\" />\n      <path d=\"M0 0h24v24H0z\" fill=\"none\" />\n    </svg>\n  `,\n  add_box: html`\n    <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 0 24 24\" width=\"24\">\n      <path\n        d=\"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10h-4v4h-2v-4H7v-2h4V7h2v4h4v2z\"\n      />\n      <path d=\"M0 0h24v24H0z\" fill=\"none\" />\n    </svg>\n  `,\n  edit: html`\n    <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 0 24 24\" width=\"24\">\n      <path\n        d=\"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z\"\n      />\n      <path d=\"M0 0h24v24H0z\" fill=\"none\" />\n    </svg>\n  `,\n  image: html`\n    <svg style=\"width:24px;height:24px\" viewBox=\"0 0 24 24\">\n      <path\n        fill=\"currentColor\"\n        d=\"M19,19H5V5H19M19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M16.5,16.25C16.5,14.75 13.5,14 12,14C10.5,14 7.5,14.75 7.5,16.25V17H16.5M12,12.25A2.25,2.25 0 0,0 14.25,10A2.25,2.25 0 0,0 12,7.75A2.25,2.25 0 0,0 9.75,10A2.25,2.25 0 0,0 12,12.25Z\"\n      />\n    </svg>\n  `,\n  youtube: html`\n    <svg style=\"width:24px;height:24px\" viewBox=\"0 0 24 24\">\n      <path\n        fill=\"currentColor\"\n        d=\"M10,15L15.19,12L10,9V15M21.56,7.17C21.69,7.64 21.78,8.27 21.84,9.07C21.91,9.87 21.94,10.56 21.94,11.16L22,12C22,14.19 21.84,15.8 21.56,16.83C21.31,17.73 20.73,18.31 19.83,18.56C19.36,18.69 18.5,18.78 17.18,18.84C15.88,18.91 14.69,18.94 13.59,18.94L12,19C7.81,19 5.2,18.84 4.17,18.56C3.27,18.31 2.69,17.73 2.44,16.83C2.31,16.36 2.22,15.73 2.16,14.93C2.09,14.13 2.06,13.44 2.06,12.84L2,12C2,9.81 2.16,8.2 2.44,7.17C2.69,6.27 3.27,5.69 4.17,5.44C4.64,5.31 5.5,5.22 6.82,5.16C8.12,5.09 9.31,5.06 10.41,5.06L12,5C16.19,5 18.8,5.16 19.83,5.44C20.73,5.69 21.31,6.27 21.56,7.17Z\"\n      />\n    </svg>\n  `,\n  code: html`\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18px\" viewBox=\"0 0 24 24\" height=\"18px\">\n      <path d=\"M0 0h24v24H0V0z\" fill=\"none\" />\n      <path\n        d=\"M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z\"\n      />\n    </svg>\n  `\n};\n","import { css } from 'lit-element';\n\nexport const iconsStyle = css`\n  clr-icon {\n    display: inline-block;\n    margin: 0;\n    height: 16px;\n    width: 16px;\n    vertical-align: middle;\n    fill: currentColor;\n  }\n  clr-icon .transparent-fill-stroke {\n    stroke: currentColor;\n  }\n  clr-icon.is-green,\n  clr-icon.is-success {\n    fill: #318700;\n  }\n  clr-icon.is-green .transparent-fill-stroke,\n  clr-icon.is-success .transparent-fill-stroke {\n    stroke: #318700;\n  }\n  clr-icon.is-danger,\n  clr-icon.is-error,\n  clr-icon.is-red {\n    fill: #e62700;\n  }\n  clr-icon.is-danger .transparent-fill-stroke,\n  clr-icon.is-error .transparent-fill-stroke,\n  clr-icon.is-red .transparent-fill-stroke {\n    stroke: #e62700;\n  }\n  clr-icon.is-warning {\n    fill: #fac400;\n  }\n  clr-icon.is-warning .transparent-fill-stroke {\n    stroke: #fac400;\n  }\n  clr-icon.is-blue,\n  clr-icon.is-info {\n    fill: #007cbb;\n  }\n  clr-icon.is-blue .transparent-fill-stroke,\n  clr-icon.is-info .transparent-fill-stroke {\n    stroke: #007cbb;\n  }\n  clr-icon.is-inverse,\n  clr-icon.is-white {\n    fill: #fff;\n  }\n  clr-icon.is-inverse .transparent-fill-stroke,\n  clr-icon.is-white .transparent-fill-stroke {\n    stroke: #fff;\n  }\n  clr-icon.is-highlight {\n    fill: #007cbb;\n  }\n  clr-icon.is-highlight .transparent-fill-stroke {\n    stroke: #007cbb;\n  }\n  clr-icon[dir='up'] svg,\n  clr-icon[shape$=' up'] svg {\n    transform: rotate(0deg);\n  }\n  clr-icon[dir='down'] svg,\n  clr-icon[shape$=' down'] svg {\n    transform: rotate(180deg);\n  }\n  clr-icon[dir='right'] svg,\n  clr-icon[shape$=' right'] svg {\n    transform: rotate(90deg);\n  }\n  clr-icon[dir='left'] svg,\n  clr-icon[shape$=' left'] svg {\n    transform: rotate(270deg);\n  }\n  clr-icon[flip='horizontal'] svg {\n    transform: scale(-1) rotateX(180deg);\n  }\n  clr-icon[flip='vertical'] svg {\n    transform: scale(-1) rotateY(180deg);\n  }\n  clr-icon .clr-i-badge {\n    fill: #e62700;\n  }\n  clr-icon .clr-i-badge .transparent-fill-stroke {\n    stroke: #e62700;\n  }\n  clr-icon > * {\n    height: 100%;\n    width: 100%;\n    display: block;\n    pointer-events: none;\n  }\n  clr-icon > svg {\n    transition: inherit;\n  }\n  clr-icon .clr-i-outline--alerted:not(.clr-i-outline),\n  clr-icon .clr-i-outline--badged:not(.clr-i-outline),\n  clr-icon .clr-i-solid,\n  clr-icon .clr-i-solid--alerted,\n  clr-icon .clr-i-solid--badged,\n  clr-icon > svg title {\n    display: none;\n  }\n  clr-icon[class*='has-alert'] .can-alert .clr-i-outline--alerted {\n    display: block;\n  }\n  clr-icon[class*='has-alert'] .can-alert .clr-i-outline:not(.clr-i-outline--alerted) {\n    display: none;\n  }\n  clr-icon[class*='has-badge'] .can-badge .clr-i-outline--badged {\n    display: block;\n  }\n  clr-icon[class*='has-badge'] .can-badge .clr-i-outline:not(.clr-i-outline--badged) {\n    display: none;\n  }\n  clr-icon.is-solid .has-solid .clr-i-solid {\n    display: block;\n  }\n  clr-icon.is-solid .has-solid .clr-i-outline,\n  clr-icon.is-solid .has-solid .clr-i-outline--badged,\n  clr-icon.is-solid .has-solid .clr-i-solid--alerted:not(.clr-i-solid),\n  clr-icon.is-solid .has-solid .clr-i-solid--badged:not(.clr-i-solid) {\n    display: none;\n  }\n  clr-icon.is-solid[class*='has-badge'] .can-badge.has-solid .clr-i-solid--badged {\n    display: block;\n  }\n  clr-icon.is-solid[class*='has-badge'] .can-badge.has-solid .clr-i-outline,\n  clr-icon.is-solid[class*='has-badge'] .can-badge.has-solid .clr-i-outline--badged,\n  clr-icon.is-solid[class*='has-badge']\n    .can-badge.has-solid\n    .clr-i-solid:not(.clr-i-solid--badged) {\n    display: none;\n  }\n  clr-icon.is-solid[class*='has-alert'] .can-alert.has-solid .clr-i-solid--alerted {\n    display: block;\n  }\n  clr-icon.is-solid[class*='has-alert'] .can-alert.has-solid .clr-i-outline,\n  clr-icon.is-solid[class*='has-alert'] .can-alert.has-solid .clr-i-outline--alerted,\n  clr-icon.is-solid[class*='has-alert']\n    .can-alert.has-solid\n    .clr-i-solid:not(.clr-i-solid--alerted) {\n    display: none;\n  }\n  clr-icon.has-badge--success .clr-i-badge {\n    fill: #318700;\n  }\n  clr-icon.has-badge--success .clr-i-badge .transparent-fill-stroke {\n    stroke: #318700;\n  }\n  clr-icon.has-badge--error .clr-i-badge {\n    fill: #e62700;\n  }\n  clr-icon.has-badge--error .clr-i-badge .transparent-fill-stroke {\n    stroke: #e62700;\n  }\n  clr-icon.has-badge--info .clr-i-badge {\n    fill: #007cbb;\n  }\n  clr-icon.has-badge--info .clr-i-badge .transparent-fill-stroke {\n    stroke: #007cbb;\n  }\n  clr-icon.has-alert .clr-i-alert {\n    fill: #fac400;\n  }\n  clr-icon.has-alert .clr-i-alert .transparent-fill-stroke {\n    stroke: #fac400;\n  }\n  clr-icon .is-off-screen {\n    position: fixed !important;\n    border: none !important;\n    height: 1px !important;\n    width: 1px !important;\n    left: 0 !important;\n    top: -1px !important;\n    overflow: hidden !important;\n    padding: 0 !important;\n    margin: 0 0 -1px 0 !important;\n  }\n`;\n","import { css } from 'lit-element';\n\nexport const styles = css`\n  .ProseMirror {\n    position: relative;\n  }\n\n  .ProseMirror {\n    word-wrap: break-word;\n    white-space: pre-wrap;\n    -webkit-font-variant-ligatures: none;\n    font-variant-ligatures: none;\n  }\n\n  .ProseMirror pre {\n    white-space: pre-wrap;\n  }\n\n  .ProseMirror li {\n    position: relative;\n  }\n\n  .ProseMirror-hideselection *::selection {\n    background: transparent;\n  }\n  .ProseMirror-hideselection *::-moz-selection {\n    background: transparent;\n  }\n  .ProseMirror-hideselection {\n    caret-color: transparent;\n  }\n\n  .ProseMirror-selectednode {\n    outline: 2px solid #8cf;\n  }\n\n  /* Make sure li selections wrap around markers */\n\n  li.ProseMirror-selectednode {\n    outline: none;\n  }\n\n  li.ProseMirror-selectednode:after {\n    content: '';\n    position: absolute;\n    left: -32px;\n    right: -2px;\n    top: -2px;\n    bottom: -2px;\n    border: 2px solid #8cf;\n    pointer-events: none;\n  }\n  .ProseMirror-textblock-dropdown {\n    min-width: 3em;\n  }\n\n  .ProseMirror-menu {\n    margin: 0 -4px;\n    line-height: 1;\n  }\n\n  .ProseMirror-tooltip .ProseMirror-menu {\n    width: -webkit-fit-content;\n    width: fit-content;\n    white-space: pre;\n  }\n\n  .ProseMirror-menuitem {\n    margin-right: 3px;\n    display: inline-block;\n  }\n\n  .ProseMirror-menuseparator {\n    border-right: 1px solid #ddd;\n    margin-right: 3px;\n  }\n\n  .ProseMirror-menu-dropdown,\n  .ProseMirror-menu-dropdown-menu {\n    font-size: 90%;\n    white-space: nowrap;\n  }\n\n  .ProseMirror-menu-dropdown {\n    vertical-align: 1px;\n    cursor: pointer;\n    position: relative;\n    padding-right: 15px;\n  }\n\n  .ProseMirror-menu-dropdown-wrap {\n    padding: 1px 0 1px 4px;\n    display: inline-block;\n    position: relative;\n  }\n\n  .ProseMirror-menu-dropdown:after {\n    content: '';\n    border-left: 4px solid transparent;\n    border-right: 4px solid transparent;\n    border-top: 4px solid currentColor;\n    opacity: 0.6;\n    position: absolute;\n    right: 4px;\n    top: calc(50% - 2px);\n  }\n\n  .ProseMirror-menu-dropdown-menu,\n  .ProseMirror-menu-submenu {\n    position: absolute;\n    background: white;\n    color: #666;\n    border: 1px solid #aaa;\n    padding: 2px;\n  }\n\n  .ProseMirror-menu-dropdown-menu {\n    z-index: 15;\n    min-width: 6em;\n  }\n\n  .ProseMirror-menu-dropdown-item {\n    cursor: pointer;\n    padding: 2px 8px 2px 4px;\n  }\n\n  .ProseMirror-menu-dropdown-item:hover {\n    background: #f2f2f2;\n  }\n\n  .ProseMirror-menu-submenu-wrap {\n    position: relative;\n    margin-right: -4px;\n  }\n\n  .ProseMirror-menu-submenu-label:after {\n    content: '';\n    border-top: 4px solid transparent;\n    border-bottom: 4px solid transparent;\n    border-left: 4px solid currentColor;\n    opacity: 0.6;\n    position: absolute;\n    right: 4px;\n    top: calc(50% - 4px);\n  }\n\n  .ProseMirror-menu-submenu {\n    display: none;\n    min-width: 4em;\n    left: 100%;\n    top: -3px;\n  }\n\n  .ProseMirror-menu-active {\n    background: #eee;\n    border-radius: 4px;\n  }\n\n  .ProseMirror-menu-active {\n    background: #eee;\n    border-radius: 4px;\n  }\n\n  .ProseMirror-menu-disabled {\n    opacity: 0.3;\n  }\n\n  .ProseMirror-menu-submenu-wrap:hover .ProseMirror-menu-submenu,\n  .ProseMirror-menu-submenu-wrap-active .ProseMirror-menu-submenu {\n    display: block;\n  }\n\n  .ProseMirror-menubar {\n    border-top-left-radius: inherit;\n    border-top-right-radius: inherit;\n    position: relative;\n    min-height: 1em;\n    color: #666;\n    padding: 1px 6px;\n    top: 0;\n    left: 0;\n    right: 0;\n    border-bottom: 1px solid silver;\n    background: white;\n    z-index: 10;\n    -moz-box-sizing: border-box;\n    box-sizing: border-box;\n    overflow: visible;\n  }\n\n  .ProseMirror-icon {\n    display: inline-block;\n    line-height: 0.8;\n    vertical-align: -2px; /* Compensate for padding */\n    padding: 2px 8px;\n    cursor: pointer;\n  }\n\n  .ProseMirror-menu-disabled.ProseMirror-icon {\n    cursor: default;\n  }\n\n  .ProseMirror-icon svg {\n    fill: currentColor;\n    height: 1em;\n  }\n\n  .ProseMirror-icon span {\n    vertical-align: text-top;\n  }\n  .ProseMirror-gapcursor {\n    display: none;\n    pointer-events: none;\n    position: absolute;\n  }\n\n  .ProseMirror-gapcursor:after {\n    content: '';\n    display: block;\n    position: absolute;\n    top: -2px;\n    width: 20px;\n    border-top: 1px solid black;\n    animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;\n  }\n\n  @keyframes ProseMirror-cursor-blink {\n    to {\n      visibility: hidden;\n    }\n  }\n\n  .ProseMirror-focused .ProseMirror-gapcursor {\n    display: block;\n  }\n  /* Add space around the hr to make clicking it easier */\n\n  .ProseMirror-example-setup-style hr {\n    padding: 2px 10px;\n    border: none;\n    margin: 1em 0;\n  }\n\n  .ProseMirror-example-setup-style hr:after {\n    content: '';\n    display: block;\n    height: 1px;\n    background-color: silver;\n    line-height: 2px;\n  }\n\n  .ProseMirror ul,\n  .ProseMirror ol {\n    padding-left: 30px;\n  }\n\n  .ProseMirror blockquote {\n    padding-left: 1em;\n    border-left: 3px solid #eee;\n    margin-left: 0;\n    margin-right: 0;\n  }\n\n  .ProseMirror-example-setup-style img {\n    cursor: default;\n  }\n\n  .ProseMirror-prompt {\n    background: white;\n    padding: 5px 10px 5px 15px;\n    border: 1px solid silver;\n    position: fixed;\n    border-radius: 3px;\n    z-index: 11;\n    box-shadow: -0.5px 2px 5px rgba(0, 0, 0, 0.2);\n  }\n\n  .ProseMirror-prompt h5 {\n    margin: 0;\n    font-weight: normal;\n    font-size: 100%;\n    color: #444;\n  }\n\n  .ProseMirror-prompt input[type='text'],\n  .ProseMirror-prompt textarea {\n    background: #eee;\n    border: none;\n    outline: none;\n  }\n\n  .ProseMirror-prompt input[type='text'] {\n    padding: 0 4px;\n  }\n\n  .ProseMirror-prompt-close {\n    position: absolute;\n    left: 2px;\n    top: 1px;\n    color: #666;\n    border: none;\n    background: transparent;\n    padding: 0;\n  }\n\n  .ProseMirror-prompt-close:after {\n    content: 'âœ•';\n    font-size: 12px;\n  }\n\n  .ProseMirror-invalid {\n    background: #ffc;\n    border: 1px solid #cc7;\n    border-radius: 4px;\n    padding: 5px 10px;\n    position: absolute;\n    min-width: 10em;\n  }\n\n  .ProseMirror-prompt-buttons {\n    margin-top: 5px;\n    display: none;\n  }\n  #editor,\n  .editor {\n    background: white;\n    color: black;\n    background-clip: padding-box;\n    border-radius: 4px;\n    border: 2px solid rgba(0, 0, 0, 0.2);\n    padding: 5px 0;\n    margin-bottom: 23px;\n  }\n\n  .ProseMirror h1:first-child,\n  .ProseMirror h2:first-child,\n  .ProseMirror h3:first-child,\n  .ProseMirror h4:first-child,\n  .ProseMirror h5:first-child,\n  .ProseMirror h6:first-child {\n    margin-top: 10px;\n    margin-bottom: 10px;\n  }\n\n  .ProseMirror {\n    padding: 4px 8px 4px 14px;\n    line-height: 1.2;\n    outline: none;\n  }\n\n  .ProseMirror p {\n    margin: 0px;\n  }\n`;\n","import { css } from 'lit-element';\n\nexport const styles = css`\n  /*\nhttp://lesscss.org/ dark theme\nPorted to CodeMirror by Peter Kroon\n*/\n  .cm-s-lesser-dark {\n    line-height: 1.3em;\n  }\n  .cm-s-lesser-dark.CodeMirror {\n    background: #262626;\n    color: #ebefe7;\n    text-shadow: 0 -1px 1px #262626;\n  }\n  .cm-s-lesser-dark div.CodeMirror-selected {\n    background: #45443b;\n  } /* 33322B*/\n  .cm-s-lesser-dark .CodeMirror-line::selection,\n  .cm-s-lesser-dark .CodeMirror-line > span::selection,\n  .cm-s-lesser-dark .CodeMirror-line > span > span::selection {\n    background: rgba(69, 68, 59, 0.99);\n  }\n  .cm-s-lesser-dark .CodeMirror-line::-moz-selection,\n  .cm-s-lesser-dark .CodeMirror-line > span::-moz-selection,\n  .cm-s-lesser-dark .CodeMirror-line > span > span::-moz-selection {\n    background: rgba(69, 68, 59, 0.99);\n  }\n  .cm-s-lesser-dark .CodeMirror-cursor {\n    border-left: 1px solid white;\n  }\n  .cm-s-lesser-dark pre {\n    padding: 0 8px;\n  } /*editable code holder*/\n\n  .cm-s-lesser-dark.CodeMirror span.CodeMirror-matchingbracket {\n    color: #7efc7e;\n  } /*65FC65*/\n\n  .cm-s-lesser-dark .CodeMirror-gutters {\n    background: #262626;\n    border-right: 1px solid #aaa;\n  }\n  .cm-s-lesser-dark .CodeMirror-guttermarker {\n    color: #599eff;\n  }\n  .cm-s-lesser-dark .CodeMirror-guttermarker-subtle {\n    color: #777;\n  }\n  .cm-s-lesser-dark .CodeMirror-linenumber {\n    color: #777;\n  }\n\n  .cm-s-lesser-dark span.cm-header {\n    color: #a0a;\n  }\n  .cm-s-lesser-dark span.cm-quote {\n    color: #090;\n  }\n  .cm-s-lesser-dark span.cm-keyword {\n    color: #599eff;\n  }\n  .cm-s-lesser-dark span.cm-atom {\n    color: #c2b470;\n  }\n  .cm-s-lesser-dark span.cm-number {\n    color: #b35e4d;\n  }\n  .cm-s-lesser-dark span.cm-def {\n    color: white;\n  }\n  .cm-s-lesser-dark span.cm-variable {\n    color: #d9bf8c;\n  }\n  .cm-s-lesser-dark span.cm-variable-2 {\n    color: #669199;\n  }\n  .cm-s-lesser-dark span.cm-variable-3,\n  .cm-s-lesser-dark span.cm-type {\n    color: white;\n  }\n  .cm-s-lesser-dark span.cm-property {\n    color: #92a75c;\n  }\n  .cm-s-lesser-dark span.cm-operator {\n    color: #92a75c;\n  }\n  .cm-s-lesser-dark span.cm-comment {\n    color: #666;\n  }\n  .cm-s-lesser-dark span.cm-string {\n    color: #bcd279;\n  }\n  .cm-s-lesser-dark span.cm-string-2 {\n    color: #f50;\n  }\n  .cm-s-lesser-dark span.cm-meta {\n    color: #738c73;\n  }\n  .cm-s-lesser-dark span.cm-qualifier {\n    color: #555;\n  }\n  .cm-s-lesser-dark span.cm-builtin {\n    color: #ff9e59;\n  }\n  .cm-s-lesser-dark span.cm-bracket {\n    color: #ebefe7;\n  }\n  .cm-s-lesser-dark span.cm-tag {\n    color: #669199;\n  }\n  .cm-s-lesser-dark span.cm-attribute {\n    color: #81a4d5;\n  }\n  .cm-s-lesser-dark span.cm-hr {\n    color: #999;\n  }\n  .cm-s-lesser-dark span.cm-link {\n    color: #7070e6;\n  }\n  .cm-s-lesser-dark span.cm-error {\n    color: #9d1e15;\n  }\n\n  .cm-s-lesser-dark .CodeMirror-activeline-background {\n    background: #3c3a3a;\n  }\n  .cm-s-lesser-dark .CodeMirror-matchingbracket {\n    outline: 1px solid grey;\n    color: white !important;\n  }\n`;\n","import { Schema } from 'prosemirror-model';\n\nconst pDOM = ['p', 0],\n  blockquoteDOM = ['blockquote', 0],\n  hrDOM = ['hr'],\n  preDOM = ['pre', ['code', 0]],\n  brDOM = ['br'];\n\n// :: Object\n// [Specs](#model.NodeSpec) for the nodes defined in this schema.\nexport const nodes = {\n  // :: NodeSpec The top level document node.\n  doc: {\n    content: 'block+'\n  },\n\n  // :: NodeSpec A plain paragraph textblock. Represented in the DOM\n  // as a `<p>` element.\n  paragraph: {\n    content: 'inline*',\n    group: 'block',\n    attrs: {\n      style: {\n        default: ''\n      }\n    },\n    toDOM(node) {\n      return ['p', { style: node.attrs.style }, 0];\n    },\n    parseDOM: [\n      {\n        tag: 'p',\n        getAttrs: node => {\n          return {\n            textAlign: node.attributes ? node.attributes.style : node.attrs.style\n          };\n        }\n      }\n    ]\n  },\n\n  // :: NodeSpec A horizontal rule (`<hr>`).\n  horizontal_rule: {\n    group: 'block',\n    parseDOM: [{ tag: 'hr' }],\n    toDOM() {\n      return hrDOM;\n    }\n  },\n\n  // :: NodeSpec A code listing. Disallows marks or non-text inline\n  // nodes by default. Represented as a `<pre>` element with a\n  // `<code>` element inside of it.\n  code_block: {\n    content: 'text*',\n    marks: '',\n    group: 'block',\n    code: true,\n    defining: true,\n    parseDOM: [{ tag: 'pre', preserveWhitespace: 'full' }],\n    toDOM: function toDOM() {\n      return ['pre', ['code', 0]];\n    }\n  },\n\n  // :: NodeSpec The text node.\n  text: {\n    group: 'inline'\n  },\n\n  // :: NodeSpec An inline image (`<img>`) node. Supports `src`,\n  // `alt`, `style`, and `href` attributes. The latter two default to the empty\n  // string.\n  image: {\n    inline: true,\n    attrs: {\n      src: {},\n      alt: { default: null },\n      title: { default: null },\n      style: {}\n    },\n    group: 'inline',\n    draggable: true,\n    parseDOM: [\n      {\n        tag: 'img',\n        getAttrs(dom) {\n          return {\n            src: dom.getAttribute('src'),\n            title: dom.getAttribute('title'),\n            alt: dom.getAttribute('alt'),\n            style: dom.getAttribute('style')\n          };\n        }\n      }\n    ],\n    toDOM(node) {\n      let { src, alt, title, style } = node.attrs;\n      return ['img', { src, alt, title, style }];\n    }\n  },\n\n  // :: NodeSpec An inline image (`<iframe>`) node. Supports `src`,\n  //  and `style` attributes.\n  iframe: {\n    inline: true,\n    attrs: {\n      src: {},\n      style: {}\n    },\n    group: 'inline',\n    parseDOM: [\n      {\n        tag: 'iframe',\n        getAttrs(dom) {\n          return {\n            src: dom.getAttribute('src'),\n            style: dom.getAttribute('style')\n          };\n        }\n      }\n    ],\n    toDOM(node) {\n      let { src, style } = node.attrs;\n      return ['iframe', { src, style, class: 'yt-embed' }];\n    }\n  },\n\n  // :: NodeSpec A hard line break, represented in the DOM as `<br>`.\n  hard_break: {\n    inline: true,\n    group: 'inline',\n    selectable: false,\n    parseDOM: [{ tag: 'br' }],\n    toDOM() {\n      return brDOM;\n    }\n  }\n};\n\nconst emDOM = ['em', 0],\n  strongDOM = ['strong', 0],\n  codeDOM = ['code', 0];\n\n// :: Object [Specs](#model.MarkSpec) for the marks in the schema.\nexport const marks = {\n  // :: MarkSpec A link. Has `href` and `title` attributes. `title`\n  // defaults to the empty string. Rendered and parsed as an `<a>`\n  // element.\n  link: {\n    attrs: {\n      href: {},\n      title: { default: null }\n    },\n    inclusive: false,\n    parseDOM: [\n      {\n        tag: 'a[href]',\n        getAttrs(dom) {\n          return { href: dom.getAttribute('href'), title: dom.getAttribute('title') };\n        }\n      }\n    ],\n    toDOM(node) {\n      let { href, title } = node.attrs;\n      return ['a', { href, title }, 0];\n    }\n  },\n\n  // :: MarkSpec An emphasis mark. Rendered as an `<em>` element.\n  // Has parse rules that also match `<i>` and `font-style: italic`.\n  em: {\n    parseDOM: [{ tag: 'i' }, { tag: 'em' }, { style: 'font-style=italic' }],\n    toDOM() {\n      return emDOM;\n    }\n  },\n\n  // :: MarkSpec A strong mark. Rendered as `<strong>`, parse rules\n  // also match `<b>` and `font-weight: bold`.\n  strong: {\n    parseDOM: [\n      { tag: 'strong' },\n      // This works around a Google Docs misbehavior where\n      // pasted content will be inexplicably wrapped in `<b>`\n      // tags with a font-weight normal.\n      { tag: 'b', getAttrs: node => node.style.fontWeight != 'normal' && null },\n      {\n        style: 'font-weight',\n        getAttrs: value => /^(bold(er)?|[5-9]\\d{2,})$/.test(value) && null\n      }\n    ],\n    toDOM() {\n      return strongDOM;\n    }\n  },\n\n  // :: MarkSpec Code font mark. Represented as a `<code>` element.\n  code: {\n    parseDOM: [{ tag: 'code', node: 'code_block', preserveWhitespace: 'full' }],\n    toDOM() {\n      return codeDOM;\n    }\n  }\n};\n\n// :: Schema\n// This schema roughly corresponds to the document schema used by\n// [CommonMark](http://commonmark.org/), minus the list elements,\n// which are defined in the [`prosemirror-schema-list`](#schema-list)\n// module.\n//\n// To reuse elements from this schema, extend or read from its\n// `spec.nodes` and `spec.marks` [properties](#model.Schema.spec).\nexport const blockSchema = new Schema({ nodes: nodes as any, marks: marks as any });\n","import { Schema } from 'prosemirror-model';\n\n// :: Object\n// [Specs](#model.NodeSpec) for the nodes defined in this schema.\nexport const nodes = {\n  // :: NodeSpec The top level document node.\n  doc: {\n    content: 'heading+',\n  },\n\n  // :: NodeSpec A heading textblock, with a `level` attribute that\n  // should hold the number 1 to 6. Parsed and serialized as `<h1>` to\n  // `<h6>` elements.\n  heading: {\n    attrs: { level: { default: 1 } },\n    content: 'inline*',\n    group: 'block',\n    defining: true,\n    parseDOM: [\n      { tag: 'h1', attrs: { level: 1 } },\n      { tag: 'h2', attrs: { level: 2 } },\n      { tag: 'h3', attrs: { level: 3 } },\n      { tag: 'h4', attrs: { level: 4 } },\n      { tag: 'h5', attrs: { level: 5 } },\n      { tag: 'h6', attrs: { level: 6 } },\n    ],\n    toDOM(node) {\n      return ['h' + node.attrs.level, 0];\n    },\n  },\n\n  // :: NodeSpec The text node.\n  text: {\n    group: 'inline',\n  },\n};\n\nconst emDOM = ['em', 0];\n\n// :: Object [Specs](#model.MarkSpec) for the marks in the schema.\nexport const marks = {\n  // :: MarkSpec A link. Has `href` and `title` attributes. `title`\n  // defaults to the empty string. Rendered and parsed as an `<a>`\n  // element.\n  link: {\n    attrs: {\n      href: {},\n      title: { default: null },\n    },\n    inclusive: false,\n    parseDOM: [\n      {\n        tag: 'a[href]',\n        getAttrs(dom) {\n          return { href: dom.getAttribute('href'), title: dom.getAttribute('title') };\n        },\n      },\n    ],\n    toDOM(node) {\n      let { href, title } = node.attrs;\n      return ['a', { href, title }, 0];\n    },\n  },\n\n  // :: MarkSpec An emphasis mark. Rendered as an `<em>` element.\n  // Has parse rules that also match `<i>` and `font-style: italic`.\n  em: {\n    parseDOM: [{ tag: 'i' }, { tag: 'em' }, { style: 'font-style=italic' }],\n    toDOM() {\n      return emDOM;\n    },\n  },\n};\n\n// :: Schema\n// This schema roughly corresponds to the document schema used by\n// [CommonMark](http://commonmark.org/), minus the list elements,\n// which are defined in the [`prosemirror-schema-list`](#schema-list)\n// module.\n//\n// To reuse elements from this schema, extend or read from its\n// `spec.nodes` and `spec.marks` [properties](#model.Schema.spec).\nexport const titleSchema = new Schema({ nodes: nodes as any, marks: marks as any });\n","import { Logger } from '@uprtcl/micro-orchestrator';\nimport { css, html, LitElement, property } from 'lit-element';\nimport { toggleMark } from 'prosemirror-commands';\nimport { DOMParser, DOMSerializer } from 'prosemirror-model';\nimport { EditorState, TextSelection } from 'prosemirror-state';\nimport { EditorView } from 'prosemirror-view';\nimport { TextType } from '../../types';\nimport { styles as cmStyle } from './codemirror.css';\nimport { CodeBlockView } from './codeview';\nimport { icons } from './icons';\nimport { iconsStyle } from './icons.css';\nimport { styles } from './prosemirror.css';\nimport { styles as theme } from './lesser-dark.css';\nimport { blockSchema } from './schema-block';\nimport { titleSchema } from './schema-title';\nimport { setBlockType } from 'prosemirror-commands';\n\nexport const APPEND_ACTION = 'append';\nexport const FOCUS_ACTION = 'focus';\n\nconst LOGINFO = false;\n\nenum ActiveSubMenu {\n  LINK = 'link',\n  IMAGE = 'image',\n  VIDEO = 'video'\n}\n\nexport class DocumentTextNodeEditor extends LitElement {\n  logger = new Logger('DOCUMENT-TEXT-NODE-EDITOR');\n\n  @property({ type: String })\n  type!: TextType;\n\n  @property({ type: String })\n  init!: string;\n\n  @property({ type: String, attribute: 'to-append' })\n  toAppend!: string;\n\n  @property({ type: String })\n  editable: string = 'true';\n\n  @property({ type: String, attribute: 'toggle-action' })\n  toggleAction: string = 'true';\n\n  @property({ type: Object })\n  action: any = {};\n\n  @property({ type: String, attribute: 'focus-init' })\n  focusInit: string = 'false';\n\n  @property({ type: Number })\n  level: number = 0;\n\n  @property({ attribute: false })\n  selected: Boolean = false;\n\n  @property({ attribute: false })\n  empty: Boolean = false;\n\n  @property({ attribute: false })\n  showMenu: Boolean = false;\n\n  @property({ attribute: false })\n  showUrlMenu: Boolean = false;\n\n  @property({  attribute: false })\n  showDimMenu: Boolean = false;\n\n  @property({ attribute: false })\n  activeSubMenu!: ActiveSubMenu | null;\n\n  editor: any = {};\n  preventHide: Boolean = false;\n  currentContent: string | undefined = undefined;\n\n  connectedCallback() {\n    super.connectedCallback();\n\n    this.addEventListener('blur', () => {\n      setTimeout(() => {\n        this.selected = false;\n      }, 200);\n    });\n  }\n\n  firstUpdated() {\n    this.initEditor();\n  }\n\n  updated(changedProperties: Map<string, any>) {\n    if (LOGINFO) this.logger.log('updated()', { changedProperties });\n\n    if (changedProperties.has('toggleAction')) {\n      if (changedProperties.get('toggleAction') !== undefined) {\n        this.runAction(this.action);\n      }\n    }\n\n    if (changedProperties.has('focusInit')) {\n      if (this.focusInit === 'true') {\n        this.editor.view.focus();\n      } else {\n        this.setShowMenu(false);\n      }\n    }\n\n    if (changedProperties.has('toAppend')) {\n      if (\n        changedProperties.get('toAppend') === undefined ||\n        changedProperties.get('toAppend') === 'undefined'\n      ) {\n        if (this.toAppend !== 'undefined') {\n          this.appendContent(this.toAppend);\n          this.dispatchEvent(new CustomEvent('content-appended'));\n        }\n      }\n    }\n\n    if (changedProperties.has('editable') || changedProperties.has('type')) {\n      // if (LOGINFO) this.logger.info('updated() - editable || type', {editable: this.editable, type: this.type, changedProperties});\n      this.initEditor();\n    }\n\n    if (changedProperties.has('init')) {\n      if (this.init !== this.currentContent) {\n        this.initEditor();\n        return;\n      }\n    }\n\n    if (changedProperties.has('showUrlMenu') && this.showUrlMenu && this.shadowRoot != null) {\n      const input = this.shadowRoot.getElementById('URL_INPUT');\n      if (input) {\n        input.focus();\n      }\n    }\n  }\n\n  runAction(action: any) {\n    if (LOGINFO) this.logger.log('runAction()', { action });\n    switch (action.name) {\n      case APPEND_ACTION:\n        this.appendContent(action.pars.content);\n        break;\n\n      case FOCUS_ACTION:\n        if (LOGINFO) this.logger.log('focusing()');\n        this.editor.view.focus();\n        break;\n\n      default:\n        throw new Error(`unexpected action ${action.name}`);\n    }\n  }\n\n  getValidInnerHTML(text: string) {\n    if (text.startsWith('<h1') || text.startsWith('<p')) {\n      const temp = document.createElement('template');\n      temp.innerHTML = text.trim();\n      if (temp.content.firstElementChild == null) {\n        return '';\n      }\n      return temp.content.firstElementChild.innerHTML;\n    } else {\n      return text;\n    }\n  }\n\n  getValidDocHtml(text: string) {\n    const innerHTML = this.getValidInnerHTML(text);\n    let tag = this.type === TextType.Title ? 'h1' : 'p';\n    return `<${tag}>${innerHTML}</${tag}>`;\n  }\n\n  getSlice(text: string) {\n    const htmlString = this.getValidDocHtml(text);\n    if (!htmlString) return undefined;\n\n    let temp = document.createElement('template');\n    temp.innerHTML = htmlString;\n\n    return temp.content.firstChild;\n  }\n\n  appendContent(content: string) {\n    if (LOGINFO) this.logger.log('appending content', content);\n\n    const sliceNode = this.getSlice(content);\n    const slice = this.editor.parser.parseSlice(sliceNode);\n\n    const end = this.editor.view.state.doc.content.content[0].nodeSize;\n\n    this.editor.view.dispatch(this.editor.view.state.tr.replace(end - 1, end, slice));\n\n    this.editor.view.dispatch(\n      this.editor.view.state.tr.setSelection(\n        TextSelection.near(this.editor.view.state.doc.resolve(end - 1))\n      )\n    );\n\n    this.editor.view.focus();\n  }\n\n  enterPressedEvent(content, asChild) {\n    this.dispatchEvent(\n      new CustomEvent('enter-pressed', {\n        detail: {\n          content,\n          asChild\n        }\n      })\n    );\n  }\n\n  keydown(view, event) {\n    if (LOGINFO) this.logger.log('keydown()', { keyCode: event.keyCode });\n\n    /** enter */\n    if (event.keyCode === 13) {\n      event.preventDefault();\n\n      /** simulate splitBlock */\n      const splitTr = view.state.tr.split(view.state.selection.$cursor.pos);\n\n      /** applied just to get the second part, the actual transaction\n       * is applied in dispatch */\n      const newState = view.state.apply(splitTr);\n      const secondPart = newState.doc.content.content[1];\n\n      view.dispatch(splitTr.delete(view.state.selection.$cursor.pos, view.state.doc.nodeSize));\n\n      /** send event to parent */\n      const fragment = this.editor.serializer.serializeFragment(secondPart);\n      const temp = document.createElement('div');\n      temp.appendChild(fragment);\n      const content = temp.innerHTML;\n\n      if (LOGINFO) this.logger.log('enter-pressed', { content });\n      this.enterPressedEvent(content, this.type === TextType.Title);\n      return;\n    }\n\n    // 27 is esc\n    if (event.keyCode === 27) {\n      if (this.showMenu) {\n        event.preventDefault();\n        this.preventHide = false;\n        this.showUrlMenu = false;\n        this.setShowMenu(false);\n      }\n    }\n\n    /** backspace */\n    if (event.keyCode === 8) {\n      if (view.state.selection.$cursor.pos === 1) {\n        event.preventDefault();\n\n        const content = this.state2Html(view.state);\n        if (LOGINFO) this.logger.log('backspace-on-start', { content });\n        this.dispatchEvent(\n          new CustomEvent('backspace-on-start', {\n            bubbles: true,\n            composed: true,\n            detail: {\n              content\n            }\n          })\n        );\n      }\n      return;\n    }\n\n    /** delete */\n    if (event.keyCode === 46) {\n      if (view.state.selection.$cursor.pos >= view.state.doc.content.content[0].nodeSize - 1) {\n        event.preventDefault();\n\n        const content = this.state2Html(view.state);\n        if (LOGINFO) this.logger.log('backspace-on-start', { content });\n        this.dispatchEvent(new CustomEvent('delete-on-end'));\n      }\n      return;\n    }\n\n    /** arrow up */\n    if (event.keyCode === 38) {\n      if (view.state.selection.$cursor.pos === 1) {\n        event.preventDefault();\n        if (LOGINFO) this.logger.log('dispatching keyup-on-start');\n        this.dispatchEvent(new CustomEvent('keyup-on-start'));\n        return;\n      }\n    }\n\n    /** arrow down */\n    if (event.keyCode === 40) {\n      if (view.state.selection.$cursor.pos >= view.state.doc.content.content[0].nodeSize - 1) {\n        event.preventDefault();\n        this.dispatchEvent(new CustomEvent('keydown-on-end'));\n        return;\n      }\n    }\n\n    /** (B)old */\n    /** backspace */\n    if (event.keyCode === 66) {\n      if (event.ctrlKey === true) {\n        event.preventDefault();\n        toggleMark(this.editor.view.state.schema.marks.strong)(\n          this.editor.view.state,\n          this.editor.view.dispatch\n        );\n      }\n      return;\n    }\n\n    if (event.keyCode === 74) {\n      if (event.ctrlKey === true) {\n        event.preventDefault();\n        toggleMark(this.editor.view.state.schema.marks.em)(\n          this.editor.view.state,\n          this.editor.view.dispatch\n        );\n      }\n      return;\n    }\n\n    if (event.keyCode === 75) {\n      if (event.ctrlKey === true) {\n        event.preventDefault();\n        this.subMenuConfirm();\n      }\n      return;\n    }\n  }\n\n  isEditable() {\n    if (LOGINFO) this.logger.log(`isEditable()`, { editable: this.editable });\n    const editable = this.editable !== undefined ? this.editable === 'true' : false;\n    return editable;\n  }\n\n  initEditor() {\n    if (this.editor && this.editor.view) {\n      this.editor.view.destroy();\n      this.editor = {};\n      if (LOGINFO)\n        this.logger.log(`initEditor() - Initializing editor`, {\n          init: this.init\n        });\n    }\n\n    const schema = this.type === TextType.Title ? titleSchema : blockSchema;\n    this.editor.parser = DOMParser.fromSchema(schema);\n    this.editor.serializer = DOMSerializer.fromSchema(schema);\n\n    this.currentContent = this.init;\n    const doc = this.html2doc(this.getValidDocHtml(this.init));\n    /** the heading level for render is given by the `level` attribute,\n     * not the heading tag (which is always <h1> in the data text) */\n    if (doc.content.content[0].type.name === 'heading') {\n      doc.content.content[0].attrs.level = this.level;\n    }\n\n    const state = EditorState.create({\n      schema: schema,\n      doc: doc,\n      plugins: []\n    });\n\n    if (this.shadowRoot == null) return;\n    const container = this.shadowRoot.getElementById('editor-content');\n\n    this.editor.view = new EditorView(container as Node, {\n      state: state,\n      editable: () => this.isEditable(),\n      dispatchTransaction: transaction => this.dispatchTransaction(transaction),\n      handleDOMEvents: {\n        focus: () =>\n          this.dispatchEvent(\n            new CustomEvent('focus-changed', {\n              bubbles: true,\n              composed: true,\n              detail: { value: true }\n            })\n          ),\n        blur: () => {\n          this.dispatchEvent(\n            new CustomEvent('focus-changed', {\n              bubbles: true,\n              composed: true,\n              detail: { value: false }\n            })\n          )\n          return true;\n        },\n        keydown: (view, event) => {\n          this.keydown(view, event);\n          return true;\n        },\n        dblclick: (view, event) => {\n          this.setShowMenu(true);\n          return true;\n        }\n      },\n      nodeViews: {\n        code_block: (node, view, getPos) =>\n          new CodeBlockView(node, view, getPos, () => this.enterPressedEvent('', false))\n      }\n    });\n\n    if (this.focusInit === 'true') {\n      this.editor.view.focus();\n    }\n  }\n\n  state2Html(state: EditorState) {\n    const fragment = this.editor.serializer.serializeFragment(state.doc);\n\n    const node = state.doc.content.child(0);\n    const temp = document.createElement('div');\n    temp.appendChild(fragment);\n    /** heading and paragraph content are stored without the exernal tag */\n    if (node.type.name === 'code_block') {\n      return (temp as HTMLElement).innerHTML;\n    } else {\n      return (temp.firstElementChild as HTMLElement).innerHTML;\n    }\n  }\n\n  html2doc(text: string) {\n    /** convert HTML string to doc state */\n    let temp = document.createElement('template');\n    temp.innerHTML = text;\n    const element = temp.content.firstChild;\n\n    return this.editor.parser.parse(element);\n  }\n\n  dispatchTransaction(transaction: any) {\n    if (!transaction.curSelection.empty) {\n      this.selected = true;\n      this.setShowMenu(true);\n    } else {\n      this.selected = false;\n    }\n\n    const content = this.state2Html(this.editor.view.state);\n    let newState = this.editor.view.state.apply(transaction);\n\n    let contentChanged = !newState.doc.eq(this.editor.view.state.doc);\n    this.editor.view.updateState(newState);\n\n    if (LOGINFO)\n      this.logger.log('dispatchTransaction()', {\n        selected: this.selected,\n        newState,\n        contentChanged,\n        transaction\n      });\n\n    if (!contentChanged) return;\n\n    /** doc changed */\n\n    const newContent = this.state2Html(newState);\n\n    if (LOGINFO)\n      this.logger.log(`dispatchTransaction() - content-changed`, {\n        content,\n        newContent\n      });\n\n    /** local copy of the html (withot the external tag) represeting the current state */\n    this.currentContent = newContent;\n\n    this.dispatchEvent(\n      new CustomEvent('content-changed', {\n        detail: {\n          content: newContent\n        }\n      })\n    );\n  }\n\n  toHeading(lift: boolean) {\n    this.changeType(TextType.Title, lift);\n  }\n\n  toParagraph() {\n    this.changeType(TextType.Paragraph, false);\n  }\n\n  reduceHeading() {\n    this.dispatchEvent(new CustomEvent('lift-heading', {}));\n  }\n\n  changeType(type: TextType, lift: boolean) {\n    this.dispatchEvent(\n      new CustomEvent('change-type', {\n        detail: { type, lift }\n      })\n    );\n  }\n\n  urlKeydown(event) {\n    // 27 is esc\n    if (event.keyCode === 27) {\n      if (this.showMenu) {\n        event.preventDefault();\n        this.subMenuCancel();\n      }\n    }\n\n    // 13 is enter\n    if (event.keyCode === 13) {\n      if (this.showMenu) {\n        event.preventDefault();\n        this.subMenuConfirm();\n      }\n    }\n  }\n\n  async setShowMenu(value: boolean) {\n    if (!this.shadowRoot) return;\n\n    if (this.editable !== 'true') {\n      this.showMenu = false;\n      return;\n    }\n\n    this.showMenu = value;\n    this.requestUpdate();\n\n    if (value === true) {\n      await this.updateComplete;\n\n      const menu = this.shadowRoot.getElementById('TOP_MENU');\n      if (!menu) return;\n\n      /** listen events */\n      menu.addEventListener('keydown', event => {\n        if (event.keyCode === 27) {\n          // 27 is esc\n          event.stopPropagation();\n          this.setShowMenu(false);\n        }\n      });\n    } else {\n      if (this.preventHide) {\n        this.editor.view.focus();\n      }\n    }\n  }\n\n  subMenuClick(type: ActiveSubMenu) {\n    if (this.activeSubMenu !== type) {\n      this.activeSubMenu = type;\n      this.preventHide = true;\n      this.showUrlMenu = true;\n\n      if (\n        this.activeSubMenu === ActiveSubMenu.IMAGE ||\n        this.activeSubMenu === ActiveSubMenu.VIDEO\n      ) {\n        this.showDimMenu = true;\n      } else {\n        this.showDimMenu = false;\n      }\n    } else {\n      this.resetSubMenu();\n    }\n  }\n\n  private resetSubMenu() {\n    this.preventHide = false;\n    this.activeSubMenu = null;\n    this.showDimMenu = false;\n    this.showUrlMenu = false;\n  }\n\n  subMenuConfirm() {\n    switch (this.activeSubMenu) {\n      case ActiveSubMenu.LINK:\n        this.applyLinkMark();\n        break;\n      case ActiveSubMenu.IMAGE:\n        this.applyImageNode();\n        break;\n      case ActiveSubMenu.VIDEO:\n        this.applyIframeNode();\n        break;\n    }\n\n    this.resetSubMenu();\n  }\n\n  subMenuCancel() {\n    this.resetSubMenu();\n    this.setShowMenu(false);\n  }\n\n  private isValidLink(link: string) {\n    if (!link.startsWith('http')) {\n      link = `http://${link}`;\n    }\n    try {\n      new URL(link);\n    } catch (_) {\n      return false;\n    }\n\n    return link;\n  }\n\n  getSubMenuFields() {\n    if (this.shadowRoot == null) return { link: '', width: '', height: '' };\n\n    return {\n      link: (this.shadowRoot.getElementById('URL_INPUT') as HTMLInputElement).value,\n      width: this.shadowRoot.getElementById('DIM_WIDTH') ? (this.shadowRoot.getElementById('DIM_WIDTH') as HTMLInputElement).value : '',\n      height: this.shadowRoot.getElementById('DIM_HEIGHT') ? (this.shadowRoot.getElementById('DIM_HEIGHT') as HTMLInputElement).value : ''\n    };\n  }\n\n  applyLinkMark() {\n    const { link } = this.getSubMenuFields();\n\n    const href = this.isValidLink(link);\n    if (href) {\n      toggleMark(this.editor.view.state.schema.marks.link, { href })(\n        this.editor.view.state,\n        this.editor.view.dispatch\n      );\n      this.preventHide = false;\n      this.selected = false;\n    }\n  }\n\n  alignNodeToCenter() {\n    setBlockType(this.editor.view.state.schema.nodes.paragraph, {\n      style: 'text-align:center'\n    })(this.editor.view.state, this.editor.view.dispatch);\n  }\n\n  applyImageNode() {\n    const { link, width, height } = this.getSubMenuFields();\n    if (this.isValidLink(link)) {\n      const node = this.editor.view.state.doc.content.content[0];\n      const end = node.nodeSize;\n      const imgNode = this.editor.view.state.schema.nodes.image.create({\n        src: link,\n        style: `${width !== '' ? `width:${width}px` : ''};${\n          height !== '' ? `height:${height}px` : ''\n          };max-width: 100%;margin: 0 auto;border-radius: 5px;`\n      });\n      this.dispatchTransaction(this.editor.view.state.tr.replaceSelectionWith(imgNode, false));\n      this.alignNodeToCenter();\n      // this.editor.view.dispatch();\n    }\n  }\n\n  parseYoutubeURL(url: string) {\n    const getParameterByName = (name, url) => {\n      name = name.replace(/[\\[\\]]/g, '\\\\$&');\n      var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),\n        results = regex.exec(url);\n      if (!results) return null;\n      if (!results[2]) return '';\n      return decodeURIComponent(results[2].replace(/\\+/g, ' '));\n    };\n\n    let embedUrl = 'https://www.youtube.com/embed';\n\n    // For when the user copies the youtube video URL\n    // on the address bar\n    if (url.indexOf('?v=') > -1) {\n      const videoId = getParameterByName('v', url);\n      embedUrl += `/${videoId}`;\n      // For when the user right-clicks on the video and\n      // copies the \"video url\"\n    } else if (url.indexOf('youtu.be') > -1) {\n      embedUrl += `/${url.split('/').pop()}`;\n\n      // If none of these patterns match, do not parse\n      // the given URL by the user.\n    } else {\n      return url;\n    }\n\n    return embedUrl;\n  }\n\n  applyIframeNode() {\n    const { link, width, height } = this.getSubMenuFields();\n    if (this.isValidLink(link)) {\n      const iframeNode = this.editor.view.state.schema.nodes.iframe.create({\n        src: this.parseYoutubeURL(link),\n        style: `width:${\n          width !== '' ? width + 'px' : '100%'\n          };height:52vw;border:0px;max-width:100%;max-height:470px;`\n      });\n\n      this.dispatchTransaction(this.editor.view.state.tr.replaceSelectionWith(iframeNode, false));\n      this.alignNodeToCenter();\n    }\n  }\n\n  menuItemClick(markType: any) {\n    this.preventHide = false;\n    toggleMark(markType)(this.editor.view.state, this.editor.view.dispatch);\n    this.resetSubMenu();\n  }\n\n  editorFocused() {\n    if (LOGINFO) this.logger.log('editor focused');\n  }\n\n  editorBlured() {\n    if (LOGINFO) this.logger.log('editor blured');\n  }\n\n  renderDimensionsMenu() {\n    // incase we want the height field back\n    // const renderHeightDim = () => html`\n    //   <input @keydown=${this.urlKeydown} class=\"dim\" placeholder=\"height\" id=\"DIM_HEIGHT\" />px\n    // `;\n    return html`\n      <input\n        @keydown=${this.urlKeydown}\n        class=\"dim\"\n        placeholder=\"width (optional)\"\n        id=\"DIM_WIDTH\"\n      />\n    `;\n  }\n\n  renderUrlMenu() {\n    return html`\n      <div class=\"inp\">\n        <div class=\"inp-hldr\">\n          <input\n            @keydown=${this.urlKeydown}\n            placeholder=\"${this.activeSubMenu !== ActiveSubMenu.LINK\n        ? this.activeSubMenu + ' '\n        : ''}url\"\n            id=\"URL_INPUT\"\n          />\n          ${this.showDimMenu ? this.renderDimensionsMenu() : ''}\n        </div>\n        <div class=\"inp-actions\">\n          <button @click=${this.subMenuCancel} class=\"btn btn-small\">\n            ${icons.cross}\n          </button>\n          <button @click=${this.subMenuConfirm} class=\"btn btn-small\">\n            ${icons.check}\n          </button>\n        </div>\n      </div>\n    `;\n  }\n\n  renderParagraphItems() {\n    return html`\n      ${this.level > 2\n        ? html`\n            <button class=\"btn btn-text\" @click=${() => this.toHeading(true)}>\n              <span>h${this.level - 1}</span>\n            </button>\n          `\n        : ''}\n      <button class=\"btn btn-text\" @click=${() => this.toHeading(false)}>\n        <span>h${this.level}</span>\n      </button>\n    `;\n  }\n\n  renderHeadingItems() {\n    return this.level > 1\n      ? html`\n          ${this.level > 2\n          ? html`\n                <button class=\"btn btn-text\" @click=${() => this.reduceHeading()}>\n                  <span>h${this.level - 1}</span>\n                </button>\n              `\n          : ''}\n          <button class=\"btn btn-text\" @click=${this.toParagraph}>\n            <span>text</span>\n          </button>\n        `\n      : '';\n  }\n\n  renderLevelControllers() {\n    return html`\n      <!-- level controllers -->\n      ${this.type === TextType.Paragraph ? this.renderParagraphItems() : this.renderHeadingItems()}\n    `;\n  }\n\n  /**\n   * Menus that needs to show up only when there is a `selection`\n   */\n\n  renderSelectionOnlyMenus(type: string) {\n    const menus = html`\n      ${this.renderLevelControllers()}\n      ${this.type !== TextType.Title\n        ? html`\n            <button\n              class=\"btn btn-square btn-large\"\n              @click=${() => this.menuItemClick(this.editor.view.state.schema.marks.strong)}\n            >\n              ${icons.bold}\n            </button>\n          `\n        : ''}\n      <button\n        class=\"btn btn-square btn-large\"\n        @click=${() => this.menuItemClick(this.editor.view.state.schema.marks.em)}\n      >\n        ${icons.em}\n      </button>\n\n      <button\n        class=\"btn btn-square btn-small\"\n        @click=${() => this.subMenuClick(ActiveSubMenu.LINK)}\n      >\n        ${icons.link}\n      </button>\n    `;\n    return this.hasSelection() && type !== 'code' ? menus : '';\n  }\n\n  hasSelection() {\n    if (this.editor.view.state.selection.from > 1 || this.editor.view.state.selection.to > 1) {\n      return true;\n    }\n    return false;\n  }\n\n  toggleCode() {\n    const node = this.editor.view.state.doc.content.content[0];\n    const end = node.nodeSize;\n    const newType =\n      node.type.name !== 'code_block' ? blockSchema.nodes.code_block : blockSchema.nodes.paragraph;\n\n    this.editor.view.dispatch(this.editor.view.state.tr.setBlockType(0, end, newType));\n  }\n\n  renderMenu() {\n    const embedSubMenu = html`\n      <button\n        class=\"btn btn-square btn-small\"\n        @click=${() => this.subMenuClick(ActiveSubMenu.IMAGE)}\n      >\n        ${icons.image}\n      </button>\n\n      <button\n        class=\"btn btn-square btn-small\"\n        @click=${() => this.subMenuClick(ActiveSubMenu.VIDEO)}\n      >\n        ${icons.youtube}\n      </button>\n    `;\n    const codeSubMenu = html`\n      <button class=\"btn btn-square btn-small\" @click=${this.toggleCode}>\n        ${icons.code}\n      </button>\n    `;\n    const type = this.getBlockType();\n    return html`\n      <div class=\"top-menu\" id=\"TOP_MENU\">\n        <!-- icons from https://material.io/resources/icons/?icon=format_bold&style=round  -->\n\n        <div class=\"menus\">\n          <!-- current level -->\n          <button class=\"btn-text btn-current\">\n            <span>${type}</span>\n          </button>\n          ${this.renderSelectionOnlyMenus(type)}\n          ${this.type === 'Paragraph' && type !== 'code' ? embedSubMenu : ''}\n          ${this.type !== 'Title' ? codeSubMenu : ''}\n        </div>\n        ${this.showUrlMenu && type !== 'code' ? this.renderUrlMenu() : ''}\n      </div>\n    `;\n  }\n\n  getBlockType() {\n    const nodeType = (this.editor.view as EditorView).state.doc.child(0).type;\n\n    if (nodeType && nodeType.name === 'code_block') {\n      return 'code';\n    }\n\n    return this.type === TextType.Title ? `h${this.level}` : 'text';\n  }\n\n  render() {\n    if (LOGINFO) this.logger.log('render()', { this: this });\n    return html`\n      ${this.showMenu ? this.renderMenu() : ''}\n      <div \n        id=\"editor-content\" \n        class=\"editor-content\">\n      </div>\n    `;\n  }\n\n  static get styles() {\n    return [\n      cmStyle,\n      styles,\n      iconsStyle,\n      theme,\n      css`\n        :host {\n          position: relative;\n          width: 100%;\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, 'Apple Color Emoji',\n            Arial, sans-serif, 'Segoe UI Emoji', 'Segoe UI Symbol';\n        }\n\n        a {\n          color: inherit;\n        }\n\n        .top-menu {\n          z-index: 10;\n          position: absolute;\n          padding: 0px 0px;\n          height: initial;\n          top: -50px;\n          left: 25px;\n          background-color: white;\n          border-radius: 10px;\n          border: solid 1px #cfcfcf;\n          background-color: #28282a60;\n          display: flex;\n          flex-direction: column;\n          overflow: hidden;\n          max-width: calc(100vw - 50px);\n        }\n\n        .top-menu .menus {\n          display: flex;\n          justify-content: center;\n          align-items: center;\n        }\n\n        .top-menu button {\n          font-family: inherit;\n          font-size: 100%;\n          line-height: 1.15;\n          margin: 0;\n          overflow: visible;\n          text-transform: none;\n          background-color: transparent;\n          border: 0px;\n        }\n\n        .btn {\n          cursor: pointer;\n          border-radius: 8px;\n          text-align: center;\n          fill: white;\n          color: white;\n        }\n\n        .btn:hover {\n          background-color: #444444;\n          transition: background-color 100ms linear;\n        }\n\n        .btn-text {\n          color: white;\n          padding: 12px 16px;\n          font-weight: bold;\n        }\n\n        .btn-current {\n          text-decoration: underline;\n          user-select: none;\n        }\n\n        .btn-square {\n          width: 40px;\n        }\n\n        .btn-large svg {\n          margin-top: 6px;\n          width: 30px;\n          height: 30px;\n        }\n\n        .btn-small svg {\n          margin-top: 8px;\n          width: 26px;\n          height: 26px;\n        }\n\n        .inp {\n          display: flex;\n          padding: 0 10px 7px 10px;\n        }\n        .inp-actions {\n          display: flex;\n        }\n\n        .inp input {\n          height: 38px;\n          font-size: 14px;\n          padding-left: 12px;\n          border: none;\n          background-color: #444444;\n          color: white;\n          margin: 0 5px 0 0;\n          border-radius: 6px;\n        }\n\n        .inp input#URL_INPUT {\n          flex-grow: 1;\n        }\n\n        .inp input.dim {\n          width: 100px;\n          margin-left: 5px;\n        }\n\n        .inp .inp-hldr {\n          display: flex;\n          flex-grow: 1;\n          color: white;\n          align-items: center;\n          margin-right: 5px;\n        }\n\n        @media (max-width: 768px) {\n          .inp {\n            flex-direction: column;\n            overflow: auto;\n          }\n          .top-menu {\n            max-width: 80vw;\n          }\n          .inp input#URL_INPUT {\n            width: 50%;\n          }\n          .inp input.dim {\n            width: 50%;\n          }\n          .inp-actions {\n            justify-content: center;\n          }\n        }\n\n        .editor-content {\n          margin: 0px 0px;\n        }\n\n        .yt-embed {\n          max-width: 100%;\n        }\n\n        @media (max-width: 768px) {\n          .yt-embed {\n            max-height: 300px;\n          }\n        }\n      `\n    ];\n  }\n}\n","import { LitElement, property, html, css } from 'lit-element';\nimport { ApolloClient } from 'apollo-boost';\nimport isEqual from 'lodash-es/isEqual';\n\nimport { ApolloClientModule } from '@uprtcl/graphql';\n\nconst styleMap = style => {\n  return Object.entries(style).reduce((styleString, [propName, propValue]) => {\n    propName = propName.replace(/([A-Z])/g, matches => `-${matches[0].toLowerCase()}`);\n    return `${styleString}${propName}:${propValue};`;\n  }, '');\n};\n\nimport { moduleConnect, Logger } from '@uprtcl/micro-orchestrator';\nimport { HasChildren, CortexModule, PatternRecognizer, Entity } from '@uprtcl/cortex';\nimport {\n  EveesRemote,\n  EveesModule,\n  UPDATE_HEAD,\n  eveeColor,\n  ContentUpdatedEvent,\n  CREATE_ENTITY,\n  EveesDraftsLocal,\n  EveesHelpers,\n  deriveSecured,\n  Perspective,\n  Secured,\n  hashObject,\n  EveesConfig\n} from '@uprtcl/evees';\nimport { MenuConfig } from '@uprtcl/common-ui';\nimport { loadEntity } from '@uprtcl/multiplatform';\n\nimport { TextType, DocNode } from '../types';\nimport { HasDocNodeLenses } from '../patterns/document-patterns';\nimport { icons } from './prosemirror/icons';\nimport { DocumentsBindings } from '../bindings';\n\nconst LOGINFO = false;\nconst SELECTED_BACKGROUND = 'rgb(200,200,200,0.2);';\nconst PLACEHOLDER_TOKEN = '_PLACEHOLDER_';\n\nexport class DocumentEditor extends moduleConnect(LitElement) {\n  logger = new Logger('DOCUMENT-EDITOR');\n\n  @property({ type: String, attribute: 'uref' })\n  firstRef!: string;\n\n  @property({ attribute: false })\n  uref!: string;\n\n  @property({ type: String, attribute: 'official-owner' })\n  officialOwner!: string;\n\n  @property({ type: Boolean, attribute: 'check-owner' })\n  checkOwner: boolean = false;\n\n  @property({ type: Boolean, attribute: 'read-only' })\n  readOnly: boolean = false;\n\n  @property({ type: Number, attribute: 'root-level' })\n  rootLevel: number = 0;\n\n  @property({ type: String })\n  parentId: string = '';\n\n  @property({ type: String, attribute: 'default-type' })\n  defaultType: string = EveesModule.bindings.PerspectiveType;\n\n  @property({ type: Boolean, attribute: 'show-info' })\n  renderInfo: boolean = false;\n\n  @property({ attribute: false })\n  docHasChanges: boolean = false;\n\n  @property({ attribute: false })\n  persistingAll: boolean = false;\n\n  @property({ type: Boolean, attribute: false })\n  showCommitMessage: boolean = false;\n\n  @property({ type: String })\n  color!: string;\n\n  @property({ attribute: false })\n  reloading: boolean = true;\n\n  @property({ attribute: false })\n  checkedOutPerspectives: { [key: string]: { firstUref: string; newUref: string } } = {};\n\n  doc: DocNode | undefined = undefined;\n  client!: ApolloClient<any>;\n\n  protected remotes!: EveesRemote[];\n  protected recognizer!: PatternRecognizer;\n  protected editableRemotesIds!: string[];\n\n  draftService = new EveesDraftsLocal();\n\n  async firstUpdated() {\n    this.remotes = this.requestAll(EveesModule.bindings.EveesRemote);\n    this.recognizer = this.request(CortexModule.bindings.Recognizer);\n    const config = this.request(EveesModule.bindings.Config) as EveesConfig;\n    this.editableRemotesIds = config.editableRemotesIds ? config.editableRemotesIds : [];\n\n    if (!this.client) {\n      this.client = this.request(ApolloClientModule.bindings.Client);\n    }\n\n    this.uref = this.firstRef;\n\n    if (LOGINFO) this.logger.log('firstUpdated()', this.uref);\n\n    await this.loadDoc();\n    this.reloading = false;\n  }\n\n  updated(changedProperties) {\n    if (LOGINFO)\n      this.logger.log('updated()', { uref: this.uref, firstRef: this.firstRef, changedProperties });\n\n    let reload: boolean = false;\n\n    if (changedProperties.has('firstRef')) {\n      this.uref = this.firstRef;\n    }\n    if (changedProperties.has('uref')) {\n      reload = true;\n    }\n    if (changedProperties.has('client')) {\n      reload = true;\n    }\n    if (changedProperties.has('editable')) {\n      reload = true;\n    }\n    if (reload) {\n      this.reload();\n    }\n  }\n\n  async reload() {\n    this.reloading = true;\n    await this.loadDoc();\n    this.reloading = false;\n  }\n\n  async loadDoc() {\n    if (!this.client) return;\n\n    if (LOGINFO) this.logger.log('loadDoc()', this.uref);\n\n    if (!this.uref) return;\n    this.doc = await this.loadNodeRec(this.uref);\n    this.requestUpdate();\n  }\n\n  async loadNodeRec(uref: string, ix?: number, parent?: DocNode): Promise<DocNode> {\n    if (LOGINFO) this.logger.log('loadNodeRec()', { uref, ix, parent });\n\n    const node = await this.loadNode(uref, parent, ix);\n\n    const loadChildren = node.hasChildren.getChildrenLinks({ id: '', object: node.draft }).map(\n      async (child, ix): Promise<DocNode> => {\n        return child !== undefined && child !== ''\n          ? await this.loadNodeRec(child, ix, node)\n          : node.childrenNodes[ix];\n      }\n    );\n\n    node.parent = parent;\n    node.childrenNodes = await Promise.all(loadChildren);\n\n    /** focus if top element */\n    if (node.uref === this.uref && node.editable) {\n      node.focused = true;\n    }\n\n    return node;\n  }\n\n  async refToNode(uref: string, parent?: DocNode, ix?: number) {\n    const entity = await loadEntity(this.client, uref);\n    if (!entity) throw Error(`Entity not found ${uref}`);\n\n    let entityType: string = this.recognizer.recognizeType(entity);\n\n    let editable = false;\n    let remoteId: string | undefined;\n    let context: string | undefined;\n    let dataId: string | undefined;\n    let headId: string | undefined;\n\n    if (entityType === EveesModule.bindings.PerspectiveType) {\n      remoteId = await EveesHelpers.getPerspectiveRemoteId(this.client, entity.id);\n\n      const remote = this.remotes.find(r => r.id === remoteId);\n      if (!remote) throw new Error(`remote not found for ${remoteId}`);\n\n      let canWrite: boolean = false;\n\n      if (!this.readOnly) {\n        const editableRemote =\n          this.editableRemotesIds.length > 0 ? this.editableRemotesIds.includes(remote.id) : true;\n        if (editableRemote) {\n          canWrite = await EveesHelpers.canWrite(this.client, uref);\n        }\n      }\n\n      if (!this.readOnly) {\n        editable = canWrite;\n        headId = await EveesHelpers.getPerspectiveHeadId(this.client, entity.id);\n        dataId =\n          headId !== undefined\n            ? await EveesHelpers.getCommitDataId(this.client, headId)\n            : undefined;\n      } else {\n        editable = false;\n        dataId = await EveesHelpers.getPerspectiveDataId(this.client, entity.id);\n        context = '';\n        headId = '';\n      }\n    } else {\n      if (entityType === EveesModule.bindings.CommitType) {\n        if (!parent) throw new Error('Commit must have a parent');\n\n        editable = parent.editable;\n        remoteId = parent.remote;\n        dataId = await EveesHelpers.getCommitDataId(this.client, entity.id);\n        headId = uref;\n      } else {\n        entityType = 'Data';\n        editable = false;\n        remoteId = '';\n        dataId = uref;\n        headId = '';\n      }\n    }\n\n    if (!dataId || !entityType) throw Error(`data not loaded for uref ${this.uref}`);\n\n    // TODO get data and patterns hasChildren/hasDocNodeLenses from query\n    const data: Entity<any> | undefined = await loadEntity(this.client, dataId);\n    if (!data) throw Error('Data undefined');\n\n    const hasChildren: HasChildren = this.recognizer\n      .recognizeBehaviours(data)\n      .find(b => (b as HasChildren).getChildrenLinks);\n    const hasDocNodeLenses: HasDocNodeLenses = this.recognizer\n      .recognizeBehaviours(data)\n      .find(b => (b as HasDocNodeLenses).docNodeLenses);\n\n    if (!hasChildren) throw Error('hasChildren undefined');\n    if (!hasDocNodeLenses) throw Error('hasDocNodeLenses undefined');\n\n    /** disable editable */\n    if (this.readOnly) {\n      editable = false;\n    }\n\n    // Add node coordinates\n    const coord = this.setNodeCoordinates(parent, ix);\n\n    // Add node level\n    const level = this.setNodeLevel(coord);\n\n    const node: DocNode = {\n      uref: entity.id,\n      isPlaceholder: false,\n      type: entityType,\n      ix,\n      hasChildren,\n      childrenNodes: [],\n      data,\n      draft: data ? data.object : undefined,\n      coord,\n      level,\n      headId,\n      hasDocNodeLenses,\n      editable,\n      remote: remoteId,\n      context,\n      focused: false,\n      timestamp: Date.now()\n    };\n\n    return node;\n  }\n\n  setNodeCoordinates(parent?: DocNode, ix?: number) {\n    const currentIndex = ix ? ix : 0;\n    const coord = parent && parent.coord ? parent.coord.concat([currentIndex]) : [currentIndex];\n\n    return coord;\n  }\n\n  setNodeLevel(coord) {\n    return this.rootLevel + (coord.length - 1);\n  }\n\n  isPlaceholder(uref: string): boolean {\n    return uref.startsWith(PLACEHOLDER_TOKEN);\n  }\n\n  async loadNode(uref: string, parent?: DocNode, ix?: number): Promise<DocNode> {\n    if (LOGINFO) this.logger.log('loadNode()', { uref, ix });\n\n    let node;\n    if (this.isPlaceholder(uref)) {\n      const draft = await this.draftService.getDraft(uref);\n      node = this.draftToPlaceholder(draft, parent, ix);\n    } else {\n      node = await this.refToNode(uref, parent, ix);\n\n      /** initialize draft */\n      const draft = await this.draftService.getDraft(uref);\n      if (draft !== undefined) {\n        node.draft = draft;\n      }\n    }\n\n    if (LOGINFO) this.logger.log('loadNode() post', { uref, ix, node });\n\n    return node;\n  }\n\n  defaultEntity(text: string, type: TextType) {\n    return {\n      data: { text, type, links: [] },\n      entityType: DocumentsBindings.TextNodeType\n    };\n  }\n\n  hasChangesAll() {\n    if (!this.doc) return false;\n    return this.hasChangesRec(this.doc);\n  }\n\n  hasChanges(node: DocNode) {\n    if (node.uref === '') return true; // is placeholder\n    if (!node.data) return true;\n    if (!isEqual(node.data.object, node.draft)) return true;\n    return false;\n  }\n\n  hasChangesRec(node: DocNode) {\n    if (this.hasChanges(node)) return true;\n    const ix = node.childrenNodes.find(child => this.hasChangesRec(child));\n    if (ix !== undefined) return true;\n    return false;\n  }\n\n  performUpdate() {\n    this.docHasChanges = this.hasChangesAll();\n    // console.log({ hasChanges: this.docHasChanges });\n    let event = new CustomEvent('doc-changed', {\n      detail: {\n        docChanged: this.docHasChanges\n      }\n    });\n    this.dispatchEvent(event);\n    super.performUpdate();\n  }\n\n  async persistAll(message?: string) {\n    if (!this.doc) return;\n    this.persistingAll = true;\n\n    if (this.doc.remote === undefined) throw Error('top element must have an remote');\n\n    await this.preparePersistRec(this.doc, this.doc.remote, message);\n    await this.persistRec(this.doc);\n\n    /** reload doc from backend */\n    await this.loadDoc();\n    this.requestUpdate();\n\n    this.persistingAll = false;\n  }\n\n  async preparePersistRec(node: DocNode, defaultAuthority: string, message?: string) {\n    const prepareChildren = node.childrenNodes.map(child =>\n      this.preparePersistRec(child, defaultAuthority, message)\n    );\n    await Promise.all(prepareChildren);\n\n    /** set the children with the children refs (which were created above) */\n    const { object } = node.hasChildren.replaceChildrenLinks({\n      id: '',\n      object: node.draft\n    })(node.childrenNodes.map(node => node.uref));\n    this.setNodeDraft(node, object);\n\n    await this.preparePersist(node, defaultAuthority, message);\n  }\n\n  async derivePerspective(node: DocNode): Promise<Secured<Perspective>> {\n    const remoteInstance = this.remotes.find(r => r.id == node.remote);\n\n    if (!remoteInstance) throw new Error(`Remote not found for remote ${remoteInstance}`);\n\n    const creatorId = remoteInstance.userId ? remoteInstance.userId : '';\n\n    const context = await hashObject({\n      creatorId,\n      timestamp: node.timestamp\n    });\n\n    const perspective: Perspective = {\n      creatorId,\n      remote: remoteInstance.id,\n      path: remoteInstance.defaultPath,\n      timestamp: node.timestamp,\n      context\n    };\n\n    return deriveSecured<Perspective>(perspective, remoteInstance.store.cidConfig);\n  }\n\n  /* bottom up traverse the tree to set the uref of all placeholders */\n  async preparePersist(node: DocNode, defaultRemote: string, message?: string) {\n    if (!node.isPlaceholder) {\n      return;\n    }\n\n    switch (this.defaultType) {\n      case EveesModule.bindings.PerspectiveType:\n        node.remote = node.remote !== undefined ? node.remote : defaultRemote;\n        const secured = await this.derivePerspective(node);\n        node.uref = secured.id;\n        node.type = EveesModule.bindings.PerspectiveType;\n        break;\n\n      case EveesModule.bindings.CommitType:\n        throw new Error('TBD');\n      // const secured = await this.deriveCommit(node);\n      // node.uref = commitId;\n      // node.type = EveesModule.bindings.CommitType;\n      // break;\n\n      default:\n        throw new Error('TBD');\n      // const dataId = await this.createEntity(node.draft, node.remote);\n      // node.uref = dataId;\n      // break;\n    }\n  }\n\n  /* top down persist all new nodes in their backend */\n  async persistRec(node: DocNode) {\n    await this.persist(node);\n\n    const persistChildren = node.childrenNodes.map(child => this.persistRec(child));\n    await Promise.all(persistChildren);\n  }\n\n  async persist(node: DocNode, message: string = '') {\n    if (!node.isPlaceholder && node.data !== undefined && isEqual(node.data.object, node.draft)) {\n      /** nothing to persist here */\n      return;\n    }\n\n    switch (node.type) {\n      case EveesModule.bindings.PerspectiveType:\n        if (node.isPlaceholder) {\n          const perspectiveId = await this.createEvee(node);\n          if (perspectiveId !== node.uref) {\n            throw new Error(\n              `perspective id ${perspectiveId} of doc node not as expected ${node.uref}`\n            );\n          }\n        } else {\n          await this.updateEvee(node, message);\n        }\n        break;\n\n      case EveesModule.bindings.CommitType:\n        const commitParents = this.isPlaceholder(node.uref) ? [] : node.headId ? [node.headId] : [];\n\n        if (node.remote === undefined) throw new Error('undefined remote for node');\n\n        const commitId = await this.createCommit(node.draft, node.remote, commitParents, message);\n\n        if (commitId !== node.uref) {\n          throw new Error(`commit id ${commitId} of doc node not as expected ${node.uref}`);\n        }\n        break;\n    }\n\n    await this.draftService.removeDraft(node.placeholderRef ? node.placeholderRef : node.uref);\n  }\n\n  async createEntity(content: any, remote: string): Promise<string> {\n    const entityType = this.recognizer.recognizeType({\n      id: '',\n      object: content\n    });\n\n    const remoteInstance = this.remotes.find(r => r.id === remote);\n    if (!remoteInstance) throw new Error(`Remote not found for remote ${remote}`);\n    const store = remoteInstance.store;\n\n    const createTextNode = await this.client.mutate({\n      mutation: CREATE_ENTITY,\n      variables: {\n        object: content,\n        casID: store.casID\n      }\n    });\n\n    return createTextNode.data.createEntity.id;\n  }\n\n  async createCommit(\n    content: object,\n    remote: string,\n    parentsIds?: string[],\n    message?: string\n  ): Promise<string> {\n    const dataId = await this.createEntity(content, remote);\n\n    const remoteInstance = this.remotes.find(r => r.id === remote);\n    if (!remoteInstance) throw new Error(`Remote not found for remote ${remote}`);\n\n    return await EveesHelpers.createCommit(this.client, remoteInstance.store, {\n      dataId,\n      parentsIds\n    });\n  }\n\n  async updateEvee(node: DocNode, message?: string): Promise<void> {\n    if (node.remote === undefined) throw Error(`remote not defined for node ${node.uref}`);\n\n    const commitId = await this.createCommit(\n      node.draft,\n      node.remote,\n      node.headId ? [node.headId] : []\n    );\n\n    await this.client.mutate({\n      mutation: UPDATE_HEAD,\n      variables: {\n        perspectiveId: node.uref,\n        headId: commitId,\n        message\n      }\n    });\n\n    /** inform the external world if top element */\n    if (this.doc && node.uref === this.doc.uref) {\n      this.dispatchEvent(\n        new ContentUpdatedEvent({\n          bubbles: true,\n          composed: true,\n          detail: { uref: this.uref as string }\n        })\n      );\n    }\n  }\n\n  async createEvee(node: DocNode): Promise<string> {\n    if (node.remote === undefined) throw new Error('undefined remote for node');\n\n    if (LOGINFO) this.logger.log('createEvee()', { node });\n\n    const commitId = await this.createCommit(node.draft, node.remote);\n\n    const remoteInstance = this.remotes.find(r => r.id === node.remote);\n    if (!remoteInstance) throw new Error(`Remote not found for remote ${node.remote}`);\n\n    // using the same function used in preparePersist to get the same id\n    const secured = await this.derivePerspective(node);\n\n    return EveesHelpers.createPerspective(this.client, remoteInstance, {\n      ...secured.object.payload,\n      headId: commitId,\n      parentId: node.parent ? node.parent.uref : undefined\n    });\n  }\n\n  draftToPlaceholder(draft: any, parent?: DocNode, ix?: number): DocNode {\n    const draftForReco = { id: '', object: draft };\n    const hasChildren = this.recognizer\n      .recognizeBehaviours(draftForReco)\n      .find(b => (b as HasChildren).getChildrenLinks);\n\n    const hasDocNodeLenses = this.recognizer\n      .recognizeBehaviours(draftForReco)\n      .find(b => (b as HasDocNodeLenses).docNodeLenses);\n\n    if (!hasChildren)\n      throw new Error(`hasChildren not found for object ${JSON.stringify(draftForReco)}`);\n    if (!hasDocNodeLenses)\n      throw new Error(`hasDocNodeLenses not found for object ${JSON.stringify(draftForReco)}`);\n\n    const randint = 0 + Math.floor((10000 - 0) * Math.random());\n    const uref = PLACEHOLDER_TOKEN + `-${ix !== undefined ? ix : 0}-${randint}`;\n\n    // Add node coordinates\n    const coord = this.setNodeCoordinates(parent, ix);\n\n    // Add node level\n    const level = this.setNodeLevel(coord);\n\n    return {\n      uref,\n      placeholderRef: uref,\n      isPlaceholder: true,\n      ix,\n      parent,\n      draft,\n      coord,\n      level,\n      childrenNodes: [],\n      hasChildren,\n      hasDocNodeLenses,\n      editable: true,\n      focused: false,\n      timestamp: Date.now()\n    };\n  }\n\n  createPlaceholder(draft: any, parent?: DocNode, ix?: number): DocNode {\n    const node = this.draftToPlaceholder(draft, parent, ix);\n    /** async store */\n    this.draftService.setDraft(node.uref, node.draft);\n    return node;\n  }\n\n  setNodeDraft(node, draft) {\n    node.draft = draft;\n    /** async store */\n    this.draftService.setDraft(node.uref, draft);\n  }\n\n  /** node updated as reference */\n  async spliceChildren(\n    node: DocNode,\n    elements: any[] = [],\n    index?: number,\n    count: number = 0\n  ): Promise<DocNode[]> {\n    if (LOGINFO) this.logger.log('spliceChildren()', { node, elements, index, count });\n\n    const currentChildren = node.hasChildren.getChildrenLinks({\n      id: '',\n      object: node.draft\n    });\n    index = index !== undefined ? index : currentChildren.length;\n\n    /** create objects if elements is not an id */\n    const getNewNodes = elements.map((el, ix) => {\n      const elIndex = (index as number) + ix;\n      if (typeof el !== 'string') {\n        if (el.object !== undefined && el.entityType !== undefined) {\n          /** element is an object from which a DocNode should be create */\n          const placeholder = this.createPlaceholder(el.object, node, elIndex);\n          return Promise.resolve(placeholder);\n        } else {\n          /** element is a DocNode */\n          return Promise.resolve(el);\n        }\n      } else {\n        /** element is a string (a uref) */\n        return this.loadNodeRec(el, elIndex, node);\n      }\n    });\n\n    const newNodes = await Promise.all(getNewNodes);\n\n    let newChildren = [...currentChildren];\n    newChildren.splice(index, count, ...newNodes.map(node => node.uref));\n    const removed = node.childrenNodes.splice(index, count, ...newNodes);\n\n    /** update ix and parent of child nodes */\n    node.childrenNodes.map((child, ix) => {\n      child.ix = ix;\n      child.parent = node;\n      child.coord = node.coord.concat(ix);\n      child.level = node.level + 1;\n    });\n\n    const { object } = node.hasChildren.replaceChildrenLinks({\n      id: '',\n      object: node.draft\n    })(newChildren);\n    this.setNodeDraft(node, object);\n\n    return removed;\n  }\n\n  /** explore node children at path until the last child of the last child is find\n   * and returns the path to that element */\n  getLastChild(node: DocNode) {\n    let child = node;\n    while (child.childrenNodes.length > 0) {\n      child = child.childrenNodes[child.childrenNodes.length - 1];\n    }\n    return child;\n  }\n\n  getNextSiblingOf(node: DocNode): DocNode | undefined {\n    if (!node.parent) return undefined;\n    if (node.ix === undefined) return undefined;\n\n    if (node.ix === node.parent.childrenNodes.length - 1) {\n      /** this is the last child of its parent */\n      return undefined;\n    } else {\n      /** return the next  */\n      return node.parent.childrenNodes[node.ix + 1];\n    }\n  }\n\n  /** find the next sibling of the parent with a next sibling */\n  getNextSiblingOfLastParent(node: DocNode): DocNode | undefined {\n    let parent = node.parent;\n\n    let nextSibling = parent ? this.getNextSiblingOf(parent) : undefined;\n\n    while (parent && !nextSibling) {\n      parent = parent.parent;\n      nextSibling = parent ? this.getNextSiblingOf(parent) : undefined;\n    }\n\n    return nextSibling;\n  }\n\n  /** the tree of nodes is falttened, this gets the upper node in that flat list */\n  getDownwardNode(node: DocNode): DocNode | undefined {\n    if (node.childrenNodes.length > 0) {\n      /** downward is the first child */\n      return node.childrenNodes[0];\n    } else {\n      let nextSibling = this.getNextSiblingOf(node);\n      if (nextSibling) {\n        return nextSibling;\n      } else {\n        return this.getNextSiblingOfLastParent(node);\n      }\n    }\n  }\n\n  getBackwardNode(node: DocNode): DocNode | undefined {\n    if (node.ix === undefined) throw new Error('Node dont have an ix');\n\n    if (node.ix === 0) {\n      /** backward is the parent */\n      return node.parent;\n    } else {\n      /** backward is the last child of the upper sybling */\n      if (!node.parent) return undefined;\n      return this.getLastChild(node.parent.childrenNodes[node.ix - 1]);\n    }\n  }\n\n  async createChild(node: DocNode, newEntity: any, entityType: string, index?: number) {\n    if (LOGINFO) this.logger.log('createChild()', { node, newEntity, entityType, index });\n\n    await this.spliceChildren(node, [{ object: newEntity, entityType }], 0);\n\n    /** focus child */\n    const child = node.childrenNodes[0];\n\n    if (child.parent) {\n      child.parent.focused = false;\n    }\n    child.focused = true;\n\n    this.requestUpdate();\n  }\n\n  async createSibling(node: DocNode, newEntity: any, entityType: string) {\n    if (!node.parent) throw new Error('Node dont have a parent');\n    if (node.ix === undefined) throw new Error('Node dont have an ix');\n\n    if (LOGINFO) this.logger.log('createSibling()', { node, newEntity, entityType });\n\n    await this.spliceChildren(node.parent, [{ object: newEntity, entityType }], node.ix + 1);\n\n    /** focus sibling */\n    const sibling = node.parent.childrenNodes[node.ix + 1];\n    node.focused = false;\n    sibling.focused = true;\n\n    this.requestUpdate();\n  }\n\n  focused(node: DocNode) {\n    if (LOGINFO) this.logger.log('focused()', { node });\n    node.focused = true;\n    this.requestUpdate();\n  }\n\n  blured(node: DocNode) {\n    if (LOGINFO) this.logger.log('blured()', { node });\n    node.focused = false;\n    this.requestUpdate();\n  }\n\n  focusBackward(node: DocNode) {\n    if (LOGINFO) this.logger.log('focusBackward()', { node });\n\n    const backwardNode = this.getBackwardNode(node);\n    if (!backwardNode) return;\n\n    node.focused = false;\n    backwardNode.focused = true;\n    this.requestUpdate();\n  }\n\n  focusDownward(node: DocNode) {\n    if (LOGINFO) this.logger.log('focusDownward()', { node });\n\n    const downwardNode = this.getDownwardNode(node);\n    if (!downwardNode) return;\n\n    node.focused = false;\n    downwardNode.focused = true;\n    this.requestUpdate();\n  }\n\n  async contentChanged(node: DocNode, content: any, lift?: boolean) {\n    if (LOGINFO) this.logger.log('contentChanged()', { node, content });\n\n    const oldType = node.draft.type;\n\n    this.setNodeDraft(node, content);\n\n    /** react to type change by manipulating the tree */\n    /** PAR => TITLE */\n    if (oldType === TextType.Paragraph && content.type === TextType.Title) {\n      if (lift === undefined || lift === false) {\n        await this.nestAfter(node);\n      } else {\n        if (!node.parent) throw new Error('parent undefined');\n        await this.nestAfter(node);\n        await this.liftChildren(node.parent, node.ix, 1);\n      }\n    }\n\n    /** TITLE => PAR */\n    if (oldType === TextType.Title && content.type === TextType.Paragraph) {\n      /** remove this node children */\n      const children = await this.spliceChildren(node, [], 0, node.childrenNodes.length);\n      /** append backwards this node with its children as siblings */\n      await this.appendBackwards(node, '', [node].concat(children));\n    }\n\n    this.requestUpdate();\n  }\n\n  /** take all next syblings of node and nest them under it */\n  async nestAfter(node: DocNode) {\n    if (!node.parent) return;\n    if (node.ix === undefined) return;\n\n    const ix = node.ix;\n    const ixNext = ix + 1;\n    const deltaWithChidren = node.parent.childrenNodes\n      .slice(ixNext)\n      .findIndex(sibling => sibling.childrenNodes.length > 0);\n\n    /** remove next siblings (until the first sibling with childs is found) from parent */\n    const removed = await this.spliceChildren(\n      node.parent,\n      [],\n      ixNext,\n      deltaWithChidren !== -1 ? deltaWithChidren : node.parent.childrenNodes.length - ixNext\n    );\n\n    /** add them as child of this node */\n    await this.spliceChildren(node, removed);\n  }\n\n  async liftChildren(node: DocNode, index?: number, count?: number) {\n    if (!node.parent) throw new Error('parent undefined');\n    if (node.ix === undefined) throw new Error('ix undefined');\n\n    /** default to all children */\n    index = index !== undefined ? index : 0;\n    count = count !== undefined ? count : node.childrenNodes.length;\n\n    /** remove children */\n    const removed = await this.spliceChildren(node, [], index, count);\n\n    /** add to parent */\n    await this.spliceChildren(node.parent, removed, node.ix + 1);\n  }\n\n  /** content is appended to the node, elements are added as silblings */\n  async appendBackwards(node: DocNode, content: any, elements: DocNode[]) {\n    const backwardNode = this.getBackwardNode(node);\n    if (!backwardNode) throw new Error('backward node not found');\n\n    if (node.parent === undefined) throw new Error('cant remove node');\n    if (node.ix === undefined) throw new Error('cant remove node');\n\n    /** set the content to append to the backward node */\n    backwardNode.append = content;\n    /** remove this node */\n    await this.spliceChildren(node.parent, [], node.ix, 1);\n\n    if (elements.length > 0) {\n      if (backwardNode.parent !== undefined) {\n        if (backwardNode.ix === undefined) throw new Error('cant append elements');\n        /** add elements as siblings of backward node */\n        await this.spliceChildren(backwardNode.parent, elements, backwardNode.ix + 1);\n      } else {\n        /** add elements as children of backward node */\n        await this.spliceChildren(backwardNode, elements, 0);\n      }\n    }\n\n    backwardNode.focused = true;\n    node.focused = false;\n  }\n\n  appended(node: DocNode) {\n    node.append = undefined;\n    this.requestUpdate();\n  }\n\n  async joinBackward(node: DocNode, tail: string) {\n    if (LOGINFO) this.logger.log('joinBackward()', { node, tail });\n\n    /** remove this node children */\n    const removed = await this.spliceChildren(node, [], 0, node.childrenNodes.length);\n    await this.appendBackwards(node, tail, removed);\n\n    this.requestUpdate();\n  }\n\n  async pullDownward(node: DocNode) {\n    if (LOGINFO) this.logger.log('pullDownward()', { node });\n\n    const next = this.getDownwardNode(node);\n    if (!next) return;\n\n    await this.joinBackward(next, next.draft.text);\n    this.requestUpdate();\n  }\n\n  async lift(node: DocNode) {\n    if (!node.parent) throw new Error('parent undefined');\n    if (node.ix === undefined) throw new Error('ix undefined');\n\n    await this.liftChildren(node.parent, node.ix, 1);\n\n    this.requestUpdate();\n  }\n\n  async split(node: DocNode, tail: string, asChild: boolean) {\n    if (LOGINFO) this.logger.log('split()', { node, tail });\n\n    const dftEntity = this.defaultEntity(tail, TextType.Paragraph);\n\n    if (asChild) {\n      await this.createChild(node, dftEntity.data, dftEntity.entityType, 0);\n    } else {\n      await this.createSibling(node, dftEntity.data, dftEntity.entityType);\n    }\n\n    this.requestUpdate();\n  }\n\n  isNodeFocused() {\n    if (!this.doc) return false;\n    return this.isNodeFocusedRec(this.doc);\n  }\n\n  isNodeFocusedRec(node: DocNode): boolean {\n    if (node.focused) {\n      return true;\n    } else {\n      for (let ix = 0; ix < node.childrenNodes.length; ix++) {\n        if (this.isNodeFocusedRec(node.childrenNodes[ix])) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  getLastNode(): DocNode | undefined {\n    if (!this.doc) return undefined;\n    return this.getLastNodeRec(this.doc);\n  }\n\n  getLastNodeRec(node: DocNode): DocNode {\n    if (node.childrenNodes.length === 0) {\n      return node;\n    } else {\n      return this.getLastNodeRec(node.childrenNodes[node.childrenNodes.length - 1]);\n    }\n  }\n\n  clickAreaClicked() {\n    if (!this.isNodeFocused()) {\n      const last = this.getLastNode();\n      if (last !== undefined) {\n        last.focused = true;\n      }\n    }\n    this.requestUpdate();\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n\n    this.addEventListener('checkout-perspective', ((event: CustomEvent) => {\n      event.stopPropagation();\n      this.uref = event.detail.perspectiveId;\n    }) as EventListener);\n\n    this.addEventListener('keydown', ((event: KeyboardEvent) => {\n      if (event.ctrlKey && event.key === 's') {\n        event.preventDefault();\n        event.stopPropagation();\n        this.persistAll();\n      }\n    }) as EventListener);\n  }\n\n  commitWithMessageClicked() {\n    this.showCommitMessage = true;\n  }\n\n  cancelCommitClicked() {\n    this.showCommitMessage = false;\n  }\n\n  acceptCommitClicked() {\n    if (!this.shadowRoot) return;\n    const input = this.shadowRoot.getElementById('COMMIT_MESSAGE') as any;\n    const message = input.value;\n\n    this.showCommitMessage = false;\n\n    this.persistAll(message);\n  }\n\n  handleNodePerspectiveCheckout(e: CustomEvent, node: DocNode) {\n    if (node.coord.length === 1 && node.coord[0] === 0) {\n      /** if this is the top element, let the parent handle this */\n      return;\n    }\n\n    e.stopPropagation();\n\n    this.checkedOutPerspectives[JSON.stringify(node.coord)] = {\n      firstUref: node.uref,\n      newUref: e.detail.perspectiveId\n    };\n\n    this.requestUpdate();\n  }\n\n  handleEditorPerspectiveCheckout(e: CustomEvent, node: DocNode) {\n    // we are in the parent document editor\n\n    e.stopPropagation();\n\n    const nodeCoord = JSON.stringify(node.coord);\n\n    if (this.checkedOutPerspectives[nodeCoord] !== undefined) {\n      if (this.checkedOutPerspectives[nodeCoord].firstUref === e.detail.perspectiveId) {\n        delete this.checkedOutPerspectives[nodeCoord];\n      } else {\n        this.checkedOutPerspectives[nodeCoord].newUref = e.detail.perspectiveId;\n      }\n    }\n\n    this.requestUpdate();\n  }\n\n  dragOverEffect(e, node: DocNode) {\n    e.preventDefault();\n    e.dataTransfer.dropEffect = 'move';\n  }\n\n  async handleDrop(e, node: DocNode) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const dragged = JSON.parse(e.dataTransfer.getData('text/plain'));\n\n    if (!dragged.uref) return;\n    if (dragged.parentId === this.uref) return;\n    if (node.parent === undefined) return;\n\n    const ix = node.ix !== undefined ? node.ix : node.parent.childrenNodes.length - 1;\n    await this.spliceChildren(node.parent, [dragged.uref], ix + 1, 0);\n\n    this.requestUpdate();\n  }\n\n  getColor() {\n    return this.color ? this.color : eveeColor(this.uref);\n  }\n\n  renderWithCortex(node: DocNode) {\n    return html`\n      <cortex-entity hash=${node.uref}></cortex-entity>\n    `;\n  }\n\n  renderTopRow(node: DocNode) {\n    if (LOGINFO) this.logger.log('renderTopRow()', { node });\n    /** the uref to which the parent is pointing at */\n\n    const nodeLense = node.hasDocNodeLenses.docNodeLenses()[0];\n    const hasIcon = this.hasChanges(node);\n    const icon = node.uref === '' ? icons.add_box : icons.edit;\n\n    // for the topNode (the docId), the uref can change, for the other nodes it can't (if it does, a new editor is rendered)\n    const uref = node.coord.length === 1 && node.coord[0] === 0 ? this.uref : node.uref;\n    const firstRef = node.coord.length === 1 && node.coord[0] === 0 ? this.firstRef : node.uref;\n\n    let paddingTop = '0px';\n    if (node.draft.type === TextType.Title) {\n      switch (node.level) {\n        case 0:\n          paddingTop = '20px';\n          break;\n        case 1:\n          paddingTop = '14px';\n          break;\n        case 2:\n          paddingTop = '10px';\n          break;\n        default:\n          paddingTop = '0px';\n          break;\n      }\n    }\n\n    return html`\n      <div\n        class=\"row\"\n        @dragover=${e => this.dragOverEffect(e, node)}\n        @drop=${e => this.handleDrop(e, node)}\n      >\n        <div class=\"evee-info\" style=${`padding-top:${paddingTop}`}>\n          ${!node.isPlaceholder && this.renderInfo\n            ? html`\n                <evees-info-popper\n                  parent-id=${node.parent ? node.parent.uref : this.parentId}\n                  uref=${uref}\n                  first-uref=${firstRef}\n                  official-owner=${this.officialOwner}\n                  ?check-owner=${this.checkOwner}\n                  evee-color=${this.getColor()}\n                  @checkout-perspective=${e => this.handleNodePerspectiveCheckout(e, node)}\n                  show-draft\n                  show-info\n                  show-icon\n                  ?show-debug=${false}\n                  emit-proposals\n                ></evees-info-popper>\n              `\n            : html`\n                <div class=\"empty-evees-info\"></div>\n              `}\n        </div>\n        <div class=\"node-content\">\n          ${nodeLense.render(node, {\n            focus: () => this.focused(node),\n            blur: () => this.blured(node),\n            contentChanged: (content: any, lift: boolean) =>\n              this.contentChanged(node, content, lift),\n            focusBackward: () => this.focusBackward(node),\n            focusDownward: () => this.focusDownward(node),\n            joinBackward: (tail: string) => this.joinBackward(node, tail),\n            pullDownward: () => this.pullDownward(node),\n            lift: () => this.lift(node),\n            split: (tail: string, asChild: boolean) => this.split(node, tail, asChild),\n            appended: () => this.appended(node)\n          })}\n          ${hasIcon\n            ? html`\n                <div class=\"node-mark\">${icon}</div>\n              `\n            : ''}\n        </div>\n      </div>\n    `;\n  }\n\n  renderHere(node: DocNode) {\n    return html`\n      ${this.renderTopRow(node)}\n      ${node.childrenNodes\n        ? node.childrenNodes.map(child => {\n            return this.renderDocNode(child);\n          })\n        : ''}\n    `;\n  }\n\n  renderDocNode(node: DocNode) {\n    const coordString = JSON.stringify(node.coord);\n\n    if (this.checkedOutPerspectives[coordString] !== undefined) {\n      return html`\n        <documents-editor\n          uref=${this.checkedOutPerspectives[coordString].newUref}\n          ?read-only=${this.readOnly}\n          root-level=${node.level}\n          color=${this.getColor()}\n          @checkout-perspective=${e => this.handleEditorPerspectiveCheckout(e, node)}\n          official-owner=${this.officialOwner}\n          ?check-owner=${this.checkOwner}\n          show-draft\n          show-info\n          show-icon\n          ?show-debug=${false}\n        >\n        </documents-editor>\n      `;\n    }\n\n    return html`\n      <div\n        style=${styleMap({\n          backgroundColor: node.focused ? SELECTED_BACKGROUND : 'transparent'\n        })}\n      >\n        ${node.hasDocNodeLenses.docNodeLenses().length > 0\n          ? this.renderHere(node)\n          : this.renderWithCortex(node)}\n      </div>\n    `;\n  }\n\n  commitOptionSelected(e) {\n    switch (e.detail.key) {\n      case 'push':\n        this.persistAll();\n        break;\n\n      case 'push-with-message':\n        this.commitWithMessageClicked();\n        break;\n    }\n  }\n\n  renderTopBar() {\n    const options: MenuConfig = {\n      'push-with-message': {\n        icon: 'notes',\n        text: 'push with message'\n      }\n    };\n    return html`\n      <div class=\"doc-topbar\">\n        ${this.docHasChanges && !this.showCommitMessage\n          ? html`\n              <uprtcl-button-loading\n                icon=\"unarchive\"\n                @click=${() => this.persistAll()}\n                ?loading=${this.persistingAll}\n              >\n                push\n              </uprtcl-button-loading>\n              <uprtcl-help>\n                <span>\n                  Your current changes are safely stored on this device and won't be lost.<br /><br />\n                  \"Push\" them if<br /><br />\n                  <li>You are about to propose a merge.</li>\n                  <br />\n                  <li>\n                    This draft is public and you want them to be visible to others.\n                  </li>\n                </span>\n              </uprtcl-help>\n            `\n          : ''}\n        ${this.showCommitMessage\n          ? html`\n              <uprtcl-textfield id=\"COMMIT_MESSAGE\" label=\"Message\"> </uprtcl-textfield>\n              <uprtcl-icon-button icon=\"clear\" @click=${this.cancelCommitClicked} button>\n              </uprtcl-icon-button>\n              <uprtcl-icon-button icon=\"done\" @click=${this.acceptCommitClicked} button>\n              </uprtcl-icon-button>\n            `\n          : ''}\n      </div>\n    `;\n  }\n\n  render() {\n    if (LOGINFO) this.logger.log('render()', { doc: this.doc });\n\n    if (this.reloading || this.doc === undefined) {\n      return html`\n        <uprtcl-loading></uprtcl-loading>\n      `;\n    }\n\n    const editorClasses = ['editor-container'];\n\n    if (!this.readOnly) {\n      editorClasses.concat(['padding-bottom']);\n    }\n\n    return html`\n      <div class=${editorClasses.join(' ')}>\n        ${this.renderTopBar()} ${this.renderDocNode(this.doc)}\n      </div>\n      <div @click=${this.clickAreaClicked} class=\"click-area\"></div>\n    `;\n  }\n\n  static get styles() {\n    return css`\n      :host {\n        flex-grow: 1;\n        display: flex;\n        flex-direction: column;\n        text-align: left;\n      }\n      .editor-container {\n        position: relative;\n        width: 100%;\n      }\n      .padding-bottom {\n        padding-bottom: 20vh;\n      }\n      .click-area {\n        flex-grow: 1;\n      }\n      .doc-topbar {\n        position: absolute;\n        top: 16px;\n        right: 16px;\n        display: flex;\n        z-index: 2;\n      }\n      .doc-topbar uprtcl-button-loading {\n        opacity: 0.9;\n        margin-right: 6px;\n        width: 90px;\n      }\n\n      .row {\n        margin-bottom: 8px;\n        display: flex;\n        flex-direction: row;\n      }\n\n      .evee-info {\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n      }\n\n      .empty-evees-info {\n        width: 30px;\n        height: 10px;\n      }\n\n      .node-content {\n        flex: 1 1 0;\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n        position: relative;\n        padding-right: 4px;\n      }\n\n      .node-mark {\n        position: absolute;\n        top: 0px;\n        left: 0px;\n        height: 100%;\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n        fill: rgb(80, 80, 80, 0.2);\n      }\n\n      .node-mark svg {\n        height: 14px;\n        width: 14px;\n      }\n\n      @media (max-width: 768px) {\n        .doc-topbar {\n          display: none;\n        }\n      }\n    `;\n  }\n}\n","import { LitElement, property, html, css } from 'lit-element';\n\nimport { moduleConnect, Logger } from '@uprtcl/micro-orchestrator';\nimport { Entity } from '@uprtcl/cortex';\nimport { EveesWorkspace } from '@uprtcl/evees';\n\nimport { TextNode } from '../types';\n\nconst LOGINFO = true;\n\nexport class TextNodeDiff extends moduleConnect(LitElement) {\n  logger = new Logger('EVEES-DIFF');\n\n  @property({ type: Boolean })\n  summary: boolean = false;\n\n  @property({ attribute: false })\n  workspace!: EveesWorkspace;\n\n  @property({ attribute: false })\n  newData!: Entity<TextNode>;\n\n  @property({ attribute: false })\n  oldData!: Entity<TextNode>;\n\n  async firstUpdated() {\n    this.logger.log('firstUpdated()', {\n      newData: this.newData,\n      oldData: this.oldData\n    });\n  }\n\n  render() {\n    if (this.newData === undefined || this.oldData === undefined) {\n      return html`\n        <uprtcl-loading></uprtcl-loading>\n      `;\n    }\n\n    return html`\n      <div class=\"page-edited-title\">Updated</div>\n      <div class=\"document-container old-page\">\n        <documents-editor\n          .client=${this.workspace.workspace}\n          uref=${this.oldData.id}\n          read-only\n        ></documents-editor>\n      </div>\n      <div class=\"document-container new-page\">\n        <documents-editor\n          .client=${this.workspace.workspace}\n          uref=${this.newData.id}\n          read-only\n        ></documents-editor>\n      </div>\n    `;\n  }\n\n  static get styles() {\n    return css`\n      :host {\n        text-align: left;\n      }\n      .page-edited-title {\n        font-weight: bold;\n        margin-bottom: 9px;\n        color: gray;\n      }\n      .document-container {\n        padding: 2vw;\n        border-radius: 3px;\n        margin-bottom: 16px;\n      }\n      .editor-container {\n        border-radius: 3px;\n      }\n      .new-page {\n        background-color: #abdaab;\n      }\n      .old-page {\n        background-color: #dab6ab;\n      }\n    `;\n  }\n}\n","import { interfaces } from 'inversify';\n\nimport { PatternsModule } from '@uprtcl/cortex';\nimport { GraphQlSchemaModule } from '@uprtcl/graphql';\nimport { i18nextModule } from '@uprtcl/micro-orchestrator';\nimport { EveesContentModule } from '@uprtcl/evees';\nimport { CommonUIModule } from '@uprtcl/common-ui';\n\nimport {\n  TextNodeCommon,\n  TextNodeTitle,\n  TextNodePattern,\n} from './patterns/text-node.pattern';\nimport { documentsTypeDefs } from './graphql/schema';\n\nimport en from './i18n/en.json';\nimport { DocumentTextNodeEditor } from './elements/prosemirror/documents-text-node-editor';\nimport { DocumentsBindings } from './bindings';\nimport { DocumentEditor } from './elements/document-editor';\nimport { TextNodeDiff } from './elements/document-text-node-diff';\n\n/**\n * Configure a documents module with the given stores\n *\n * Depends on these modules being present: LensesModule, CortexModule, DiscoveryModule, i18nBaseModule\n *\n * Example usage:\n *\n * ```ts\n * import { IpfsStore } from '@uprtcl/ipfs-provider';\n * import { DocumentsModule } from '@uprtcl/documents';\n *\n * const ipfsStore = new IpfsStore({\n *   host: 'ipfs.infura.io',\n *   port: 5001,\n *   protocol: 'https'\n * });\n *\n * const docs = new DocumentsModule([ ipfsStore ]);\n * await orchestrator.loadModule(docs);\n * ```\n *\n * @param stores an array of CASStores in which the documents objects can be stored/retrieved from\n */\nexport class DocumentsModule extends EveesContentModule {\n  static id = 'documents-module';\n\n  static bindings = DocumentsBindings;\n\n  providerIdentifier = DocumentsBindings.DocumentsRemote;\n\n  async onLoad(container: interfaces.Container) {\n    super.onLoad(container);\n    customElements.define('documents-text-node-editor', DocumentTextNodeEditor);\n    customElements.define('documents-editor', DocumentEditor);\n    customElements.define('documents-text-node-diff', TextNodeDiff);\n  }\n\n  get submodules() {\n    return [\n      ...super.submodules,\n      new GraphQlSchemaModule(documentsTypeDefs, {}),\n      new i18nextModule('documents', { en: en }),\n      new PatternsModule([\n        new TextNodePattern([TextNodeCommon, TextNodeTitle]),\n      ]),\n      new CommonUIModule(),\n    ];\n  }\n}\n"],"names":["TextType","Pattern","recognizeEntity","TextNodeCommon","html","mergeResult","injectable","TextNodeTitle","gql","css","CodeMirror","TextSelection","Selection","styles","Schema","nodes","emDOM","marks","LitElement","Logger","toggleMark","DOMParser","DOMSerializer","EditorState","EditorView","setBlockType","cmStyle","theme","property","moduleConnect","EveesModule","EveesDraftsLocal","CortexModule","ApolloClientModule","loadEntity","EveesHelpers","isEqual","hashObject","deriveSecured","CREATE_ENTITY","UPDATE_HEAD","ContentUpdatedEvent","eveeColor","EveesWorkspace","EveesContentModule","GraphQlSchemaModule","i18nextModule","PatternsModule","CommonUIModule"],"mappings":"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"}