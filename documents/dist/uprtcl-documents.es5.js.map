{"version":3,"file":"uprtcl-documents.es5.js","sources":["../src/types.ts","../src/bindings.ts","../src/support/documents.support.ts","../src/patterns/text-node.pattern.ts","../src/graphql/schema.ts","../src/elements/prosemirror/codemirror.css.ts","../src/elements/prosemirror/codeview.ts","../src/elements/prosemirror/icons.ts","../src/elements/prosemirror/icons.css.ts","../src/elements/prosemirror/prosemirror.css.ts","../src/elements/prosemirror/lesser-dark.css.ts","../src/elements/prosemirror/schema-block.ts","../src/elements/prosemirror/schema-title.ts","../src/elements/prosemirror/documents-text-node-editor.ts","../src/elements/document-editor.ts","../src/elements/document-text-node-diff.ts","../src/documents.module.ts"],"sourcesContent":["import { Entity, HasChildren } from '@uprtcl/cortex';\nimport { HasDocNodeLenses } from './patterns/document-patterns';\n\nexport enum TextType {\n  Title = 'Title',\n  Paragraph = 'Paragraph'\n}\n\nexport interface TextNode {\n  text: string;\n  type: TextType;\n  links: string[];\n}\n\nexport interface DocNode {\n  uref: string;\n  isPlaceholder: boolean;\n  placeholderRef?: string;\n  remote?: string;\n  context?: string;\n  data?: Entity<any>;\n  draft: any;\n  type?: string;\n  timestamp: number;\n  coord: number[];\n  level: number;\n  append?: any; // used by upper layer to tell the docnode lense to append content using its internal appending logic.\n  childrenNodes: DocNode[];\n  headId?: string;\n  editable: boolean;\n  parent?: DocNode;\n  ix?: number; // ix on parent\n  focused: boolean;\n  hasDocNodeLenses: HasDocNodeLenses;\n  hasChildren: HasChildren;\n}\n\nexport interface DocNodeEventsHandlers {\n  focus: () => void;\n  blur: () => void;\n  contentChanged: (newContent: any, lift: boolean) => void;\n  split: (tail: string, asChild: boolean) => void;\n  joinBackward: (tail: string) => void;\n  pullDownward: () => void;\n  focusBackward: () => void;\n  focusDownward: () => void;\n  lift: () => void;\n  appended: () => void;\n}\n","export const DocumentsBindings = {\n  TextNodeType: 'TextNode',\n  DocumentsRemote: 'documents-remote',\n};\n","export const htmlToText = (textWithHtml: string): string => {\n  const temp = document.createElement('template');\n  temp.innerHTML = textWithHtml;\n\n  if (!temp.content) return 'unknown';\n  if (temp.content.textContent !== '') {\n    return temp.content.textContent != null ? temp.content.textContent : 'unknown';\n  } else {\n    if (!temp.content.firstElementChild) return 'unknown';\n    return (temp.content.firstElementChild as HTMLElement).innerText;\n  }\n};\n","import { html } from 'lit-element';\nimport { injectable } from 'inversify';\n\nimport {\n  Pattern,\n  recognizeEntity,\n  HasChildren,\n  Entity,\n  HasTitle,\n  New,\n} from '@uprtcl/cortex';\nimport {\n  Merge,\n  MergeStrategy,\n  mergeStrings,\n  mergeResult,\n  HasDiffLenses,\n  DiffLens,\n  EveesWorkspace,\n} from '@uprtcl/evees';\nimport { Lens, HasLenses } from '@uprtcl/lenses';\n\nimport { TextNode, TextType, DocNode, DocNodeEventsHandlers } from '../types';\nimport { DocNodeLens } from './document-patterns';\nimport { DocumentsBindings } from '../bindings';\n\nconst propertyOrder = ['text', 'type', 'links'];\n\nconst textToTextNode = (textNode: TextNode, text: string): TextNode => {\n  return {\n    ...textNode,\n    text: text,\n  };\n};\n\nconst typeToTextNode = (textNode: TextNode, type: TextType): TextNode => {\n  return {\n    ...textNode,\n    type: type,\n  };\n};\n\nexport class TextNodePattern extends Pattern<Entity<TextNode>> {\n  recognize(entity: object): boolean {\n    return (\n      recognizeEntity(entity) &&\n      propertyOrder.every((p) => entity.object.hasOwnProperty(p))\n    );\n  }\n\n  type = DocumentsBindings.TextNodeType;\n}\n\n@injectable()\nexport class TextNodeCommon\n  implements\n    HasLenses<Entity<TextNode>>,\n    HasChildren<Entity<TextNode>>,\n    Merge<Entity<TextNode>> {\n  replaceChildrenLinks = (node: Entity<TextNode>) => (\n    childrenHashes: string[]\n  ): Entity<TextNode> => ({\n    id: '',\n    object: {\n      ...node.object,\n      links: childrenHashes,\n    },\n  });\n\n  getChildrenLinks = (node: Entity<TextNode>): string[] => node.object.links;\n\n  links = async (node: Entity<TextNode>) => this.getChildrenLinks(node);\n\n  lenses = (node: Entity<TextNode>): Lens[] => {\n    return [\n      {\n        name: 'documents:document',\n        type: 'content',\n        render: (entity: Entity<any>, context: any) => {\n          return html`\n            <documents-text-node .data=${node} uref=${entity.id}>\n            </documents-text-node>\n          `;\n        },\n      },\n    ];\n  };\n\n  /** lenses top is a lense that dont render the node children, leaving the job to an upper node tree controller */\n  docNodeLenses = (): DocNodeLens[] => {\n    return [\n      {\n        name: 'documents:document',\n        type: 'content',\n        render: (node: DocNode, events: DocNodeEventsHandlers) => {\n          // logger.log('lenses: documents:document - render()', { node });\n          return html`\n            <documents-text-node-editor\n              type=${node.draft.type}\n              init=${node.draft.text}\n              to-append=${node.append}\n              level=${node.level + 1}\n              editable=${node.editable ? 'true' : 'false'}\n              focus-init=${node.focused}\n              @focus=${events.focus}\n              @blur=${events.blur}\n              @content-changed=${(e) =>\n                events.contentChanged(\n                  textToTextNode(node.draft, e.detail.content),\n                  false\n                )}\n              @enter-pressed=${(e) =>\n                events.split(e.detail.content, e.detail.asChild)}\n              @backspace-on-start=${(e) =>\n                events.joinBackward(e.detail.content)}\n              @delete-on-end=${(e) => events.pullDownward()}\n              @keyup-on-start=${events.focusBackward}\n              @keydown-on-end=${events.focusDownward}\n              @lift-heading=${events.lift}\n              @change-type=${(e) =>\n                events.contentChanged(\n                  typeToTextNode(node.draft, e.detail.type),\n                  e.detail.lift\n                )}\n              @content-appended=${events.appended}\n            >\n            </documents-text-node-editor>\n          `;\n        },\n      },\n    ];\n  };\n\n  merge = (originalNode: Entity<TextNode>) => async (\n    modifications: Entity<TextNode>[],\n    mergeStrategy: MergeStrategy,\n    workspace: EveesWorkspace,\n    config: any\n  ): Promise<TextNode> => {\n    const resultText = modifications[1].object.text;\n    const resultType = mergeResult(\n      originalNode.object.type,\n      modifications.map((data) => data.object.type)\n    );\n\n    const mergedLinks = await mergeStrategy.mergeLinks(\n      originalNode.object.links,\n      modifications.map((data) => data.object.links),\n      workspace,\n      config\n    );\n\n    return {\n      text: resultText,\n      type: resultType,\n      links: mergedLinks,\n    };\n  };\n}\n\n@injectable()\nexport class TextNodeTitle implements HasTitle, HasDiffLenses {\n  title = (textNode: Entity<TextNode>) => textNode.object.text;\n\n  diffLenses = (node?: TextNode): DiffLens[] => {\n    return [\n      {\n        name: 'documents:document-diff',\n        type: 'diff',\n        render: (\n          workspace: EveesWorkspace,\n          newEntity: Entity<TextNode>,\n          oldEntity: Entity<TextNode>,\n          summary: boolean\n        ) => {\n          // logger.log('lenses: documents:document - render()', { node, lensContent, context });\n          return html`\n            <documents-text-node-diff\n              .workspace=${workspace}\n              .newData=${newEntity}\n              .oldData=${oldEntity}\n              ?summary=${summary}\n            >\n            </documents-text-node-diff>\n          `;\n        },\n      },\n    ];\n  };\n}\n","import gql from 'graphql-tag';\nimport { DocumentNode } from 'graphql';\n\nexport const documentsTypeDefs: DocumentNode = gql`\n  extend type Patterns {\n    title: String\n  }\n\n  enum TextType {\n    Title\n    Paragraph\n  }\n\n  type TextNode implements Entity {\n    id: ID!\n\n    text: String!\n    type: TextType!\n    links: [Entity]! @discover\n\n    _context: EntityContext!\n  }\n`;\n","import { css } from 'lit-element';\n\nexport const styles = css`\n  /* BASICS */\n\n  .CodeMirror {\n    /* Set height, width, borders, and global font properties here */\n    font-family: monospace;\n    height: auto;\n    color: black;\n    direction: ltr;\n    padding: 2vh 1.5vh;\n    border-radius: 5px;\n  }\n\n  /* PADDING */\n\n  .CodeMirror-lines {\n    padding: 4px 0; /* Vertical padding around content */\n  }\n  .CodeMirror pre.CodeMirror-line,\n  .CodeMirror pre.CodeMirror-line-like {\n    padding: 0 4px; /* Horizontal padding of content */\n  }\n\n  .CodeMirror-scrollbar-filler,\n  .CodeMirror-gutter-filler {\n    background-color: white; /* The little square between H and V scrollbars */\n  }\n\n  /* GUTTER */\n\n  .CodeMirror-gutters {\n    border-right: 1px solid #ddd;\n    background-color: #f7f7f7;\n    white-space: nowrap;\n  }\n  .CodeMirror-linenumbers {\n  }\n  .CodeMirror-linenumber {\n    padding: 0 3px 0 5px;\n    min-width: 20px;\n    text-align: right;\n    color: #999;\n    white-space: nowrap;\n  }\n\n  .CodeMirror-guttermarker {\n    color: black;\n  }\n  .CodeMirror-guttermarker-subtle {\n    color: #999;\n  }\n\n  /* CURSOR */\n\n  .CodeMirror-cursor {\n    border-left: 1px solid black;\n    border-right: none;\n    width: 0;\n  }\n  /* Shown when moving in bi-directional text */\n  .CodeMirror div.CodeMirror-secondarycursor {\n    border-left: 1px solid silver;\n  }\n  .cm-fat-cursor .CodeMirror-cursor {\n    width: auto;\n    border: 0 !important;\n    background: #7e7;\n  }\n  .cm-fat-cursor div.CodeMirror-cursors {\n    z-index: 1;\n  }\n  .cm-fat-cursor-mark {\n    background-color: rgba(20, 255, 20, 0.5);\n    -webkit-animation: blink 1.06s steps(1) infinite;\n    -moz-animation: blink 1.06s steps(1) infinite;\n    animation: blink 1.06s steps(1) infinite;\n  }\n  .cm-animate-fat-cursor {\n    width: auto;\n    border: 0;\n    -webkit-animation: blink 1.06s steps(1) infinite;\n    -moz-animation: blink 1.06s steps(1) infinite;\n    animation: blink 1.06s steps(1) infinite;\n    background-color: #7e7;\n  }\n  @-moz-keyframes blink {\n    0% {\n    }\n    50% {\n      background-color: transparent;\n    }\n    100% {\n    }\n  }\n  @-webkit-keyframes blink {\n    0% {\n    }\n    50% {\n      background-color: transparent;\n    }\n    100% {\n    }\n  }\n  @keyframes blink {\n    0% {\n    }\n    50% {\n      background-color: transparent;\n    }\n    100% {\n    }\n  }\n\n  /* Can style cursor different in overwrite (non-insert) mode */\n  .CodeMirror-overwrite .CodeMirror-cursor {\n  }\n\n  .cm-tab {\n    display: inline-block;\n    text-decoration: inherit;\n  }\n\n  .CodeMirror-rulers {\n    position: absolute;\n    left: 0;\n    right: 0;\n    top: -50px;\n    bottom: 0;\n    overflow: hidden;\n  }\n  .CodeMirror-ruler {\n    border-left: 1px solid #ccc;\n    top: 0;\n    bottom: 0;\n    position: absolute;\n  }\n\n  /* DEFAULT THEME */\n\n  .cm-s-default .cm-header {\n    color: blue;\n  }\n  .cm-s-default .cm-quote {\n    color: #090;\n  }\n  .cm-negative {\n    color: #d44;\n  }\n  .cm-positive {\n    color: #292;\n  }\n  .cm-header,\n  .cm-strong {\n    font-weight: bold;\n  }\n  .cm-em {\n    font-style: italic;\n  }\n  .cm-link {\n    text-decoration: underline;\n  }\n  .cm-strikethrough {\n    text-decoration: line-through;\n  }\n\n  .cm-s-default .cm-keyword {\n    color: #708;\n  }\n  .cm-s-default .cm-atom {\n    color: #219;\n  }\n  .cm-s-default .cm-number {\n    color: #164;\n  }\n  .cm-s-default .cm-def {\n    color: #00f;\n  }\n  .cm-s-default .cm-variable,\n  .cm-s-default .cm-punctuation,\n  .cm-s-default .cm-property,\n  .cm-s-default .cm-operator {\n  }\n  .cm-s-default .cm-variable-2 {\n    color: #05a;\n  }\n  .cm-s-default .cm-variable-3,\n  .cm-s-default .cm-type {\n    color: #085;\n  }\n  .cm-s-default .cm-comment {\n    color: #a50;\n  }\n  .cm-s-default .cm-string {\n    color: #a11;\n  }\n  .cm-s-default .cm-string-2 {\n    color: #f50;\n  }\n  .cm-s-default .cm-meta {\n    color: #555;\n  }\n  .cm-s-default .cm-qualifier {\n    color: #555;\n  }\n  .cm-s-default .cm-builtin {\n    color: #30a;\n  }\n  .cm-s-default .cm-bracket {\n    color: #997;\n  }\n  .cm-s-default .cm-tag {\n    color: #170;\n  }\n  .cm-s-default .cm-attribute {\n    color: #00c;\n  }\n  .cm-s-default .cm-hr {\n    color: #999;\n  }\n  .cm-s-default .cm-link {\n    color: #00c;\n  }\n\n  .cm-s-default .cm-error {\n    color: #f00;\n  }\n  .cm-invalidchar {\n    color: #f00;\n  }\n\n  .CodeMirror-composing {\n    border-bottom: 2px solid;\n  }\n\n  /* Default styles for common addons */\n\n  div.CodeMirror span.CodeMirror-matchingbracket {\n    color: #0b0;\n  }\n  div.CodeMirror span.CodeMirror-nonmatchingbracket {\n    color: #a22;\n  }\n  .CodeMirror-matchingtag {\n    background: rgba(255, 150, 0, 0.3);\n  }\n  .CodeMirror-activeline-background {\n    background: #e8f2ff;\n  }\n\n  /* STOP */\n\n  /* The rest of this file contains styles related to the mechanics of\n   the editor. You probably shouldn't touch them. */\n\n  .CodeMirror {\n    position: relative;\n    overflow: hidden;\n    background: white;\n  }\n\n  .CodeMirror-scroll {\n    overflow: scroll !important; /* Things will break if this is overridden */\n    /* 50px is the magic margin used to hide the element's real scrollbars */\n    /* See overflow: hidden in .CodeMirror */\n    margin-bottom: -50px;\n    margin-right: -50px;\n    padding-bottom: 50px;\n    height: auto !important;\n    outline: none; /* Prevent dragging from highlighting the element */\n    position: relative;\n  }\n  .CodeMirror-sizer {\n    position: relative;\n    border-right: 50px solid transparent;\n  }\n\n  /* The fake, visible scrollbars. Used to force redraw during scrolling\n   before actual scrolling happens, thus preventing shaking and\n   flickering artifacts. */\n  .CodeMirror-vscrollbar,\n  .CodeMirror-hscrollbar,\n  .CodeMirror-scrollbar-filler,\n  .CodeMirror-gutter-filler {\n    position: absolute;\n    z-index: 6;\n    display: none;\n  }\n  .CodeMirror-vscrollbar {\n    right: 0;\n    top: 0;\n    overflow-x: hidden;\n    overflow-y: scroll;\n  }\n  .CodeMirror-hscrollbar {\n    bottom: 0;\n    left: 0;\n    overflow-y: hidden;\n    overflow-x: scroll;\n  }\n  .CodeMirror-scrollbar-filler {\n    right: 0;\n    bottom: 0;\n  }\n  .CodeMirror-gutter-filler {\n    left: 0;\n    bottom: 0;\n  }\n\n  .CodeMirror-gutters {\n    position: absolute;\n    left: 0;\n    top: 0;\n    min-height: 100%;\n    z-index: 3;\n  }\n  .CodeMirror-gutter {\n    white-space: normal;\n    height: 100%;\n    display: inline-block;\n    vertical-align: top;\n    margin-bottom: -50px;\n  }\n  .CodeMirror-gutter-wrapper {\n    position: absolute;\n    z-index: 4;\n    background: none !important;\n    border: none !important;\n  }\n  .CodeMirror-gutter-background {\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    z-index: 4;\n  }\n  .CodeMirror-gutter-elt {\n    position: absolute;\n    cursor: default;\n    z-index: 4;\n  }\n  .CodeMirror-gutter-wrapper ::selection {\n    background-color: transparent;\n  }\n  .CodeMirror-gutter-wrapper ::-moz-selection {\n    background-color: transparent;\n  }\n\n  .CodeMirror-lines {\n    cursor: text;\n    min-height: 1px; /* prevents collapsing before first draw */\n  }\n  .CodeMirror pre.CodeMirror-line,\n  .CodeMirror pre.CodeMirror-line-like {\n    /* Reset some styles that the rest of the page might have set */\n    -moz-border-radius: 0;\n    -webkit-border-radius: 0;\n    border-radius: 0;\n    border-width: 0;\n    background: transparent;\n    font-family: inherit;\n    font-size: inherit;\n    margin: 0;\n    white-space: pre;\n    word-wrap: normal;\n    line-height: inherit;\n    color: inherit;\n    z-index: 2;\n    position: relative;\n    overflow: visible;\n    -webkit-tap-highlight-color: transparent;\n    -webkit-font-variant-ligatures: contextual;\n    font-variant-ligatures: contextual;\n  }\n  .CodeMirror-wrap pre.CodeMirror-line,\n  .CodeMirror-wrap pre.CodeMirror-line-like {\n    word-wrap: break-word;\n    white-space: pre-wrap;\n    word-break: normal;\n  }\n\n  .CodeMirror-linebackground {\n    position: absolute;\n    left: 0;\n    right: 0;\n    top: 0;\n    bottom: 0;\n    z-index: 0;\n  }\n\n  .CodeMirror-linewidget {\n    position: relative;\n    z-index: 2;\n    padding: 0.1px; /* Force widget margins to stay inside of the container */\n  }\n\n  .CodeMirror-widget {\n  }\n\n  .CodeMirror-rtl pre {\n    direction: rtl;\n  }\n\n  .CodeMirror-code {\n    outline: none;\n  }\n\n  /* Force content-box sizing for the elements where we expect it */\n  .CodeMirror-scroll,\n  .CodeMirror-sizer,\n  .CodeMirror-gutter,\n  .CodeMirror-gutters,\n  .CodeMirror-linenumber {\n    -moz-box-sizing: content-box;\n    box-sizing: content-box;\n  }\n\n  .CodeMirror-measure {\n    position: absolute;\n    width: 100%;\n    height: 0;\n    overflow: hidden;\n    visibility: hidden;\n  }\n\n  .CodeMirror-cursor {\n    position: absolute;\n    pointer-events: none;\n  }\n  .CodeMirror-measure pre {\n    position: static;\n  }\n\n  div.CodeMirror-cursors {\n    visibility: hidden;\n    position: relative;\n    z-index: 3;\n  }\n  div.CodeMirror-dragcursors {\n    visibility: visible;\n  }\n\n  .CodeMirror-focused div.CodeMirror-cursors {\n    visibility: visible;\n  }\n\n  .CodeMirror-selected {\n    background: #d9d9d9;\n  }\n  .CodeMirror-focused .CodeMirror-selected {\n    background: #d7d4f0;\n  }\n  .CodeMirror-crosshair {\n    cursor: crosshair;\n  }\n  .CodeMirror-line::selection,\n  .CodeMirror-line > span::selection,\n  .CodeMirror-line > span > span::selection {\n    background: #d7d4f0;\n  }\n  .CodeMirror-line::-moz-selection,\n  .CodeMirror-line > span::-moz-selection,\n  .CodeMirror-line > span > span::-moz-selection {\n    background: #d7d4f0;\n  }\n\n  .cm-searching {\n    background-color: #ffa;\n    background-color: rgba(255, 255, 0, 0.4);\n  }\n\n  /* Used to force a border model for a node */\n  .cm-force-border {\n    padding-right: 0.1px;\n  }\n\n  @media print {\n    /* Hide the cursor when printing */\n    .CodeMirror div.CodeMirror-cursors {\n      visibility: hidden;\n    }\n  }\n\n  /* See issue #2901 */\n  .cm-tab-wrap-hack:after {\n    content: '';\n  }\n\n  /* Help users use markselection to safely style text background */\n  span.CodeMirror-selectedtext {\n    background: none;\n  }\n`;\n","import CodeMirror from 'codemirror';\nimport { exitCode } from 'prosemirror-commands';\nimport { Node } from 'prosemirror-model';\nimport { Selection, TextSelection } from 'prosemirror-state';\nimport { EditorView } from 'prosemirror-view';\n\n// This is the one responsible for code highlighting\n// in codemirror editor\nrequire('codemirror/mode/javascript/javascript.js');\n\nexport class CodeBlockView {\n  cm: CodeMirror.Editor;\n  dom: HTMLElement;\n  updating: boolean;\n  incomingChanges = false;\n\n  constructor(\n    public node: Node,\n    public view: EditorView,\n    public getPos,\n    public enterPressed: Function\n  ) {\n    // Create a CodeMirror instance\n    this.cm = CodeMirror(null as any, {\n      value: this.node.textContent,\n      mode: 'javascript',\n      extraKeys: this.codeMirrorKeymap(),\n      lineNumbers: false,\n      theme: 'lesser-dark',\n    });\n\n    // The editor's outer node is our DOM representation\n    this.dom = this.cm.getWrapperElement();\n    // CodeMirror needs to be in the DOM to properly initialize, so\n    // schedule it to update itself\n    setTimeout(() => this.cm.refresh(), 20);\n\n    // This flag is used to avoid an update loop between the outer and\n    // inner editor\n    this.updating = false;\n    // Track whether changes are have been made but not yet propagated\n    this.cm.on('beforeChange', () => (this.incomingChanges = true));\n    // Propagate updates from the code editor to ProseMirror\n    this.cm.on('cursorActivity', () => {\n      if (!this.updating && !this.incomingChanges) this.forwardSelection();\n    });\n    this.cm.on('changes', () => {\n      if (!this.updating) {\n        this.valueChanged();\n        this.forwardSelection();\n      }\n      this.incomingChanges = false;\n    });\n    this.cm.on('focus', () => this.forwardSelection());\n  }\n\n  forwardSelection() {\n    if (!this.cm.hasFocus()) return;\n    let state = this.view.state;\n    let selection = this.asProseMirrorSelection(state.doc);\n    if (!selection.eq(state.selection))\n      this.view.dispatch(state.tr.setSelection(selection));\n  }\n\n  asProseMirrorSelection(doc) {\n    let offset = this.getPos() + 1;\n    let anchor = this.cm.indexFromPos(this.cm.getCursor('anchor')) + offset;\n    let head = this.cm.indexFromPos(this.cm.getCursor('head')) + offset;\n    return TextSelection.create(doc, anchor, head);\n  }\n\n  setSelection(anchor, head) {\n    this.cm.focus();\n    this.updating = true;\n    this.cm.setSelection(\n      this.cm.posFromIndex(anchor),\n      this.cm.posFromIndex(head)\n    );\n    this.updating = false;\n  }\n\n  valueChanged() {\n    let change = computeChange(this.node.textContent, this.cm.getValue());\n    if (change) {\n      let start = this.getPos() + 1;\n      let tr = this.view.state.tr.replaceWith(\n        start + change.from,\n        start + change.to,\n        change.text ? this.view.state.schema.text(change.text) : null\n      );\n      this.view.dispatch(tr);\n    }\n  }\n\n  codeMirrorKeymap() {\n    let view = this.view;\n    return CodeMirror.normalizeKeyMap({\n      Up: () => this.maybeEscape('line', -1),\n      Left: () => this.maybeEscape('char', -1),\n      Down: () => this.maybeEscape('line', 1),\n      Right: () => this.maybeEscape('char', 1),\n      'Ctrl-Enter': () => {\n        this.enterPressed();\n      },\n    });\n  }\n\n  maybeEscape(unit, dir) {\n    let pos = this.cm.getCursor();\n    if (\n      this.cm.somethingSelected() ||\n      pos.line != (dir < 0 ? this.cm.firstLine() : this.cm.lastLine()) ||\n      (unit == 'char' &&\n        pos.ch != (dir < 0 ? 0 : this.cm.getLine(pos.line).length))\n    )\n      return CodeMirror.Pass;\n    this.view.focus();\n    let targetPos = this.getPos() + (dir < 0 ? 0 : this.node.nodeSize);\n    let selection = Selection.near(this.view.state.doc.resolve(targetPos), dir);\n    this.view.dispatch(\n      this.view.state.tr.setSelection(selection).scrollIntoView()\n    );\n    this.view.focus();\n  }\n\n  update(node) {\n    if (node.type != this.node.type) return false;\n    this.node = node;\n    let change = computeChange(this.cm.getValue(), node.textContent);\n    if (change) {\n      this.updating = true;\n      this.cm.replaceRange(\n        change.text,\n        this.cm.posFromIndex(change.from),\n        this.cm.posFromIndex(change.to)\n      );\n      this.updating = false;\n    }\n    return true;\n  }\n\n  selectNode() {\n    this.cm.focus();\n  }\n  stopEvent() {\n    return true;\n  }\n}\n\nfunction computeChange(oldVal, newVal) {\n  if (oldVal == newVal) return null;\n  let start = 0,\n    oldEnd = oldVal.length,\n    newEnd = newVal.length;\n  while (start < oldEnd && oldVal.charCodeAt(start) == newVal.charCodeAt(start))\n    ++start;\n  while (\n    oldEnd > start &&\n    newEnd > start &&\n    oldVal.charCodeAt(oldEnd - 1) == newVal.charCodeAt(newEnd - 1)\n  ) {\n    oldEnd--;\n    newEnd--;\n  }\n  return { from: start, to: oldEnd, text: newVal.slice(start, newEnd) };\n}\n","import { html } from 'lit-element';\n\nexport const icons = {\n  bold: html`\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\n      <path fill=\"none\" d=\"M0 0h24v24H0V0z\" />\n      <path\n        d=\"M15.6 10.79c.97-.67 1.65-1.77 1.65-2.79 0-2.26-1.75-4-4-4H8c-.55 0-1 .45-1 1v12c0 .55.45 1 1 1h5.78c2.07 0 3.96-1.69 3.97-3.77.01-1.53-.85-2.84-2.15-3.44zM10 6.5h3c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5h-3v-3zm3.5 9H10v-3h3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5z\"\n      />\n    </svg>\n  `,\n  em: html`\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\n      <path fill=\"none\" d=\"M0 0h24v24H0V0z\" />\n      <path\n        d=\"M10 5.5c0 .83.67 1.5 1.5 1.5h.71l-3.42 8H7.5c-.83 0-1.5.67-1.5 1.5S6.67 18 7.5 18h5c.83 0 1.5-.67 1.5-1.5s-.67-1.5-1.5-1.5h-.71l3.42-8h1.29c.83 0 1.5-.67 1.5-1.5S17.33 4 16.5 4h-5c-.83 0-1.5.67-1.5 1.5z\"\n      />\n    </svg>\n  `,\n  link: html`\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\n      <path fill=\"none\" d=\"M0 0h24v24H0V0z\" />\n      <path\n        d=\"M3.96 11.38C4.24 9.91 5.62 8.9 7.12 8.9h2.93c.52 0 .95-.43.95-.95S10.57 7 10.05 7H7.22c-2.61 0-4.94 1.91-5.19 4.51C1.74 14.49 4.08 17 7 17h3.05c.52 0 .95-.43.95-.95s-.43-.95-.95-.95H7c-1.91 0-3.42-1.74-3.04-3.72zM9 13h6c.55 0 1-.45 1-1s-.45-1-1-1H9c-.55 0-1 .45-1 1s.45 1 1 1zm7.78-6h-2.83c-.52 0-.95.43-.95.95s.43.95.95.95h2.93c1.5 0 2.88 1.01 3.16 2.48.38 1.98-1.13 3.72-3.04 3.72h-3.05c-.52 0-.95.43-.95.95s.43.95.95.95H17c2.92 0 5.26-2.51 4.98-5.49-.25-2.6-2.59-4.51-5.2-4.51z\"\n      />\n    </svg>\n  `,\n  check: html`\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\n      <path fill=\"none\" d=\"M0 0h24v24H0V0z\" />\n      <path\n        d=\"M9 16.2l-3.5-3.5c-.39-.39-1.01-.39-1.4 0-.39.39-.39 1.01 0 1.4l4.19 4.19c.39.39 1.02.39 1.41 0L20.3 7.7c.39-.39.39-1.01 0-1.4-.39-.39-1.01-.39-1.4 0L9 16.2z\"\n      />\n    </svg>\n  `,\n  cross: html`\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\n      <path fill=\"none\" d=\"M0 0h24v24H0V0z\" />\n      <path\n        d=\"M18.3 5.71c-.39-.39-1.02-.39-1.41 0L12 10.59 7.11 5.7c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41L10.59 12 5.7 16.89c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0L12 13.41l4.89 4.89c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4z\"\n      />\n    </svg>\n  `,\n  arrow_left: html`\n    <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 0 24 24\" width=\"24\">\n      <path d=\"M14 7l-5 5 5 5V7z\" />\n      <path d=\"M24 0v24H0V0h24z\" fill=\"none\" />\n    </svg>\n  `,\n  arrow_right: html`\n    <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 0 24 24\" width=\"24\">\n      <path d=\"M10 17l5-5-5-5v10z\" />\n      <path d=\"M0 24V0h24v24H0z\" fill=\"none\" />\n    </svg>\n  `,\n  arrow_drop_down: html`\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      viewBox=\"0 0 24 24\"\n      fill=\"black\"\n      width=\"18px\"\n      height=\"18px\"\n    >\n      <path d=\"M0 0h24v24H0z\" fill=\"none\" />\n      <path d=\"M7 10l5 5 5-5z\" />\n    </svg>\n  `,\n  arrow_back: html`\n    <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 0 24 24\" width=\"24\">\n      <path d=\"M0 0h24v24H0z\" fill=\"none\" />\n      <path d=\"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z\" />\n    </svg>\n  `,\n  add: html`\n    <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 0 24 24\" width=\"24\">\n      <path d=\"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z\" />\n      <path d=\"M0 0h24v24H0z\" fill=\"none\" />\n    </svg>\n  `,\n  add_box: html`\n    <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 0 24 24\" width=\"24\">\n      <path\n        d=\"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10h-4v4h-2v-4H7v-2h4V7h2v4h4v2z\"\n      />\n      <path d=\"M0 0h24v24H0z\" fill=\"none\" />\n    </svg>\n  `,\n  edit: html`\n    <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 0 24 24\" width=\"24\">\n      <path\n        d=\"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z\"\n      />\n      <path d=\"M0 0h24v24H0z\" fill=\"none\" />\n    </svg>\n  `,\n  image: html`\n    <svg style=\"width:24px;height:24px\" viewBox=\"0 0 24 24\">\n      <path\n        fill=\"currentColor\"\n        d=\"M19,19H5V5H19M19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M16.5,16.25C16.5,14.75 13.5,14 12,14C10.5,14 7.5,14.75 7.5,16.25V17H16.5M12,12.25A2.25,2.25 0 0,0 14.25,10A2.25,2.25 0 0,0 12,7.75A2.25,2.25 0 0,0 9.75,10A2.25,2.25 0 0,0 12,12.25Z\"\n      />\n    </svg>\n  `,\n  youtube: html`\n    <svg style=\"width:24px;height:24px\" viewBox=\"0 0 24 24\">\n      <path\n        fill=\"currentColor\"\n        d=\"M10,15L15.19,12L10,9V15M21.56,7.17C21.69,7.64 21.78,8.27 21.84,9.07C21.91,9.87 21.94,10.56 21.94,11.16L22,12C22,14.19 21.84,15.8 21.56,16.83C21.31,17.73 20.73,18.31 19.83,18.56C19.36,18.69 18.5,18.78 17.18,18.84C15.88,18.91 14.69,18.94 13.59,18.94L12,19C7.81,19 5.2,18.84 4.17,18.56C3.27,18.31 2.69,17.73 2.44,16.83C2.31,16.36 2.22,15.73 2.16,14.93C2.09,14.13 2.06,13.44 2.06,12.84L2,12C2,9.81 2.16,8.2 2.44,7.17C2.69,6.27 3.27,5.69 4.17,5.44C4.64,5.31 5.5,5.22 6.82,5.16C8.12,5.09 9.31,5.06 10.41,5.06L12,5C16.19,5 18.8,5.16 19.83,5.44C20.73,5.69 21.31,6.27 21.56,7.17Z\"\n      />\n    </svg>\n  `,\n  code: html`\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18px\" viewBox=\"0 0 24 24\" height=\"18px\">\n      <path d=\"M0 0h24v24H0V0z\" fill=\"none\" />\n      <path\n        d=\"M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z\"\n      />\n    </svg>\n  `\n};\n","import { css } from 'lit-element';\n\nexport const iconsStyle = css`\n  clr-icon {\n    display: inline-block;\n    margin: 0;\n    height: 16px;\n    width: 16px;\n    vertical-align: middle;\n    fill: currentColor;\n  }\n  clr-icon .transparent-fill-stroke {\n    stroke: currentColor;\n  }\n  clr-icon.is-green,\n  clr-icon.is-success {\n    fill: #318700;\n  }\n  clr-icon.is-green .transparent-fill-stroke,\n  clr-icon.is-success .transparent-fill-stroke {\n    stroke: #318700;\n  }\n  clr-icon.is-danger,\n  clr-icon.is-error,\n  clr-icon.is-red {\n    fill: #e62700;\n  }\n  clr-icon.is-danger .transparent-fill-stroke,\n  clr-icon.is-error .transparent-fill-stroke,\n  clr-icon.is-red .transparent-fill-stroke {\n    stroke: #e62700;\n  }\n  clr-icon.is-warning {\n    fill: #fac400;\n  }\n  clr-icon.is-warning .transparent-fill-stroke {\n    stroke: #fac400;\n  }\n  clr-icon.is-blue,\n  clr-icon.is-info {\n    fill: #007cbb;\n  }\n  clr-icon.is-blue .transparent-fill-stroke,\n  clr-icon.is-info .transparent-fill-stroke {\n    stroke: #007cbb;\n  }\n  clr-icon.is-inverse,\n  clr-icon.is-white {\n    fill: #fff;\n  }\n  clr-icon.is-inverse .transparent-fill-stroke,\n  clr-icon.is-white .transparent-fill-stroke {\n    stroke: #fff;\n  }\n  clr-icon.is-highlight {\n    fill: #007cbb;\n  }\n  clr-icon.is-highlight .transparent-fill-stroke {\n    stroke: #007cbb;\n  }\n  clr-icon[dir='up'] svg,\n  clr-icon[shape$=' up'] svg {\n    transform: rotate(0deg);\n  }\n  clr-icon[dir='down'] svg,\n  clr-icon[shape$=' down'] svg {\n    transform: rotate(180deg);\n  }\n  clr-icon[dir='right'] svg,\n  clr-icon[shape$=' right'] svg {\n    transform: rotate(90deg);\n  }\n  clr-icon[dir='left'] svg,\n  clr-icon[shape$=' left'] svg {\n    transform: rotate(270deg);\n  }\n  clr-icon[flip='horizontal'] svg {\n    transform: scale(-1) rotateX(180deg);\n  }\n  clr-icon[flip='vertical'] svg {\n    transform: scale(-1) rotateY(180deg);\n  }\n  clr-icon .clr-i-badge {\n    fill: #e62700;\n  }\n  clr-icon .clr-i-badge .transparent-fill-stroke {\n    stroke: #e62700;\n  }\n  clr-icon > * {\n    height: 100%;\n    width: 100%;\n    display: block;\n    pointer-events: none;\n  }\n  clr-icon > svg {\n    transition: inherit;\n  }\n  clr-icon .clr-i-outline--alerted:not(.clr-i-outline),\n  clr-icon .clr-i-outline--badged:not(.clr-i-outline),\n  clr-icon .clr-i-solid,\n  clr-icon .clr-i-solid--alerted,\n  clr-icon .clr-i-solid--badged,\n  clr-icon > svg title {\n    display: none;\n  }\n  clr-icon[class*='has-alert'] .can-alert .clr-i-outline--alerted {\n    display: block;\n  }\n  clr-icon[class*='has-alert'] .can-alert .clr-i-outline:not(.clr-i-outline--alerted) {\n    display: none;\n  }\n  clr-icon[class*='has-badge'] .can-badge .clr-i-outline--badged {\n    display: block;\n  }\n  clr-icon[class*='has-badge'] .can-badge .clr-i-outline:not(.clr-i-outline--badged) {\n    display: none;\n  }\n  clr-icon.is-solid .has-solid .clr-i-solid {\n    display: block;\n  }\n  clr-icon.is-solid .has-solid .clr-i-outline,\n  clr-icon.is-solid .has-solid .clr-i-outline--badged,\n  clr-icon.is-solid .has-solid .clr-i-solid--alerted:not(.clr-i-solid),\n  clr-icon.is-solid .has-solid .clr-i-solid--badged:not(.clr-i-solid) {\n    display: none;\n  }\n  clr-icon.is-solid[class*='has-badge'] .can-badge.has-solid .clr-i-solid--badged {\n    display: block;\n  }\n  clr-icon.is-solid[class*='has-badge'] .can-badge.has-solid .clr-i-outline,\n  clr-icon.is-solid[class*='has-badge'] .can-badge.has-solid .clr-i-outline--badged,\n  clr-icon.is-solid[class*='has-badge']\n    .can-badge.has-solid\n    .clr-i-solid:not(.clr-i-solid--badged) {\n    display: none;\n  }\n  clr-icon.is-solid[class*='has-alert'] .can-alert.has-solid .clr-i-solid--alerted {\n    display: block;\n  }\n  clr-icon.is-solid[class*='has-alert'] .can-alert.has-solid .clr-i-outline,\n  clr-icon.is-solid[class*='has-alert'] .can-alert.has-solid .clr-i-outline--alerted,\n  clr-icon.is-solid[class*='has-alert']\n    .can-alert.has-solid\n    .clr-i-solid:not(.clr-i-solid--alerted) {\n    display: none;\n  }\n  clr-icon.has-badge--success .clr-i-badge {\n    fill: #318700;\n  }\n  clr-icon.has-badge--success .clr-i-badge .transparent-fill-stroke {\n    stroke: #318700;\n  }\n  clr-icon.has-badge--error .clr-i-badge {\n    fill: #e62700;\n  }\n  clr-icon.has-badge--error .clr-i-badge .transparent-fill-stroke {\n    stroke: #e62700;\n  }\n  clr-icon.has-badge--info .clr-i-badge {\n    fill: #007cbb;\n  }\n  clr-icon.has-badge--info .clr-i-badge .transparent-fill-stroke {\n    stroke: #007cbb;\n  }\n  clr-icon.has-alert .clr-i-alert {\n    fill: #fac400;\n  }\n  clr-icon.has-alert .clr-i-alert .transparent-fill-stroke {\n    stroke: #fac400;\n  }\n  clr-icon .is-off-screen {\n    position: fixed !important;\n    border: none !important;\n    height: 1px !important;\n    width: 1px !important;\n    left: 0 !important;\n    top: -1px !important;\n    overflow: hidden !important;\n    padding: 0 !important;\n    margin: 0 0 -1px 0 !important;\n  }\n`;\n","import { css } from 'lit-element';\n\nexport const styles = css`\n  .ProseMirror {\n    position: relative;\n  }\n\n  .ProseMirror {\n    word-wrap: break-word;\n    white-space: pre-wrap;\n    -webkit-font-variant-ligatures: none;\n    font-variant-ligatures: none;\n  }\n\n  .ProseMirror pre {\n    white-space: pre-wrap;\n  }\n\n  .ProseMirror li {\n    position: relative;\n  }\n\n  .ProseMirror-hideselection *::selection {\n    background: transparent;\n  }\n  .ProseMirror-hideselection *::-moz-selection {\n    background: transparent;\n  }\n  .ProseMirror-hideselection {\n    caret-color: transparent;\n  }\n\n  .ProseMirror-selectednode {\n    outline: 2px solid #8cf;\n  }\n\n  /* Make sure li selections wrap around markers */\n\n  li.ProseMirror-selectednode {\n    outline: none;\n  }\n\n  li.ProseMirror-selectednode:after {\n    content: '';\n    position: absolute;\n    left: -32px;\n    right: -2px;\n    top: -2px;\n    bottom: -2px;\n    border: 2px solid #8cf;\n    pointer-events: none;\n  }\n  .ProseMirror-textblock-dropdown {\n    min-width: 3em;\n  }\n\n  .ProseMirror-menu {\n    margin: 0 -4px;\n    line-height: 1;\n  }\n\n  .ProseMirror-tooltip .ProseMirror-menu {\n    width: -webkit-fit-content;\n    width: fit-content;\n    white-space: pre;\n  }\n\n  .ProseMirror-menuitem {\n    margin-right: 3px;\n    display: inline-block;\n  }\n\n  .ProseMirror-menuseparator {\n    border-right: 1px solid #ddd;\n    margin-right: 3px;\n  }\n\n  .ProseMirror-menu-dropdown,\n  .ProseMirror-menu-dropdown-menu {\n    font-size: 90%;\n    white-space: nowrap;\n  }\n\n  .ProseMirror-menu-dropdown {\n    vertical-align: 1px;\n    cursor: pointer;\n    position: relative;\n    padding-right: 15px;\n  }\n\n  .ProseMirror-menu-dropdown-wrap {\n    padding: 1px 0 1px 4px;\n    display: inline-block;\n    position: relative;\n  }\n\n  .ProseMirror-menu-dropdown:after {\n    content: '';\n    border-left: 4px solid transparent;\n    border-right: 4px solid transparent;\n    border-top: 4px solid currentColor;\n    opacity: 0.6;\n    position: absolute;\n    right: 4px;\n    top: calc(50% - 2px);\n  }\n\n  .ProseMirror-menu-dropdown-menu,\n  .ProseMirror-menu-submenu {\n    position: absolute;\n    background: white;\n    color: #666;\n    border: 1px solid #aaa;\n    padding: 2px;\n  }\n\n  .ProseMirror-menu-dropdown-menu {\n    z-index: 15;\n    min-width: 6em;\n  }\n\n  .ProseMirror-menu-dropdown-item {\n    cursor: pointer;\n    padding: 2px 8px 2px 4px;\n  }\n\n  .ProseMirror-menu-dropdown-item:hover {\n    background: #f2f2f2;\n  }\n\n  .ProseMirror-menu-submenu-wrap {\n    position: relative;\n    margin-right: -4px;\n  }\n\n  .ProseMirror-menu-submenu-label:after {\n    content: '';\n    border-top: 4px solid transparent;\n    border-bottom: 4px solid transparent;\n    border-left: 4px solid currentColor;\n    opacity: 0.6;\n    position: absolute;\n    right: 4px;\n    top: calc(50% - 4px);\n  }\n\n  .ProseMirror-menu-submenu {\n    display: none;\n    min-width: 4em;\n    left: 100%;\n    top: -3px;\n  }\n\n  .ProseMirror-menu-active {\n    background: #eee;\n    border-radius: 4px;\n  }\n\n  .ProseMirror-menu-active {\n    background: #eee;\n    border-radius: 4px;\n  }\n\n  .ProseMirror-menu-disabled {\n    opacity: 0.3;\n  }\n\n  .ProseMirror-menu-submenu-wrap:hover .ProseMirror-menu-submenu,\n  .ProseMirror-menu-submenu-wrap-active .ProseMirror-menu-submenu {\n    display: block;\n  }\n\n  .ProseMirror-menubar {\n    border-top-left-radius: inherit;\n    border-top-right-radius: inherit;\n    position: relative;\n    min-height: 1em;\n    color: #666;\n    padding: 1px 6px;\n    top: 0;\n    left: 0;\n    right: 0;\n    border-bottom: 1px solid silver;\n    background: white;\n    z-index: 10;\n    -moz-box-sizing: border-box;\n    box-sizing: border-box;\n    overflow: visible;\n  }\n\n  .ProseMirror-icon {\n    display: inline-block;\n    line-height: 0.8;\n    vertical-align: -2px; /* Compensate for padding */\n    padding: 2px 8px;\n    cursor: pointer;\n  }\n\n  .ProseMirror-menu-disabled.ProseMirror-icon {\n    cursor: default;\n  }\n\n  .ProseMirror-icon svg {\n    fill: currentColor;\n    height: 1em;\n  }\n\n  .ProseMirror-icon span {\n    vertical-align: text-top;\n  }\n  .ProseMirror-gapcursor {\n    display: none;\n    pointer-events: none;\n    position: absolute;\n  }\n\n  .ProseMirror-gapcursor:after {\n    content: '';\n    display: block;\n    position: absolute;\n    top: -2px;\n    width: 20px;\n    border-top: 1px solid black;\n    animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;\n  }\n\n  @keyframes ProseMirror-cursor-blink {\n    to {\n      visibility: hidden;\n    }\n  }\n\n  .ProseMirror-focused .ProseMirror-gapcursor {\n    display: block;\n  }\n  /* Add space around the hr to make clicking it easier */\n\n  .ProseMirror-example-setup-style hr {\n    padding: 2px 10px;\n    border: none;\n    margin: 1em 0;\n  }\n\n  .ProseMirror-example-setup-style hr:after {\n    content: '';\n    display: block;\n    height: 1px;\n    background-color: silver;\n    line-height: 2px;\n  }\n\n  .ProseMirror ul,\n  .ProseMirror ol {\n    padding-left: 30px;\n  }\n\n  .ProseMirror blockquote {\n    padding-left: 1em;\n    border-left: 3px solid #eee;\n    margin-left: 0;\n    margin-right: 0;\n  }\n\n  .ProseMirror-example-setup-style img {\n    cursor: default;\n  }\n\n  .ProseMirror-prompt {\n    background: white;\n    padding: 5px 10px 5px 15px;\n    border: 1px solid silver;\n    position: fixed;\n    border-radius: 3px;\n    z-index: 11;\n    box-shadow: -0.5px 2px 5px rgba(0, 0, 0, 0.2);\n  }\n\n  .ProseMirror-prompt h5 {\n    margin: 0;\n    font-weight: normal;\n    font-size: 100%;\n    color: #444;\n  }\n\n  .ProseMirror-prompt input[type='text'],\n  .ProseMirror-prompt textarea {\n    background: #eee;\n    border: none;\n    outline: none;\n  }\n\n  .ProseMirror-prompt input[type='text'] {\n    padding: 0 4px;\n  }\n\n  .ProseMirror-prompt-close {\n    position: absolute;\n    left: 2px;\n    top: 1px;\n    color: #666;\n    border: none;\n    background: transparent;\n    padding: 0;\n  }\n\n  .ProseMirror-prompt-close:after {\n    content: 'âœ•';\n    font-size: 12px;\n  }\n\n  .ProseMirror-invalid {\n    background: #ffc;\n    border: 1px solid #cc7;\n    border-radius: 4px;\n    padding: 5px 10px;\n    position: absolute;\n    min-width: 10em;\n  }\n\n  .ProseMirror-prompt-buttons {\n    margin-top: 5px;\n    display: none;\n  }\n  #editor,\n  .editor {\n    background: white;\n    color: black;\n    background-clip: padding-box;\n    border-radius: 4px;\n    border: 2px solid rgba(0, 0, 0, 0.2);\n    padding: 5px 0;\n    margin-bottom: 23px;\n  }\n\n  .ProseMirror h1:first-child,\n  .ProseMirror h2:first-child,\n  .ProseMirror h3:first-child,\n  .ProseMirror h4:first-child,\n  .ProseMirror h5:first-child,\n  .ProseMirror h6:first-child {\n    margin-top: 10px;\n    margin-bottom: 10px;\n  }\n\n  .ProseMirror {\n    padding: 4px 8px 4px 14px;\n    line-height: 1.2;\n    outline: none;\n  }\n\n  .ProseMirror p {\n    margin: 0px;\n  }\n`;\n","import { css } from 'lit-element';\n\nexport const styles = css`\n  /*\nhttp://lesscss.org/ dark theme\nPorted to CodeMirror by Peter Kroon\n*/\n  .cm-s-lesser-dark {\n    line-height: 1.3em;\n  }\n  .cm-s-lesser-dark.CodeMirror {\n    background: #262626;\n    color: #ebefe7;\n    text-shadow: 0 -1px 1px #262626;\n  }\n  .cm-s-lesser-dark div.CodeMirror-selected {\n    background: #45443b;\n  } /* 33322B*/\n  .cm-s-lesser-dark .CodeMirror-line::selection,\n  .cm-s-lesser-dark .CodeMirror-line > span::selection,\n  .cm-s-lesser-dark .CodeMirror-line > span > span::selection {\n    background: rgba(69, 68, 59, 0.99);\n  }\n  .cm-s-lesser-dark .CodeMirror-line::-moz-selection,\n  .cm-s-lesser-dark .CodeMirror-line > span::-moz-selection,\n  .cm-s-lesser-dark .CodeMirror-line > span > span::-moz-selection {\n    background: rgba(69, 68, 59, 0.99);\n  }\n  .cm-s-lesser-dark .CodeMirror-cursor {\n    border-left: 1px solid white;\n  }\n  .cm-s-lesser-dark pre {\n    padding: 0 8px;\n  } /*editable code holder*/\n\n  .cm-s-lesser-dark.CodeMirror span.CodeMirror-matchingbracket {\n    color: #7efc7e;\n  } /*65FC65*/\n\n  .cm-s-lesser-dark .CodeMirror-gutters {\n    background: #262626;\n    border-right: 1px solid #aaa;\n  }\n  .cm-s-lesser-dark .CodeMirror-guttermarker {\n    color: #599eff;\n  }\n  .cm-s-lesser-dark .CodeMirror-guttermarker-subtle {\n    color: #777;\n  }\n  .cm-s-lesser-dark .CodeMirror-linenumber {\n    color: #777;\n  }\n\n  .cm-s-lesser-dark span.cm-header {\n    color: #a0a;\n  }\n  .cm-s-lesser-dark span.cm-quote {\n    color: #090;\n  }\n  .cm-s-lesser-dark span.cm-keyword {\n    color: #599eff;\n  }\n  .cm-s-lesser-dark span.cm-atom {\n    color: #c2b470;\n  }\n  .cm-s-lesser-dark span.cm-number {\n    color: #b35e4d;\n  }\n  .cm-s-lesser-dark span.cm-def {\n    color: white;\n  }\n  .cm-s-lesser-dark span.cm-variable {\n    color: #d9bf8c;\n  }\n  .cm-s-lesser-dark span.cm-variable-2 {\n    color: #669199;\n  }\n  .cm-s-lesser-dark span.cm-variable-3,\n  .cm-s-lesser-dark span.cm-type {\n    color: white;\n  }\n  .cm-s-lesser-dark span.cm-property {\n    color: #92a75c;\n  }\n  .cm-s-lesser-dark span.cm-operator {\n    color: #92a75c;\n  }\n  .cm-s-lesser-dark span.cm-comment {\n    color: #666;\n  }\n  .cm-s-lesser-dark span.cm-string {\n    color: #bcd279;\n  }\n  .cm-s-lesser-dark span.cm-string-2 {\n    color: #f50;\n  }\n  .cm-s-lesser-dark span.cm-meta {\n    color: #738c73;\n  }\n  .cm-s-lesser-dark span.cm-qualifier {\n    color: #555;\n  }\n  .cm-s-lesser-dark span.cm-builtin {\n    color: #ff9e59;\n  }\n  .cm-s-lesser-dark span.cm-bracket {\n    color: #ebefe7;\n  }\n  .cm-s-lesser-dark span.cm-tag {\n    color: #669199;\n  }\n  .cm-s-lesser-dark span.cm-attribute {\n    color: #81a4d5;\n  }\n  .cm-s-lesser-dark span.cm-hr {\n    color: #999;\n  }\n  .cm-s-lesser-dark span.cm-link {\n    color: #7070e6;\n  }\n  .cm-s-lesser-dark span.cm-error {\n    color: #9d1e15;\n  }\n\n  .cm-s-lesser-dark .CodeMirror-activeline-background {\n    background: #3c3a3a;\n  }\n  .cm-s-lesser-dark .CodeMirror-matchingbracket {\n    outline: 1px solid grey;\n    color: white !important;\n  }\n`;\n","import { Schema } from 'prosemirror-model';\n\nconst pDOM = ['p', 0],\n  blockquoteDOM = ['blockquote', 0],\n  hrDOM = ['hr'],\n  preDOM = ['pre', ['code', 0]],\n  brDOM = ['br'];\n\n// :: Object\n// [Specs](#model.NodeSpec) for the nodes defined in this schema.\nexport const nodes = {\n  // :: NodeSpec The top level document node.\n  doc: {\n    content: 'block+'\n  },\n\n  // :: NodeSpec A plain paragraph textblock. Represented in the DOM\n  // as a `<p>` element.\n  paragraph: {\n    content: 'inline*',\n    group: 'block',\n    attrs: {\n      style: {\n        default: ''\n      }\n    },\n    toDOM(node) {\n      return ['p', { style: node.attrs.style }, 0];\n    },\n    parseDOM: [\n      {\n        tag: 'p',\n        getAttrs: node => {\n          return {\n            textAlign: node.attributes ? node.attributes.style : node.attrs.style\n          };\n        }\n      }\n    ]\n  },\n\n  // :: NodeSpec A horizontal rule (`<hr>`).\n  horizontal_rule: {\n    group: 'block',\n    parseDOM: [{ tag: 'hr' }],\n    toDOM() {\n      return hrDOM;\n    }\n  },\n\n  // :: NodeSpec A code listing. Disallows marks or non-text inline\n  // nodes by default. Represented as a `<pre>` element with a\n  // `<code>` element inside of it.\n  code_block: {\n    content: 'text*',\n    marks: '',\n    group: 'block',\n    code: true,\n    defining: true,\n    parseDOM: [{ tag: 'pre', preserveWhitespace: 'full' }],\n    toDOM: function toDOM() {\n      return ['pre', ['code', 0]];\n    }\n  },\n\n  // :: NodeSpec The text node.\n  text: {\n    group: 'inline'\n  },\n\n  // :: NodeSpec An inline image (`<img>`) node. Supports `src`,\n  // `alt`, `style`, and `href` attributes. The latter two default to the empty\n  // string.\n  image: {\n    inline: true,\n    attrs: {\n      src: {},\n      alt: { default: null },\n      title: { default: null },\n      style: {}\n    },\n    group: 'inline',\n    draggable: true,\n    parseDOM: [\n      {\n        tag: 'img',\n        getAttrs(dom) {\n          return {\n            src: dom.getAttribute('src'),\n            title: dom.getAttribute('title'),\n            alt: dom.getAttribute('alt'),\n            style: dom.getAttribute('style')\n          };\n        }\n      }\n    ],\n    toDOM(node) {\n      let { src, alt, title, style } = node.attrs;\n      return ['img', { src, alt, title, style }];\n    }\n  },\n\n  // :: NodeSpec An inline image (`<iframe>`) node. Supports `src`,\n  //  and `style` attributes.\n  iframe: {\n    inline: true,\n    attrs: {\n      src: {},\n      style: {}\n    },\n    group: 'inline',\n    parseDOM: [\n      {\n        tag: 'iframe',\n        getAttrs(dom) {\n          return {\n            src: dom.getAttribute('src'),\n            style: dom.getAttribute('style')\n          };\n        }\n      }\n    ],\n    toDOM(node) {\n      let { src, style } = node.attrs;\n      return ['iframe', { src, style, class: 'yt-embed' }];\n    }\n  },\n\n  // :: NodeSpec A hard line break, represented in the DOM as `<br>`.\n  hard_break: {\n    inline: true,\n    group: 'inline',\n    selectable: false,\n    parseDOM: [{ tag: 'br' }],\n    toDOM() {\n      return brDOM;\n    }\n  }\n};\n\nconst emDOM = ['em', 0],\n  strongDOM = ['strong', 0],\n  codeDOM = ['code', 0];\n\n// :: Object [Specs](#model.MarkSpec) for the marks in the schema.\nexport const marks = {\n  // :: MarkSpec A link. Has `href` and `title` attributes. `title`\n  // defaults to the empty string. Rendered and parsed as an `<a>`\n  // element.\n  link: {\n    attrs: {\n      href: {},\n      title: { default: null }\n    },\n    inclusive: false,\n    parseDOM: [\n      {\n        tag: 'a[href]',\n        getAttrs(dom) {\n          return { href: dom.getAttribute('href'), title: dom.getAttribute('title') };\n        }\n      }\n    ],\n    toDOM(node) {\n      let { href, title } = node.attrs;\n      return ['a', { href, title }, 0];\n    }\n  },\n\n  // :: MarkSpec An emphasis mark. Rendered as an `<em>` element.\n  // Has parse rules that also match `<i>` and `font-style: italic`.\n  em: {\n    parseDOM: [{ tag: 'i' }, { tag: 'em' }, { style: 'font-style=italic' }],\n    toDOM() {\n      return emDOM;\n    }\n  },\n\n  // :: MarkSpec A strong mark. Rendered as `<strong>`, parse rules\n  // also match `<b>` and `font-weight: bold`.\n  strong: {\n    parseDOM: [\n      { tag: 'strong' },\n      // This works around a Google Docs misbehavior where\n      // pasted content will be inexplicably wrapped in `<b>`\n      // tags with a font-weight normal.\n      { tag: 'b', getAttrs: node => node.style.fontWeight != 'normal' && null },\n      {\n        style: 'font-weight',\n        getAttrs: value => /^(bold(er)?|[5-9]\\d{2,})$/.test(value) && null\n      }\n    ],\n    toDOM() {\n      return strongDOM;\n    }\n  },\n\n  // :: MarkSpec Code font mark. Represented as a `<code>` element.\n  code: {\n    parseDOM: [{ tag: 'code', node: 'code_block', preserveWhitespace: 'full' }],\n    toDOM() {\n      return codeDOM;\n    }\n  }\n};\n\n// :: Schema\n// This schema roughly corresponds to the document schema used by\n// [CommonMark](http://commonmark.org/), minus the list elements,\n// which are defined in the [`prosemirror-schema-list`](#schema-list)\n// module.\n//\n// To reuse elements from this schema, extend or read from its\n// `spec.nodes` and `spec.marks` [properties](#model.Schema.spec).\nexport const blockSchema = new Schema({ nodes: nodes as any, marks: marks as any });\n","import { Schema } from 'prosemirror-model';\n\n// :: Object\n// [Specs](#model.NodeSpec) for the nodes defined in this schema.\nexport const nodes = {\n  // :: NodeSpec The top level document node.\n  doc: {\n    content: 'heading+',\n  },\n\n  // :: NodeSpec A heading textblock, with a `level` attribute that\n  // should hold the number 1 to 6. Parsed and serialized as `<h1>` to\n  // `<h6>` elements.\n  heading: {\n    attrs: { level: { default: 1 } },\n    content: 'inline*',\n    group: 'block',\n    defining: true,\n    parseDOM: [\n      { tag: 'h1', attrs: { level: 1 } },\n      { tag: 'h2', attrs: { level: 2 } },\n      { tag: 'h3', attrs: { level: 3 } },\n      { tag: 'h4', attrs: { level: 4 } },\n      { tag: 'h5', attrs: { level: 5 } },\n      { tag: 'h6', attrs: { level: 6 } },\n    ],\n    toDOM(node) {\n      return ['h' + node.attrs.level, 0];\n    },\n  },\n\n  // :: NodeSpec The text node.\n  text: {\n    group: 'inline',\n  },\n};\n\nconst emDOM = ['em', 0];\n\n// :: Object [Specs](#model.MarkSpec) for the marks in the schema.\nexport const marks = {\n  // :: MarkSpec A link. Has `href` and `title` attributes. `title`\n  // defaults to the empty string. Rendered and parsed as an `<a>`\n  // element.\n  link: {\n    attrs: {\n      href: {},\n      title: { default: null },\n    },\n    inclusive: false,\n    parseDOM: [\n      {\n        tag: 'a[href]',\n        getAttrs(dom) {\n          return { href: dom.getAttribute('href'), title: dom.getAttribute('title') };\n        },\n      },\n    ],\n    toDOM(node) {\n      let { href, title } = node.attrs;\n      return ['a', { href, title }, 0];\n    },\n  },\n\n  // :: MarkSpec An emphasis mark. Rendered as an `<em>` element.\n  // Has parse rules that also match `<i>` and `font-style: italic`.\n  em: {\n    parseDOM: [{ tag: 'i' }, { tag: 'em' }, { style: 'font-style=italic' }],\n    toDOM() {\n      return emDOM;\n    },\n  },\n};\n\n// :: Schema\n// This schema roughly corresponds to the document schema used by\n// [CommonMark](http://commonmark.org/), minus the list elements,\n// which are defined in the [`prosemirror-schema-list`](#schema-list)\n// module.\n//\n// To reuse elements from this schema, extend or read from its\n// `spec.nodes` and `spec.marks` [properties](#model.Schema.spec).\nexport const titleSchema = new Schema({ nodes: nodes as any, marks: marks as any });\n","import { Logger } from '@uprtcl/micro-orchestrator';\nimport { css, html, LitElement, property } from 'lit-element';\nimport { toggleMark } from 'prosemirror-commands';\nimport { DOMParser, DOMSerializer } from 'prosemirror-model';\nimport { EditorState, TextSelection } from 'prosemirror-state';\nimport { EditorView } from 'prosemirror-view';\nimport { TextType } from '../../types';\nimport { styles as cmStyle } from './codemirror.css';\nimport { CodeBlockView } from './codeview';\nimport { icons } from './icons';\nimport { iconsStyle } from './icons.css';\nimport { styles } from './prosemirror.css';\nimport { styles as theme } from './lesser-dark.css';\nimport { blockSchema } from './schema-block';\nimport { titleSchema } from './schema-title';\nimport { setBlockType } from 'prosemirror-commands';\n\nexport const APPEND_ACTION = 'append';\nexport const FOCUS_ACTION = 'focus';\n\nconst LOGINFO = false;\n\nenum ActiveSubMenu {\n  LINK = 'link',\n  IMAGE = 'image',\n  VIDEO = 'video'\n}\n\nexport class DocumentTextNodeEditor extends LitElement {\n  logger = new Logger('DOCUMENT-TEXT-NODE-EDITOR');\n\n  @property({ type: String })\n  type!: TextType;\n\n  @property({ type: String })\n  init!: string;\n\n  @property({ type: String, attribute: 'to-append' })\n  toAppend!: string;\n\n  @property({ type: String })\n  editable: string = 'true';\n\n  @property({ type: String, attribute: 'toggle-action' })\n  toggleAction: string = 'true';\n\n  @property({ type: Object })\n  action: any = {};\n\n  @property({ type: String, attribute: 'focus-init' })\n  focusInit: string = 'false';\n\n  @property({ type: Number })\n  level: number = 0;\n\n  @property({ attribute: false })\n  selected: Boolean = false;\n\n  @property({ attribute: false })\n  empty: Boolean = false;\n\n  @property({ attribute: false })\n  showMenu: Boolean = false;\n\n  @property({ attribute: false })\n  showUrlMenu: Boolean = false;\n\n  @property({  attribute: false })\n  showDimMenu: Boolean = false;\n\n  @property({ attribute: false })\n  activeSubMenu!: ActiveSubMenu | null;\n\n  editor: any = {};\n  preventHide: Boolean = false;\n  currentContent: string | undefined = undefined;\n\n  connectedCallback() {\n    super.connectedCallback();\n\n    this.addEventListener('blur', () => {\n      setTimeout(() => {\n        this.selected = false;\n      }, 200);\n    });\n  }\n\n  firstUpdated() {\n    this.initEditor();\n  }\n\n  updated(changedProperties: Map<string, any>) {\n    if (LOGINFO) this.logger.log('updated()', { changedProperties });\n\n    if (changedProperties.has('toggleAction')) {\n      if (changedProperties.get('toggleAction') !== undefined) {\n        this.runAction(this.action);\n      }\n    }\n\n    if (changedProperties.has('focusInit')) {\n      if (this.focusInit === 'true') {\n        this.editor.view.focus();\n      } else {\n        this.setShowMenu(false);\n      }\n    }\n\n    if (changedProperties.has('toAppend')) {\n      if (\n        changedProperties.get('toAppend') === undefined ||\n        changedProperties.get('toAppend') === 'undefined'\n      ) {\n        if (this.toAppend !== 'undefined') {\n          this.appendContent(this.toAppend);\n          this.dispatchEvent(new CustomEvent('content-appended'));\n        }\n      }\n    }\n\n    if (changedProperties.has('editable') || changedProperties.has('type')) {\n      // if (LOGINFO) this.logger.info('updated() - editable || type', {editable: this.editable, type: this.type, changedProperties});\n      this.initEditor();\n    }\n\n    if (changedProperties.has('init')) {\n      if (this.init !== this.currentContent) {\n        this.initEditor();\n        return;\n      }\n    }\n\n    if (changedProperties.has('showUrlMenu') && this.showUrlMenu && this.shadowRoot != null) {\n      const input = this.shadowRoot.getElementById('URL_INPUT');\n      if (input) {\n        input.focus();\n      }\n    }\n  }\n\n  runAction(action: any) {\n    if (LOGINFO) this.logger.log('runAction()', { action });\n    switch (action.name) {\n      case APPEND_ACTION:\n        this.appendContent(action.pars.content);\n        break;\n\n      case FOCUS_ACTION:\n        if (LOGINFO) this.logger.log('focusing()');\n        this.editor.view.focus();\n        break;\n\n      default:\n        throw new Error(`unexpected action ${action.name}`);\n    }\n  }\n\n  getValidInnerHTML(text: string) {\n    if (text.startsWith('<h1') || text.startsWith('<p')) {\n      const temp = document.createElement('template');\n      temp.innerHTML = text.trim();\n      if (temp.content.firstElementChild == null) {\n        return '';\n      }\n      return temp.content.firstElementChild.innerHTML;\n    } else {\n      return text;\n    }\n  }\n\n  getValidDocHtml(text: string) {\n    const innerHTML = this.getValidInnerHTML(text);\n    let tag = this.type === TextType.Title ? 'h1' : 'p';\n    return `<${tag}>${innerHTML}</${tag}>`;\n  }\n\n  getSlice(text: string) {\n    const htmlString = this.getValidDocHtml(text);\n    if (!htmlString) return undefined;\n\n    let temp = document.createElement('template');\n    temp.innerHTML = htmlString;\n\n    return temp.content.firstChild;\n  }\n\n  appendContent(content: string) {\n    if (LOGINFO) this.logger.log('appending content', content);\n\n    const sliceNode = this.getSlice(content);\n    const slice = this.editor.parser.parseSlice(sliceNode);\n\n    const end = this.editor.view.state.doc.content.content[0].nodeSize;\n\n    this.editor.view.dispatch(this.editor.view.state.tr.replace(end - 1, end, slice));\n\n    this.editor.view.dispatch(\n      this.editor.view.state.tr.setSelection(\n        TextSelection.near(this.editor.view.state.doc.resolve(end - 1))\n      )\n    );\n\n    this.editor.view.focus();\n  }\n\n  enterPressedEvent(content, asChild) {\n    this.dispatchEvent(\n      new CustomEvent('enter-pressed', {\n        detail: {\n          content,\n          asChild\n        }\n      })\n    );\n  }\n\n  keydown(view, event) {\n    if (LOGINFO) this.logger.log('keydown()', { keyCode: event.keyCode });\n\n    /** enter */\n    if (event.keyCode === 13) {\n      event.preventDefault();\n\n      /** simulate splitBlock */\n      const splitTr = view.state.tr.split(view.state.selection.$cursor.pos);\n\n      /** applied just to get the second part, the actual transaction\n       * is applied in dispatch */\n      const newState = view.state.apply(splitTr);\n      const secondPart = newState.doc.content.content[1];\n\n      view.dispatch(splitTr.delete(view.state.selection.$cursor.pos, view.state.doc.nodeSize));\n\n      /** send event to parent */\n      const fragment = this.editor.serializer.serializeFragment(secondPart);\n      const temp = document.createElement('div');\n      temp.appendChild(fragment);\n      const content = temp.innerHTML;\n\n      if (LOGINFO) this.logger.log('enter-pressed', { content });\n      this.enterPressedEvent(content, this.type === TextType.Title);\n      return;\n    }\n\n    // 27 is esc\n    if (event.keyCode === 27) {\n      if (this.showMenu) {\n        event.preventDefault();\n        this.preventHide = false;\n        this.showUrlMenu = false;\n        this.setShowMenu(false);\n      }\n    }\n\n    /** backspace */\n    if (event.keyCode === 8) {\n      if (view.state.selection.$cursor.pos === 1) {\n        event.preventDefault();\n\n        const content = this.state2Html(view.state);\n        if (LOGINFO) this.logger.log('backspace-on-start', { content });\n        this.dispatchEvent(\n          new CustomEvent('backspace-on-start', {\n            bubbles: true,\n            composed: true,\n            detail: {\n              content\n            }\n          })\n        );\n      }\n      return;\n    }\n\n    /** delete */\n    if (event.keyCode === 46) {\n      if (view.state.selection.$cursor.pos >= view.state.doc.content.content[0].nodeSize - 1) {\n        event.preventDefault();\n\n        const content = this.state2Html(view.state);\n        if (LOGINFO) this.logger.log('backspace-on-start', { content });\n        this.dispatchEvent(new CustomEvent('delete-on-end'));\n      }\n      return;\n    }\n\n    /** arrow up */\n    if (event.keyCode === 38) {\n      if (view.state.selection.$cursor.pos === 1) {\n        event.preventDefault();\n        if (LOGINFO) this.logger.log('dispatching keyup-on-start');\n        this.dispatchEvent(new CustomEvent('keyup-on-start'));\n        return;\n      }\n    }\n\n    /** arrow down */\n    if (event.keyCode === 40) {\n      if (view.state.selection.$cursor.pos >= view.state.doc.content.content[0].nodeSize - 1) {\n        event.preventDefault();\n        this.dispatchEvent(new CustomEvent('keydown-on-end'));\n        return;\n      }\n    }\n\n    /** (B)old */\n    /** backspace */\n    if (event.keyCode === 66) {\n      if (event.ctrlKey === true) {\n        event.preventDefault();\n        toggleMark(this.editor.view.state.schema.marks.strong)(\n          this.editor.view.state,\n          this.editor.view.dispatch\n        );\n      }\n      return;\n    }\n\n    if (event.keyCode === 74) {\n      if (event.ctrlKey === true) {\n        event.preventDefault();\n        toggleMark(this.editor.view.state.schema.marks.em)(\n          this.editor.view.state,\n          this.editor.view.dispatch\n        );\n      }\n      return;\n    }\n\n    if (event.keyCode === 75) {\n      if (event.ctrlKey === true) {\n        event.preventDefault();\n        this.subMenuConfirm();\n      }\n      return;\n    }\n  }\n\n  isEditable() {\n    if (LOGINFO) this.logger.log(`isEditable()`, { editable: this.editable });\n    const editable = this.editable !== undefined ? this.editable === 'true' : false;\n    return editable;\n  }\n\n  initEditor() {\n    if (this.editor && this.editor.view) {\n      this.editor.view.destroy();\n      this.editor = {};\n      if (LOGINFO)\n        this.logger.log(`initEditor() - Initializing editor`, {\n          init: this.init\n        });\n    }\n\n    const schema = this.type === TextType.Title ? titleSchema : blockSchema;\n    this.editor.parser = DOMParser.fromSchema(schema);\n    this.editor.serializer = DOMSerializer.fromSchema(schema);\n\n    this.currentContent = this.init;\n    const doc = this.html2doc(this.getValidDocHtml(this.init));\n    /** the heading level for render is given by the `level` attribute,\n     * not the heading tag (which is always <h1> in the data text) */\n    if (doc.content.content[0].type.name === 'heading') {\n      doc.content.content[0].attrs.level = this.level;\n    }\n\n    const state = EditorState.create({\n      schema: schema,\n      doc: doc,\n      plugins: []\n    });\n\n    if (this.shadowRoot == null) return;\n    const container = this.shadowRoot.getElementById('editor-content');\n\n    this.editor.view = new EditorView(container as Node, {\n      state: state,\n      editable: () => this.isEditable(),\n      dispatchTransaction: transaction => this.dispatchTransaction(transaction),\n      handleDOMEvents: {\n        focus: () =>\n          this.dispatchEvent(\n            new CustomEvent('focus-changed', {\n              bubbles: true,\n              composed: true,\n              detail: { value: true }\n            })\n          ),\n        blur: () => {\n          this.dispatchEvent(\n            new CustomEvent('focus-changed', {\n              bubbles: true,\n              composed: true,\n              detail: { value: false }\n            })\n          )\n          return true;\n        },\n        keydown: (view, event) => {\n          this.keydown(view, event);\n          return true;\n        },\n        dblclick: (view, event) => {\n          this.setShowMenu(true);\n          return true;\n        }\n      },\n      nodeViews: {\n        code_block: (node, view, getPos) =>\n          new CodeBlockView(node, view, getPos, () => this.enterPressedEvent('', false))\n      }\n    });\n\n    if (this.focusInit === 'true') {\n      this.editor.view.focus();\n    }\n  }\n\n  state2Html(state: EditorState) {\n    const fragment = this.editor.serializer.serializeFragment(state.doc);\n\n    const node = state.doc.content.child(0);\n    const temp = document.createElement('div');\n    temp.appendChild(fragment);\n    /** heading and paragraph content are stored without the exernal tag */\n    if (node.type.name === 'code_block') {\n      return (temp as HTMLElement).innerHTML;\n    } else {\n      return (temp.firstElementChild as HTMLElement).innerHTML;\n    }\n  }\n\n  html2doc(text: string) {\n    /** convert HTML string to doc state */\n    let temp = document.createElement('template');\n    temp.innerHTML = text;\n    const element = temp.content.firstChild;\n\n    return this.editor.parser.parse(element);\n  }\n\n  dispatchTransaction(transaction: any) {\n    if (!transaction.curSelection.empty) {\n      this.selected = true;\n      this.setShowMenu(true);\n    } else {\n      this.selected = false;\n    }\n\n    const content = this.state2Html(this.editor.view.state);\n    let newState = this.editor.view.state.apply(transaction);\n\n    let contentChanged = !newState.doc.eq(this.editor.view.state.doc);\n    this.editor.view.updateState(newState);\n\n    if (LOGINFO)\n      this.logger.log('dispatchTransaction()', {\n        selected: this.selected,\n        newState,\n        contentChanged,\n        transaction\n      });\n\n    if (!contentChanged) return;\n\n    /** doc changed */\n\n    const newContent = this.state2Html(newState);\n\n    if (LOGINFO)\n      this.logger.log(`dispatchTransaction() - content-changed`, {\n        content,\n        newContent\n      });\n\n    /** local copy of the html (withot the external tag) represeting the current state */\n    this.currentContent = newContent;\n\n    this.dispatchEvent(\n      new CustomEvent('content-changed', {\n        detail: {\n          content: newContent\n        }\n      })\n    );\n  }\n\n  toHeading(lift: boolean) {\n    this.changeType(TextType.Title, lift);\n  }\n\n  toParagraph() {\n    this.changeType(TextType.Paragraph, false);\n  }\n\n  reduceHeading() {\n    this.dispatchEvent(new CustomEvent('lift-heading', {}));\n  }\n\n  changeType(type: TextType, lift: boolean) {\n    this.dispatchEvent(\n      new CustomEvent('change-type', {\n        detail: { type, lift }\n      })\n    );\n  }\n\n  urlKeydown(event) {\n    // 27 is esc\n    if (event.keyCode === 27) {\n      if (this.showMenu) {\n        event.preventDefault();\n        this.subMenuCancel();\n      }\n    }\n\n    // 13 is enter\n    if (event.keyCode === 13) {\n      if (this.showMenu) {\n        event.preventDefault();\n        this.subMenuConfirm();\n      }\n    }\n  }\n\n  async setShowMenu(value: boolean) {\n    if (!this.shadowRoot) return;\n\n    if (this.editable !== 'true') {\n      this.showMenu = false;\n      return;\n    }\n\n    this.showMenu = value;\n    this.requestUpdate();\n\n    if (value === true) {\n      await this.updateComplete;\n\n      const menu = this.shadowRoot.getElementById('TOP_MENU');\n      if (!menu) return;\n\n      /** listen events */\n      menu.addEventListener('keydown', event => {\n        if (event.keyCode === 27) {\n          // 27 is esc\n          event.stopPropagation();\n          this.setShowMenu(false);\n        }\n      });\n    } else {\n      if (this.preventHide) {\n        this.editor.view.focus();\n      }\n    }\n  }\n\n  subMenuClick(type: ActiveSubMenu) {\n    if (this.activeSubMenu !== type) {\n      this.activeSubMenu = type;\n      this.preventHide = true;\n      this.showUrlMenu = true;\n\n      if (\n        this.activeSubMenu === ActiveSubMenu.IMAGE ||\n        this.activeSubMenu === ActiveSubMenu.VIDEO\n      ) {\n        this.showDimMenu = true;\n      } else {\n        this.showDimMenu = false;\n      }\n    } else {\n      this.resetSubMenu();\n    }\n  }\n\n  private resetSubMenu() {\n    this.preventHide = false;\n    this.activeSubMenu = null;\n    this.showDimMenu = false;\n    this.showUrlMenu = false;\n  }\n\n  subMenuConfirm() {\n    switch (this.activeSubMenu) {\n      case ActiveSubMenu.LINK:\n        this.applyLinkMark();\n        break;\n      case ActiveSubMenu.IMAGE:\n        this.applyImageNode();\n        break;\n      case ActiveSubMenu.VIDEO:\n        this.applyIframeNode();\n        break;\n    }\n\n    this.resetSubMenu();\n  }\n\n  subMenuCancel() {\n    this.resetSubMenu();\n    this.setShowMenu(false);\n  }\n\n  private isValidLink(link: string) {\n    if (!link.startsWith('http')) {\n      link = `http://${link}`;\n    }\n    try {\n      new URL(link);\n    } catch (_) {\n      return false;\n    }\n\n    return link;\n  }\n\n  getSubMenuFields() {\n    if (this.shadowRoot == null) return { link: '', width: '', height: '' };\n\n    return {\n      link: (this.shadowRoot.getElementById('URL_INPUT') as HTMLInputElement).value,\n      width: this.shadowRoot.getElementById('DIM_WIDTH') ? (this.shadowRoot.getElementById('DIM_WIDTH') as HTMLInputElement).value : '',\n      height: this.shadowRoot.getElementById('DIM_HEIGHT') ? (this.shadowRoot.getElementById('DIM_HEIGHT') as HTMLInputElement).value : ''\n    };\n  }\n\n  applyLinkMark() {\n    const { link } = this.getSubMenuFields();\n\n    const href = this.isValidLink(link);\n    if (href) {\n      toggleMark(this.editor.view.state.schema.marks.link, { href })(\n        this.editor.view.state,\n        this.editor.view.dispatch\n      );\n      this.preventHide = false;\n      this.selected = false;\n    }\n  }\n\n  alignNodeToCenter() {\n    setBlockType(this.editor.view.state.schema.nodes.paragraph, {\n      style: 'text-align:center'\n    })(this.editor.view.state, this.editor.view.dispatch);\n  }\n\n  applyImageNode() {\n    const { link, width, height } = this.getSubMenuFields();\n    if (this.isValidLink(link)) {\n      const node = this.editor.view.state.doc.content.content[0];\n      const end = node.nodeSize;\n      const imgNode = this.editor.view.state.schema.nodes.image.create({\n        src: link,\n        style: `${width !== '' ? `width:${width}px` : ''};${\n          height !== '' ? `height:${height}px` : ''\n          };max-width: 100%;margin: 0 auto;border-radius: 5px;`\n      });\n      this.dispatchTransaction(this.editor.view.state.tr.replaceSelectionWith(imgNode, false));\n      this.alignNodeToCenter();\n      // this.editor.view.dispatch();\n    }\n  }\n\n  parseYoutubeURL(url: string) {\n    const getParameterByName = (name, url) => {\n      name = name.replace(/[\\[\\]]/g, '\\\\$&');\n      var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),\n        results = regex.exec(url);\n      if (!results) return null;\n      if (!results[2]) return '';\n      return decodeURIComponent(results[2].replace(/\\+/g, ' '));\n    };\n\n    let embedUrl = 'https://www.youtube.com/embed';\n\n    // For when the user copies the youtube video URL\n    // on the address bar\n    if (url.indexOf('?v=') > -1) {\n      const videoId = getParameterByName('v', url);\n      embedUrl += `/${videoId}`;\n      // For when the user right-clicks on the video and\n      // copies the \"video url\"\n    } else if (url.indexOf('youtu.be') > -1) {\n      embedUrl += `/${url.split('/').pop()}`;\n\n      // If none of these patterns match, do not parse\n      // the given URL by the user.\n    } else {\n      return url;\n    }\n\n    return embedUrl;\n  }\n\n  applyIframeNode() {\n    const { link, width, height } = this.getSubMenuFields();\n    if (this.isValidLink(link)) {\n      const iframeNode = this.editor.view.state.schema.nodes.iframe.create({\n        src: this.parseYoutubeURL(link),\n        style: `width:${\n          width !== '' ? width + 'px' : '100%'\n          };height:52vw;border:0px;max-width:100%;max-height:470px;`\n      });\n\n      this.dispatchTransaction(this.editor.view.state.tr.replaceSelectionWith(iframeNode, false));\n      this.alignNodeToCenter();\n    }\n  }\n\n  menuItemClick(markType: any) {\n    this.preventHide = false;\n    toggleMark(markType)(this.editor.view.state, this.editor.view.dispatch);\n    this.resetSubMenu();\n  }\n\n  editorFocused() {\n    if (LOGINFO) this.logger.log('editor focused');\n  }\n\n  editorBlured() {\n    if (LOGINFO) this.logger.log('editor blured');\n  }\n\n  renderDimensionsMenu() {\n    // incase we want the height field back\n    // const renderHeightDim = () => html`\n    //   <input @keydown=${this.urlKeydown} class=\"dim\" placeholder=\"height\" id=\"DIM_HEIGHT\" />px\n    // `;\n    return html`\n      <input\n        @keydown=${this.urlKeydown}\n        class=\"dim\"\n        placeholder=\"width (optional)\"\n        id=\"DIM_WIDTH\"\n      />\n    `;\n  }\n\n  renderUrlMenu() {\n    return html`\n      <div class=\"inp\">\n        <div class=\"inp-hldr\">\n          <input\n            @keydown=${this.urlKeydown}\n            placeholder=\"${this.activeSubMenu !== ActiveSubMenu.LINK\n        ? this.activeSubMenu + ' '\n        : ''}url\"\n            id=\"URL_INPUT\"\n          />\n          ${this.showDimMenu ? this.renderDimensionsMenu() : ''}\n        </div>\n        <div class=\"inp-actions\">\n          <button @click=${this.subMenuCancel} class=\"btn btn-small\">\n            ${icons.cross}\n          </button>\n          <button @click=${this.subMenuConfirm} class=\"btn btn-small\">\n            ${icons.check}\n          </button>\n        </div>\n      </div>\n    `;\n  }\n\n  renderParagraphItems() {\n    return html`\n      ${this.level > 2\n        ? html`\n            <button class=\"btn btn-text\" @click=${() => this.toHeading(true)}>\n              <span>h${this.level - 1}</span>\n            </button>\n          `\n        : ''}\n      <button class=\"btn btn-text\" @click=${() => this.toHeading(false)}>\n        <span>h${this.level}</span>\n      </button>\n    `;\n  }\n\n  renderHeadingItems() {\n    return this.level > 1\n      ? html`\n          ${this.level > 2\n          ? html`\n                <button class=\"btn btn-text\" @click=${() => this.reduceHeading()}>\n                  <span>h${this.level - 1}</span>\n                </button>\n              `\n          : ''}\n          <button class=\"btn btn-text\" @click=${this.toParagraph}>\n            <span>text</span>\n          </button>\n        `\n      : '';\n  }\n\n  renderLevelControllers() {\n    return html`\n      <!-- level controllers -->\n      ${this.type === TextType.Paragraph ? this.renderParagraphItems() : this.renderHeadingItems()}\n    `;\n  }\n\n  /**\n   * Menus that needs to show up only when there is a `selection`\n   */\n\n  renderSelectionOnlyMenus(type: string) {\n    const menus = html`\n      ${this.renderLevelControllers()}\n      ${this.type !== TextType.Title\n        ? html`\n            <button\n              class=\"btn btn-square btn-large\"\n              @click=${() => this.menuItemClick(this.editor.view.state.schema.marks.strong)}\n            >\n              ${icons.bold}\n            </button>\n          `\n        : ''}\n      <button\n        class=\"btn btn-square btn-large\"\n        @click=${() => this.menuItemClick(this.editor.view.state.schema.marks.em)}\n      >\n        ${icons.em}\n      </button>\n\n      <button\n        class=\"btn btn-square btn-small\"\n        @click=${() => this.subMenuClick(ActiveSubMenu.LINK)}\n      >\n        ${icons.link}\n      </button>\n    `;\n    return this.hasSelection() && type !== 'code' ? menus : '';\n  }\n\n  hasSelection() {\n    if (this.editor.view.state.selection.from > 1 || this.editor.view.state.selection.to > 1) {\n      return true;\n    }\n    return false;\n  }\n\n  toggleCode() {\n    const node = this.editor.view.state.doc.content.content[0];\n    const end = node.nodeSize;\n    const newType =\n      node.type.name !== 'code_block' ? blockSchema.nodes.code_block : blockSchema.nodes.paragraph;\n\n    this.editor.view.dispatch(this.editor.view.state.tr.setBlockType(0, end, newType));\n  }\n\n  renderMenu() {\n    const embedSubMenu = html`\n      <button\n        class=\"btn btn-square btn-small\"\n        @click=${() => this.subMenuClick(ActiveSubMenu.IMAGE)}\n      >\n        ${icons.image}\n      </button>\n\n      <button\n        class=\"btn btn-square btn-small\"\n        @click=${() => this.subMenuClick(ActiveSubMenu.VIDEO)}\n      >\n        ${icons.youtube}\n      </button>\n    `;\n    const codeSubMenu = html`\n      <button class=\"btn btn-square btn-small\" @click=${this.toggleCode}>\n        ${icons.code}\n      </button>\n    `;\n    const type = this.getBlockType();\n    return html`\n      <div class=\"top-menu\" id=\"TOP_MENU\">\n        <!-- icons from https://material.io/resources/icons/?icon=format_bold&style=round  -->\n\n        <div class=\"menus\">\n          <!-- current level -->\n          <button class=\"btn-text btn-current\">\n            <span>${type}</span>\n          </button>\n          ${this.renderSelectionOnlyMenus(type)}\n          ${this.type === 'Paragraph' && type !== 'code' ? embedSubMenu : ''}\n          ${this.type !== 'Title' ? codeSubMenu : ''}\n        </div>\n        ${this.showUrlMenu && type !== 'code' ? this.renderUrlMenu() : ''}\n      </div>\n    `;\n  }\n\n  getBlockType() {\n    const nodeType = (this.editor.view as EditorView).state.doc.child(0).type;\n\n    if (nodeType && nodeType.name === 'code_block') {\n      return 'code';\n    }\n\n    return this.type === TextType.Title ? `h${this.level}` : 'text';\n  }\n\n  render() {\n    if (LOGINFO) this.logger.log('render()', { this: this });\n    return html`\n      ${this.showMenu ? this.renderMenu() : ''}\n      <div \n        id=\"editor-content\" \n        class=\"editor-content\">\n      </div>\n    `;\n  }\n\n  static get styles() {\n    return [\n      cmStyle,\n      styles,\n      iconsStyle,\n      theme,\n      css`\n        :host {\n          position: relative;\n          width: 100%;\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, 'Apple Color Emoji',\n            Arial, sans-serif, 'Segoe UI Emoji', 'Segoe UI Symbol';\n        }\n\n        a {\n          color: inherit;\n        }\n\n        .top-menu {\n          z-index: 10;\n          position: absolute;\n          padding: 0px 0px;\n          height: initial;\n          top: -50px;\n          left: 25px;\n          background-color: white;\n          border-radius: 10px;\n          border: solid 1px #cfcfcf;\n          background-color: #28282a60;\n          display: flex;\n          flex-direction: column;\n          overflow: hidden;\n          max-width: calc(100vw - 50px);\n        }\n\n        .top-menu .menus {\n          display: flex;\n          justify-content: center;\n          align-items: center;\n        }\n\n        .top-menu button {\n          font-family: inherit;\n          font-size: 100%;\n          line-height: 1.15;\n          margin: 0;\n          overflow: visible;\n          text-transform: none;\n          background-color: transparent;\n          border: 0px;\n        }\n\n        .btn {\n          cursor: pointer;\n          border-radius: 8px;\n          text-align: center;\n          fill: white;\n          color: white;\n        }\n\n        .btn:hover {\n          background-color: #444444;\n          transition: background-color 100ms linear;\n        }\n\n        .btn-text {\n          color: white;\n          padding: 12px 16px;\n          font-weight: bold;\n        }\n\n        .btn-current {\n          text-decoration: underline;\n          user-select: none;\n        }\n\n        .btn-square {\n          width: 40px;\n        }\n\n        .btn-large svg {\n          margin-top: 6px;\n          width: 30px;\n          height: 30px;\n        }\n\n        .btn-small svg {\n          margin-top: 8px;\n          width: 26px;\n          height: 26px;\n        }\n\n        .inp {\n          display: flex;\n          padding: 0 10px 7px 10px;\n        }\n        .inp-actions {\n          display: flex;\n        }\n\n        .inp input {\n          height: 38px;\n          font-size: 14px;\n          padding-left: 12px;\n          border: none;\n          background-color: #444444;\n          color: white;\n          margin: 0 5px 0 0;\n          border-radius: 6px;\n        }\n\n        .inp input#URL_INPUT {\n          flex-grow: 1;\n        }\n\n        .inp input.dim {\n          width: 100px;\n          margin-left: 5px;\n        }\n\n        .inp .inp-hldr {\n          display: flex;\n          flex-grow: 1;\n          color: white;\n          align-items: center;\n          margin-right: 5px;\n        }\n\n        @media (max-width: 768px) {\n          .inp {\n            flex-direction: column;\n            overflow: auto;\n          }\n          .top-menu {\n            max-width: 80vw;\n          }\n          .inp input#URL_INPUT {\n            width: 50%;\n          }\n          .inp input.dim {\n            width: 50%;\n          }\n          .inp-actions {\n            justify-content: center;\n          }\n        }\n\n        .editor-content {\n          margin: 0px 0px;\n        }\n\n        .yt-embed {\n          max-width: 100%;\n        }\n\n        @media (max-width: 768px) {\n          .yt-embed {\n            max-height: 300px;\n          }\n        }\n      `\n    ];\n  }\n}\n","import { LitElement, property, html, css } from 'lit-element';\nimport { ApolloClient } from 'apollo-boost';\nimport isEqual from 'lodash-es/isEqual';\n\nimport { ApolloClientModule } from '@uprtcl/graphql';\n\nconst styleMap = style => {\n  return Object.entries(style).reduce((styleString, [propName, propValue]) => {\n    propName = propName.replace(/([A-Z])/g, matches => `-${matches[0].toLowerCase()}`);\n    return `${styleString}${propName}:${propValue};`;\n  }, '');\n};\n\nimport { moduleConnect, Logger } from '@uprtcl/micro-orchestrator';\nimport { HasChildren, CortexModule, PatternRecognizer, Entity } from '@uprtcl/cortex';\nimport {\n  EveesRemote,\n  EveesModule,\n  UPDATE_HEAD,\n  eveeColor,\n  ContentUpdatedEvent,\n  CREATE_ENTITY,\n  EveesDraftsLocal,\n  EveesHelpers,\n  deriveSecured,\n  Perspective,\n  Secured,\n  hashObject,\n  EveesConfig\n} from '@uprtcl/evees';\nimport { MenuConfig } from '@uprtcl/common-ui';\nimport { loadEntity } from '@uprtcl/multiplatform';\n\nimport { TextType, DocNode } from '../types';\nimport { HasDocNodeLenses } from '../patterns/document-patterns';\nimport { icons } from './prosemirror/icons';\nimport { DocumentsBindings } from '../bindings';\n\nconst LOGINFO = false;\nconst SELECTED_BACKGROUND = 'rgb(200,200,200,0.2);';\nconst PLACEHOLDER_TOKEN = '_PLACEHOLDER_';\n\nexport class DocumentEditor extends moduleConnect(LitElement) {\n  logger = new Logger('DOCUMENT-EDITOR');\n\n  @property({ type: String, attribute: 'uref' })\n  firstRef!: string;\n\n  @property({ attribute: false })\n  uref!: string;\n\n  @property({ type: String, attribute: 'official-owner' })\n  officialOwner!: string;\n\n  @property({ type: Boolean, attribute: 'check-owner' })\n  checkOwner: boolean = false;\n\n  @property({ type: Boolean, attribute: 'read-only' })\n  readOnly: boolean = false;\n\n  @property({ type: Number, attribute: 'root-level' })\n  rootLevel: number = 0;\n\n  @property({ type: String })\n  parentId: string = '';\n\n  @property({ type: String, attribute: 'default-type' })\n  defaultType: string = EveesModule.bindings.PerspectiveType;\n\n  @property({ type: Boolean, attribute: 'show-info' })\n  renderInfo: boolean = false;\n\n  @property({ attribute: false })\n  docHasChanges: boolean = false;\n\n  @property({ attribute: false })\n  persistingAll: boolean = false;\n\n  @property({ type: Boolean, attribute: false })\n  showCommitMessage: boolean = false;\n\n  @property({ type: String })\n  color!: string;\n\n  @property({ attribute: false })\n  reloading: boolean = true;\n\n  @property({ attribute: false })\n  checkedOutPerspectives: { [key: string]: { firstUref: string; newUref: string } } = {};\n\n  doc: DocNode | undefined = undefined;\n  client!: ApolloClient<any>;\n\n  protected remotes!: EveesRemote[];\n  protected recognizer!: PatternRecognizer;\n  protected editableRemotesIds!: string[];\n\n  draftService = new EveesDraftsLocal();\n\n  async firstUpdated() {\n    this.remotes = this.requestAll(EveesModule.bindings.EveesRemote);\n    this.recognizer = this.request(CortexModule.bindings.Recognizer);\n    const config = this.request(EveesModule.bindings.Config) as EveesConfig;\n    this.editableRemotesIds = config.editableRemotesIds ? config.editableRemotesIds : [];\n\n    if (!this.client) {\n      this.client = this.request(ApolloClientModule.bindings.Client);\n    }\n\n    this.uref = this.firstRef;\n\n    if (LOGINFO) this.logger.log('firstUpdated()', this.uref);\n\n    await this.loadDoc();\n    this.reloading = false;\n  }\n\n  updated(changedProperties) {\n    if (LOGINFO)\n      this.logger.log('updated()', { uref: this.uref, firstRef: this.firstRef, changedProperties });\n\n    let reload: boolean = false;\n\n    if (changedProperties.has('firstRef')) {\n      this.uref = this.firstRef;\n    }\n    if (changedProperties.has('uref')) {\n      reload = true;\n    }\n    if (changedProperties.has('client')) {\n      reload = true;\n    }\n    if (changedProperties.has('editable')) {\n      reload = true;\n    }\n    if (reload) {\n      this.reload();\n    }\n  }\n\n  async reload() {\n    this.reloading = true;\n    await this.loadDoc();\n    this.reloading = false;\n  }\n\n  async loadDoc() {\n    if (!this.client) return;\n\n    if (LOGINFO) this.logger.log('loadDoc()', this.uref);\n\n    if (!this.uref) return;\n    this.doc = await this.loadNodeRec(this.uref);\n    this.requestUpdate();\n  }\n\n  async loadNodeRec(uref: string, ix?: number, parent?: DocNode): Promise<DocNode> {\n    if (LOGINFO) this.logger.log('loadNodeRec()', { uref, ix, parent });\n\n    const node = await this.loadNode(uref, parent, ix);\n\n    const loadChildren = node.hasChildren.getChildrenLinks({ id: '', object: node.draft }).map(\n      async (child, ix): Promise<DocNode> => {\n        return child !== undefined && child !== ''\n          ? await this.loadNodeRec(child, ix, node)\n          : node.childrenNodes[ix];\n      }\n    );\n\n    node.parent = parent;\n    node.childrenNodes = await Promise.all(loadChildren);\n\n    /** focus if top element */\n    if (node.uref === this.uref && node.editable) {\n      node.focused = true;\n    }\n\n    return node;\n  }\n\n  async refToNode(uref: string, parent?: DocNode, ix?: number) {\n    const entity = await loadEntity(this.client, uref);\n    if (!entity) throw Error(`Entity not found ${uref}`);\n\n    let entityType: string = this.recognizer.recognizeType(entity);\n\n    let editable = false;\n    let remoteId: string | undefined;\n    let context: string | undefined;\n    let dataId: string | undefined;\n    let headId: string | undefined;\n\n    if (entityType === EveesModule.bindings.PerspectiveType) {\n      remoteId = await EveesHelpers.getPerspectiveRemoteId(this.client, entity.id);\n\n      const remote = this.remotes.find(r => r.id === remoteId);\n      if (!remote) throw new Error(`remote not found for ${remoteId}`);\n\n      let canWrite: boolean = false;\n\n      if (!this.readOnly) {\n        const editableRemote =\n          this.editableRemotesIds.length > 0 ? this.editableRemotesIds.includes(remote.id) : true;\n        if (editableRemote) {\n          canWrite = await EveesHelpers.canWrite(this.client, uref);\n        }\n      }\n\n      if (!this.readOnly) {\n        editable = canWrite;\n        headId = await EveesHelpers.getPerspectiveHeadId(this.client, entity.id);\n        dataId =\n          headId !== undefined\n            ? await EveesHelpers.getCommitDataId(this.client, headId)\n            : undefined;\n      } else {\n        editable = false;\n        dataId = await EveesHelpers.getPerspectiveDataId(this.client, entity.id);\n        context = '';\n        headId = '';\n      }\n    } else {\n      if (entityType === EveesModule.bindings.CommitType) {\n        if (!parent) throw new Error('Commit must have a parent');\n\n        editable = parent.editable;\n        remoteId = parent.remote;\n        dataId = await EveesHelpers.getCommitDataId(this.client, entity.id);\n        headId = uref;\n      } else {\n        entityType = 'Data';\n        editable = false;\n        remoteId = '';\n        dataId = uref;\n        headId = '';\n      }\n    }\n\n    if (!dataId || !entityType) throw Error(`data not loaded for uref ${this.uref}`);\n\n    // TODO get data and patterns hasChildren/hasDocNodeLenses from query\n    const data: Entity<any> | undefined = await loadEntity(this.client, dataId);\n    if (!data) throw Error('Data undefined');\n\n    const hasChildren: HasChildren = this.recognizer\n      .recognizeBehaviours(data)\n      .find(b => (b as HasChildren).getChildrenLinks);\n    const hasDocNodeLenses: HasDocNodeLenses = this.recognizer\n      .recognizeBehaviours(data)\n      .find(b => (b as HasDocNodeLenses).docNodeLenses);\n\n    if (!hasChildren) throw Error('hasChildren undefined');\n    if (!hasDocNodeLenses) throw Error('hasDocNodeLenses undefined');\n\n    /** disable editable */\n    if (this.readOnly) {\n      editable = false;\n    }\n\n    // Add node coordinates\n    const coord = this.setNodeCoordinates(parent, ix);\n\n    // Add node level\n    const level = this.setNodeLevel(coord);\n\n    const node: DocNode = {\n      uref: entity.id,\n      isPlaceholder: false,\n      type: entityType,\n      ix,\n      hasChildren,\n      childrenNodes: [],\n      data,\n      draft: data ? data.object : undefined,\n      coord,\n      level,\n      headId,\n      hasDocNodeLenses,\n      editable,\n      remote: remoteId,\n      context,\n      focused: false,\n      timestamp: Date.now()\n    };\n\n    return node;\n  }\n\n  setNodeCoordinates(parent?: DocNode, ix?: number) {\n    const currentIndex = ix ? ix : 0;\n    const coord = parent && parent.coord ? parent.coord.concat([currentIndex]) : [currentIndex];\n\n    return coord;\n  }\n\n  setNodeLevel(coord) {\n    return this.rootLevel + (coord.length - 1);\n  }\n\n  isPlaceholder(uref: string): boolean {\n    return uref.startsWith(PLACEHOLDER_TOKEN);\n  }\n\n  async loadNode(uref: string, parent?: DocNode, ix?: number): Promise<DocNode> {\n    if (LOGINFO) this.logger.log('loadNode()', { uref, ix });\n\n    let node;\n    if (this.isPlaceholder(uref)) {\n      const draft = await this.draftService.getDraft(uref);\n      node = this.draftToPlaceholder(draft, parent, ix);\n    } else {\n      node = await this.refToNode(uref, parent, ix);\n\n      /** initialize draft */\n      const draft = await this.draftService.getDraft(uref);\n      if (draft !== undefined) {\n        node.draft = draft;\n      }\n    }\n\n    if (LOGINFO) this.logger.log('loadNode() post', { uref, ix, node });\n\n    return node;\n  }\n\n  defaultEntity(text: string, type: TextType) {\n    return {\n      data: { text, type, links: [] },\n      entityType: DocumentsBindings.TextNodeType\n    };\n  }\n\n  hasChangesAll() {\n    if (!this.doc) return false;\n    return this.hasChangesRec(this.doc);\n  }\n\n  hasChanges(node: DocNode) {\n    if (node.uref === '') return true; // is placeholder\n    if (!node.data) return true;\n    if (!isEqual(node.data.object, node.draft)) return true;\n    return false;\n  }\n\n  hasChangesRec(node: DocNode) {\n    if (this.hasChanges(node)) return true;\n    const ix = node.childrenNodes.find(child => this.hasChangesRec(child));\n    if (ix !== undefined) return true;\n    return false;\n  }\n\n  performUpdate() {\n    this.docHasChanges = this.hasChangesAll();\n    // console.log({ hasChanges: this.docHasChanges });\n    let event = new CustomEvent('doc-changed', {\n      detail: {\n        docChanged: this.docHasChanges\n      }\n    });\n    this.dispatchEvent(event);\n    super.performUpdate();\n  }\n\n  async persistAll(message?: string) {\n    if (!this.doc) return;\n    this.persistingAll = true;\n\n    if (this.doc.remote === undefined) throw Error('top element must have an remote');\n\n    await this.preparePersistRec(this.doc, this.doc.remote, message);\n    await this.persistRec(this.doc);\n\n    /** reload doc from backend */\n    await this.loadDoc();\n    this.requestUpdate();\n\n    this.persistingAll = false;\n  }\n\n  async preparePersistRec(node: DocNode, defaultAuthority: string, message?: string) {\n    const prepareChildren = node.childrenNodes.map(child =>\n      this.preparePersistRec(child, defaultAuthority, message)\n    );\n    await Promise.all(prepareChildren);\n\n    /** set the children with the children refs (which were created above) */\n    const { object } = node.hasChildren.replaceChildrenLinks({\n      id: '',\n      object: node.draft\n    })(node.childrenNodes.map(node => node.uref));\n    this.setNodeDraft(node, object);\n\n    await this.preparePersist(node, defaultAuthority, message);\n  }\n\n  async derivePerspective(node: DocNode): Promise<Secured<Perspective>> {\n    const remoteInstance = this.remotes.find(r => r.id == node.remote);\n\n    if (!remoteInstance) throw new Error(`Remote not found for remote ${remoteInstance}`);\n\n    const creatorId = remoteInstance.userId ? remoteInstance.userId : '';\n\n    const context = await hashObject({\n      creatorId,\n      timestamp: node.timestamp\n    });\n\n    const perspective: Perspective = {\n      creatorId,\n      remote: remoteInstance.id,\n      path: remoteInstance.defaultPath,\n      timestamp: node.timestamp,\n      context\n    };\n\n    return deriveSecured<Perspective>(perspective, remoteInstance.store.cidConfig);\n  }\n\n  /* bottom up traverse the tree to set the uref of all placeholders */\n  async preparePersist(node: DocNode, defaultRemote: string, message?: string) {\n    if (!node.isPlaceholder) {\n      return;\n    }\n\n    switch (this.defaultType) {\n      case EveesModule.bindings.PerspectiveType:\n        node.remote = node.remote !== undefined ? node.remote : defaultRemote;\n        const secured = await this.derivePerspective(node);\n        node.uref = secured.id;\n        node.type = EveesModule.bindings.PerspectiveType;\n        break;\n\n      case EveesModule.bindings.CommitType:\n        throw new Error('TBD');\n      // const secured = await this.deriveCommit(node);\n      // node.uref = commitId;\n      // node.type = EveesModule.bindings.CommitType;\n      // break;\n\n      default:\n        throw new Error('TBD');\n      // const dataId = await this.createEntity(node.draft, node.remote);\n      // node.uref = dataId;\n      // break;\n    }\n  }\n\n  /* top down persist all new nodes in their backend */\n  async persistRec(node: DocNode) {\n    await this.persist(node);\n\n    const persistChildren = node.childrenNodes.map(child => this.persistRec(child));\n    await Promise.all(persistChildren);\n  }\n\n  async persist(node: DocNode, message: string = '') {\n    if (!node.isPlaceholder && node.data !== undefined && isEqual(node.data.object, node.draft)) {\n      /** nothing to persist here */\n      return;\n    }\n\n    switch (node.type) {\n      case EveesModule.bindings.PerspectiveType:\n        if (node.isPlaceholder) {\n          const perspectiveId = await this.createEvee(node);\n          if (perspectiveId !== node.uref) {\n            throw new Error(\n              `perspective id ${perspectiveId} of doc node not as expected ${node.uref}`\n            );\n          }\n        } else {\n          await this.updateEvee(node, message);\n        }\n        break;\n\n      case EveesModule.bindings.CommitType:\n        const commitParents = this.isPlaceholder(node.uref) ? [] : node.headId ? [node.headId] : [];\n\n        if (node.remote === undefined) throw new Error('undefined remote for node');\n\n        const commitId = await this.createCommit(node.draft, node.remote, commitParents, message);\n\n        if (commitId !== node.uref) {\n          throw new Error(`commit id ${commitId} of doc node not as expected ${node.uref}`);\n        }\n        break;\n    }\n\n    await this.draftService.removeDraft(node.placeholderRef ? node.placeholderRef : node.uref);\n  }\n\n  async createEntity(content: any, remote: string): Promise<string> {\n    const entityType = this.recognizer.recognizeType({\n      id: '',\n      object: content\n    });\n\n    const remoteInstance = this.remotes.find(r => r.id === remote);\n    if (!remoteInstance) throw new Error(`Remote not found for remote ${remote}`);\n    const store = remoteInstance.store;\n\n    const createTextNode = await this.client.mutate({\n      mutation: CREATE_ENTITY,\n      variables: {\n        object: content,\n        casID: store.casID\n      }\n    });\n\n    return createTextNode.data.createEntity.id;\n  }\n\n  async createCommit(\n    content: object,\n    remote: string,\n    parentsIds?: string[],\n    message?: string\n  ): Promise<string> {\n    const dataId = await this.createEntity(content, remote);\n\n    const remoteInstance = this.remotes.find(r => r.id === remote);\n    if (!remoteInstance) throw new Error(`Remote not found for remote ${remote}`);\n\n    return await EveesHelpers.createCommit(this.client, remoteInstance.store, {\n      dataId,\n      parentsIds\n    });\n  }\n\n  async updateEvee(node: DocNode, message?: string): Promise<void> {\n    if (node.remote === undefined) throw Error(`remote not defined for node ${node.uref}`);\n\n    const commitId = await this.createCommit(\n      node.draft,\n      node.remote,\n      node.headId ? [node.headId] : []\n    );\n\n    await this.client.mutate({\n      mutation: UPDATE_HEAD,\n      variables: {\n        perspectiveId: node.uref,\n        headId: commitId,\n        message\n      }\n    });\n\n    /** inform the external world if top element */\n    if (this.doc && node.uref === this.doc.uref) {\n      this.dispatchEvent(\n        new ContentUpdatedEvent({\n          bubbles: true,\n          composed: true,\n          detail: { uref: this.uref as string }\n        })\n      );\n    }\n  }\n\n  async createEvee(node: DocNode): Promise<string> {\n    if (node.remote === undefined) throw new Error('undefined remote for node');\n\n    if (LOGINFO) this.logger.log('createEvee()', { node });\n\n    const commitId = await this.createCommit(node.draft, node.remote);\n\n    const remoteInstance = this.remotes.find(r => r.id === node.remote);\n    if (!remoteInstance) throw new Error(`Remote not found for remote ${node.remote}`);\n\n    // using the same function used in preparePersist to get the same id\n    const secured = await this.derivePerspective(node);\n\n    return EveesHelpers.createPerspective(this.client, remoteInstance, {\n      ...secured.object.payload,\n      headId: commitId,\n      parentId: node.parent ? node.parent.uref : undefined\n    });\n  }\n\n  draftToPlaceholder(draft: any, parent?: DocNode, ix?: number): DocNode {\n    const draftForReco = { id: '', object: draft };\n    const hasChildren = this.recognizer\n      .recognizeBehaviours(draftForReco)\n      .find(b => (b as HasChildren).getChildrenLinks);\n\n    const hasDocNodeLenses = this.recognizer\n      .recognizeBehaviours(draftForReco)\n      .find(b => (b as HasDocNodeLenses).docNodeLenses);\n\n    if (!hasChildren)\n      throw new Error(`hasChildren not found for object ${JSON.stringify(draftForReco)}`);\n    if (!hasDocNodeLenses)\n      throw new Error(`hasDocNodeLenses not found for object ${JSON.stringify(draftForReco)}`);\n\n    const randint = 0 + Math.floor((10000 - 0) * Math.random());\n    const uref = PLACEHOLDER_TOKEN + `-${ix !== undefined ? ix : 0}-${randint}`;\n\n    // Add node coordinates\n    const coord = this.setNodeCoordinates(parent, ix);\n\n    // Add node level\n    const level = this.setNodeLevel(coord);\n\n    return {\n      uref,\n      placeholderRef: uref,\n      isPlaceholder: true,\n      ix,\n      parent,\n      draft,\n      coord,\n      level,\n      childrenNodes: [],\n      hasChildren,\n      hasDocNodeLenses,\n      editable: true,\n      focused: false,\n      timestamp: Date.now()\n    };\n  }\n\n  createPlaceholder(draft: any, parent?: DocNode, ix?: number): DocNode {\n    const node = this.draftToPlaceholder(draft, parent, ix);\n    /** async store */\n    this.draftService.setDraft(node.uref, node.draft);\n    return node;\n  }\n\n  setNodeDraft(node, draft) {\n    node.draft = draft;\n    /** async store */\n    this.draftService.setDraft(node.uref, draft);\n  }\n\n  /** node updated as reference */\n  async spliceChildren(\n    node: DocNode,\n    elements: any[] = [],\n    index?: number,\n    count: number = 0\n  ): Promise<DocNode[]> {\n    if (LOGINFO) this.logger.log('spliceChildren()', { node, elements, index, count });\n\n    const currentChildren = node.hasChildren.getChildrenLinks({\n      id: '',\n      object: node.draft\n    });\n    index = index !== undefined ? index : currentChildren.length;\n\n    /** create objects if elements is not an id */\n    const getNewNodes = elements.map((el, ix) => {\n      const elIndex = (index as number) + ix;\n      if (typeof el !== 'string') {\n        if (el.object !== undefined && el.entityType !== undefined) {\n          /** element is an object from which a DocNode should be create */\n          const placeholder = this.createPlaceholder(el.object, node, elIndex);\n          return Promise.resolve(placeholder);\n        } else {\n          /** element is a DocNode */\n          return Promise.resolve(el);\n        }\n      } else {\n        /** element is a string (a uref) */\n        return this.loadNodeRec(el, elIndex, node);\n      }\n    });\n\n    const newNodes = await Promise.all(getNewNodes);\n\n    let newChildren = [...currentChildren];\n    newChildren.splice(index, count, ...newNodes.map(node => node.uref));\n    const removed = node.childrenNodes.splice(index, count, ...newNodes);\n\n    /** update ix and parent of child nodes */\n    node.childrenNodes.map((child, ix) => {\n      child.ix = ix;\n      child.parent = node;\n      child.coord = node.coord.concat(ix);\n      child.level = node.level + 1;\n    });\n\n    const { object } = node.hasChildren.replaceChildrenLinks({\n      id: '',\n      object: node.draft\n    })(newChildren);\n    this.setNodeDraft(node, object);\n\n    return removed;\n  }\n\n  /** explore node children at path until the last child of the last child is find\n   * and returns the path to that element */\n  getLastChild(node: DocNode) {\n    let child = node;\n    while (child.childrenNodes.length > 0) {\n      child = child.childrenNodes[child.childrenNodes.length - 1];\n    }\n    return child;\n  }\n\n  getNextSiblingOf(node: DocNode): DocNode | undefined {\n    if (!node.parent) return undefined;\n    if (node.ix === undefined) return undefined;\n\n    if (node.ix === node.parent.childrenNodes.length - 1) {\n      /** this is the last child of its parent */\n      return undefined;\n    } else {\n      /** return the next  */\n      return node.parent.childrenNodes[node.ix + 1];\n    }\n  }\n\n  /** find the next sibling of the parent with a next sibling */\n  getNextSiblingOfLastParent(node: DocNode): DocNode | undefined {\n    let parent = node.parent;\n\n    let nextSibling = parent ? this.getNextSiblingOf(parent) : undefined;\n\n    while (parent && !nextSibling) {\n      parent = parent.parent;\n      nextSibling = parent ? this.getNextSiblingOf(parent) : undefined;\n    }\n\n    return nextSibling;\n  }\n\n  /** the tree of nodes is falttened, this gets the upper node in that flat list */\n  getDownwardNode(node: DocNode): DocNode | undefined {\n    if (node.childrenNodes.length > 0) {\n      /** downward is the first child */\n      return node.childrenNodes[0];\n    } else {\n      let nextSibling = this.getNextSiblingOf(node);\n      if (nextSibling) {\n        return nextSibling;\n      } else {\n        return this.getNextSiblingOfLastParent(node);\n      }\n    }\n  }\n\n  getBackwardNode(node: DocNode): DocNode | undefined {\n    if (node.ix === undefined) throw new Error('Node dont have an ix');\n\n    if (node.ix === 0) {\n      /** backward is the parent */\n      return node.parent;\n    } else {\n      /** backward is the last child of the upper sybling */\n      if (!node.parent) return undefined;\n      return this.getLastChild(node.parent.childrenNodes[node.ix - 1]);\n    }\n  }\n\n  async createChild(node: DocNode, newEntity: any, entityType: string, index?: number) {\n    if (LOGINFO) this.logger.log('createChild()', { node, newEntity, entityType, index });\n\n    await this.spliceChildren(node, [{ object: newEntity, entityType }], 0);\n\n    /** focus child */\n    const child = node.childrenNodes[0];\n\n    if (child.parent) {\n      child.parent.focused = false;\n    }\n    child.focused = true;\n\n    this.requestUpdate();\n  }\n\n  async createSibling(node: DocNode, newEntity: any, entityType: string) {\n    if (!node.parent) throw new Error('Node dont have a parent');\n    if (node.ix === undefined) throw new Error('Node dont have an ix');\n\n    if (LOGINFO) this.logger.log('createSibling()', { node, newEntity, entityType });\n\n    await this.spliceChildren(node.parent, [{ object: newEntity, entityType }], node.ix + 1);\n\n    /** focus sibling */\n    const sibling = node.parent.childrenNodes[node.ix + 1];\n    node.focused = false;\n    sibling.focused = true;\n\n    this.requestUpdate();\n  }\n\n  focused(node: DocNode) {\n    if (LOGINFO) this.logger.log('focused()', { node });\n    node.focused = true;\n    this.requestUpdate();\n  }\n\n  blured(node: DocNode) {\n    if (LOGINFO) this.logger.log('blured()', { node });\n    node.focused = false;\n    this.requestUpdate();\n  }\n\n  focusBackward(node: DocNode) {\n    if (LOGINFO) this.logger.log('focusBackward()', { node });\n\n    const backwardNode = this.getBackwardNode(node);\n    if (!backwardNode) return;\n\n    node.focused = false;\n    backwardNode.focused = true;\n    this.requestUpdate();\n  }\n\n  focusDownward(node: DocNode) {\n    if (LOGINFO) this.logger.log('focusDownward()', { node });\n\n    const downwardNode = this.getDownwardNode(node);\n    if (!downwardNode) return;\n\n    node.focused = false;\n    downwardNode.focused = true;\n    this.requestUpdate();\n  }\n\n  async contentChanged(node: DocNode, content: any, lift?: boolean) {\n    if (LOGINFO) this.logger.log('contentChanged()', { node, content });\n\n    const oldType = node.draft.type;\n\n    this.setNodeDraft(node, content);\n\n    /** react to type change by manipulating the tree */\n    /** PAR => TITLE */\n    if (oldType === TextType.Paragraph && content.type === TextType.Title) {\n      if (lift === undefined || lift === false) {\n        await this.nestAfter(node);\n      } else {\n        if (!node.parent) throw new Error('parent undefined');\n        await this.nestAfter(node);\n        await this.liftChildren(node.parent, node.ix, 1);\n      }\n    }\n\n    /** TITLE => PAR */\n    if (oldType === TextType.Title && content.type === TextType.Paragraph) {\n      /** remove this node children */\n      const children = await this.spliceChildren(node, [], 0, node.childrenNodes.length);\n      /** append backwards this node with its children as siblings */\n      await this.appendBackwards(node, '', [node].concat(children));\n    }\n\n    this.requestUpdate();\n  }\n\n  /** take all next syblings of node and nest them under it */\n  async nestAfter(node: DocNode) {\n    if (!node.parent) return;\n    if (node.ix === undefined) return;\n\n    const ix = node.ix;\n    const ixNext = ix + 1;\n    const deltaWithChidren = node.parent.childrenNodes\n      .slice(ixNext)\n      .findIndex(sibling => sibling.childrenNodes.length > 0);\n\n    /** remove next siblings (until the first sibling with childs is found) from parent */\n    const removed = await this.spliceChildren(\n      node.parent,\n      [],\n      ixNext,\n      deltaWithChidren !== -1 ? deltaWithChidren : node.parent.childrenNodes.length - ixNext\n    );\n\n    /** add them as child of this node */\n    await this.spliceChildren(node, removed);\n  }\n\n  async liftChildren(node: DocNode, index?: number, count?: number) {\n    if (!node.parent) throw new Error('parent undefined');\n    if (node.ix === undefined) throw new Error('ix undefined');\n\n    /** default to all children */\n    index = index !== undefined ? index : 0;\n    count = count !== undefined ? count : node.childrenNodes.length;\n\n    /** remove children */\n    const removed = await this.spliceChildren(node, [], index, count);\n\n    /** add to parent */\n    await this.spliceChildren(node.parent, removed, node.ix + 1);\n  }\n\n  /** content is appended to the node, elements are added as silblings */\n  async appendBackwards(node: DocNode, content: any, elements: DocNode[]) {\n    const backwardNode = this.getBackwardNode(node);\n    if (!backwardNode) throw new Error('backward node not found');\n\n    if (node.parent === undefined) throw new Error('cant remove node');\n    if (node.ix === undefined) throw new Error('cant remove node');\n\n    /** set the content to append to the backward node */\n    backwardNode.append = content;\n    /** remove this node */\n    await this.spliceChildren(node.parent, [], node.ix, 1);\n\n    if (elements.length > 0) {\n      if (backwardNode.parent !== undefined) {\n        if (backwardNode.ix === undefined) throw new Error('cant append elements');\n        /** add elements as siblings of backward node */\n        await this.spliceChildren(backwardNode.parent, elements, backwardNode.ix + 1);\n      } else {\n        /** add elements as children of backward node */\n        await this.spliceChildren(backwardNode, elements, 0);\n      }\n    }\n\n    backwardNode.focused = true;\n    node.focused = false;\n  }\n\n  appended(node: DocNode) {\n    node.append = undefined;\n    this.requestUpdate();\n  }\n\n  async joinBackward(node: DocNode, tail: string) {\n    if (LOGINFO) this.logger.log('joinBackward()', { node, tail });\n\n    /** remove this node children */\n    const removed = await this.spliceChildren(node, [], 0, node.childrenNodes.length);\n    await this.appendBackwards(node, tail, removed);\n\n    this.requestUpdate();\n  }\n\n  async pullDownward(node: DocNode) {\n    if (LOGINFO) this.logger.log('pullDownward()', { node });\n\n    const next = this.getDownwardNode(node);\n    if (!next) return;\n\n    await this.joinBackward(next, next.draft.text);\n    this.requestUpdate();\n  }\n\n  async lift(node: DocNode) {\n    if (!node.parent) throw new Error('parent undefined');\n    if (node.ix === undefined) throw new Error('ix undefined');\n\n    await this.liftChildren(node.parent, node.ix, 1);\n\n    this.requestUpdate();\n  }\n\n  async split(node: DocNode, tail: string, asChild: boolean) {\n    if (LOGINFO) this.logger.log('split()', { node, tail });\n\n    const dftEntity = this.defaultEntity(tail, TextType.Paragraph);\n\n    if (asChild) {\n      await this.createChild(node, dftEntity.data, dftEntity.entityType, 0);\n    } else {\n      await this.createSibling(node, dftEntity.data, dftEntity.entityType);\n    }\n\n    this.requestUpdate();\n  }\n\n  isNodeFocused() {\n    if (!this.doc) return false;\n    return this.isNodeFocusedRec(this.doc);\n  }\n\n  isNodeFocusedRec(node: DocNode): boolean {\n    if (node.focused) {\n      return true;\n    } else {\n      for (let ix = 0; ix < node.childrenNodes.length; ix++) {\n        if (this.isNodeFocusedRec(node.childrenNodes[ix])) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  getLastNode(): DocNode | undefined {\n    if (!this.doc) return undefined;\n    return this.getLastNodeRec(this.doc);\n  }\n\n  getLastNodeRec(node: DocNode): DocNode {\n    if (node.childrenNodes.length === 0) {\n      return node;\n    } else {\n      return this.getLastNodeRec(node.childrenNodes[node.childrenNodes.length - 1]);\n    }\n  }\n\n  clickAreaClicked() {\n    if (!this.isNodeFocused()) {\n      const last = this.getLastNode();\n      if (last !== undefined) {\n        last.focused = true;\n      }\n    }\n    this.requestUpdate();\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n\n    this.addEventListener('checkout-perspective', ((event: CustomEvent) => {\n      event.stopPropagation();\n      this.uref = event.detail.perspectiveId;\n    }) as EventListener);\n\n    this.addEventListener('keydown', ((event: KeyboardEvent) => {\n      if (event.ctrlKey && event.key === 's') {\n        event.preventDefault();\n        event.stopPropagation();\n        this.persistAll();\n      }\n    }) as EventListener);\n  }\n\n  commitWithMessageClicked() {\n    this.showCommitMessage = true;\n  }\n\n  cancelCommitClicked() {\n    this.showCommitMessage = false;\n  }\n\n  acceptCommitClicked() {\n    if (!this.shadowRoot) return;\n    const input = this.shadowRoot.getElementById('COMMIT_MESSAGE') as any;\n    const message = input.value;\n\n    this.showCommitMessage = false;\n\n    this.persistAll(message);\n  }\n\n  handleNodePerspectiveCheckout(e: CustomEvent, node: DocNode) {\n    if (node.coord.length === 1 && node.coord[0] === 0) {\n      /** if this is the top element, let the parent handle this */\n      return;\n    }\n\n    e.stopPropagation();\n\n    this.checkedOutPerspectives[JSON.stringify(node.coord)] = {\n      firstUref: node.uref,\n      newUref: e.detail.perspectiveId\n    };\n\n    this.requestUpdate();\n  }\n\n  handleEditorPerspectiveCheckout(e: CustomEvent, node: DocNode) {\n    // we are in the parent document editor\n\n    e.stopPropagation();\n\n    const nodeCoord = JSON.stringify(node.coord);\n\n    if (this.checkedOutPerspectives[nodeCoord] !== undefined) {\n      if (this.checkedOutPerspectives[nodeCoord].firstUref === e.detail.perspectiveId) {\n        delete this.checkedOutPerspectives[nodeCoord];\n      } else {\n        this.checkedOutPerspectives[nodeCoord].newUref = e.detail.perspectiveId;\n      }\n    }\n\n    this.requestUpdate();\n  }\n\n  dragOverEffect(e, node: DocNode) {\n    e.preventDefault();\n    e.dataTransfer.dropEffect = 'move';\n  }\n\n  async handleDrop(e, node: DocNode) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const dragged = JSON.parse(e.dataTransfer.getData('text/plain'));\n\n    if (!dragged.uref) return;\n    if (dragged.parentId === this.uref) return;\n    if (node.parent === undefined) return;\n\n    const ix = node.ix !== undefined ? node.ix : node.parent.childrenNodes.length - 1;\n    await this.spliceChildren(node.parent, [dragged.uref], ix + 1, 0);\n\n    this.requestUpdate();\n  }\n\n  getColor() {\n    return this.color ? this.color : eveeColor(this.uref);\n  }\n\n  renderWithCortex(node: DocNode) {\n    return html`\n      <cortex-entity hash=${node.uref}></cortex-entity>\n    `;\n  }\n\n  renderTopRow(node: DocNode) {\n    if (LOGINFO) this.logger.log('renderTopRow()', { node });\n    /** the uref to which the parent is pointing at */\n\n    const nodeLense = node.hasDocNodeLenses.docNodeLenses()[0];\n    const hasIcon = this.hasChanges(node);\n    const icon = node.uref === '' ? icons.add_box : icons.edit;\n\n    // for the topNode (the docId), the uref can change, for the other nodes it can't (if it does, a new editor is rendered)\n    const uref = node.coord.length === 1 && node.coord[0] === 0 ? this.uref : node.uref;\n    const firstRef = node.coord.length === 1 && node.coord[0] === 0 ? this.firstRef : node.uref;\n\n    let paddingTop = '0px';\n    if (node.draft.type === TextType.Title) {\n      switch (node.level) {\n        case 0:\n          paddingTop = '20px';\n          break;\n        case 1:\n          paddingTop = '14px';\n          break;\n        case 2:\n          paddingTop = '10px';\n          break;\n        default:\n          paddingTop = '0px';\n          break;\n      }\n    }\n\n    return html`\n      <div\n        class=\"row\"\n        @dragover=${e => this.dragOverEffect(e, node)}\n        @drop=${e => this.handleDrop(e, node)}\n      >\n        <div class=\"evee-info\" style=${`padding-top:${paddingTop}`}>\n          ${!node.isPlaceholder && this.renderInfo\n            ? html`\n                <evees-info-popper\n                  parent-id=${node.parent ? node.parent.uref : this.parentId}\n                  uref=${uref}\n                  first-uref=${firstRef}\n                  official-owner=${this.officialOwner}\n                  ?check-owner=${this.checkOwner}\n                  evee-color=${this.getColor()}\n                  @checkout-perspective=${e => this.handleNodePerspectiveCheckout(e, node)}\n                  show-draft\n                  show-info\n                  show-icon\n                  ?show-debug=${false}\n                  emit-proposals\n                ></evees-info-popper>\n              `\n            : html`\n                <div class=\"empty-evees-info\"></div>\n              `}\n        </div>\n        <div class=\"node-content\">\n          ${nodeLense.render(node, {\n            focus: () => this.focused(node),\n            blur: () => this.blured(node),\n            contentChanged: (content: any, lift: boolean) =>\n              this.contentChanged(node, content, lift),\n            focusBackward: () => this.focusBackward(node),\n            focusDownward: () => this.focusDownward(node),\n            joinBackward: (tail: string) => this.joinBackward(node, tail),\n            pullDownward: () => this.pullDownward(node),\n            lift: () => this.lift(node),\n            split: (tail: string, asChild: boolean) => this.split(node, tail, asChild),\n            appended: () => this.appended(node)\n          })}\n          ${hasIcon\n            ? html`\n                <div class=\"node-mark\">${icon}</div>\n              `\n            : ''}\n        </div>\n      </div>\n    `;\n  }\n\n  renderHere(node: DocNode) {\n    return html`\n      ${this.renderTopRow(node)}\n      ${node.childrenNodes\n        ? node.childrenNodes.map(child => {\n            return this.renderDocNode(child);\n          })\n        : ''}\n    `;\n  }\n\n  renderDocNode(node: DocNode) {\n    const coordString = JSON.stringify(node.coord);\n\n    if (this.checkedOutPerspectives[coordString] !== undefined) {\n      return html`\n        <documents-editor\n          uref=${this.checkedOutPerspectives[coordString].newUref}\n          ?read-only=${this.readOnly}\n          root-level=${node.level}\n          color=${this.getColor()}\n          @checkout-perspective=${e => this.handleEditorPerspectiveCheckout(e, node)}\n          official-owner=${this.officialOwner}\n          ?check-owner=${this.checkOwner}\n          show-draft\n          show-info\n          show-icon\n          ?show-debug=${false}\n        >\n        </documents-editor>\n      `;\n    }\n\n    return html`\n      <div\n        style=${styleMap({\n          backgroundColor: node.focused ? SELECTED_BACKGROUND : 'transparent'\n        })}\n      >\n        ${node.hasDocNodeLenses.docNodeLenses().length > 0\n          ? this.renderHere(node)\n          : this.renderWithCortex(node)}\n      </div>\n    `;\n  }\n\n  commitOptionSelected(e) {\n    switch (e.detail.key) {\n      case 'push':\n        this.persistAll();\n        break;\n\n      case 'push-with-message':\n        this.commitWithMessageClicked();\n        break;\n    }\n  }\n\n  renderTopBar() {\n    const options: MenuConfig = {\n      'push-with-message': {\n        icon: 'notes',\n        text: 'push with message'\n      }\n    };\n    return html`\n      <div class=\"doc-topbar\">\n        ${this.docHasChanges && !this.showCommitMessage\n          ? html`\n              <uprtcl-button-loading\n                icon=\"unarchive\"\n                @click=${() => this.persistAll()}\n                ?loading=${this.persistingAll}\n              >\n                push\n              </uprtcl-button-loading>\n              <uprtcl-help>\n                <span>\n                  Your current changes are safely stored on this device and won't be lost.<br /><br />\n                  \"Push\" them if<br /><br />\n                  <li>You are about to propose a merge.</li>\n                  <br />\n                  <li>\n                    This draft is public and you want them to be visible to others.\n                  </li>\n                </span>\n              </uprtcl-help>\n            `\n          : ''}\n        ${this.showCommitMessage\n          ? html`\n              <uprtcl-textfield id=\"COMMIT_MESSAGE\" label=\"Message\"> </uprtcl-textfield>\n              <uprtcl-icon-button icon=\"clear\" @click=${this.cancelCommitClicked} button>\n              </uprtcl-icon-button>\n              <uprtcl-icon-button icon=\"done\" @click=${this.acceptCommitClicked} button>\n              </uprtcl-icon-button>\n            `\n          : ''}\n      </div>\n    `;\n  }\n\n  render() {\n    if (LOGINFO) this.logger.log('render()', { doc: this.doc });\n\n    if (this.reloading || this.doc === undefined) {\n      return html`\n        <uprtcl-loading></uprtcl-loading>\n      `;\n    }\n\n    const editorClasses = ['editor-container'];\n\n    if (!this.readOnly) {\n      editorClasses.concat(['padding-bottom']);\n    }\n\n    return html`\n      <div class=${editorClasses.join(' ')}>\n        ${this.renderTopBar()} ${this.renderDocNode(this.doc)}\n      </div>\n      <div @click=${this.clickAreaClicked} class=\"click-area\"></div>\n    `;\n  }\n\n  static get styles() {\n    return css`\n      :host {\n        flex-grow: 1;\n        display: flex;\n        flex-direction: column;\n        text-align: left;\n      }\n      .editor-container {\n        position: relative;\n        width: 100%;\n      }\n      .padding-bottom {\n        padding-bottom: 20vh;\n      }\n      .click-area {\n        flex-grow: 1;\n      }\n      .doc-topbar {\n        position: absolute;\n        top: 16px;\n        right: 16px;\n        display: flex;\n        z-index: 2;\n      }\n      .doc-topbar uprtcl-button-loading {\n        opacity: 0.9;\n        margin-right: 6px;\n        width: 90px;\n      }\n\n      .row {\n        margin-bottom: 8px;\n        display: flex;\n        flex-direction: row;\n      }\n\n      .evee-info {\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n      }\n\n      .empty-evees-info {\n        width: 30px;\n        height: 10px;\n      }\n\n      .node-content {\n        flex: 1 1 0;\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n        position: relative;\n        padding-right: 4px;\n      }\n\n      .node-mark {\n        position: absolute;\n        top: 0px;\n        left: 0px;\n        height: 100%;\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n        fill: rgb(80, 80, 80, 0.2);\n      }\n\n      .node-mark svg {\n        height: 14px;\n        width: 14px;\n      }\n\n      @media (max-width: 768px) {\n        .doc-topbar {\n          display: none;\n        }\n      }\n    `;\n  }\n}\n","import { LitElement, property, html, css } from 'lit-element';\n\nimport { moduleConnect, Logger } from '@uprtcl/micro-orchestrator';\nimport { Entity } from '@uprtcl/cortex';\nimport { EveesWorkspace } from '@uprtcl/evees';\n\nimport { TextNode } from '../types';\n\nconst LOGINFO = true;\n\nexport class TextNodeDiff extends moduleConnect(LitElement) {\n  logger = new Logger('EVEES-DIFF');\n\n  @property({ type: Boolean })\n  summary: boolean = false;\n\n  @property({ attribute: false })\n  workspace!: EveesWorkspace;\n\n  @property({ attribute: false })\n  newData!: Entity<TextNode>;\n\n  @property({ attribute: false })\n  oldData!: Entity<TextNode>;\n\n  async firstUpdated() {\n    this.logger.log('firstUpdated()', {\n      newData: this.newData,\n      oldData: this.oldData\n    });\n  }\n\n  render() {\n    if (this.newData === undefined || this.oldData === undefined) {\n      return html`\n        <uprtcl-loading></uprtcl-loading>\n      `;\n    }\n\n    return html`\n      <div class=\"page-edited-title\">Updated</div>\n      <div class=\"document-container old-page\">\n        <documents-editor\n          .client=${this.workspace.workspace}\n          uref=${this.oldData.id}\n          read-only\n        ></documents-editor>\n      </div>\n      <div class=\"document-container new-page\">\n        <documents-editor\n          .client=${this.workspace.workspace}\n          uref=${this.newData.id}\n          read-only\n        ></documents-editor>\n      </div>\n    `;\n  }\n\n  static get styles() {\n    return css`\n      :host {\n        text-align: left;\n      }\n      .page-edited-title {\n        font-weight: bold;\n        margin-bottom: 9px;\n        color: gray;\n      }\n      .document-container {\n        padding: 2vw;\n        border-radius: 3px;\n        margin-bottom: 16px;\n      }\n      .editor-container {\n        border-radius: 3px;\n      }\n      .new-page {\n        background-color: #abdaab;\n      }\n      .old-page {\n        background-color: #dab6ab;\n      }\n    `;\n  }\n}\n","import { interfaces } from 'inversify';\n\nimport { PatternsModule } from '@uprtcl/cortex';\nimport { GraphQlSchemaModule } from '@uprtcl/graphql';\nimport { i18nextModule } from '@uprtcl/micro-orchestrator';\nimport { EveesContentModule } from '@uprtcl/evees';\nimport { CommonUIModule } from '@uprtcl/common-ui';\n\nimport {\n  TextNodeCommon,\n  TextNodeTitle,\n  TextNodePattern,\n} from './patterns/text-node.pattern';\nimport { documentsTypeDefs } from './graphql/schema';\n\nimport en from './i18n/en.json';\nimport { DocumentTextNodeEditor } from './elements/prosemirror/documents-text-node-editor';\nimport { DocumentsBindings } from './bindings';\nimport { DocumentEditor } from './elements/document-editor';\nimport { TextNodeDiff } from './elements/document-text-node-diff';\n\n/**\n * Configure a documents module with the given stores\n *\n * Depends on these modules being present: LensesModule, CortexModule, DiscoveryModule, i18nBaseModule\n *\n * Example usage:\n *\n * ```ts\n * import { IpfsStore } from '@uprtcl/ipfs-provider';\n * import { DocumentsModule } from '@uprtcl/documents';\n *\n * const ipfsStore = new IpfsStore({\n *   host: 'ipfs.infura.io',\n *   port: 5001,\n *   protocol: 'https'\n * });\n *\n * const docs = new DocumentsModule([ ipfsStore ]);\n * await orchestrator.loadModule(docs);\n * ```\n *\n * @param stores an array of CASStores in which the documents objects can be stored/retrieved from\n */\nexport class DocumentsModule extends EveesContentModule {\n  static id = 'documents-module';\n\n  static bindings = DocumentsBindings;\n\n  providerIdentifier = DocumentsBindings.DocumentsRemote;\n\n  async onLoad(container: interfaces.Container) {\n    super.onLoad(container);\n    customElements.define('documents-text-node-editor', DocumentTextNodeEditor);\n    customElements.define('documents-editor', DocumentEditor);\n    customElements.define('documents-text-node-diff', TextNodeDiff);\n  }\n\n  get submodules() {\n    return [\n      ...super.submodules,\n      new GraphQlSchemaModule(documentsTypeDefs, {}),\n      new i18nextModule('documents', { en: en }),\n      new PatternsModule([\n        new TextNodePattern([TextNodeCommon, TextNodeTitle]),\n      ]),\n      new CommonUIModule(),\n    ];\n  }\n}\n"],"names":["styles","nodes","emDOM","marks","cmStyle","theme"],"mappings":"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"}